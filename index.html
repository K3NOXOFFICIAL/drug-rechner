<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XTCalc Enhanced - Drug Calculator Suite</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Comprehensive drug calculator suite for harm reduction education and scientific research. Calculate dosages for MDMA, LSD, Ketamine, GHB, and more with advanced tolerance modeling and safety features.">
    <meta name="keywords" content="drug calculator, harm reduction, dosage calculator, tolerance calculator, MDMA calculator, LSD calculator, ketamine calculator, substance safety, pharmacology">
    <meta name="author" content="XTCalc Enhanced">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://your-domain.com/">
    <meta property="og:title" content="XTCalc Enhanced - Drug Calculator Suite">
    <meta property="og:description" content="🧮 Comprehensive drug calculator suite for harm reduction education and scientific research. Features advanced tolerance modeling, safety warnings, and interactive graphs for 8+ substances.">
    <meta property="og:image" content="https://your-domain.com/preview-image.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="XTCalc Enhanced">
    <meta property="og:locale" content="en_US">
    
    <!-- Twitter Card -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://your-domain.com/">
    <meta property="twitter:title" content="XTCalc Enhanced - Drug Calculator Suite">
    <meta property="twitter:description" content="🧮 Comprehensive drug calculator suite for harm reduction education and scientific research. Features advanced tolerance modeling, safety warnings, and interactive graphs for 8+ substances.">
    <meta property="twitter:image" content="https://your-domain.com/preview-image.png">
    <meta property="twitter:image:alt" content="XTCalc Enhanced - Drug Calculator Suite Interface">
    
    <!-- WhatsApp / Telegram specific -->
    <meta name="telegram:channel" content="@xtcalc">
    
    <!-- Additional Meta Tags -->
    <meta name="theme-color" content="#667eea">
    <meta name="msapplication-TileColor" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="XTCalc Enhanced">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🧮</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🧮</text></svg>">
    
    <!-- Schema.org markup for better SEO -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "XTCalc Enhanced - Drug Calculator Suite",
        "description": "Comprehensive drug calculator suite for harm reduction education and scientific research with advanced tolerance modeling and safety features.",
        "url": "https://your-domain.com/",
        "applicationCategory": "HealthApplication",
        "operatingSystem": "Any",
        "permissions": "none",
        "isAccessibleForFree": true,
        "creator": {
            "@type": "Organization",
            "name": "XTCalc Enhanced"
        },
        "audience": {
            "@type": "Audience",
            "audienceType": "Researchers, Harm Reduction Educators"
        },
        "mainEntity": {
            "@type": "Thing",
            "name": "Drug Dosage Calculator",
            "description": "Educational calculator for substance dosage and tolerance modeling"
        }
    }
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            padding: 40px 0;
        }
        
        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            background: linear-gradient(45deg, #fff, #e0e0e0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }
        
        .nav-tabs {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px;
            position: relative;
            z-index: 10000;
        }
        
        .tab-btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
        }
        
        .tab-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .tab-btn.active {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            border-color: #ff6b6b;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255,107,107,0.4);
        }
        
        .dropdown {
            position: relative;
            display: inline-block;
            z-index: 9999;
        }
        
        .dropdown-content {
            display: none;
            position: absolute;
            background: rgba(255,255,255,0.98);
            backdrop-filter: blur(15px);
            min-width: 250px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            border-radius: 15px;
            z-index: 9999;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-top: 10px;
            border: 2px solid rgba(255,255,255,0.4);
            max-height: 400px;
            overflow-y: auto;
        }
        
        .dropdown-content a {
            color: #333;
            padding: 12px 20px;
            text-decoration: none;
            display: block;
            transition: all 0.3s ease;
            border-radius: 10px;
            margin: 5px;
            font-weight: 500;
        }
        
        .dropdown-content a:hover {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            transform: translateY(-1px);
        }
        
        .dropdown-content a.active {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
        }
        
        .dropdown:hover .dropdown-content {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        .dropdown-arrow {
            margin-left: 8px;
            transition: transform 0.3s ease;
        }
        
        .dropdown:hover .dropdown-arrow {
            transform: rotate(180deg);
        }
        
        .calculator-section {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            display: none;
            animation: fadeIn 0.5s ease-in;
            position: relative;
            z-index: 1;
        }
        
        .calculator-section.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .calculator-section h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 2rem;
            text-align: center;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        
        .calculator-section p {
            color: #666;
            margin-bottom: 25px;
            text-align: center;
            font-style: italic;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .input-group {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 0.95rem;
        }
        
        .input-group input, .input-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }
        
        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
            transform: translateY(-1px);
        }
        
        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            display: block;
            margin: 20px auto;
            min-width: 200px;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(102,126,234,0.4);
        }
        
        .btn:active {
            transform: translateY(-1px);
        }
        
        .result {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            border: 2px solid #28a745;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(40,167,69,0.2);
        }
        
        .result h3 {
            color: #155724;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        .result-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #155724;
            text-align: center;
            margin: 15px 0;
        }
        
        .warning {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border: 2px solid #ffc107;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(255,193,7,0.2);
        }
        
        .warning.danger {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            border-color: #dc3545;
            box-shadow: 0 5px 15px rgba(220,53,69,0.2);
        }
        
        .warning h4 {
            color: #856404;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .warning.danger h4 {
            color: #721c24;
        }
        
        .scientific-note {
            background: #e9ecef;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            font-style: italic;
            color: #6c757d;
            border-left: 4px solid #6c757d;
        }
        
        .disclaimer {
            background: rgba(220,53,69,0.1);
            border: 2px solid #dc3545;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            color: #721c24;
        }
        
        .disclaimer h4 {
            color: #dc3545;
            margin-bottom: 15px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .disclaimer h4::before {
            content: "⚠️";
            font-size: 1.5rem;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .nav-tabs {
                flex-direction: column;
                align-items: center;
            }
            
            .tab-btn {
                width: 200px;
                text-align: center;
                margin-bottom: 10px;
            }
            
            .dropdown {
                width: 100%;
            }
            
            .dropdown-content {
                position: static;
                display: none;
                transform: none;
                margin-top: 0;
                width: 100%;
                box-shadow: inset 0 2px 10px rgba(0,0,0,0.1);
                background: rgba(255,255,255,0.9);
            }
            
            .dropdown:hover .dropdown-content {
                display: block;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .calculator-section {
                padding: 20px;
            }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        .tooltip {
            position: relative;
            cursor: help;
        }
        
        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .tooltip:hover::after {
            opacity: 1;
            visibility: visible;
        }
        
        .graph-container {
            background: rgba(255,255,255,0.9);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid rgba(102,126,234,0.3);
        }
        
        .graph-wrapper {
            display: flex;
            justify-content: center;
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.1);
        }
        
        #tolerance-graph {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
        }
        
        .graph-legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: #333;
        }
        
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
            display: inline-block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>K3NOX Drug Calc</h1>
            <p>Your comprehensive drug dose calculator suite</p>
        </div>

        <div class="disclaimer">
            <h4>For Scientific/Educational Purposes Only</h4>
            <p>This calculator is designed for harm reduction education and scientific research purposes. Always consult medical professionals and follow local laws. Individual responses vary significantly, and these calculations are theoretical models based on general guidelines.</p>
        </div>

        <div class="nav-tabs">
            <button class="tab-btn active" onclick="showCalculator('liquid')">💧 Liquid Dosage</button>
            
            <div class="dropdown">
                <button class="tab-btn" id="dose-calc-btn">💊 Dose Calculator <span class="dropdown-arrow">▼</span></button>
                <div class="dropdown-content">
                    <a href="#" onclick="showCalculator('mdma'); return false;">💊 MDMA</a>
                    <a href="#" onclick="showCalculator('lsd'); return false;">🌈 LSD</a>
                    <a href="#" onclick="showCalculator('ketamine'); return false;">🧠 Ketamine</a>
                    <a href="#" onclick="showCalculator('ghb'); return false;">🥤 GHB/GBL</a>
                    <a href="#" onclick="showCalculator('amphetamines'); return false;">⚡ Amphetamines</a>
                    <a href="#" onclick="showCalculator('cocaine'); return false;">❄️ Cocaine</a>
                    <a href="#" onclick="showCalculator('4mmc'); return false;">🔥 4-MMC</a>
                </div>
            </div>
            
            <button class="tab-btn" onclick="showCalculator('tolerance')">⚖️ General Tolerance</button>
        </div>

        <!-- Liquid Dosage Calculator -->
        <div id="liquid" class="calculator-section active">
            <h2>� Liquid Dosage Calculator</h2>
            <p>Calculate the amount of medication in a specific volume of liquid</p>

            <div class="form-grid">
                <div class="input-group">
                    <label for="total-volume">Total liquid volume (ml):</label>
                    <input type="number" id="total-volume" placeholder="e.g., 28" step="0.1">
                </div>

                <div class="input-group">
                    <label for="total-medication">Total medication (g):</label>
                    <input type="number" id="total-medication" placeholder="e.g., 4" step="0.01">
                </div>

                <div class="input-group">
                    <label for="drug-purity" class="tooltip" data-tooltip="Purity percentage of the substance">Drug Purity (%):</label>
                    <input type="number" id="drug-purity" value="100" placeholder="e.g., 97" min="0" max="100">
                </div>

                <div class="input-group">
                    <label for="target-volume">Target volume (ml):</label>
                    <input type="number" id="target-volume" value="0.1" placeholder="e.g., 0.1" step="0.01">
                </div>
            </div>

            <button class="btn" onclick="calculateLiquidDose()">Calculate Liquid Dose</button>

            <div id="liquid-result" class="result" style="display: none;">
                <h3>Result:</h3>
                <div class="result-value" id="liquid-result-value"></div>
            </div>
        </div>

        <!-- MDMA Calculator -->
        <div id="mdma" class="calculator-section">
            <h2>💊 MDMA Dose Calculator</h2>
            <p>Calculate MDMA dosage based on body weight and desired intensity</p>

            <div class="form-grid">
                <div class="input-group">
                    <label for="mdma-weight">Body Weight (kg):</label>
                    <input type="number" id="mdma-weight" placeholder="e.g., 70" min="40" max="150">
                </div>

                <div class="input-group">
                    <label for="mdma-gender">Gender:</label>
                    <select id="mdma-gender">
                        <option value="">Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="mdma-experience" class="tooltip" data-tooltip="Your experience level with MDMA">Experience Level:</label>
                    <select id="mdma-experience">
                        <option value="">Select Experience</option>
                        <option value="beginner">Beginner</option>
                        <option value="experienced">Experienced</option>
                        <option value="expert">Expert</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="mdma-intensity">Desired Intensity:</label>
                    <select id="mdma-intensity">
                        <option value="">Select Intensity</option>
                        <option value="threshold">Threshold (mild)</option>
                        <option value="light">Light</option>
                        <option value="common">Common</option>
                        <option value="strong">Strong</option>
                    </select>
                </div>
            </div>

            <button class="btn" onclick="calculateMDMA()">Calculate MDMA Dose</button>

            <div id="mdma-result" class="result" style="display: none;">
                <h3>Recommended MDMA Dose:</h3>
                <div class="result-value" id="mdma-result-value"></div>
                <div id="mdma-details"></div>
            </div>
        </div>

        <!-- LSD Calculator -->
        <div id="lsd" class="calculator-section">
            <h2>🌈 LSD Dose Calculator</h2>
            <p>Calculate LSD dosage based on body weight, gender, and desired intensity</p>

            <div class="form-grid">
                <div class="input-group">
                    <label for="lsd-weight">Body Weight (kg):</label>
                    <input type="number" id="lsd-weight" placeholder="e.g., 70" min="40" max="150">
                </div>

                <div class="input-group">
                    <label for="lsd-gender">Gender:</label>
                    <select id="lsd-gender">
                        <option value="">Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="lsd-experience">Experience Level:</label>
                    <select id="lsd-experience">
                        <option value="">Select Experience</option>
                        <option value="beginner">Beginner</option>
                        <option value="experienced">Experienced</option>
                        <option value="expert">Expert</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="lsd-intensity">Desired Intensity:</label>
                    <select id="lsd-intensity">
                        <option value="">Select Intensity</option>
                        <option value="microdose">Microdose</option>
                        <option value="threshold">Threshold</option>
                        <option value="light">Light</option>
                        <option value="common">Common</option>
                        <option value="strong">Strong</option>
                        <option value="heavy">Heavy</option>
                    </select>
                </div>
            </div>

            <button class="btn" onclick="calculateLSD()">Calculate LSD Dose</button>

            <div id="lsd-result" class="result" style="display: none;">
                <h3>Recommended LSD Dose:</h3>
                <div class="result-value" id="lsd-result-value"></div>
                <div id="lsd-details"></div>
            </div>
        </div>

        <!-- Ketamine Calculator (Enhanced) -->
        <div id="ketamine" class="calculator-section">
            <h2>🧠 Ketamine Tolerance Calculator</h2>
            <p>Calculate adjusted dosage based on previous ketamine use and tolerance buildup</p>

            <div class="form-grid">
                <div class="input-group">
                    <label for="ket-weight">Body Weight (kg):</label>
                    <input type="number" id="ket-weight" placeholder="e.g., 70" min="40" max="150">
                </div>

                <div class="input-group">
                    <label for="ket-previous-dose">Previous dose (mg):</label>
                    <input type="number" id="ket-previous-dose" placeholder="e.g., 100">
                </div>

                <div class="input-group">
                    <label for="ket-days-ago">Days since last dose:</label>
                    <input type="number" id="ket-days-ago" placeholder="e.g., 4" min="0">
                </div>

                <div class="input-group">
                    <label for="ket-desired-effect" class="tooltip" data-tooltip="1=threshold, 10=maximum safe intensity">Desired effect intensity (1-10):</label>
                    <input type="number" id="ket-desired-effect" min="1" max="10" value="7" placeholder="7">
                </div>
            </div>

            <button class="btn" onclick="calculateKetamineTolerance()">Calculate Ketamine Dose</button>

            <div id="ketamine-result" class="result" style="display: none;">
                <h3>Recommended Ketamine Dose:</h3>
                <div class="result-value" id="ket-result-value"></div>
                <div id="ket-details"></div>
                <div class="scientific-note">
                    Based on ketamine's tolerance half-life of approximately 3-5 days and NMDA receptor downregulation patterns.
                </div>
            </div>
        </div>

        <!-- GHB/GBL Calculator -->
        <div id="ghb" class="calculator-section">
            <h2>🥤 GHB/GBL Dose Calculator</h2>
            <p>Calculate GHB or GBL dosage based on body weight and substance type</p>

            <div class="form-grid">
                <div class="input-group">
                    <label for="ghb-weight">Body Weight (kg):</label>
                    <input type="number" id="ghb-weight" placeholder="e.g., 70" min="40" max="150">
                </div>

                <div class="input-group">
                    <label for="ghb-gender">Gender:</label>
                    <select id="ghb-gender">
                        <option value="">Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="ghb-substance">Substance:</label>
                    <select id="ghb-substance">
                        <option value="">Select Substance</option>
                        <option value="ghb">GHB (Sodium γ-hydroxybutyrate)</option>
                        <option value="gbl">GBL (γ-butyrolactone)</option>
                        <option value="bdo">1,4-BDO (1,4-butanediol)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="ghb-intensity">Desired Intensity:</label>
                    <select id="ghb-intensity">
                        <option value="">Select Intensity</option>
                        <option value="threshold">Threshold</option>
                        <option value="light">Light</option>
                        <option value="common">Common</option>
                        <option value="strong">Strong</option>
                    </select>
                </div>
            </div>

            <button class="btn" onclick="calculateGHB()">Calculate GHB/GBL Dose</button>

            <div id="ghb-result" class="result" style="display: none;">
                <h3>Recommended Dose:</h3>
                <div class="result-value" id="ghb-result-value"></div>
                <div id="ghb-details"></div>
            </div>
        </div>

        <!-- Amphetamines Calculator -->
        <div id="amphetamines" class="calculator-section">
            <h2>⚡ Amphetamines Dose Calculator</h2>
            <p>Calculate amphetamine dosage based on body weight and substance type</p>

            <div class="form-grid">
                <div class="input-group">
                    <label for="amp-weight">Body Weight (kg):</label>
                    <input type="number" id="amp-weight" placeholder="e.g., 70" min="40" max="150">
                </div>

                <div class="input-group">
                    <label for="amp-gender">Gender:</label>
                    <select id="amp-gender">
                        <option value="">Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="amp-substance">Substance Type:</label>
                    <select id="amp-substance">
                        <option value="">Select Substance</option>
                        <option value="amphetamine">Amphetamine (racemic)</option>
                        <option value="dextroamphetamine">Dextroamphetamine</option>
                        <option value="methamphetamine">Methamphetamine</option>
                        <option value="adderall">Adderall (mixed salts)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="amp-intensity">Desired Intensity:</label>
                    <select id="amp-intensity">
                        <option value="">Select Intensity</option>
                        <option value="threshold">Threshold</option>
                        <option value="light">Light</option>
                        <option value="common">Common</option>
                        <option value="strong">Strong</option>
                    </select>
                </div>
            </div>

            <button class="btn" onclick="calculateAmphetamines()">Calculate Amphetamine Dose</button>

            <div id="amp-result" class="result" style="display: none;">
                <h3>Recommended Dose:</h3>
                <div class="result-value" id="amp-result-value"></div>
                <div id="amp-details"></div>
            </div>
        </div>

        <!-- Cocaine Calculator -->
        <div id="cocaine" class="calculator-section">
            <h2>❄️ Cocaine Dose Calculator</h2>
            <p>Calculate cocaine dosage based on body weight and route of administration</p>

            <div class="form-grid">
                <div class="input-group">
                    <label for="coc-weight">Body Weight (kg):</label>
                    <input type="number" id="coc-weight" placeholder="e.g., 70" min="40" max="150">
                </div>

                <div class="input-group">
                    <label for="coc-gender">Gender:</label>
                    <select id="coc-gender">
                        <option value="">Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="coc-route">Route of Administration:</label>
                    <select id="coc-route">
                        <option value="">Select Route</option>
                        <option value="nasal">Nasal (snorted)</option>
                        <option value="oral">Oral</option>
                        <option value="iv">Intravenous (IV)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="coc-intensity">Desired Intensity:</label>
                    <select id="coc-intensity">
                        <option value="">Select Intensity</option>
                        <option value="threshold">Threshold</option>
                        <option value="light">Light</option>
                        <option value="common">Common</option>
                        <option value="strong">Strong</option>
                    </select>
                </div>
            </div>

            <button class="btn" onclick="calculateCocaine()">Calculate Cocaine Dose</button>

            <div id="coc-result" class="result" style="display: none;">
                <h3>Recommended Dose:</h3>
                <div class="result-value" id="coc-result-value"></div>
                <div id="coc-details"></div>
            </div>
        </div>

        <!-- 4-MMC Calculator (Enhanced) -->
        <div id="4mmc" class="calculator-section">
            <h2>🔥 4-MMC Tolerance Calculator</h2>
            <p>Calculate adjusted 4-MMC dosage based on previous use and tolerance buildup</p>

            <div class="form-grid">
                <div class="input-group">
                    <label for="mmc-weight">Body Weight (kg):</label>
                    <input type="number" id="mmc-weight" placeholder="e.g., 70" min="40" max="150">
                </div>

                <div class="input-group">
                    <label for="mmc-previous-dose">Previous dose (mg):</label>
                    <input type="number" id="mmc-previous-dose" placeholder="e.g., 150">
                </div>

                <div class="input-group">
                    <label for="mmc-days-ago">Days since last dose:</label>
                    <input type="number" id="mmc-days-ago" placeholder="e.g., 4" min="0">
                </div>

                <div class="input-group">
                    <label for="mmc-desired-effect" class="tooltip" data-tooltip="1=threshold, 10=maximum safe intensity">Desired effect intensity (1-10):</label>
                    <input type="number" id="mmc-desired-effect" min="1" max="10" value="7" placeholder="7">
                </div>
            </div>

            <button class="btn" onclick="calculate4MMCTolerance()">Calculate 4-MMC Dose</button>

            <div id="mmc-result" class="result" style="display: none;">
                <h3>Recommended 4-MMC Dose:</h3>
                <div class="result-value" id="mmc-result-value"></div>
                <div id="mmc-details"></div>
                <div class="scientific-note">
                    Based on 4-MMC's tolerance half-life of approximately 7-14 days and serotonin/dopamine receptor recovery patterns.
                </div>
            </div>
        </div>

        <!-- General Tolerance Calculator -->
        <div id="tolerance" class="calculator-section">
            <h2>⚖️ General Tolerance Calculator</h2>
            <p>Calculate how much you need to take for the same effect based on previous dose and time elapsed</p>

            <div class="form-grid">
                <div class="input-group">
                    <label for="tol-substance" class="tooltip" data-tooltip="Different substances have different tolerance patterns">Substance Type:</label>
                    <select id="tol-substance">
                        <option value="">Select Substance</option>
                        
                        <!-- Psychedelics -->
                        <option value="lsd">LSD (Lysergic Acid Diethylamide)</option>
                        <option value="psilocybin">Psilocybin (Magic Mushrooms)</option>
                        <option value="dmt">DMT (N,N-Dimethyltryptamine)</option>
                        <option value="2cb">2C-B</option>
                        <option value="mescaline">Mescaline</option>
                        
                        <!-- Entactogens -->
                        <option value="mdma">MDMA (Ecstasy/Molly)</option>
                        <option value="mda">MDA (Methylenedioxyamphetamine)</option>
                        <option value="4mmc">4-MMC (Mephedrone)</option>
                        <option value="6apb">6-APB</option>
                        
                        <!-- Stimulants -->
                        <option value="amphetamine">Amphetamine (Speed)</option>
                        <option value="dextroamphetamine">Dextroamphetamine (Dexedrine)</option>
                        <option value="methamphetamine">Methamphetamine (Crystal)</option>
                        <option value="cocaine">Cocaine</option>
                        <option value="caffeine">Caffeine</option>
                        <option value="modafinil">Modafinil</option>
                        
                        <!-- Dissociatives -->
                        <option value="ketamine">Ketamine</option>
                        <option value="dxm">DXM (Dextromethorphan)</option>
                        <option value="pcp">PCP</option>
                        <option value="3meopcp">3-MeO-PCP</option>
                        
                        <!-- Depressants -->
                        <option value="ghb">GHB (γ-Hydroxybutyric acid)</option>
                        <option value="gbl">GBL (γ-Butyrolactone)</option>
                        <option value="phenibut">Phenibut</option>
                        <option value="alcohol">Alcohol (Ethanol)</option>
                        <option value="xanax">Xanax (Alprazolam)</option>
                        <option value="valium">Valium (Diazepam)</option>
                        
                        <!-- Opioids -->
                        <option value="morphine">Morphine</option>
                        <option value="oxycodone">Oxycodone</option>
                        <option value="tramadol">Tramadol</option>
                        <option value="kratom">Kratom</option>
                        
                        <!-- Cannabis -->
                        <option value="thc">THC (Cannabis)</option>
                        <option value="cbd">CBD</option>
                        
                        <!-- Other -->
                        <option value="nitrous">Nitrous Oxide (N2O)</option>
                        <option value="custom">Custom (specify half-life)</option>
                    </select>
                </div>

                <div class="input-group" id="custom-halflife-group" style="display: none;">
                    <label for="tol-custom-halflife" class="tooltip" data-tooltip="Tolerance half-life in days - how long it takes for tolerance to reduce by 50%">Custom Tolerance Half-life (days):</label>
                    <input type="number" id="tol-custom-halflife" placeholder="e.g., 3" min="0.1" step="0.1">
                </div>

                <div class="input-group">
                    <label for="tol-previous-dose">Previous Dose:</label>
                    <input type="number" id="tol-previous-dose" placeholder="e.g., 100" step="0.1">
                </div>

                <div class="input-group">
                    <label for="tol-dose-unit">Dose Unit:</label>
                    <select id="tol-dose-unit">
                        <option value="mg">mg (milligrams)</option>
                        <option value="μg">μg (micrograms)</option>
                        <option value="g">g (grams)</option>
                        <option value="ml">ml (milliliters)</option>
                        <option value="tabs">tabs/hits</option>
                        <option value="custom">custom unit</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="tol-days-ago">Days Since Last Dose:</label>
                    <input type="number" id="tol-days-ago" placeholder="e.g., 4" min="0" step="0.1">
                </div>

                <div class="input-group">
                    <label for="tol-target-effect" class="tooltip" data-tooltip="What effect level are you aiming for?">Target Effect Level:</label>
                    <select id="tol-target-effect">
                        <option value="same">Same as previous dose</option>
                        <option value="stronger">Stronger than previous</option>
                        <option value="weaker">Weaker than previous</option>
                        <option value="baseline">Baseline (no tolerance)</option>
                    </select>
                </div>

                <div class="input-group" id="effect-multiplier-group" style="display: none;">
                    <label for="tol-effect-multiplier" class="tooltip" data-tooltip="How much stronger/weaker? 1.5 = 50% stronger, 0.7 = 30% weaker">Effect Multiplier:</label>
                    <input type="number" id="tol-effect-multiplier" placeholder="e.g., 1.5" min="0.1" max="3" step="0.1" value="1">
                </div>
            </div>

            <button class="btn" onclick="calculateGeneralTolerance()">Calculate Required Dose</button>

            <div id="tolerance-result" class="result" style="display: none;">
                <h3>Recommended Dose for Same Effect:</h3>
                <div class="result-value" id="tolerance-result-value"></div>
                <div id="tolerance-details"></div>
                
                <!-- Tolerance Recovery Graph -->
                <div class="graph-container" id="tolerance-graph-container" style="margin-top: 25px;">
                    <h4 style="text-align: center; color: #155724; margin-bottom: 15px;">📊 Tolerance Recovery Over Time</h4>
                    <div class="graph-wrapper">
                        <canvas id="tolerance-graph" width="600" height="300"></canvas>
                    </div>
                    <div class="graph-legend">
                        <div class="legend-item">
                            <span class="legend-color" style="background: #667eea;"></span>
                            <span>Tolerance Level (%)</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color" style="background: #ff6b6b;"></span>
                            <span>Current Day</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Navigation functionality
        function showCalculator(calculatorId) {
            // Hide all calculators
            const sections = document.querySelectorAll('.calculator-section');
            sections.forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all main tabs
            const tabs = document.querySelectorAll('.tab-btn');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all dropdown items
            const dropdownItems = document.querySelectorAll('.dropdown-content a');
            dropdownItems.forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected calculator
            document.getElementById(calculatorId).classList.add('active');
            
            // Set active states based on calculator type
            const doseCalculators = ['mdma', 'lsd', 'ketamine', 'ghb', 'amphetamines', 'cocaine', '4mmc'];
            
            if (calculatorId === 'liquid') {
                // Activate liquid dosage tab
                document.querySelector('button[onclick="showCalculator(\'liquid\')"]').classList.add('active');
            } else if (calculatorId === 'tolerance') {
                // Activate general tolerance tab
                document.querySelector('button[onclick="showCalculator(\'tolerance\')"]').classList.add('active');
            } else if (doseCalculators.includes(calculatorId)) {
                // Activate dose calculator dropdown button
                document.getElementById('dose-calc-btn').classList.add('active');
                // Also activate the specific dropdown item
                const dropdownItem = document.querySelector(`a[onclick="showCalculator('${calculatorId}'); return false;"]`);
                if (dropdownItem) {
                    dropdownItem.classList.add('active');
                }
            }
        }

        // Utility functions
        function showWarning(message, type = 'warning') {
            const warningClass = type === 'danger' ? 'warning danger' : 'warning';
            return `<div class="${warningClass}"><h4>${type === 'danger' ? '⚠️ Danger' : '⚠️ Warning'}</h4><p>${message}</p></div>`;
        }

        function validateWeight(weight) {
            return weight >= 40 && weight <= 150;
        }

        function getGenderMultiplier(gender, substance) {
            const multipliers = {
                'mdma': { male: 1.0, female: 0.85 },
                'lsd': { male: 1.0, female: 0.9 },
                'ghb': { male: 1.0, female: 0.8 },
                'amphetamines': { male: 1.0, female: 0.85 },
                'cocaine': { male: 1.0, female: 0.85 }
            };
            return multipliers[substance] ? multipliers[substance][gender] || 1.0 : 1.0;
        }

        // Enhanced liquid dosage calculator
        function calculateLiquidDose() {
            const totalVolume = parseFloat(document.getElementById('total-volume').value);
            const totalMedication = parseFloat(document.getElementById('total-medication').value);
            const drugPurity = parseFloat(document.getElementById('drug-purity').value);
            const targetVolume = parseFloat(document.getElementById('target-volume').value);
            const resultValue = document.getElementById('liquid-result-value');
            const resultDiv = document.getElementById('liquid-result');

            if (isNaN(totalVolume) || isNaN(totalMedication) || isNaN(targetVolume) || isNaN(drugPurity) || 
                totalVolume <= 0 || drugPurity < 0 || drugPurity > 100) {
                resultValue.innerHTML = 'Please enter valid numbers. Total volume must be > 0. Purity must be between 0 and 100.';
                resultDiv.style.display = 'block';
                return;
            }

            const result = (totalMedication * 1000) / totalVolume * targetVolume * (drugPurity / 100);
            resultValue.innerHTML = `${result.toFixed(2)} mg`;
            resultDiv.style.display = 'block';
        }

        // MDMA calculator
        function calculateMDMA() {
            const weight = parseFloat(document.getElementById('mdma-weight').value);
            const gender = document.getElementById('mdma-gender').value;
            const experience = document.getElementById('mdma-experience').value;
            const intensity = document.getElementById('mdma-intensity').value;
            const resultValue = document.getElementById('mdma-result-value');
            const resultDetails = document.getElementById('mdma-details');
            const resultDiv = document.getElementById('mdma-result');

            if (!validateWeight(weight) || !gender || !experience || !intensity) {
                resultValue.innerHTML = 'Please fill in all fields with valid values.';
                resultDetails.innerHTML = '';
                resultDiv.style.display = 'block';
                return;
            }

            const intensityDoses = {
                'threshold': { base: 0.8, max: 1.0 },
                'light': { base: 1.0, max: 1.3 },
                'common': { base: 1.3, max: 1.7 },
                'strong': { base: 1.7, max: 2.5 }
            };

            const experienceMultiplier = {
                'beginner': 0.8,
                'experienced': 1.0,
                'expert': 1.1
            };

            const genderMultiplier = getGenderMultiplier(gender, 'mdma');
            const baseDose = weight * intensityDoses[intensity].base * genderMultiplier * experienceMultiplier[experience];
            const maxDose = weight * intensityDoses[intensity].max * genderMultiplier * experienceMultiplier[experience];

            // Safety caps
            const absoluteMax = Math.min(200, weight * 2.5);
            const safeDose = Math.min(baseDose, absoluteMax);
            const safeMaxDose = Math.min(maxDose, absoluteMax);

            let warnings = '';
            if (safeDose > 150) {
                warnings += showWarning('High dose - exercise extreme caution! Consider reducing dose.', 'danger');
            } else if (safeDose > 120) {
                warnings += showWarning('Moderate-high dose - be careful and stay hydrated.');
            }

            if (experience === 'beginner' && intensity === 'strong') {
                warnings += showWarning('Strong doses not recommended for beginners. Consider starting with a lower intensity.');
            }

            resultValue.innerHTML = `${Math.round(safeDose)} - ${Math.round(safeMaxDose)} mg`;
            resultDetails.innerHTML = `
                <p><strong>Initial dose:</strong> ${Math.round(safeDose)} mg</p>
                <p><strong>Optional redose:</strong> ${Math.round(safeDose * 0.5)} mg (after 1.5-2 hours)</p>
                <p><strong>Total session:</strong> ≤ ${Math.round(safeMaxDose)} mg</p>
                <div class="scientific-note">
                    <strong>Safety Guidelines:</strong><br>
                    • Wait at least 3 months between uses<br>
                    • Stay hydrated but don't overdrink<br>
                    • Test your substance with reagents<br>
                    • Have a trusted sober friend present
                </div>
                ${warnings}
            `;
            resultDiv.style.display = 'block';
        }

        // LSD calculator
        function calculateLSD() {
            const weight = parseFloat(document.getElementById('lsd-weight').value);
            const gender = document.getElementById('lsd-gender').value;
            const experience = document.getElementById('lsd-experience').value;
            const intensity = document.getElementById('lsd-intensity').value;
            const resultValue = document.getElementById('lsd-result-value');
            const resultDetails = document.getElementById('lsd-details');
            const resultDiv = document.getElementById('lsd-result');

            if (!validateWeight(weight) || !gender || !experience || !intensity) {
                resultValue.innerHTML = 'Please fill in all fields with valid values.';
                resultDetails.innerHTML = '';
                resultDiv.style.display = 'block';
                return;
            }

            const intensityDoses = {
                'microdose': { dose: 10 },
                'threshold': { dose: 25 },
                'light': { dose: 50 },
                'common': { dose: 100 },
                'strong': { dose: 200 },
                'heavy': { dose: 300 }
            };

            const experienceMultiplier = {
                'beginner': 0.7,
                'experienced': 1.0,
                'expert': 1.2
            };

            const genderMultiplier = getGenderMultiplier(gender, 'lsd');
            let dose = intensityDoses[intensity].dose * genderMultiplier * experienceMultiplier[experience];

            // Weight adjustment for LSD (minimal effect)
            const weightFactor = weight / 70; // 70kg reference
            dose *= Math.pow(weightFactor, 0.3); // Weak weight dependence

            let warnings = '';
            if (dose > 250) {
                warnings += showWarning('Very high dose - serious psychological risks!', 'danger');
            } else if (dose > 150) {
                warnings += showWarning('High dose - ensure safe environment and experienced trip sitter.');
            }

            if (experience === 'beginner' && ['strong', 'heavy'].includes(intensity)) {
                warnings += showWarning('High doses not recommended for beginners. Start with threshold or light doses.');
            }

            const duration = intensity === 'microdose' ? '4-6 hours' : 
                           ['threshold', 'light'].includes(intensity) ? '8-10 hours' : '10-12 hours';

            resultValue.innerHTML = `${Math.round(dose)} µg`;
            resultDetails.innerHTML = `
                <p><strong>Expected duration:</strong> ${duration}</p>
                <p><strong>Onset:</strong> 30-90 minutes</p>
                <p><strong>Peak:</strong> 2-4 hours after onset</p>
                <div class="scientific-note">
                    <strong>Safety Guidelines:</strong><br>
                    • Use only in a safe, comfortable environment<br>
                    • Have a trusted, sober trip sitter present<br>
                    • Avoid mixing with other substances<br>
                    • Wait at least 2 weeks between uses for tolerance reset
                </div>
                ${warnings}
            `;
            resultDiv.style.display = 'block';
        }

        // Enhanced ketamine tolerance calculator
        function calculateKetamineTolerance() {
            const weight = parseFloat(document.getElementById('ket-weight').value);
            const previousDose = parseFloat(document.getElementById('ket-previous-dose').value);
            const daysAgo = parseFloat(document.getElementById('ket-days-ago').value);
            const desiredEffect = parseFloat(document.getElementById('ket-desired-effect').value);
            const resultValue = document.getElementById('ket-result-value');
            const resultDetails = document.getElementById('ket-details');
            const resultDiv = document.getElementById('ketamine-result');

            if (!validateWeight(weight) || isNaN(previousDose) || isNaN(daysAgo) || isNaN(desiredEffect) || 
                previousDose <= 0 || daysAgo < 0 || desiredEffect < 1 || desiredEffect > 10) {
                resultValue.innerHTML = 'Please enter valid numbers. Previous dose > 0, days ≥ 0, effect intensity 1-10.';
                resultDetails.innerHTML = '';
                resultDiv.style.display = 'block';
                return;
            }

            const toleranceHalfLife = 4; // days
            const baselineDose = weight * 1.0; // 1mg/kg baseline
            
            // Calculate remaining tolerance
            const toleranceDecay = Math.pow(0.5, daysAgo / toleranceHalfLife);
            const remainingTolerance = toleranceDecay;
            
            // Cross-tolerance factor
            const crossToleranceFactor = Math.log(previousDose / baselineDose + 1) * 0.3;
            const totalTolerance = remainingTolerance * (1 + crossToleranceFactor);
            
            // Effect scaling
            const effectMultiplier = Math.pow(desiredEffect / 7, 1.5);
            
            // Calculate dose
            let recommendedDose = baselineDose * effectMultiplier * (1 + totalTolerance);
            
            // Safety caps
            const maxRecommendedDose = Math.min(previousDose * 2.5, weight * 4);
            if (recommendedDose > maxRecommendedDose) {
                recommendedDose = maxRecommendedDose;
            }

            let warnings = '';
            if (recommendedDose > weight * 3) {
                warnings += showWarning('Very high dose relative to body weight!', 'danger');
            } else if (recommendedDose > weight * 2.5) {
                warnings += showWarning('High dose - exercise extreme caution!');
            }

            resultValue.innerHTML = `${Math.round(recommendedDose)} mg`;
            resultDetails.innerHTML = `
                <p><strong>Tolerance factor:</strong> ${(totalTolerance * 100).toFixed(1)}% remaining</p>
                <p><strong>Recovery rate:</strong> ${((1 - remainingTolerance) * 100).toFixed(1)}% recovered</p>
                <p><strong>Dose per kg:</strong> ${(recommendedDose / weight).toFixed(1)} mg/kg</p>
                <div class="scientific-note">
                    <strong>Route Guidelines:</strong><br>
                    • Oral: Full dose, 45-90 min onset<br>
                    • Nasal: 70% of dose, 10-20 min onset<br>
                    • IM: 60% of dose, 5-15 min onset
                </div>
                ${warnings}
            `;
            resultDiv.style.display = 'block';
        }

        // GHB/GBL calculator
        function calculateGHB() {
            const weight = parseFloat(document.getElementById('ghb-weight').value);
            const gender = document.getElementById('ghb-gender').value;
            const substance = document.getElementById('ghb-substance').value;
            const intensity = document.getElementById('ghb-intensity').value;
            const resultValue = document.getElementById('ghb-result-value');
            const resultDetails = document.getElementById('ghb-details');
            const resultDiv = document.getElementById('ghb-result');

            if (!validateWeight(weight) || !gender || !substance || !intensity) {
                resultValue.innerHTML = 'Please fill in all fields with valid values.';
                resultDetails.innerHTML = '';
                resultDiv.style.display = 'block';
                return;
            }

            const intensityMultipliers = {
                'threshold': 15,
                'light': 25,
                'common': 35,
                'strong': 50
            };

            const substanceMultipliers = {
                'ghb': 1.0,
                'gbl': 0.7,  // GBL is more potent
                'bdo': 1.2   // BDO is less potent
            };

            const genderMultiplier = getGenderMultiplier(gender, 'ghb');
            let dose = (weight / 70) * intensityMultipliers[intensity] * genderMultiplier * substanceMultipliers[substance];

            // Convert to ml for liquid substances
            const density = substance === 'ghb' ? 1.0 : 1.1; // Approximate densities
            const volumeMl = dose / density / 1000; // Convert mg to ml

            let warnings = '';
            if (dose > 60) {
                warnings += showWarning('Very high dose - serious risk of unconsciousness and respiratory depression!', 'danger');
            } else if (dose > 45) {
                warnings += showWarning('High dose - significant risk of loss of consciousness!', 'danger');
            }

            warnings += showWarning('Never mix with alcohol or other depressants - potentially fatal combination!', 'danger');

            const unit = substance === 'ghb' ? 'mg' : 'ml';
            const displayValue = substance === 'ghb' ? Math.round(dose) : volumeMl.toFixed(2);

            resultValue.innerHTML = `${displayValue} ${unit}`;
            resultDetails.innerHTML = `
                <p><strong>Onset:</strong> 15-45 minutes</p>
                <p><strong>Duration:</strong> 2-4 hours</p>
                <p><strong>Peak:</strong> 1-2 hours</p>
                <div class="scientific-note">
                    <strong>Critical Safety Information:</strong><br>
                    • NEVER mix with alcohol or other depressants<br>
                    • Wait at least 2-3 hours between doses<br>
                    • Have a sober person monitor you<br>
                    • Keep emergency contacts ready<br>
                    • The margin between active and dangerous dose is very small
                </div>
                ${warnings}
            `;
            resultDiv.style.display = 'block';
        }

        // Amphetamines calculator
        function calculateAmphetamines() {
            const weight = parseFloat(document.getElementById('amp-weight').value);
            const gender = document.getElementById('amp-gender').value;
            const substance = document.getElementById('amp-substance').value;
            const intensity = document.getElementById('amp-intensity').value;
            const resultValue = document.getElementById('amp-result-value');
            const resultDetails = document.getElementById('amp-details');
            const resultDiv = document.getElementById('amp-result');

            if (!validateWeight(weight) || !gender || !substance || !intensity) {
                resultValue.innerHTML = 'Please fill in all fields with valid values.';
                resultDetails.innerHTML = '';
                resultDiv.style.display = 'block';
                return;
            }

            const intensityMultipliers = {
                'threshold': 0.15,
                'light': 0.3,
                'common': 0.5,
                'strong': 0.8
            };

            const substanceMultipliers = {
                'amphetamine': 1.0,
                'dextroamphetamine': 0.7,
                'methamphetamine': 0.4,
                'adderall': 0.8
            };

            const genderMultiplier = getGenderMultiplier(gender, 'amphetamines');
            let dose = weight * intensityMultipliers[intensity] * genderMultiplier * substanceMultipliers[substance];

            // Safety caps
            const maxDoses = {
                'amphetamine': 60,
                'dextroamphetamine': 40,
                'methamphetamine': 25,
                'adderall': 50
            };

            dose = Math.min(dose, maxDoses[substance]);

            let warnings = '';
            if (dose > maxDoses[substance] * 0.8) {
                warnings += showWarning('High dose - monitor heart rate and blood pressure!');
            }

            if (substance === 'methamphetamine') {
                warnings += showWarning('Methamphetamine has high addiction potential and neurotoxicity risk.', 'danger');
            }

            const duration = {
                'amphetamine': '4-6 hours',
                'dextroamphetamine': '4-6 hours',
                'methamphetamine': '8-12 hours',
                'adderall': '4-6 hours'
            };

            resultValue.innerHTML = `${Math.round(dose)} mg`;
            resultDetails.innerHTML = `
                <p><strong>Duration:</strong> ${duration[substance]}</p>
                <p><strong>Onset:</strong> 30-60 minutes (oral)</p>
                <p><strong>Peak:</strong> 1-3 hours</p>
                <div class="scientific-note">
                    <strong>Safety Guidelines:</strong><br>
                    • Monitor cardiovascular signs<br>
                    • Stay hydrated and eat regularly<br>
                    • Avoid frequent use (tolerance and dependence)<br>
                    • Get adequate sleep between uses
                </div>
                ${warnings}
            `;
            resultDiv.style.display = 'block';
        }

        // Cocaine calculator
        function calculateCocaine() {
            const weight = parseFloat(document.getElementById('coc-weight').value);
            const gender = document.getElementById('coc-gender').value;
            const route = document.getElementById('coc-route').value;
            const intensity = document.getElementById('coc-intensity').value;
            const resultValue = document.getElementById('coc-result-value');
            const resultDetails = document.getElementById('coc-details');
            const resultDiv = document.getElementById('coc-result');

            if (!validateWeight(weight) || !gender || !route || !intensity) {
                resultValue.innerHTML = 'Please fill in all fields with valid values.';
                resultDetails.innerHTML = '';
                resultDiv.style.display = 'block';
                return;
            }

            const routeMultipliers = {
                'oral': 1.0,
                'nasal': 0.7,
                'iv': 0.3
            };

            const intensityMultipliers = {
                'threshold': 0.3,
                'light': 0.6,
                'common': 1.0,
                'strong': 1.5
            };

            const genderMultiplier = getGenderMultiplier(gender, 'cocaine');
            let dose = weight * intensityMultipliers[intensity] * genderMultiplier * routeMultipliers[route];

            // Safety caps by route
            const maxDoses = {
                'oral': 200,
                'nasal': 100,
                'iv': 50
            };

            dose = Math.min(dose, maxDoses[route]);

            let warnings = '';
            if (route === 'iv') {
                warnings += showWarning('Intravenous use carries extreme risks including overdose, infection, and addiction!', 'danger');
            }
            if (dose > maxDoses[route] * 0.7) {
                warnings += showWarning('High dose - serious cardiovascular risks!', 'danger');
            }

            warnings += showWarning('Cocaine has high addiction potential and serious cardiovascular risks.', 'danger');

            const duration = {
                'oral': '30-90 minutes',
                'nasal': '15-30 minutes',
                'iv': '5-15 minutes'
            };

            const onset = {
                'oral': '30-60 minutes',
                'nasal': '1-5 minutes',
                'iv': 'Immediate'
            };

            resultValue.innerHTML = `${Math.round(dose)} mg`;
            resultDetails.innerHTML = `
                <p><strong>Duration:</strong> ${duration[route]}</p>
                <p><strong>Onset:</strong> ${onset[route]}</p>
                <p><strong>Route:</strong> ${route.charAt(0).toUpperCase() + route.slice(1)}</p>
                <div class="scientific-note">
                    <strong>Critical Safety Information:</strong><br>
                    • Never mix with alcohol (creates cocaethylene)<br>
                    • Monitor heart rate and blood pressure<br>
                    • Have emergency contacts ready<br>
                    • High risk of addiction and cardiovascular events<br>
                    • Consider harm reduction alternatives
                </div>
                ${warnings}
            `;
            resultDiv.style.display = 'block';
        }

        // Enhanced 4-MMC tolerance calculator
        function calculate4MMCTolerance() {
            const weight = parseFloat(document.getElementById('mmc-weight').value);
            const previousDose = parseFloat(document.getElementById('mmc-previous-dose').value);
            const daysAgo = parseFloat(document.getElementById('mmc-days-ago').value);
            const desiredEffect = parseFloat(document.getElementById('mmc-desired-effect').value);
            const resultValue = document.getElementById('mmc-result-value');
            const resultDetails = document.getElementById('mmc-details');
            const resultDiv = document.getElementById('mmc-result');

            if (!validateWeight(weight) || isNaN(previousDose) || isNaN(daysAgo) || isNaN(desiredEffect) || 
                previousDose <= 0 || daysAgo < 0 || desiredEffect < 1 || desiredEffect > 10) {
                resultValue.innerHTML = 'Please enter valid numbers. Previous dose > 0, days ≥ 0, effect intensity 1-10.';
                resultDetails.innerHTML = '';
                resultDiv.style.display = 'block';
                return;
            }

            const toleranceHalfLife = 10; // days
            const baselineDose = weight * 1.7; // 1.7mg/kg baseline
            
            // Calculate remaining tolerance
            const toleranceDecay = Math.pow(0.5, daysAgo / toleranceHalfLife);
            const remainingTolerance = toleranceDecay;
            
            // Cross-tolerance factor
            const crossToleranceFactor = Math.log(previousDose / baselineDose + 1) * 0.4;
            const totalTolerance = remainingTolerance * (1 + crossToleranceFactor);
            
            // Effect scaling
            const effectMultiplier = Math.pow(desiredEffect / 7, 1.3);
            
            // Calculate dose
            let recommendedDose = baselineDose * effectMultiplier * (1 + totalTolerance);
            
            // Safety caps
            const maxRecommendedDose = Math.min(previousDose * 2, 300, weight * 4);
            if (recommendedDose > maxRecommendedDose) {
                recommendedDose = maxRecommendedDose;
            }

            let warnings = '';
            if (recommendedDose > 250) {
                warnings += showWarning('Very high dose - serious health risks including hyperthermia and cardiovascular stress!', 'danger');
            } else if (recommendedDose > 200) {
                warnings += showWarning('High dose - significant risks!', 'danger');
            }
            
            if (daysAgo < 7) {
                warnings += showWarning('Consider waiting longer for better serotonin recovery (recommended: 1-2 weeks minimum).');
            }

            warnings += showWarning('4-MMC has neurotoxic potential - limit frequency of use and consider safer alternatives.');

            resultValue.innerHTML = `${Math.round(recommendedDose)} mg`;
            resultDetails.innerHTML = `
                <p><strong>Tolerance factor:</strong> ${(totalTolerance * 100).toFixed(1)}% remaining</p>
                <p><strong>Recovery rate:</strong> ${((1 - remainingTolerance) * 100).toFixed(1)}% recovered</p>
                <p><strong>Dose per kg:</strong> ${(recommendedDose / weight).toFixed(1)} mg/kg</p>
                <div class="scientific-note">
                    <strong>Safety Guidelines:</strong><br>
                    • Wait at least 1-2 weeks between uses<br>
                    • Monitor body temperature and hydration<br>
                    • Use in cool environment with good ventilation<br>
                    • Consider pre/post-loading with supplements (5-HTP, antioxidants)<br>
                    • Maximum 3-4 uses per year recommended
                </div>
                ${warnings}
            `;
            resultDiv.style.display = 'block';
        }

        // General tolerance calculator
        function calculateGeneralTolerance() {
            const substance = document.getElementById('tol-substance').value;
            const customHalflife = parseFloat(document.getElementById('tol-custom-halflife').value);
            const previousDose = parseFloat(document.getElementById('tol-previous-dose').value);
            const doseUnit = document.getElementById('tol-dose-unit').value;
            const daysAgo = parseFloat(document.getElementById('tol-days-ago').value);
            const targetEffect = document.getElementById('tol-target-effect').value;
            const effectMultiplier = parseFloat(document.getElementById('tol-effect-multiplier').value) || 1;
            const resultValue = document.getElementById('tolerance-result-value');
            const resultDetails = document.getElementById('tolerance-details');
            const resultDiv = document.getElementById('tolerance-result');

            // Validation
            if (!substance || isNaN(previousDose) || isNaN(daysAgo) || previousDose <= 0 || daysAgo < 0) {
                resultValue.innerHTML = 'Please fill in all required fields with valid values.';
                resultDetails.innerHTML = '';
                resultDiv.style.display = 'block';
                return;
            }

            if (substance === 'custom' && (isNaN(customHalflife) || customHalflife <= 0)) {
                resultValue.innerHTML = 'Please enter a valid custom tolerance half-life.';
                resultDetails.innerHTML = '';
                resultDiv.style.display = 'block';
                return;
            }

            // Tolerance half-lives in days (approximate values based on research)
            const toleranceHalfLives = {
                // Psychedelics - very fast tolerance, cross-tolerance between them
                'lsd': 2.5,               // LSD - classic psychedelic tolerance
                'psilocybin': 3,          // Psilocybin - slightly longer than LSD
                'dmt': 0.5,               // DMT - minimal tolerance buildup
                '2cb': 4,                 // 2C-B - phenethylamine tolerance
                'mescaline': 5,           // Mescaline - longer lasting tolerance
                
                // Entactogens - serotonin-heavy, longer recovery needed
                'mdma': 14,               // MDMA - long recovery due to serotonin depletion
                'mda': 12,                // MDA - similar to MDMA but slightly faster
                '4mmc': 10,               // 4-MMC - cathinone tolerance pattern
                '6apb': 16,               // 6-APB - longer acting, longer tolerance
                
                // Stimulants - dopamine/norepinephrine, moderate tolerance
                'amphetamine': 7,         // Amphetamine - moderate stimulant tolerance
                'dextroamphetamine': 6,   // Dextroamphetamine - slightly faster recovery
                'methamphetamine': 10,    // Methamphetamine - longer tolerance due to neurotoxicity
                'cocaine': 2,             // Cocaine - fast tolerance but quick recovery
                'caffeine': 1,            // Caffeine - daily tolerance cycle
                'modafinil': 3,           // Modafinil - unique mechanism, moderate tolerance
                
                // Dissociatives - NMDA antagonism, variable tolerance
                'ketamine': 4,            // Ketamine - moderate NMDA tolerance
                'dxm': 7,                 // DXM - longer tolerance due to multiple mechanisms
                'pcp': 14,                // PCP - long-lasting tolerance
                '3meopcp': 10,            // 3-MeO-PCP - research chemical, estimated
                
                // Depressants - GABA system, fast tolerance development
                'ghb': 3,                 // GHB - fast tolerance, dangerous escalation
                'gbl': 3,                 // GBL - similar to GHB
                'phenibut': 3,            // Phenibut - rapid tolerance development
                'alcohol': 1,             // Alcohol - daily tolerance cycle
                'xanax': 7,               // Alprazolam - benzodiazepine tolerance
                'valium': 14,             // Diazepam - longer half-life, longer tolerance
                
                // Opioids - significant tolerance and dependence issues
                'morphine': 5,            // Morphine - classic opioid tolerance
                'oxycodone': 4,           // Oxycodone - faster tolerance development
                'tramadol': 6,            // Tramadol - unique mechanism, moderate tolerance
                'kratom': 3,              // Kratom - faster tolerance than traditional opioids
                
                // Cannabis - cannabinoid system
                'thc': 3,                 // THC - fast tolerance development
                'cbd': 0.5,               // CBD - minimal tolerance
                
                // Other
                'nitrous': 0.1,           // N2O - virtually no tolerance
                'custom': customHalflife  // User-defined
            };

            const toleranceHalfLife = toleranceHalfLives[substance];

            // Calculate remaining tolerance (exponential decay)
            const toleranceDecay = Math.pow(0.5, daysAgo / toleranceHalfLife);
            const remainingTolerance = toleranceDecay;

            // Generate tolerance recovery graph
            generateToleranceGraph(toleranceHalfLife, daysAgo, substance);

            // Calculate required dose multiplier based on target effect
            let targetMultiplier = 1;
            switch (targetEffect) {
                case 'same':
                    targetMultiplier = 1;
                    break;
                case 'stronger':
                    targetMultiplier = effectMultiplier;
                    break;
                case 'weaker':
                    targetMultiplier = effectMultiplier;
                    break;
                case 'baseline':
                    targetMultiplier = 1;
                    // For baseline, we calculate what the original dose would be without any tolerance
                    const baselineDose = previousDose / (1 + remainingTolerance);
                    resultValue.innerHTML = `${baselineDose.toFixed(2)} ${doseUnit}`;
                    resultDetails.innerHTML = `
                        <p><strong>Baseline dose (no tolerance):</strong> ${baselineDose.toFixed(2)} ${doseUnit}</p>
                        <p><strong>Your previous dose had tolerance:</strong> ${(remainingTolerance * 100).toFixed(1)}% tolerance present</p>
                        <p><strong>Current tolerance remaining:</strong> ${(toleranceDecay * 100).toFixed(1)}%</p>
                        <div class="scientific-note">
                            <strong>Substance:</strong> ${substance.charAt(0).toUpperCase() + substance.slice(1)}<br>
                            <strong>Tolerance half-life:</strong> ${toleranceHalfLife} days<br>
                            <strong>Recovery rate:</strong> ${((1 - toleranceDecay) * 100).toFixed(1)}% recovered
                        </div>
                    `;
                    resultDiv.style.display = 'block';
                    return;
            }

            // Calculate required dose for target effect
            // If we want the same effect as before, we need to account for current tolerance
            let requiredDose = previousDose * targetMultiplier;

            // Adjust for current tolerance level
            if (remainingTolerance > 0) {
                requiredDose = requiredDose * (1 + remainingTolerance);
            }

            // Safety warnings
            let warnings = '';
            const doseIncrease = requiredDose / previousDose;
            
            if (doseIncrease > 2.0) {
                warnings += showWarning('Very high dose increase required - consider waiting longer for tolerance to decrease!', 'danger');
            } else if (doseIncrease > 1.5) {
                warnings += showWarning('Significant dose increase required - exercise caution and consider harm reduction strategies.');
            }

            if (daysAgo < toleranceHalfLife) {
                warnings += showWarning(`Short time since last dose. Consider waiting longer for better tolerance recovery (half-life: ${toleranceHalfLife} days).`);
            }

            // Substance-specific warnings
            // Psychedelics
            if (['lsd', 'psilocybin', '2cb', 'mescaline'].includes(substance) && daysAgo < 7) {
                warnings += showWarning('Psychedelics: Consider waiting at least 1-2 weeks between uses for full tolerance reset and meaningful experiences.');
            } else if (substance === 'dmt' && daysAgo < 1) {
                warnings += showWarning('DMT: While tolerance is minimal, consider spacing sessions for integration time.');
            
            // Entactogens - Serotonin heavy substances
            } else if (substance === 'mdma' && daysAgo < 30) {
                warnings += showWarning('MDMA: Recommended to wait at least 1-3 months between uses for serotonin recovery and safety.', 'danger');
            } else if (substance === 'mda' && daysAgo < 30) {
                warnings += showWarning('MDA: Similar to MDMA - wait at least 1-3 months between uses for neurotransmitter recovery.', 'danger');
            } else if (substance === '4mmc' && daysAgo < 14) {
                warnings += showWarning('4-MMC: Recommended to wait at least 2 weeks between uses due to neurotoxicity concerns.', 'danger');
            } else if (substance === '6apb' && daysAgo < 45) {
                warnings += showWarning('6-APB: Very long-acting - wait at least 6-8 weeks between uses for safety.', 'danger');
            
            // Stimulants
            } else if (substance === 'methamphetamine') {
                warnings += showWarning('Methamphetamine: High neurotoxicity and addiction potential. Consider harm reduction resources.', 'danger');
            } else if (substance === 'cocaine' && daysAgo < 3) {
                warnings += showWarning('Cocaine: High cardiovascular risks and addiction potential. Frequent use is dangerous.');
            } else if (substance === 'caffeine' && daysAgo < 2) {
                warnings += showWarning('Caffeine: Daily tolerance develops quickly. Consider cycling to maintain effectiveness.');
            
            // Dissociatives
            } else if (substance === 'ketamine' && daysAgo < 7) {
                warnings += showWarning('Ketamine: Frequent use can lead to bladder damage and psychological dependence.');
            } else if (substance === 'pcp') {
                warnings += showWarning('PCP: Extremely unpredictable and dangerous substance. High risk of injury and legal issues.', 'danger');
            
            // Depressants
            } else if (['ghb', 'gbl'].includes(substance)) {
                warnings += showWarning('GHB/GBL: Extremely dangerous - narrow margin between active and lethal dose. Never mix with alcohol!', 'danger');
            } else if (substance === 'alcohol' && daysAgo < 1) {
                warnings += showWarning('Alcohol: Daily use leads to rapid tolerance and health issues. Consider moderation.');
            } else if (['xanax', 'valium'].includes(substance)) {
                warnings += showWarning('Benzodiazepines: High dependence potential and dangerous withdrawals. Medical supervision recommended.', 'danger');
            } else if (substance === 'phenibut' && daysAgo < 3) {
                warnings += showWarning('Phenibut: Rapid tolerance and severe withdrawal syndrome. Maximum 2-3 times per week.', 'danger');
            
            // Opioids
            } else if (['morphine', 'oxycodone', 'tramadol', 'kratom'].includes(substance)) {
                warnings += showWarning('Opioids: Extremely high addiction potential and serious tolerance issues. Consider harm reduction resources.', 'danger');
            
            // Cannabis
            } else if (substance === 'thc' && daysAgo < 2) {
                warnings += showWarning('THC: Rapid tolerance development with daily use. Consider tolerance breaks for effectiveness.');
            
            // Special cases
            } else if (substance === 'nitrous' && daysAgo < 0.1) {
                warnings += showWarning('Nitrous Oxide: Risk of B12 depletion with frequent use. Ensure adequate spacing and B12 supplementation.');
            }

            resultValue.innerHTML = `${requiredDose.toFixed(2)} ${doseUnit}`;
            resultDetails.innerHTML = `
                <p><strong>Previous dose:</strong> ${previousDose} ${doseUnit}</p>
                <p><strong>Required dose:</strong> ${requiredDose.toFixed(2)} ${doseUnit}</p>
                <p><strong>Dose multiplier:</strong> ${doseIncrease.toFixed(2)}x</p>
                <p><strong>Current tolerance:</strong> ${(toleranceDecay * 100).toFixed(1)}% remaining</p>
                <p><strong>Recovery:</strong> ${((1 - toleranceDecay) * 100).toFixed(1)}% recovered</p>
                <div class="scientific-note">
                    <strong>Substance category:</strong> ${substance.charAt(0).toUpperCase() + substance.slice(1)}<br>
                    <strong>Tolerance half-life:</strong> ${toleranceHalfLife} days<br>
                    <strong>Days since last use:</strong> ${daysAgo} days<br>
                    <strong>Target effect:</strong> ${targetEffect === 'same' ? 'Same as previous' : targetEffect}
                    ${targetEffect !== 'same' ? `<br><strong>Effect multiplier:</strong> ${effectMultiplier}x` : ''}
                </div>
                ${warnings}
            `;
            resultDiv.style.display = 'block';
        }

        // Generate tolerance recovery graph
        function generateToleranceGraph(halfLife, currentDay, substance) {
            const canvas = document.getElementById('tolerance-graph');
            const ctx = canvas.getContext('2d');
            
            // Set canvas size
            canvas.width = 600;
            canvas.height = 300;
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Graph dimensions
            const padding = 50;
            const graphWidth = canvas.width - 2 * padding;
            const graphHeight = canvas.height - 2 * padding;
            
            // Time range (show up to 4 half-lives for good visualization)
            const maxDays = Math.max(halfLife * 4, currentDay + halfLife);
            const timeStep = maxDays / 100; // 100 points for smooth curve
            
            // Set up drawing context
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            
            // Draw axes
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            // Y-axis
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, canvas.height - padding);
            // X-axis
            ctx.moveTo(padding, canvas.height - padding);
            ctx.lineTo(canvas.width - padding, canvas.height - padding);
            ctx.stroke();
            
            // Draw tolerance curve
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            let firstPoint = true;
            for (let day = 0; day <= maxDays; day += timeStep) {
                const tolerance = Math.pow(0.5, day / halfLife) * 100; // Convert to percentage
                const x = padding + (day / maxDays) * graphWidth;
                const y = canvas.height - padding - (tolerance / 100) * graphHeight;
                
                if (firstPoint) {
                    ctx.moveTo(x, y);
                    firstPoint = false;
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.stroke();
            
            // Mark current day
            if (currentDay <= maxDays) {
                const currentTolerance = Math.pow(0.5, currentDay / halfLife) * 100;
                const currentX = padding + (currentDay / maxDays) * graphWidth;
                const currentY = canvas.height - padding - (currentTolerance / 100) * graphHeight;
                
                // Draw current day marker
                ctx.fillStyle = '#ff6b6b';
                ctx.beginPath();
                ctx.arc(currentX, currentY, 6, 0, 2 * Math.PI);
                ctx.fill();
                
                // Draw vertical line to current day
                ctx.strokeStyle = '#ff6b6b';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(currentX, currentY);
                ctx.lineTo(currentX, canvas.height - padding);
                ctx.stroke();
                ctx.setLineDash([]);
            }
            
            // Add labels
            ctx.fillStyle = '#333';
            ctx.font = 'bold 14px Segoe UI';
            ctx.textAlign = 'center';
            
            // Y-axis labels (tolerance percentage)
            ctx.textAlign = 'right';
            ctx.textBaseline = 'middle';
            for (let i = 0; i <= 100; i += 25) {
                const y = canvas.height - padding - (i / 100) * graphHeight;
                ctx.fillText(i + '%', padding - 10, y);
                
                // Draw grid lines
                if (i > 0) {
                    ctx.strokeStyle = '#e0e0e0';
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.moveTo(padding, y);
                    ctx.lineTo(canvas.width - padding, y);
                    ctx.stroke();
                }
            }
            
            // X-axis labels (days)
            ctx.textAlign = 'center';
            ctx.textBaseline = 'top';
            const dayStep = Math.ceil(maxDays / 8); // Show about 8 labels
            for (let day = 0; day <= maxDays; day += dayStep) {
                const x = padding + (day / maxDays) * graphWidth;
                ctx.fillStyle = '#333';
                ctx.fillText(Math.round(day) + 'd', x, canvas.height - padding + 5);
                
                // Draw grid lines
                if (day > 0) {
                    ctx.strokeStyle = '#e0e0e0';
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.moveTo(x, padding);
                    ctx.lineTo(x, canvas.height - padding);
                    ctx.stroke();
                }
            }
            
            // Add axis titles
            ctx.fillStyle = '#333';
            ctx.font = 'bold 16px Segoe UI';
            
            // Y-axis title
            ctx.save();
            ctx.translate(20, canvas.height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.textAlign = 'center';
            ctx.fillText('Tolerance Level (%)', 0, 0);
            ctx.restore();
            
            // X-axis title
            ctx.textAlign = 'center';
            ctx.fillText('Days Since Last Use', canvas.width / 2, canvas.height - 10);
            
            // Add half-life marker
            if (halfLife <= maxDays) {
                const halfLifeX = padding + (halfLife / maxDays) * graphWidth;
                ctx.strokeStyle = '#ffa500';
                ctx.lineWidth = 2;
                ctx.setLineDash([10, 5]);
                ctx.beginPath();
                ctx.moveTo(halfLifeX, padding);
                ctx.lineTo(halfLifeX, canvas.height - padding);
                ctx.stroke();
                ctx.setLineDash([]);
                
                // Half-life label
                ctx.fillStyle = '#ffa500';
                ctx.font = 'bold 12px Segoe UI';
                ctx.textAlign = 'center';
                ctx.fillText('Half-life', halfLifeX, padding - 10);
            }
            
            // Add substance name and half-life info
            ctx.fillStyle = '#333';
            ctx.font = 'bold 14px Segoe UI';
            ctx.textAlign = 'left';
            const substanceName = substance.charAt(0).toUpperCase() + substance.slice(1);
            ctx.fillText(`${substanceName} (t½ = ${halfLife}d)`, padding + 10, padding + 20);
        }

        // Show/hide custom half-life input based on substance selection
        function handleSubstanceChange() {
            const substance = document.getElementById('tol-substance').value;
            const customGroup = document.getElementById('custom-halflife-group');
            
            if (substance === 'custom') {
                customGroup.style.display = 'block';
            } else {
                customGroup.style.display = 'none';
            }
        }

        // Show/hide effect multiplier based on target effect
        function handleTargetEffectChange() {
            const targetEffect = document.getElementById('tol-target-effect').value;
            const multiplierGroup = document.getElementById('effect-multiplier-group');
            
            if (targetEffect === 'stronger' || targetEffect === 'weaker') {
                multiplierGroup.style.display = 'block';
            } else {
                multiplierGroup.style.display = 'none';
            }
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            // Show liquid calculator by default
            showCalculator('liquid');
            
            // Add event listeners for dynamic form behavior
            const substanceSelect = document.getElementById('tol-substance');
            const targetEffectSelect = document.getElementById('tol-target-effect');
            
            if (substanceSelect) {
                substanceSelect.addEventListener('change', handleSubstanceChange);
            }
            
            if (targetEffectSelect) {
                targetEffectSelect.addEventListener('change', handleTargetEffectChange);
            }
        });
    </script>
</body>
</html>
