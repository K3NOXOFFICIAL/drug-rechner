<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K3NOX Drug Calculator - Drug Calculator Suite</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Comprehensive drug calculator suite for harm reduction education and scientific research. Calculate dosages for MDMA, LSD, Ketamine, GHB, and more with advanced tolerance modeling and safety features.">
    <meta name="keywords" content="drug calculator, harm reduction, dosage calculator, tolerance calculator, MDMA calculator, LSD calculator, ketamine calculator, substance safety, pharmacology">
    <meta name="author" content="K3NOX Drug Calculator">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://k3noxofficial.github.io/drug-rechner/">
    <meta property="og:title" content="K3NOX Drug Calculator - Drug Calculator Suite">
    <meta property="og:description" content="🧮 Comprehensive drug calculator suite for harm reduction education and scientific research. Features advanced tolerance modeling, safety warnings, and interactive graphs for 8+ substances.">
    <meta property="og:image" content="https://k3noxofficial.github.io/drug-rechner/preview-image.svg">
    <meta property="og:image:type" content="image/svg+xml">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="K3NOX Drug Calculator - Harm Reduction Calculator Suite with dose calculator, tolerance calculator, and liquid dosage tools">
    <meta property="og:site_name" content="K3NOX Drug Calculator">
    <meta property="og:locale" content="en_US">
    
    <!-- Twitter Card -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://k3noxofficial.github.io/drug-rechner/">
    <meta property="twitter:title" content="K3NOX Drug Calculator - Drug Calculator Suite">
    <meta property="twitter:description" content="🧮 Comprehensive drug calculator suite for harm reduction education and scientific research. Features advanced tolerance modeling, safety warnings, and interactive graphs for 8+ substances.">
    <meta property="twitter:image" content="https://k3noxofficial.github.io/drug-rechner/preview-image.svg">
    <meta property="twitter:image:alt" content="K3NOX Drug Calculator - Drug Calculator Suite Interface">
    
    <!-- Telegram specific optimizations -->
    <meta property="telegram:channel" content="@k3noxofficial">
    <meta property="telegram:image" content="https://k3noxofficial.github.io/drug-rechner/preview-image.svg">
    <meta name="format-detection" content="telephone=no">
    
    <!-- Additional Meta Tags -->
    <meta name="theme-color" content="#667eea">
    <meta name="msapplication-TileColor" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="K3NOX Drug Calculator">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🧮</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🧮</text></svg>">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Drug Calc">
    <meta name="msapplication-TileColor" content="#667eea">
    <meta name="msapplication-config" content="browserconfig.xml">
    
    <!-- iOS specific PWA enhancements -->
    <meta name="apple-touch-fullscreen" content="yes">
    <link rel="apple-touch-startup-image" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><rect width='192' height='192' fill='%23000000'/><text x='96' y='130' font-size='120' text-anchor='middle' fill='%23667eea'>🧮</text></svg>">
    
    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    
    <!-- Schema.org markup for better SEO -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "K3NOX Drug Calculator - Drug Calculator Suite",
        "description": "Comprehensive drug calculator suite for harm reduction education and scientific research with advanced tolerance modeling and safety features.",
        "url": "https://k3noxofficial.github.io/drug-rechner/",
        "applicationCategory": "HealthApplication",
        "operatingSystem": "Any",
        "permissions": "none",
        "isAccessibleForFree": true,
        "creator": {
            "@type": "Organization",
            "name": "K3NOX Drug Calculator"
        },
        "audience": {
            "@type": "Audience",
            "audienceType": "Researchers, Harm Reduction Educators"
        },
        "mainEntity": {
            "@type": "Thing",
            "name": "Drug Dosage Calculator",
            "description": "Educational calculator for substance dosage and tolerance modeling"
        }
    }
    </script>
    <style>
        :root {
            --primary-color: #3b82f6;
            --primary-hover: #2563eb;
            --secondary-color: #6b7280;
            --accent-color: #06b6d4;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --background-primary: #000000;
            --background-secondary: #111111;
            --background-card: #1a1a1a;
            --background-elevated: #222222;
            --text-primary: #ffffff;
            --text-secondary: #d1d5db;
            --text-muted: #9ca3af;
            --border-color: #333333;
            --border-light: #2a2a2a;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.3);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.4), 0 2px 4px -2px rgb(0 0 0 / 0.3);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.5), 0 4px 6px -4px rgb(0 0 0 / 0.4);
            --radius-sm: 0.5rem;
            --radius-md: 0.75rem;
            --radius-lg: 1rem;
            --radius-xl: 1.5rem;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background: var(--background-primary);
            min-height: 100vh;
            font-size: 16px;
        }
        
        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        
        /* Header Styling */
        .header {
            padding: 4rem 0 3rem;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
        }
        
        .header-content {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .brand {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .brand-icon {
            font-size: 3.5rem;
            opacity: 0.9;
        }
        
        .brand-text h1 {
            font-size: 3rem;
            font-weight: 600;
            margin: 0;
            color: var(--text-primary);
            letter-spacing: -0.02em;
        }
        
        .brand-tagline {
            font-size: 0.875rem;
            font-weight: 400;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.15em;
            margin-top: 0.5rem;
            display: block;
        }
        
        .header-description {
            font-size: 1rem;
            color: var(--text-secondary);
            font-weight: 400;
            max-width: 500px;
            margin: 0 auto;
        }
        
        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 3rem 0;
            padding: 0;
        }
        
        .tab-btn {
            background: var(--background-secondary);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 1rem 1.5rem;
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            white-space: nowrap;
        }
        
        .tab-btn:hover {
            background: var(--background-elevated);
            color: var(--text-primary);
            border-color: var(--primary-color);
        }
        
        .tab-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        /* Dropdown Styling */
        .dose-calculators {
            position: relative;
            display: inline-block;
        }
        
        .dose-toggle {
            background: var(--background-secondary);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 1rem 1.5rem;
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .dose-toggle:hover {
            background: var(--background-elevated);
            color: var(--text-primary);
            border-color: var(--primary-color);
        }
        
        .dose-toggle.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .dose-menu {
            display: none;
            position: absolute;
            top: calc(100% + 0.5rem);
            left: 50%;
            transform: translateX(-50%);
            background: var(--background-card);
            min-width: 320px;
            max-width: 400px;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
            padding: 0.75rem;
            z-index: 1000;
            animation: slideDown 0.2s ease;
        }
        
        .dose-menu.show {
            display: block;
        }
        
        .dose-category {
            margin-bottom: 0.75rem;
        }
        
        .dose-category:last-child {
            margin-bottom: 0;
        }
        
        .dose-category-title {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding: 0.5rem 0.75rem 0.25rem;
            border-bottom: 1px solid var(--border-light);
            margin-bottom: 0.25rem;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-8px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }
        
        .dose-menu-item {
            display: block;
            width: 100%;
            padding: 0.75rem 1rem;
            border: none;
            background: none;
            text-align: left;
            color: var(--text-secondary);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .dose-menu-item:hover {
            background: var(--background-elevated);
            color: var(--text-primary);
        }
        
        .dose-menu-item.active {
            background: var(--primary-color);
            color: white;
        }
        
        .dropdown-arrow {
            transition: transform 0.2s ease;
            font-size: 0.75rem;
        }
        
        .dose-calculators.open .dropdown-arrow {
            transform: rotate(180deg);
        }
        
        .mobile-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }
        
        .mobile-overlay.show {
            display: block;
        }
        
        /* Calculator Sections */
        .calculator-section {
            display: none;
            background: var(--background-card);
            border-radius: var(--radius-xl);
            padding: 3rem;
            margin-bottom: 3rem;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
            animation: fadeIn 0.3s ease;
        }
        
        .calculator-section.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(20px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }
        
        .calculator-section h2 {
            color: var(--text-primary);
            margin-bottom: 1rem;
            font-size: 2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 1rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 1rem;
        }
        
        .calculator-section p {
            color: var(--text-secondary);
            margin-bottom: 2.5rem;
            font-size: 1rem;
        }
        
        /* Form Styling */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 2.5rem;
        }
        
        .input-group {
            background: var(--background-secondary);
            padding: 1.5rem;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            transition: all 0.2s ease;
        }
        
        .input-group:hover {
            border-color: var(--primary-color);
        }
        
        .input-group:focus-within {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .input-group label {
            display: block;
            margin-bottom: 0.75rem;
            font-weight: 500;
            color: var(--text-primary);
            font-size: 0.875rem;
        }
        
        .input-group input,
        .input-group select {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: 1rem;
            background: var(--background-primary);
            color: var(--text-primary);
            transition: all 0.2s ease;
        }
        
        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .input-group input::placeholder {
            color: var(--text-muted);
        }
        
        /* Button Styling */
        .btn {
            background: var(--primary-color);
            color: white;
            padding: 1.25rem 2.5rem;
            border: none;
            border-radius: var(--radius-lg);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.2s ease;
            display: block;
            margin: 2rem auto;
            min-width: 220px;
            box-shadow: var(--shadow-sm);
        }
        
        .btn:hover {
            background: var(--primary-hover);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        /* Result Styling */
        .result {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: var(--radius-lg);
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: var(--shadow-sm);
        }
        
        .result h3 {
            color: var(--success-color);
            margin-bottom: 1.5rem;
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        .result-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--success-color);
            text-align: center;
            margin: 1.5rem 0;
        }
        
        /* Warning Styling */
        .warning {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(245, 158, 11, 0.05) 100%);
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: var(--radius-lg);
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: var(--shadow-sm);
        }
        
        .warning.danger {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.05) 100%);
            border-color: rgba(239, 68, 68, 0.3);
        }
        
        .warning h4 {
            color: var(--warning-color);
            margin-bottom: 1rem;
            font-size: 1.125rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .warning.danger h4 {
            color: var(--danger-color);
        }
        
        /* Disclaimer */
        .disclaimer {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.05) 100%);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: var(--radius-xl);
            padding: 2rem;
            margin: 2rem 0 3rem 0;
            color: var(--text-primary);
            box-shadow: var(--shadow-sm);
        }
        
        .disclaimer h4 {
            color: var(--danger-color);
            margin-bottom: 1rem;
            font-size: 1.125rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .disclaimer h4::before {
            content: "⚠️";
            font-size: 1.25rem;
        }
        
        .disclaimer p {
            margin: 0;
            line-height: 1.6;
            color: var(--text-secondary);
        }
        
        /* Scientific Note */
        .scientific-note {
            background: var(--background-secondary);
            border-radius: var(--radius-md);
            padding: 1.25rem;
            margin-top: 1.5rem;
            font-style: italic;
            color: var(--text-secondary);
            border-left: 4px solid var(--secondary-color);
            font-size: 0.875rem;
        }
        
        /* Tooltip */
        .tooltip {
            position: relative;
            cursor: help;
            border-bottom: 1px dotted var(--text-muted);
        }
        
        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--background-elevated);
            color: var(--text-primary);
            padding: 0.75rem 1rem;
            border-radius: var(--radius-md);
            font-size: 0.75rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            z-index: 1000;
            pointer-events: none;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
        }
        
        .tooltip:hover::after {
            opacity: 1;
            visibility: visible;
        }
        
        /* Graph Container */
        .graph-container {
            background: var(--background-secondary);
            border-radius: var(--radius-lg);
            padding: 2rem;
            margin: 2rem 0;
            border: 1px solid var(--border-color);
        }
        
        .graph-wrapper {
            display: flex;
            justify-content: center;
            background: var(--background-card);
            border-radius: var(--radius-md);
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
        }
        
        #tolerance-graph {
            max-width: 100%;
            height: auto;
            border-radius: var(--radius-sm);
        }
        
        .graph-legend {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.875rem;
            color: var(--text-primary);
        }
        
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: var(--radius-sm);
            display: inline-block;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 0 0.75rem;
            }
            
            .header {
                padding: 2rem 0 1.5rem;
            }
            
            .brand {
                flex-direction: column;
                gap: 0.75rem;
            }
            
            .brand-text h1 {
                font-size: 2rem;
            }
            
            .nav-tabs {
                flex-direction: column;
                gap: 0.75rem;
                padding: 1.5rem;
            }
            
            .tab-btn,
            .dose-toggle {
                width: 100%;
                justify-content: center;
            }
            
            .dose-calculators {
                width: 100%;
            }
            
            .dose-menu {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 90%;
                max-width: 320px;
                max-height: 60vh;
                overflow-y: auto;
                border-radius: var(--radius-xl);
                padding: 1rem;
            }
            
            .calculator-section {
                padding: 1.5rem;
                margin-bottom: 1.5rem;
            }
            
            .calculator-section h2 {
                font-size: 1.5rem;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .input-group {
                padding: 1rem;
            }
            
            .result-value {
                font-size: 1.5rem;
            }
            
            .footer-content {
                grid-template-columns: 1fr;
                gap: 2rem;
                text-align: center;
            }
            
            .modal-content {
                width: 95%;
                margin: 1rem auto;
                max-height: 90vh;
            }
        }
        
        @media (max-width: 480px) {
            .brand-icon {
                font-size: 2.5rem;
            }
            
            .brand-text h1 {
                font-size: 1.75rem;
            }
            
            .header-description {
                font-size: 1rem;
            }
            
            .calculator-section {
                padding: 1rem;
            }
            
            .disclaimer {
                padding: 1.5rem;
            }
        }
        
        /* Drug Information Styles */
        .drug-info-nav {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 1rem;
        }

        .drug-info-nav li {
            list-style: none;
            background: var(--background-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            white-space: nowrap;
        }

        .drug-info-nav li:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }

        .drug-info-nav li.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .drug-info-content {
            display: none;
            animation: fadeInUp 0.5s ease forwards;
        }

        .drug-info-content.active {
            display: block;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .emergency-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .emergency-card {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.05) 100%);
            border: 2px solid rgba(239, 68, 68, 0.3);
            border-radius: var(--radius-lg);
            padding: 2rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .emergency-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.2);
        }

        @media (max-width: 768px) {
            .drug-info-nav {
                justify-content: center;
            }
            
            .drug-info-nav li {
                font-size: 0.8rem;
                padding: 0.5rem 0.75rem;
            }
            
            .emergency-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .emergency-card {
                padding: 1.5rem;
            }
        }
        
        /* Footer Styling */
        .footer {
            background: var(--background-secondary);
            border-top: 1px solid var(--border-color);
            padding: 3rem 0 2rem;
            margin-top: 4rem;
        }
        
        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 3rem;
            margin-bottom: 2rem;
        }
        
        .footer-section h4 {
            color: var(--text-primary);
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        .footer-section p {
            color: var(--text-secondary);
            font-size: 0.875rem;
            line-height: 1.5;
        }
        
        .footer-links {
            list-style: none;
            padding: 0;
        }
        
        .footer-links li {
            margin-bottom: 0.5rem;
        }
        
        .footer-links a {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.875rem;
            transition: color 0.2s ease;
        }
        
        .footer-links a:hover {
            color: var(--primary-color);
        }
        
        .footer-bottom {
            border-top: 1px solid var(--border-color);
            padding-top: 2rem;
            text-align: center;
        }
        
        .footer-bottom p {
            color: var(--text-muted);
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }
        
        .footer-disclaimer {
            font-size: 0.75rem !important;
            font-style: italic;
        }
        
        /* Modal Styling */
        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
        }
        
        .modal-content {
            background-color: var(--background-card);
            margin: 2rem auto;
            border-radius: var(--radius-xl);
            width: 90%;
            max-width: 800px;
            max-height: 85vh;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-lg);
            animation: modalSlideIn 0.3s ease;
            overflow: hidden;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--border-color);
            background: var(--background-secondary);
        }
        
        .modal-header h2 {
            color: var(--text-primary);
            font-size: 1.5rem;
            font-weight: 600;
            margin: 0;
        }
        
        .close {
            color: var(--text-muted);
            font-size: 2rem;
            font-weight: 300;
            cursor: pointer;
            transition: color 0.2s ease;
            line-height: 1;
        }
        
        .close:hover {
            color: var(--text-primary);
        }
        
        .modal-body {
            padding: 2rem;
            overflow-y: auto;
            max-height: 70vh;
        }
        
        .legal-content {
            color: var(--text-secondary);
            line-height: 1.6;
        }
        
        .legal-content section {
            margin-bottom: 2rem;
        }
        
        .legal-content h3 {
            color: var(--text-primary);
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 0.5rem;
        }
        
        .legal-content p {
            margin-bottom: 1rem;
        }
        
        .legal-content ul {
            margin: 1rem 0;
            padding-left: 1.5rem;
        }
        
        .legal-content li {
            margin-bottom: 0.5rem;
        }
        
        .legal-content strong {
            color: var(--text-primary);
            font-weight: 600;
        }
        
        .legal-update {
            font-style: italic;
            color: var(--text-muted);
            font-size: 0.875rem;
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <div class="brand">
                    <div class="brand-icon">🧮</div>
                    <div class="brand-text">
                        <h1>K3NOX Drug Calculator</h1>
                        <span class="brand-tagline">Harm Reduction Calculator Suite</span>
                    </div>
                </div>
                <p class="header-description">Evidence-based dosage calculations for educational and research purposes</p>
            </div>
        </div>

        <div class="disclaimer">
            <h4>For Scientific/Educational Purposes Only</h4>
            <p>This calculator is designed for harm reduction education and scientific research purposes. Always consult medical professionals and follow local laws. Individual responses vary significantly, and these calculations are theoretical models based on general guidelines.</p>
        </div>

        <div class="nav-tabs">
            <button class="tab-btn active" onclick="showCalculator('liquid')" role="tab" aria-selected="true" aria-controls="liquid" id="liquid-tab" tabindex="0">💧 Liquid Dosage</button>
            
            <div class="dose-calculators">
                <button class="dose-toggle" id="dose-calc-btn" onclick="toggleDoseMenu()">
                    💊 Dose Calculator 
                    <span class="dropdown-arrow">▼</span>
                </button>
                <div class="dose-menu" id="dose-menu">
                    <div class="dose-category">
                        <div class="dose-category-title">💊 Entactogens/Empathogens</div>
                        <button class="dose-menu-item" onclick="selectDoseCalculator('mdma')">💊 MDMA (Ecstasy/Molly)</button>
                        <button class="dose-menu-item" onclick="selectDoseCalculator('4mmc')">🔥 4-MMC (Mephedrone)</button>
                        <button class="dose-menu-item" onclick="selectDoseCalculator('2mmc')">⚡ 2-MMC (2-Methylmethcathinone)</button>
                    </div>
                    <div class="dose-category">
                        <div class="dose-category-title">🌈 Psychedelics</div>
                        <button class="dose-menu-item" onclick="selectDoseCalculator('lsd')">🌈 LSD (Acid)</button>
                    </div>
                    <div class="dose-category">
                        <div class="dose-category-title">🧠 Dissociatives</div>
                        <button class="dose-menu-item" onclick="selectDoseCalculator('ketamine')">� Ketamine (Special K)</button>
                    </div>
                    <div class="dose-category">
                        <div class="dose-category-title">⚡ Stimulants</div>
                        <button class="dose-menu-item" onclick="selectDoseCalculator('amphetamines')">⚡ Amphetamines (Speed)</button>
                        <button class="dose-menu-item" onclick="selectDoseCalculator('cocaine')">❄️ Cocaine</button>
                    </div>
                    <div class="dose-category">
                        <div class="dose-category-title">🥤 Depressants</div>
                        <button class="dose-menu-item" onclick="selectDoseCalculator('ghb')">🥤 GHB/GBL</button>
                    </div>
                </div>
            </div>
            
            <button class="tab-btn" onclick="showCalculator('tolerance')" role="tab" aria-selected="false" aria-controls="tolerance" id="tolerance-tab" tabindex="0">⚖️ Tolerance Calculator</button>
            
            <div class="dose-calculators">
                <button class="dose-toggle" id="general-info-btn" onclick="toggleGeneralInfoMenu()">
                    📚 General Info 
                    <span class="dropdown-arrow">▼</span>
                </button>
                <div class="dose-menu" id="general-info-menu">
                    <div class="dose-category">
                        <button class="dose-menu-item" onclick="showDrugInfoSection('overview')">🏠 Overview</button>
                        <button class="dose-menu-item" onclick="showDrugInfoSection('first-time')">🌱 First Time Use</button>
                        <button class="dose-menu-item" onclick="showDrugInfoSection('redosing')">⏰ Redosing Guide</button>
                        <button class="dose-menu-item" onclick="showDrugInfoSection('dos-donts')">✅ Dos & Don'ts</button>
                        <button class="dose-menu-item" onclick="showDrugInfoSection('emergency')">🚨 Emergency Info</button>
                        <button class="dose-menu-item" onclick="showDrugInfoSection('tripsitting')">🤝 Trip-Sitting</button>
                        <button class="dose-menu-item" onclick="showDrugInfoSection('harm-reduction')">🛡️ Harm Reduction</button>
                    </div>
                </div>
            </div>
            
            <div class="dose-calculators">
                <button class="dose-toggle" id="drug-specific-btn" onclick="toggleDrugSpecificMenu()">
                    💊 Drug Info 
                    <span class="dropdown-arrow">▼</span>
                </button>
                <div class="dose-menu" id="drug-specific-menu">
                    <div class="dose-category">
                        <button class="dose-menu-item" onclick="showDrugInfoSection('mdma-info')">💊 MDMA</button>
                        <button class="dose-menu-item" onclick="showDrugInfoSection('lsd-info')">🌈 LSD</button>
                        <button class="dose-menu-item" onclick="showDrugInfoSection('ketamine-info')">🧠 Ketamine</button>
                        <button class="dose-menu-item" onclick="showDrugInfoSection('ghb-info')">🥤 GHB/GBL</button>
                        <button class="dose-menu-item" onclick="showDrugInfoSection('amphetamines-info')">⚡ Amphetamines</button>
                        <button class="dose-menu-item" onclick="showDrugInfoSection('cocaine-info')">❄️ Cocaine</button>
                        <button class="dose-menu-item" onclick="showDrugInfoSection('4mmc-info')">🔥 4-MMC</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mobile overlay -->
        <div class="mobile-overlay" id="mobile-overlay" onclick="closeAllMenus()"></div>

        <!-- Liquid Dosage Calculator -->
        <div id="liquid" class="calculator-section active">
            <h2>� Liquid Dosage Calculator</h2>
            <p>Calculate the amount of medication in a specific volume of liquid</p>

            <div class="form-grid">
                <div class="input-group">
                    <label for="total-volume">Total liquid volume (ml):</label>
                    <input type="number" id="total-volume" placeholder="e.g., 28" step="0.1">
                </div>

                <div class="input-group">
                    <label for="total-medication">Total medication (g):</label>
                    <input type="number" id="total-medication" placeholder="e.g., 4" step="0.01">
                </div>

                <div class="input-group">
                    <label for="drug-purity" class="tooltip" data-tooltip="Purity percentage of the substance">Drug Purity (%):</label>
                    <input type="number" id="drug-purity" value="100" placeholder="e.g., 97" min="0" max="100">
                </div>

                <div class="input-group">
                    <label for="target-volume">Target volume (ml):</label>
                    <input type="number" id="target-volume" value="0.1" placeholder="e.g., 0.1" step="0.01">
                </div>
            </div>

            <button class="btn" onclick="calculateLiquidDose()">Calculate Liquid Dose</button>

            <div id="liquid-result" class="result" style="display: none;">
                <h3>Result:</h3>
                <div class="result-value" id="liquid-result-value"></div>
            </div>
        </div>

        <!-- MDMA Calculator -->
        <div id="mdma" class="calculator-section">
            <h2>💊 MDMA Dose Calculator</h2>
            <p>Calculate MDMA dosage based on body weight, experience, and individual factors with enhanced safety considerations</p>

            <div class="form-grid">
                <div class="input-group">
                    <label for="mdma-weight">Body Weight (kg):</label>
                    <input type="number" id="mdma-weight" placeholder="e.g., 70" min="40" max="150">
                </div>

                <div class="input-group">
                    <label for="mdma-duration">Desired Trip Duration:</label>
                    <select id="mdma-duration">
                        <option value="">Select Duration</option>
                        <option value="short">Short (3-4 hours)</option>
                        <option value="medium">Medium (4-6 hours)</option>
                        <option value="long">Long (6-8 hours)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="mdma-age" class="tooltip" data-tooltip="Age affects metabolism and safety considerations">Age (years) - Optional:</label>
                    <input type="number" id="mdma-age" placeholder="e.g., 25" min="18" max="80">
                </div>

                <div class="input-group">
                    <label for="mdma-gender">Gender:</label>
                    <select id="mdma-gender">
                        <option value="">Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other/Prefer not to say</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="mdma-experience" class="tooltip" data-tooltip="Your experience level with MDMA affects recommended dosage">Experience Level:</label>
                    <select id="mdma-experience">
                        <option value="">Select Experience</option>
                        <option value="beginner">Beginner (0-2 times)</option>
                        <option value="experienced" selected>Experienced (3-10 times)</option>
                        <option value="expert">Expert (10+ times)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="mdma-intensity">Desired Intensity:</label>
                    <select id="mdma-intensity">
                        <option value="">Select Intensity</option>
                        <option value="threshold">Threshold (mild effects)</option>
                        <option value="light">Light (noticeable effects)</option>
                        <option value="common" selected>Common (full experience)</option>
                        <option value="strong">Strong (intense experience)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="mdma-last-use" class="tooltip" data-tooltip="Time since last MDMA use affects tolerance and safety">Days since last MDMA use:</label>
                    <input type="number" id="mdma-last-use" placeholder="e.g., 90" min="0" value="90">
                </div>

                <div class="input-group">
                    <label for="mdma-setting">Setting/Environment:</label>
                    <select id="mdma-setting">
                        <option value="">Select Setting</option>
                        <option value="home" selected>Home/Private setting</option>
                        <option value="club">Club/Rave</option>
                        <option value="festival">Festival/Outdoor</option>
                        <option value="therapy">Therapeutic setting</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="mdma-medications" class="tooltip" data-tooltip="Current medications can interact dangerously with MDMA">Current Medications:</label>
                    <select id="mdma-medications">
                        <option value="">Select if taking medications</option>
                        <option value="none" selected>No medications</option>
                        <option value="ssri">SSRI Antidepressants (Prozac, Zoloft, etc.)</option>
                        <option value="snri">SNRI Antidepressants (Effexor, Cymbalta, etc.)</option>
                        <option value="maoi">MAOI Antidepressants (Nardil, Parnate, etc.)</option>
                        <option value="tricyclic">Tricyclic Antidepressants (Elavil, etc.)</option>
                        <option value="lithium">Lithium (mood stabilizer)</option>
                        <option value="tramadol">Tramadol (pain medication)</option>
                        <option value="dxm">DXM (cough medicine)</option>
                        <option value="other_serotonin">Other serotonergic medications</option>
                        <option value="other">Other medications (specify in notes)</option>
                    </select>
                </div>
            </div>

            <button class="btn" onclick="calculateMDMA()">Calculate MDMA Dose</button>

            <div id="mdma-result" class="result" style="display: none;">
                <h3>Recommended MDMA Dose:</h3>
                <div class="result-value" id="mdma-result-value"></div>
                <div id="mdma-details"></div>
            </div>
        </div>

        <!-- Enhanced LSD Calculator -->
        <div id="lsd" class="calculator-section">
            <h2>🌈 LSD Dose Calculator</h2>
            <p>Calculate LSD dosage with enhanced safety considerations and detailed experience information</p>

            <div class="form-grid">
                <div class="input-group">
                    <label for="lsd-weight">Body Weight (kg):</label>
                    <input type="number" id="lsd-weight" placeholder="e.g., 70" min="40" max="150">
                </div>

                <div class="input-group">
                    <label for="lsd-gender">Gender:</label>
                    <select id="lsd-gender">
                        <option value="">Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other/Prefer not to say</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="lsd-experience">Psychedelic Experience:</label>
                    <select id="lsd-experience">
                        <option value="">Select Experience</option>
                        <option value="beginner">Beginner (0-2 psychedelic experiences)</option>
                        <option value="experienced" selected>Experienced (3-15 experiences)</option>
                        <option value="expert">Expert (15+ experiences)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="lsd-intensity">Desired Intensity:</label>
                    <select id="lsd-intensity">
                        <option value="">Select Intensity</option>
                        <option value="microdose">Microdose (sub-perceptual)</option>
                        <option value="threshold">Threshold (barely perceptible)</option>
                        <option value="light">Light (clear effects)</option>
                        <option value="common" selected>Common (full experience)</option>
                        <option value="strong">Strong (intense experience)</option>
                        <option value="heavy">Heavy (overwhelming intensity)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="lsd-last-psychedelic" class="tooltip" data-tooltip="Time since last psychedelic use affects tolerance">Days since last psychedelic:</label>
                    <input type="number" id="lsd-last-psychedelic" placeholder="e.g., 14" min="0" value="14">
                </div>

                <div class="input-group">
                    <label for="lsd-setting">Setting/Environment:</label>
                    <select id="lsd-setting">
                        <option value="">Select Setting</option>
                        <option value="home" selected>Home/Safe indoor space</option>
                        <option value="nature">Nature/Outdoor setting</option>
                        <option value="controlled">Controlled/Therapeutic setting</option>
                        <option value="festival">Festival/Social gathering</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="lsd-duration">Desired Trip Duration:</label>
                    <select id="lsd-duration">
                        <option value="">Select Duration</option>
                        <option value="short">Short (6-8 hours)</option>
                        <option value="medium">Medium (8-12 hours)</option>
                        <option value="long">Long (12-16 hours)</option>
                    </select>
                </div>
            </div>

            <button class="btn" onclick="calculateLSD()">Calculate LSD Dose</button>

            <div id="lsd-result" class="result" style="display: none;">
                <h3>Recommended LSD Dose:</h3>
                <div class="result-value" id="lsd-result-value"></div>
                <div id="lsd-details"></div>
            </div>
        </div>

        <!-- Ketamine Calculator (Enhanced) -->
        <div id="ketamine" class="calculator-section">
            <h2>🧠 Ketamine Dose Calculator</h2>
            <p>Calculate ketamine dosage with comprehensive safety considerations and tolerance modeling</p>

            <div class="form-grid">
                <div class="input-group">
                    <label for="ket-weight">Body Weight (kg):</label>
                    <input type="number" id="ket-weight" placeholder="e.g., 70" min="40" max="150">
                </div>

                <div class="input-group">
                    <label for="ket-gender">Gender:</label>
                    <select id="ket-gender">
                        <option value="">Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other/Prefer not to say</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="ket-experience" class="tooltip" data-tooltip="Your experience level with dissociatives affects recommended dosage">Experience Level:</label>
                    <select id="ket-experience">
                        <option value="">Select Experience</option>
                        <option value="beginner">Beginner (0-3 times)</option>
                        <option value="experienced" selected>Experienced (4-15 times)</option>
                        <option value="expert">Expert (15+ times)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="ket-route">Route of Administration:</label>
                    <select id="ket-route">
                        <option value="">Select Route</option>
                        <option value="oral">Oral</option>
                        <option value="nasal">Nasal (insufflated)</option>
                        <option value="sublingual">Sublingual</option>
                        <option value="intramuscular">Intramuscular (IM)</option>
                        <option value="intravenous">Intravenous (IV)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="ket-intensity">Desired Intensity:</label>
                    <select id="ket-intensity">
                        <option value="">Select Intensity</option>
                        <option value="threshold">Threshold (mild dissociation)</option>
                        <option value="light">Light (noticeable effects)</option>
                        <option value="common" selected>Common (full dissociative experience)</option>
                        <option value="strong">Strong (intense dissociation)</option>
                        <option value="k-hole">K-hole (complete dissociation)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="ket-last-use" class="tooltip" data-tooltip="Time since last ketamine/dissociative use affects tolerance">Days since last ketamine use:</label>
                    <input type="number" id="ket-last-use" placeholder="e.g., 7" min="0" value="7">
                </div>

                <div class="input-group">
                    <label for="ket-setting">Setting/Environment:</label>
                    <select id="ket-setting">
                        <option value="">Select Setting</option>
                        <option value="home" selected>Home/Safe indoor space</option>
                        <option value="therapeutic">Therapeutic/Medical setting</option>
                        <option value="party">Party/Social gathering</option>
                        <option value="club">Club/Rave</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="ket-tolerance-history" class="tooltip" data-tooltip="How frequently have you used ketamine in the past 3 months?">Recent Usage Pattern:</label>
                    <select id="ket-tolerance-history">
                        <option value="">Select Pattern</option>
                        <option value="none">No recent use (3+ months)</option>
                        <option value="occasional">Occasional (1-3 times)</option>
                        <option value="regular">Regular (4-10 times)</option>
                        <option value="frequent">Frequent (10+ times)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="ket-duration">Desired Trip Duration:</label>
                    <select id="ket-duration">
                        <option value="">Select Duration</option>
                        <option value="short">Short (45-90 minutes)</option>
                        <option value="medium">Medium (1-2 hours)</option>
                        <option value="long">Long (2-4 hours)</option>
                    </select>
                </div>
            </div>

            <button class="btn" onclick="calculateKetamine()">Calculate Ketamine Dose</button>

            <div id="ketamine-result" class="result" style="display: none;">
                <h3>Recommended Ketamine Dose:</h3>
                <div class="result-value" id="ket-result-value"></div>
                <div id="ket-details"></div>
                <div class="scientific-note">
                    Based on ketamine's tolerance half-life of approximately 3-5 days and NMDA receptor downregulation patterns.
                </div>
            </div>
        </div>

        <!-- GHB/GBL Calculator -->
        <div id="ghb" class="calculator-section">
            <h2>🥤 GHB/GBL Dose Calculator</h2>
            <p>Calculate GHB or GBL dosage with comprehensive safety considerations and harm reduction factors</p>

            <div class="form-grid">
                <div class="input-group">
                    <label for="ghb-weight">Body Weight (kg):</label>
                    <input type="number" id="ghb-weight" placeholder="e.g., 70" min="40" max="150">
                </div>

                <div class="input-group">
                    <label for="ghb-gender">Gender:</label>
                    <select id="ghb-gender">
                        <option value="">Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other/Prefer not to say</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="ghb-substance">Substance:</label>
                    <select id="ghb-substance">
                        <option value="">Select Substance</option>
                        <option value="ghb">GHB (Sodium γ-hydroxybutyrate)</option>
                        <option value="gbl">GBL (γ-butyrolactone)</option>
                        <option value="bdo">1,4-BDO (1,4-butanediol)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="ghb-experience" class="tooltip" data-tooltip="Your experience level with GHB/depressants affects safety considerations">Experience Level:</label>
                    <select id="ghb-experience">
                        <option value="">Select Experience</option>
                        <option value="beginner">Beginner (0-2 times)</option>
                        <option value="experienced" selected>Experienced (3-10 times)</option>
                        <option value="expert">Expert (10+ times)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="ghb-intensity">Desired Intensity:</label>
                    <select id="ghb-intensity">
                        <option value="">Select Intensity</option>
                        <option value="threshold">Threshold (mild relaxation)</option>
                        <option value="light">Light (noticeable effects)</option>
                        <option value="common" selected>Common (full euphoric effects)</option>
                        <option value="strong">Strong (intense sedation)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="ghb-last-use" class="tooltip" data-tooltip="Time since last GHB/depressant use affects tolerance">Days since last GHB use:</label>
                    <input type="number" id="ghb-last-use" placeholder="e.g., 3" min="0" value="3">
                </div>

                <div class="input-group">
                    <label for="ghb-stomach" class="tooltip" data-tooltip="Food in stomach significantly affects absorption and safety">Stomach Status:</label>
                    <select id="ghb-stomach">
                        <option value="">Select Status</option>
                        <option value="empty">Empty stomach (4+ hours since food)</option>
                        <option value="light">Light food (2-3 hours ago)</option>
                        <option value="full">Full stomach (recent meal)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="ghb-setting">Setting/Environment:</label>
                    <select id="ghb-setting">
                        <option value="">Select Setting</option>
                        <option value="home" selected>Home/Safe indoor space</option>
                        <option value="party">House party/Small gathering</option>
                        <option value="club">Club/Rave</option>
                        <option value="therapeutic">Therapeutic/Medical setting</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="ghb-alcohol" class="tooltip" data-tooltip="ANY alcohol consumption with GHB is extremely dangerous">Alcohol Consumption:</label>
                    <select id="ghb-alcohol">
                        <option value="">Select Status</option>
                        <option value="none" selected>No alcohol (past 12+ hours)</option>
                        <option value="recent">Recent alcohol (within 12 hours)</option>
                        <option value="current">Currently under alcohol influence</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="ghb-duration">Desired Trip Duration:</label>
                    <select id="ghb-duration">
                        <option value="">Select Duration</option>
                        <option value="short">Short (1-2 hours)</option>
                        <option value="medium">Medium (2-4 hours)</option>
                        <option value="long">Long (4-6 hours)</option>
                    </select>
                </div>
            </div>

            <button class="btn" onclick="calculateGHB()">Calculate GHB/GBL Dose</button>

            <div id="ghb-result" class="result" style="display: none;">
                <h3>Recommended Dose:</h3>
                <div class="result-value" id="ghb-result-value"></div>
                <div id="ghb-details"></div>
            </div>
        </div>

        <!-- Amphetamines Calculator -->
        <div id="amphetamines" class="calculator-section">
            <h2>⚡ Amphetamines Dose Calculator</h2>
            <p>Calculate amphetamine dosage with comprehensive safety considerations and tolerance modeling</p>

            <div class="form-grid">
                <div class="input-group">
                    <label for="amp-weight">Body Weight (kg):</label>
                    <input type="number" id="amp-weight" placeholder="e.g., 70" min="40" max="150">
                </div>

                <div class="input-group">
                    <label for="amp-gender">Gender:</label>
                    <select id="amp-gender">
                        <option value="">Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other/Prefer not to say</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="amp-substance">Substance Type:</label>
                    <select id="amp-substance">
                        <option value="">Select Substance</option>
                        <option value="amphetamine">Amphetamine (racemic)</option>
                        <option value="dextroamphetamine">Dextroamphetamine</option>
                        <option value="methamphetamine">Methamphetamine</option>
                        <option value="adderall">Adderall (mixed salts)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="amp-experience" class="tooltip" data-tooltip="Your experience level with stimulants affects safety considerations">Experience Level:</label>
                    <select id="amp-experience">
                        <option value="">Select Experience</option>
                        <option value="beginner">Beginner (0-3 times)</option>
                        <option value="experienced" selected>Experienced (4-20 times)</option>
                        <option value="expert">Expert (20+ times)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="amp-route">Route of Administration:</label>
                    <select id="amp-route">
                        <option value="">Select Route</option>
                        <option value="oral">Oral (swallowed)</option>
                        <option value="nasal">Nasal (insufflated)</option>
                        <option value="sublingual">Sublingual (under tongue)</option>
                        <option value="rectal">Rectal (plugged)</option>
                        <option value="intravenous">Intravenous (IV)</option>
                        <option value="smoked">Smoked/Vaporized</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="amp-intensity">Desired Intensity:</label>
                    <select id="amp-intensity">
                        <option value="">Select Intensity</option>
                        <option value="threshold">Threshold (mild stimulation)</option>
                        <option value="light">Light (clear effects)</option>
                        <option value="common" selected>Common (full stimulation)</option>
                        <option value="strong">Strong (intense effects)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="amp-last-use" class="tooltip" data-tooltip="Time since last stimulant use affects tolerance">Days since last stimulant use:</label>
                    <input type="number" id="amp-last-use" placeholder="e.g., 7" min="0" value="7">
                </div>

                <div class="input-group">
                    <label for="amp-setting">Setting/Environment:</label>
                    <select id="amp-setting">
                        <option value="">Select Setting</option>
                        <option value="home" selected>Home/Study environment</option>
                        <option value="work">Work/Productivity setting</option>
                        <option value="party">Party/Social gathering</option>
                        <option value="club">Club/Rave</option>
                        <option value="therapeutic">Therapeutic/Medical setting</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="amp-health" class="tooltip" data-tooltip="Cardiovascular conditions significantly affect stimulant safety">Cardiovascular Health:</label>
                    <select id="amp-health">
                        <option value="">Select Status</option>
                        <option value="healthy" selected>Healthy (no known issues)</option>
                        <option value="minor">Minor issues (controlled)</option>
                        <option value="moderate">Moderate cardiovascular concerns</option>
                        <option value="serious">Serious heart/blood pressure issues</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="amp-duration">Desired Trip Duration:</label>
                    <select id="amp-duration">
                        <option value="">Select Duration</option>
                        <option value="short">Short (4-6 hours)</option>
                        <option value="medium">Medium (6-10 hours)</option>
                        <option value="long">Long (8-12 hours)</option>
                    </select>
                </div>
            </div>

            <button class="btn" onclick="calculateAmphetamines()">Calculate Amphetamine Dose</button>

            <div id="amp-result" class="result" style="display: none;">
                <h3>Recommended Dose:</h3>
                <div class="result-value" id="amp-result-value"></div>
                <div id="amp-details"></div>
            </div>
        </div>

        <!-- Cocaine Calculator -->
        <div id="cocaine" class="calculator-section">
            <h2>❄️ Cocaine Dose Calculator</h2>
            <p>Calculate cocaine dosage with comprehensive safety considerations and harm reduction factors</p>

            <div class="form-grid">
                <div class="input-group">
                    <label for="coc-weight">Body Weight (kg):</label>
                    <input type="number" id="coc-weight" placeholder="e.g., 70" min="40" max="150">
                </div>

                <div class="input-group">
                    <label for="coc-gender">Gender:</label>
                    <select id="coc-gender">
                        <option value="">Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other/Prefer not to say</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="coc-experience" class="tooltip" data-tooltip="Your experience level with stimulants affects safety considerations">Experience Level:</label>
                    <select id="coc-experience">
                        <option value="">Select Experience</option>
                        <option value="beginner">Beginner (0-3 times)</option>
                        <option value="experienced" selected>Experienced (4-15 times)</option>
                        <option value="expert">Expert (15+ times)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="coc-route">Route of Administration:</label>
                    <select id="coc-route">
                        <option value="">Select Route</option>
                        <option value="nasal">Nasal (insufflated)</option>
                        <option value="oral">Oral (swallowed)</option>
                        <option value="gums">Gums (rubbed on gums)</option>
                        <option value="smoked">Smoked (crack/freebase)</option>
                        <option value="intravenous">Intravenous (IV)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="coc-intensity">Desired Intensity:</label>
                    <select id="coc-intensity">
                        <option value="">Select Intensity</option>
                        <option value="threshold">Threshold (mild stimulation)</option>
                        <option value="light">Light (clear effects)</option>
                        <option value="common" selected>Common (full stimulation)</option>
                        <option value="strong">Strong (intense effects)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="coc-last-use" class="tooltip" data-tooltip="Time since last stimulant use affects tolerance">Days since last cocaine use:</label>
                    <input type="number" id="coc-last-use" placeholder="e.g., 14" min="0" value="14">
                </div>

                <div class="input-group">
                    <label for="coc-setting">Setting/Environment:</label>
                    <select id="coc-setting">
                        <option value="">Select Setting</option>
                        <option value="home" selected>Home/Private setting</option>
                        <option value="party">Party/Social gathering</option>
                        <option value="club">Club/Nightlife</option>
                        <option value="public">Public/Outdoor setting</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="coc-health" class="tooltip" data-tooltip="Cardiovascular health is critical with cocaine use">Cardiovascular Health:</label>
                    <select id="coc-health">
                        <option value="">Select Status</option>
                        <option value="healthy" selected>Healthy (no known issues)</option>
                        <option value="minor">Minor issues (controlled)</option>
                        <option value="moderate">Moderate cardiovascular concerns</option>
                        <option value="serious">Serious heart/blood pressure issues</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="coc-alcohol" class="tooltip" data-tooltip="Alcohol and cocaine create dangerous cocaethylene">Alcohol Consumption:</label>
                    <select id="coc-alcohol">
                        <option value="">Select Status</option>
                        <option value="none" selected>No alcohol (past 12+ hours)</option>
                        <option value="recent">Recent alcohol (within 12 hours)</option>
                        <option value="current">Currently under alcohol influence</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="coc-duration">Desired Trip Duration:</label>
                    <select id="coc-duration">
                        <option value="">Select Duration</option>
                        <option value="short">Short (30-60 minutes)</option>
                        <option value="medium">Medium (1-2 hours)</option>
                        <option value="long">Long (2-4 hours)</option>
                    </select>
                </div>
            </div>

            <button class="btn" onclick="calculateCocaine()">Calculate Cocaine Dose</button>

            <div id="coc-result" class="result" style="display: none;">
                <h3>Recommended Dose:</h3>
                <div class="result-value" id="coc-result-value"></div>
                <div id="coc-details"></div>
            </div>
        </div>

        <!-- 4-MMC Calculator (Enhanced) -->
        <div id="4mmc" class="calculator-section">
            <h2>🔥 4-MMC (Mephedrone) Calculator</h2>
            <p>Calculate safe 4-MMC dosage with comprehensive harm reduction factors</p>

            <div class="form-grid">
                <div class="input-group">
                    <label for="mmc-weight">Body Weight (kg):</label>
                    <input type="number" id="mmc-weight" placeholder="e.g., 70" min="40" max="150">
                </div>

                <div class="input-group">
                    <label for="mmc-gender">Gender:</label>
                    <select id="mmc-gender">
                        <option value="">Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other/Non-binary</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="mmc-experience">Experience Level:</label>
                    <select id="mmc-experience">
                        <option value="">Select Experience</option>
                        <option value="beginner">Beginner (No/Limited experience)</option>
                        <option value="experienced" selected>Experienced (Regular user)</option>
                        <option value="expert">Expert (Extensive experience)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="mmc-route">Route of Administration:</label>
                    <select id="mmc-route">
                        <option value="">Select Route</option>
                        <option value="oral">Oral (Capsule/Bomb)</option>
                        <option value="nasal">Nasal (Insufflation)</option>
                        <option value="rectal">Rectal (Plugging)</option>
                        <option value="intravenous">Intravenous (IV) - EXTREME RISK</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="mmc-intensity">Desired Intensity:</label>
                    <select id="mmc-intensity">
                        <option value="">Select Intensity</option>
                        <option value="threshold">Threshold (Just noticeable)</option>
                        <option value="light">Light (Mild effects)</option>
                        <option value="common" selected>Common (Moderate effects)</option>
                        <option value="strong">Strong (Intense effects)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="mmc-last-use">Days Since Last 4-MMC Use:</label>
                    <input type="number" id="mmc-last-use" placeholder="e.g., 14" min="0" max="365">
                </div>

                <div class="input-group">
                    <label for="mmc-setting">Setting/Environment:</label>
                    <select id="mmc-setting">
                        <option value="">Select Setting</option>
                        <option value="home" selected>Home (Safe, controlled)</option>
                        <option value="party">House Party (Social)</option>
                        <option value="club">Club/Rave (High stimulation)</option>
                        <option value="public">Public/Unknown (Higher risk)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="mmc-cardiovascular">Cardiovascular Health:</label>
                    <select id="mmc-cardiovascular">
                        <option value="">Select Health Status</option>
                        <option value="healthy" selected>Healthy (No issues)</option>
                        <option value="minor">Minor concerns (Mild hypertension)</option>
                        <option value="moderate">Moderate issues (Heart conditions)</option>
                        <option value="serious">Serious conditions (Contraindicated)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="mmc-temperature">Temperature Management:</label>
                    <select id="mmc-temperature">
                        <option value="">Select Environment</option>
                        <option value="cool">Cool environment (Good ventilation)</option>
                        <option value="warm">Warm environment (Limited ventilation)</option>
                        <option value="hot">Hot environment (Poor ventilation/crowds)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="mmc-serotonin">Recent Serotonergic Drug Use:</label>
                    <select id="mmc-serotonin">
                        <option value="">Select Recent Use</option>
                        <option value="none" selected>None in past 3 months</option>
                        <option value="mdma">MDMA/MDA within 3 months</option>
                        <option value="antidepressants">On antidepressants (SSRIs/SNRIs)</option>
                        <option value="recent">Other serotonergic drugs recently</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="mmc-duration">Desired Trip Duration:</label>
                    <select id="mmc-duration">
                        <option value="">Select Duration</option>
                        <option value="short">Short (2-4 hours)</option>
                        <option value="medium">Medium (4-6 hours)</option>
                        <option value="long">Long (6-8 hours)</option>
                    </select>
                </div>
            </div>

            <button class="btn" onclick="calculate4MMC()">Calculate 4-MMC Dose</button>

            <div id="mmc-result" class="result" style="display: none;">
                <h3>Recommended 4-MMC Dose:</h3>
                <div class="result-value" id="mmc-result-value"></div>
                <div id="mmc-details"></div>
            </div>
        </div>

        <!-- Tolerance Calculator -->
        <div id="tolerance" class="calculator-section">
            <h2>⚖️ Tolerance Calculator</h2>
            <p>Calculate how much you need to take for the same effect based on previous dose and time elapsed</p>

            <div class="form-grid">
                <div class="input-group">
                    <label for="tol-substance" class="tooltip" data-tooltip="Different substances have different tolerance patterns">Substance Type:</label>
                    <select id="tol-substance">
                        <option value="">Select Substance</option>
                        
                        <!-- Psychedelics -->
                        <option value="lsd">LSD (Lysergic Acid Diethylamide)</option>
                        <option value="psilocybin">Psilocybin (Magic Mushrooms)</option>
                        <option value="dmt">DMT (N,N-Dimethyltryptamine)</option>
                        <option value="2cb">2C-B</option>
                        <option value="mescaline">Mescaline</option>
                        
                        <!-- Entactogens -->
                        <option value="mdma">MDMA (Ecstasy/Molly)</option>
                        <option value="mda">MDA (Methylenedioxyamphetamine)</option>
                        <option value="4mmc">4-MMC (Mephedrone)</option>
                        <option value="6apb">6-APB</option>
                        
                        <!-- Stimulants -->
                        <option value="amphetamine">Amphetamine (Speed)</option>
                        <option value="dextroamphetamine">Dextroamphetamine (Dexedrine)</option>
                        <option value="methamphetamine">Methamphetamine (Crystal)</option>
                        <option value="cocaine">Cocaine</option>
                        <option value="caffeine">Caffeine</option>
                        <option value="modafinil">Modafinil</option>
                        
                        <!-- Dissociatives -->
                        <option value="ketamine">Ketamine</option>
                        <option value="dxm">DXM (Dextromethorphan)</option>
                        <option value="pcp">PCP</option>
                        <option value="3meopcp">3-MeO-PCP</option>
                        
                        <!-- Depressants -->
                        <option value="ghb">GHB (γ-Hydroxybutyric acid)</option>
                        <option value="gbl">GBL (γ-Butyrolactone)</option>
                        <option value="phenibut">Phenibut</option>
                        <option value="alcohol">Alcohol (Ethanol)</option>
                        <option value="xanax">Xanax (Alprazolam)</option>
                        <option value="valium">Valium (Diazepam)</option>
                        
                        <!-- Opioids -->
                        <option value="morphine">Morphine</option>
                        <option value="oxycodone">Oxycodone</option>
                        <option value="tramadol">Tramadol</option>
                        <option value="kratom">Kratom</option>
                        
                        <!-- Cannabis -->
                        <option value="thc">THC (Cannabis)</option>
                        <option value="cbd">CBD</option>
                        
                        <!-- Other -->
                        <option value="nitrous">Nitrous Oxide (N2O)</option>
                        <option value="custom">Custom (specify half-life)</option>
                    </select>
                </div>

                <div class="input-group" id="custom-halflife-group" style="display: none;">
                    <label for="tol-custom-halflife" class="tooltip" data-tooltip="Tolerance half-life in days - how long it takes for tolerance to reduce by 50%">Custom Tolerance Half-life (days):</label>
                    <input type="number" id="tol-custom-halflife" placeholder="e.g., 3" min="0.1" step="0.1">
                </div>

                <div class="input-group">
                    <label for="tol-previous-dose">Previous Dose:</label>
                    <input type="number" id="tol-previous-dose" placeholder="e.g., 100" step="0.1">
                </div>

                <div class="input-group">
                    <label for="tol-dose-unit">Dose Unit:</label>
                    <select id="tol-dose-unit">
                        <option value="mg">mg (milligrams)</option>
                        <option value="μg">μg (micrograms)</option>
                        <option value="g">g (grams)</option>
                        <option value="ml">ml (milliliters)</option>
                        <option value="tabs">tabs/hits</option>
                        <option value="custom">custom unit</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="tol-days-ago">Days Since Last Dose:</label>
                    <input type="number" id="tol-days-ago" placeholder="e.g., 4" min="0" step="0.1">
                </div>

                <div class="input-group">
                    <label for="tol-target-effect" class="tooltip" data-tooltip="What effect level are you aiming for?">Target Effect Level:</label>
                    <select id="tol-target-effect">
                        <option value="same">Same as previous dose</option>
                        <option value="stronger">Stronger than previous</option>
                        <option value="weaker">Weaker than previous</option>
                        <option value="baseline">Baseline (no tolerance)</option>
                    </select>
                </div>

                <div class="input-group" id="effect-multiplier-group" style="display: none;">
                    <label for="tol-effect-multiplier" class="tooltip" data-tooltip="How much stronger/weaker? 1.5 = 50% stronger, 0.7 = 30% weaker">Effect Multiplier:</label>
                    <input type="number" id="tol-effect-multiplier" placeholder="e.g., 1.5" min="0.1" max="3" step="0.1" value="1">
                </div>
            </div>

            <button class="btn" onclick="calculateGeneralTolerance()">Calculate Required Dose</button>

            <div id="tolerance-result" class="result" style="display: none;">
                <h3>Recommended Dose for Same Effect:</h3>
                <div class="result-value" id="tolerance-result-value"></div>
                <div id="tolerance-details"></div>
                
                <!-- Tolerance Recovery Graph -->
                <div class="graph-container" id="tolerance-graph-container" style="margin-top: 25px;">
                    <h4 style="text-align: center; color: #155724; margin-bottom: 15px;">📊 Tolerance Recovery Over Time</h4>
                    <div class="graph-wrapper">
                        <canvas id="tolerance-graph" width="600" height="300"></canvas>
                    </div>
                    <div class="graph-legend">
                        <div class="legend-item">
                            <span class="legend-color" style="background: #667eea;"></span>
                            <span>Tolerance Level (%)</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color" style="background: #ff6b6b;"></span>
                            <span>Current Day</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 2-MMC Calculator -->
        <div id="2mmc" class="calculator-section">
            <h2>⚡ 2-MMC (2-Methylmethcathinone) Calculator</h2>
            <p>Advanced dosage calculator for 2-MMC with comprehensive safety factors and health warnings</p>
            
            <div class="safety-warning" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.05) 100%); border: 2px solid rgba(239, 68, 68, 0.3); border-radius: 12px; padding: 20px; margin: 20px 0;">
                <h3 style="color: #ef4444; margin-bottom: 15px;">⚠️ CRITICAL SAFETY WARNING</h3>
                <div style="display: grid; gap: 10px;">
                    <p style="margin: 0; font-weight: 600;">🚨 2-MMC is a synthetic cathinone with EXTREME addiction potential and significant health risks:</p>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li><strong>Extremely high addiction risk</strong> - can develop after just a few uses</li>
                        <li><strong>Severe cardiovascular stress</strong> - risk of heart attack and stroke</li>
                        <li><strong>Hyperthermia danger</strong> - potentially fatal overheating</li>
                        <li><strong>Compulsive redosing</strong> - very difficult to control intake</li>
                        <li><strong>Limited research</strong> - unknown long-term effects</li>
                    </ul>
                    <p style="margin: 0; font-weight: 600; color: #dc2626;">This calculator is for harm reduction only. We strongly advise against using 2-MMC.</p>
                </div>
            </div>

            <div class="input-container">
                <div class="input-group">
                    <label for="2mmc-weight">Body Weight (kg):</label>
                    <input type="number" id="2mmc-weight" placeholder="Enter weight in kg" min="30" max="200" step="0.1">
                </div>

                <div class="input-group">
                    <label for="2mmc-experience">Experience Level:</label>
                    <select id="2mmc-experience">
                        <option value="">Select Experience</option>
                        <option value="first-time">First Time User</option>
                        <option value="inexperienced">Inexperienced (1-3 times)</option>
                        <option value="experienced">Experienced (4+ times)</option>
                        <option value="very-experienced">Very Experienced (10+ times)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="2mmc-route">Route of Administration:</label>
                    <select id="2mmc-route">
                        <option value="">Select Route</option>
                        <option value="oral">Oral (Recommended - Safer)</option>
                        <option value="nasal">Nasal (Higher Risk - Tissue Damage)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="2mmc-last-use">Time Since Last 2-MMC Use:</label>
                    <select id="2mmc-last-use">
                        <option value="">Select Time Frame</option>
                        <option value="never">Never used before</option>
                        <option value="1-week">1 week or more</option>
                        <option value="3-days">3-6 days ago</option>
                        <option value="1-day">1-2 days ago (HIGH TOLERANCE)</option>
                        <option value="same-day">Same day (DANGEROUS - DO NOT USE)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="2mmc-setting">Environment/Setting:</label>
                    <select id="2mmc-setting">
                        <option value="">Select Setting</option>
                        <option value="home">At home (Safe, controlled)</option>
                        <option value="private">Private party (Familiar people)</option>
                        <option value="public">Public venue/club (Higher risk)</option>
                        <option value="outdoor">Outdoor event (Variable conditions)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="2mmc-temperature">Temperature Control:</label>
                    <select id="2mmc-temperature">
                        <option value="">Select Environment</option>
                        <option value="cool">Cool environment (Good ventilation)</option>
                        <option value="warm">Warm environment (Limited ventilation)</option>
                        <option value="hot">Hot environment (Poor ventilation/crowds)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="2mmc-serotonin">Recent Serotonergic Drug Use:</label>
                    <select id="2mmc-serotonin">
                        <option value="">Select Recent Use</option>
                        <option value="none">None in past 2 weeks</option>
                        <option value="mdma">MDMA in past week (DANGEROUS COMBINATION)</option>
                        <option value="ssri">On SSRI medication (DANGEROUS COMBINATION)</option>
                        <option value="other-stim">Other stimulants recently (HIGH RISK)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="2mmc-medical">Medical Conditions:</label>
                    <select id="2mmc-medical">
                        <option value="">Select Condition</option>
                        <option value="none">No relevant conditions</option>
                        <option value="cardiac">Heart condition (DO NOT USE)</option>
                        <option value="hypertension">High blood pressure (DO NOT USE)</option>
                        <option value="mental-health">Mental health condition (HIGH RISK)</option>
                        <option value="medication">On medication (CHECK INTERACTIONS)</option>
                    </select>
                </div>

                <button onclick="calculate2MMC()" class="calculate-btn">Calculate 2-MMC Dosage</button>

                <div id="2mmc-results" class="results-container" style="display: none;">
                    <div class="results-header">
                        <h3>📊 2-MMC Dosage Recommendations</h3>
                    </div>
                    <div class="results-content">
                        <div class="dosage-card" id="2mmc-threshold">
                            <h4>🌱 Threshold Dose</h4>
                            <p class="dose-amount" id="2mmc-threshold-dose">-</p>
                            <p class="dose-description">Minimal effects, good for testing sensitivity</p>
                        </div>
                        <div class="dosage-card" id="2mmc-light">
                            <h4>✨ Light Dose</h4>
                            <p class="dose-amount" id="2mmc-light-dose">-</p>
                            <p class="dose-description">Mild stimulation and mood enhancement</p>
                        </div>
                        <div class="dosage-card" id="2mmc-common">
                            <h4>🌟 Common Dose</h4>
                            <p class="dose-amount" id="2mmc-common-dose">-</p>
                            <p class="dose-description">Full effects, recommended maximum</p>
                        </div>
                        <div class="dosage-card danger" id="2mmc-danger">
                            <h4>⚠️ Dangerous Territory</h4>
                            <p class="dose-amount" id="2mmc-danger-dose">-</p>
                            <p class="dose-description">HIGH RISK - Avoid these doses</p>
                        </div>
                    </div>
                    
                    <div class="safety-recommendations" id="2mmc-safety">
                        <h4>🛡️ Safety Recommendations</h4>
                        <div id="2mmc-safety-content"></div>
                    </div>
                    
                    <div class="timeline-info">
                        <h4>⏱️ 2-MMC Timeline</h4>
                        <div class="timeline-grid">
                            <div class="timeline-item">
                                <strong>Onset (Oral):</strong> 20-45 minutes<br>
                                <strong>Onset (Nasal):</strong> 5-15 minutes
                            </div>
                            <div class="timeline-item">
                                <strong>Peak:</strong> 1-3 hours<br>
                                <strong>Duration:</strong> 3-6 hours
                            </div>
                            <div class="timeline-item">
                                <strong>Come-down:</strong> 2-4 hours<br>
                                <strong>After-effects:</strong> 6-24 hours
                            </div>
                        </div>
                    </div>

                    <div class="emergency-info">
                        <h4 style="color: #ef4444;">🚨 Emergency Information</h4>
                        <p><strong>Call 112/911 if experiencing:</strong></p>
                        <ul>
                            <li>Chest pain or heart palpitations</li>
                            <li>Difficulty breathing</li>
                            <li>Extreme overheating</li>
                            <li>Seizures or convulsions</li>
                            <li>Loss of consciousness</li>
                            <li>Severe anxiety or panic</li>
                        </ul>
                        <p><strong>Tell medical professionals exactly what was taken and when.</strong></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Drug Information/Wiki Section -->
        <div id="drug-info" class="calculator-section">
            <h2>📚 Drug Information & Harm Reduction Wiki</h2>
            <p>Comprehensive information for harm reduction, first-time use, emergency protocols, and trip-sitting</p>

            <!-- Overview Section -->
            <div id="drug-info-overview" class="drug-info-content active">
                <h3>🏠 Welcome to the Drug Information & Harm Reduction Wiki</h3>
                <div class="info-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; margin: 2rem 0;">
                    
                    <div class="info-card" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; border: 1px solid var(--border-color);">
                        <h4 style="color: var(--primary-color); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                            🌱 First Time Users
                        </h4>
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">Essential information for those considering or planning their first experience with any substance.</p>
                        <ul style="color: var(--text-secondary); padding-left: 1.5rem;">
                            <li>Preparation and set/setting guidelines</li>
                            <li>Dosage recommendations for beginners</li>
                            <li>What to expect during different phases</li>
                            <li>Safety precautions and contraindications</li>
                        </ul>
                    </div>

                    <div class="info-card" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; border: 1px solid var(--border-color);">
                        <h4 style="color: var(--accent-color); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                            ⏰ Redosing Information
                        </h4>
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">Science-based guidelines on when and how to safely redose different substances.</p>
                        <ul style="color: var(--text-secondary); padding-left: 1.5rem;">
                            <li>Optimal timing for redoses</li>
                            <li>Recommended redose amounts</li>
                            <li>Tolerance considerations</li>
                            <li>When NOT to redose</li>
                        </ul>
                    </div>

                    <div class="info-card" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; border: 1px solid var(--border-color);">
                        <h4 style="color: var(--success-color); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                            ✅ Safety Guidelines
                        </h4>
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">Essential dos and don'ts for responsible use and risk minimization.</p>
                        <ul style="color: var(--text-secondary); padding-left: 1.5rem;">
                            <li>Critical safety protocols</li>
                            <li>Drug interaction warnings</li>
                            <li>Environmental considerations</li>
                            <li>Health monitoring guidelines</li>
                        </ul>
                    </div>

                    <div class="info-card" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; border: 1px solid var(--border-color);">
                        <h4 style="color: var(--danger-color); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                            🚨 Emergency Information
                        </h4>
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">Critical emergency contacts and procedures for Germany, Switzerland, and other regions.</p>
                        <ul style="color: var(--text-secondary); padding-left: 1.5rem;">
                            <li>Emergency phone numbers by country</li>
                            <li>Poison control centers</li>
                            <li>Crisis intervention resources</li>
                            <li>Hospital preparation guidelines</li>
                        </ul>
                    </div>

                    <div class="info-card" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; border: 1px solid var(--border-color);">
                        <h4 style="color: var(--warning-color); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                            🤝 Trip-Sitting Guide
                        </h4>
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">Comprehensive guide for supporting someone during their psychoactive experience.</p>
                        <ul style="color: var(--text-secondary); padding-left: 1.5rem;">
                            <li>How to be an effective trip-sitter</li>
                            <li>Communication strategies</li>
                            <li>Recognizing problem situations</li>
                            <li>Creating safe environments</li>
                        </ul>
                    </div>

                    <div class="info-card" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; border: 1px solid var(--border-color);">
                        <h4 style="color: var(--secondary-color); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                            🛡️ Harm Reduction
                        </h4>
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">Evidence-based strategies to minimize risks and maximize safety.</p>
                        <ul style="color: var(--text-secondary); padding-left: 1.5rem;">
                            <li>Drug testing and purity assessment</li>
                            <li>Safe use practices</li>
                            <li>Recovery and integration</li>
                            <li>Resource networks and support</li>
                        </ul>
                    </div>
                </div>

                <div class="disclaimer" style="margin-top: 2rem;">
                    <h4>Educational Purpose & Legal Disclaimer</h4>
                    <p>This information is provided for educational and harm reduction purposes only. The use of controlled substances may be illegal in your jurisdiction. Always consult with healthcare professionals and follow local laws. This information does not constitute medical advice.</p>
                </div>
            </div>

            <!-- First Time Use Section -->
            <div id="drug-info-first-time" class="drug-info-content">
                <h3>🌱 First Time Use Guide</h3>
                
                <!-- General Preparation -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">🎯 Pre-Experience Preparation</h4>
                    
                    <div class="preparation-checklist" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">✅ Essential Checklist</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem;">
                                <li><strong>Research extensively</strong> - Know the effects, duration, and risks</li>
                                <li><strong>Test your substance</strong> - Use reagent tests when possible</li>
                                <li><strong>Start with low doses</strong> - You can always take more, but never less</li>
                                <li><strong>Have a trusted trip-sitter</strong> - Preferably experienced and sober</li>
                                <li><strong>Choose safe setting</strong> - Comfortable, familiar environment</li>
                                <li><strong>Clear schedule</strong> - No responsibilities for 24+ hours</li>
                                <li><strong>Mental preparation</strong> - Positive mindset and expectations</li>
                            </ul>
                        </div>
                        
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">⚠️ Red Flags - DO NOT Use If:</h5>
                            <ul style="color: var(--danger-color); padding-left: 1.5rem;">
                                <li>Taking antidepressants or other medications</li>
                                <li>History of heart problems or high blood pressure</li>
                                <li>Mental health conditions (bipolar, psychosis, severe anxiety)</li>
                                <li>Pregnant or breastfeeding</li>
                                <li>Under 18 years old</li>
                                <li>Family history of schizophrenia or psychotic disorders</li>
                                <li>Feeling anxious, depressed, or unstable</li>
                                <li>In an unsafe or unfamiliar environment</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Set and Setting -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--accent-color); margin-bottom: 1rem;">🌍 Set and Setting Guidelines</h4>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🧠 Set (Your Mental State)</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem;">
                                <li><strong>Positive mood</strong> - Feeling good and optimistic</li>
                                <li><strong>Well-rested</strong> - Good sleep the night before</li>
                                <li><strong>Properly nourished</strong> - Eaten appropriately for the substance</li>
                                <li><strong>Hydrated</strong> - Good hydration status</li>
                                <li><strong>Clear intentions</strong> - Know why you're doing this</li>
                                <li><strong>Prepared mindset</strong> - Ready for unexpected experiences</li>
                            </ul>
                        </div>
                        
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🏠 Setting (Your Environment)</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem;">
                                <li><strong>Safe location</strong> - Familiar, private space</li>
                                <li><strong>Comfortable temperature</strong> - Good ventilation</li>
                                <li><strong>Minimal distractions</strong> - Phone on silent, no obligations</li>
                                <li><strong>Trusted companions</strong> - People you feel safe with</li>
                                <li><strong>Easy access to necessities</strong> - Water, bathroom, comfortable seating</li>
                                <li><strong>Escape route</strong> - Ability to change environments if needed</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Additional Drug Info Sections -->
            <div id="drug-info-redosing" class="drug-info-content">
                <h3>⏰ Redosing Guidelines</h3>
                <div class="warning" style="margin-bottom: 2rem;">
                    <h4>⚠️ Important Redosing Warning</h4>
                    <p>Redosing significantly increases risks including overdose, dangerous drug interactions, prolonged effects, increased toxicity, and unpredictable responses. Many substances have non-linear dose-response curves.</p>
                </div>
                
                <div class="redosing-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin: 2rem 0;">
                    <div class="info-card" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; border: 1px solid var(--border-color);">
                        <h4 style="color: var(--primary-color); margin-bottom: 1rem;">💊 Stimulants (MDMA, Amphetamines)</h4>
                        <ul style="color: var(--text-secondary); padding-left: 1.5rem;">
                            <li><strong>Wait minimum 6-8 weeks</strong> between MDMA uses</li>
                            <li><strong>Never redose MDMA</strong> in the same session</li>
                            <li><strong>Amphetamines:</strong> Wait 2-4 hours, max 50% of initial dose</li>
                            <li><strong>Risk:</strong> Neurotoxicity, cardiovascular stress</li>
                        </ul>
                    </div>
                    
                    <div class="info-card" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; border: 1px solid var(--border-color);">
                        <h4 style="color: var(--primary-color); margin-bottom: 1rem;">🍄 Psychedelics (LSD, Psilocybin)</h4>
                        <ul style="color: var(--text-secondary); padding-left: 1.5rem;">
                            <li><strong>Tolerance builds immediately</strong> - redosing ineffective</li>
                            <li><strong>LSD:</strong> Effects can last 12+ hours</li>
                            <li><strong>Psilocybin:</strong> Wait 1-2 weeks between uses</li>
                            <li><strong>Risk:</strong> Psychological overwhelm, panic</li>
                        </ul>
                    </div>
                    
                    <div class="info-card" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; border: 1px solid var(--border-color);">
                        <h4 style="color: var(--primary-color); margin-bottom: 1rem;">🌊 Dissociatives (Ketamine, DXM)</h4>
                        <ul style="color: var(--text-secondary); padding-left: 1.5rem;">
                            <li><strong>Ketamine:</strong> Wait 45-60 minutes, start low</li>
                            <li><strong>Risk of K-hole</strong> with excessive redosing</li>
                            <li><strong>DXM:</strong> Never redose - long duration (6-8 hours)</li>
                            <li><strong>Risk:</strong> Dissociation, injury, addiction</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div id="drug-info-dos-donts" class="drug-info-content">
                <h3>✅ Essential Dos & Don'ts</h3>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 2rem; margin: 2rem 0;">
                    <div class="dos-section" style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, rgba(34, 197, 94, 0.05) 100%); border: 2px solid rgba(34, 197, 94, 0.3); border-radius: var(--radius-lg); padding: 2rem;">
                        <h4 style="color: #22c55e; margin-bottom: 1.5rem;">✅ DO</h4>
                        <ul style="color: var(--text-secondary); line-height: 1.6;">
                            <li><strong>Research thoroughly</strong> before trying any substance</li>
                            <li><strong>Test your substances</strong> with reagent kits</li>
                            <li><strong>Start with small doses</strong> and wait</li>
                            <li><strong>Stay hydrated</strong> but don't overdrink</li>
                            <li><strong>Have a sober trip-sitter</strong> present</li>
                            <li><strong>Plan your setting</strong> carefully</li>
                            <li><strong>Keep emergency contacts</strong> available</li>
                            <li><strong>Tell someone</strong> your plans</li>
                            <li><strong>Prepare integration time</strong> after psychedelics</li>
                            <li><strong>Respect set and setting</strong></li>
                        </ul>
                    </div>
                    
                    <div class="donts-section" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.05) 100%); border: 2px solid rgba(239, 68, 68, 0.3); border-radius: var(--radius-lg); padding: 2rem;">
                        <h4 style="color: #ef4444; margin-bottom: 1.5rem;">❌ DON'T</h4>
                        <ul style="color: var(--text-secondary); line-height: 1.6;">
                            <li><strong>Mix substances</strong> without research</li>
                            <li><strong>Use alone</strong> (especially with dissociatives)</li>
                            <li><strong>Drive or operate machinery</strong></li>
                            <li><strong>Use if depressed/anxious</strong></li>
                            <li><strong>Take unknown substances</strong></li>
                            <li><strong>Redose impulsively</strong></li>
                            <li><strong>Use in unsafe environments</strong></li>
                            <li><strong>Combine with alcohol</strong> (most substances)</li>
                            <li><strong>Use frequently</strong> - respect tolerance</li>
                            <li><strong>Ignore contraindications</strong> with medications</li>
                        </ul>
                    </div>
                </div>
                
                <div class="critical-warning" style="background: linear-gradient(135deg, rgba(234, 88, 12, 0.1) 0%, rgba(234, 88, 12, 0.05) 100%); border: 2px solid rgba(234, 88, 12, 0.5); border-radius: var(--radius-lg); padding: 2rem; margin-top: 2rem;">
                    <h4 style="color: #ea580c; margin-bottom: 1rem;">⚠️ Critical Contraindications</h4>
                    <p style="color: var(--text-secondary); margin-bottom: 1rem;"><strong>Never use psychoactive substances if you:</strong></p>
                    <ul style="color: var(--text-secondary); padding-left: 1.5rem; line-height: 1.6;">
                        <li>Are taking MAOIs (antidepressants) - wait 2+ weeks</li>
                        <li>Have heart conditions, high blood pressure, or epilepsy</li>
                        <li>Are pregnant or breastfeeding</li>
                        <li>Have a personal/family history of psychosis or schizophrenia</li>
                        <li>Are under 25 (brain development)</li>
                        <li>Are in a poor mental state or crisis</li>
                    </ul>
                </div>
            </div>

            <div id="drug-info-emergency" class="drug-info-content">
                <h3>🚨 Emergency Information & Crisis Resources</h3>
                
                <!-- Germany Emergency -->
                <div class="emergency-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin: 2rem 0;">
                    <div class="emergency-card" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.05) 100%); border: 2px solid rgba(239, 68, 68, 0.3); border-radius: var(--radius-lg); padding: 2rem;">
                        <h4 style="color: var(--danger-color); margin-bottom: 1rem;">🇩🇪 Germany Emergency</h4>
                        <div style="color: var(--text-primary); font-size: 1.1rem; margin-bottom: 1rem;">
                            <strong>🚑 Emergency: 112</strong><br>
                            <span style="color: var(--text-secondary); font-size: 0.9rem;">Fire, Medical, Police - EU-wide</span>
                        </div>
                        <div style="color: var(--text-secondary); margin-bottom: 0.5rem;">
                            <strong>☎️ Poison Control:</strong><br>
                            +49 30 19240 (Berlin)<br>
                            +49 228 19240 (Bonn)<br>
                            +49 89 19240 (Munich)
                        </div>
                        <div style="color: var(--text-secondary); margin-bottom: 0.5rem;">
                            <strong>🧠 Crisis Helpline:</strong><br>
                            0800 111 0 111 / 0800 111 0 222<br>
                            <span style="font-size: 0.8rem;">Telefonseelsorge - 24/7</span>
                        </div>
                        <div style="color: var(--primary-color); margin-top: 1rem; font-size: 0.9rem;">
                            <strong>📍 Good Samaritan protections apply</strong>
                        </div>
                    </div>

                    <div class="emergency-card" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.05) 100%); border: 2px solid rgba(239, 68, 68, 0.3); border-radius: var(--radius-lg); padding: 2rem;">
                        <h4 style="color: var(--danger-color); margin-bottom: 1rem;">🇨🇭 Switzerland Emergency</h4>
                        <div style="color: var(--text-primary); font-size: 1.1rem; margin-bottom: 1rem;">
                            <strong>🚑 Emergency: 112</strong><br>
                            <span style="color: var(--text-secondary); font-size: 0.9rem;">General emergency</span>
                        </div>
                        <div style="color: var(--text-secondary); margin-bottom: 0.5rem;">
                            <strong>☎️ Poison Control:</strong><br>
                            145 or +41 44 251 51 51<br>
                            <span style="font-size: 0.8rem;">Tox Info Suisse - 24/7</span>
                        </div>
                        <div style="color: var(--text-secondary); margin-bottom: 0.5rem;">
                            <strong>🧠 Crisis Helpline:</strong> 143<br>
                            <strong>🏥 Medical:</strong> 144<br>
                            <strong>👮 Police:</strong> 117
                        </div>
                        <div style="color: var(--primary-color); margin-top: 1rem; font-size: 0.9rem;">
                            <strong>📍 Harm reduction services available</strong>
                        </div>
                    </div>
                </div>
            </div>

            <div id="drug-info-tripsitting" class="drug-info-content">
                <h3>🤝 Trip-Sitting Guide</h3>
                <div class="warning" style="margin-bottom: 2rem;">
                    <h4>⚠️ Trip-Sitting Responsibility</h4>
                    <p>Being a trip-sitter is a serious responsibility. You may need to make critical decisions about someone's safety and wellbeing.</p>
                </div>
                
                <div class="tripsitting-sections" style="display: grid; gap: 2rem; margin: 2rem 0;">
                    <div class="preparation-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; border: 1px solid var(--border-color);">
                        <h4 style="color: var(--primary-color); margin-bottom: 1rem;">📋 Preparation Checklist</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                            <div>
                                <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">Before the Session</h5>
                                <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                    <li>Know the substance, dose, and expected duration</li>
                                    <li>Have emergency numbers ready</li>
                                    <li>Clear your schedule completely</li>
                                    <li>Prepare comfort items (blankets, music)</li>
                                    <li>Stock up on water and light snacks</li>
                                    <li>Test all substances beforehand</li>
                                </ul>
                            </div>
                            <div>
                                <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">Environment Setup</h5>
                                <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                    <li>Safe, familiar, comfortable space</li>
                                    <li>Remove dangerous objects</li>
                                    <li>Control lighting and temperature</li>
                                    <li>Prepare calming music playlists</li>
                                    <li>Have access to outdoors if possible</li>
                                    <li>Ensure privacy and no interruptions</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="communication-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; border: 1px solid var(--border-color);">
                        <h4 style="color: var(--primary-color); margin-bottom: 1rem;">💬 Communication Strategies</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                            <div>
                                <h5 style="color: #22c55e; margin-bottom: 0.5rem;">✅ Helpful Phrases</h5>
                                <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                    <li>"You are safe"</li>
                                    <li>"This is temporary"</li>
                                    <li>"I'm here with you"</li>
                                    <li>"Focus on your breathing"</li>
                                    <li>"You took [substance] at [time]"</li>
                                    <li>"Let's change the music/lighting"</li>
                                </ul>
                            </div>
                            <div>
                                <h5 style="color: #ef4444; margin-bottom: 0.5rem;">❌ Avoid Saying</h5>
                                <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                    <li>"Calm down" or "Just relax"</li>
                                    <li>"It's all in your head"</li>
                                    <li>"You're being paranoid"</li>
                                    <li>Arguing with their reality</li>
                                    <li>Bringing up stressful topics</li>
                                    <li>"You took too much"</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="crisis-section" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.05) 100%); border: 2px solid rgba(239, 68, 68, 0.3); border-radius: var(--radius-lg); padding: 2rem;">
                        <h4 style="color: var(--danger-color); margin-bottom: 1rem;">🚨 Crisis Management</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                            <div>
                                <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">Warning Signs</h5>
                                <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                    <li>Difficulty breathing</li>
                                    <li>Chest pain or heart issues</li>
                                    <li>Extreme agitation or violence</li>
                                    <li>Self-harm behavior</li>
                                    <li>Complete loss of reality contact</li>
                                    <li>Hyperthermia or hypothermia</li>
                                </ul>
                            </div>
                            <div>
                                <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">Emergency Actions</h5>
                                <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                    <li><strong>Call 112 immediately</strong></li>
                                    <li>Be honest with paramedics</li>
                                    <li>Stay with them at all times</li>
                                    <li>Remove dangerous objects</li>
                                    <li>Monitor vital signs</li>
                                    <li>Keep them cool and hydrated</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="drug-info-harm-reduction" class="drug-info-content">
                <h3>🛡️ Harm Reduction Resources</h3>
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">🧪 Drug Testing Resources</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🇩🇪 Germany</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem;">
                                <li><strong>Mindzone:</strong> mindzone.info</li>
                                <li><strong>Eclipse:</strong> eclipse-online.de</li>
                                <li><strong>Substitol:</strong> Drug testing services</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🇨🇭 Switzerland</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem;">
                                <li><strong>DIB+:</strong> Drug checking Zurich</li>
                                <li><strong>Safer Dance Swiss:</strong> saferdanceswiss.ch</li>
                                <li><strong>Eve & Rave Schweiz:</strong> eve-rave.ch</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🌍 International</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem;">
                                <li><strong>DanceSafe:</strong> dancesafe.org</li>
                                <li><strong>The Loop:</strong> wearetheloop.org</li>
                                <li><strong>Erowid:</strong> erowid.org</li>
                                <li><strong>PsychonautWiki:</strong> psychonautwiki.org</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MDMA Information Page -->
            <div id="drug-info-mdma-info" class="drug-info-content">
                <h3>💊 MDMA (Ecstasy/Molly) - Complete Information Guide</h3>
                
                <!-- Overview Section -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">🧬 What is MDMA?</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">Chemical Information</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li><strong>Chemical name:</strong> 3,4-Methylenedioxymethamphetamine</li>
                                <li><strong>Street names:</strong> Ecstasy, Molly, E, X, Pills</li>
                                <li><strong>Class:</strong> Empathogen-entactogen</li>
                                <li><strong>Schedule:</strong> Class A/Schedule I (illegal)</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">Mechanism of Action</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Increases serotonin, dopamine, and norepinephrine</li>
                                <li>Blocks reuptake and promotes release</li>
                                <li>Primary effects through serotonin system</li>
                                <li>Creates empathy and emotional openness</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Dosage Information -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">⚖️ Dosage Guidelines</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div style="background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(16, 185, 129, 0.3);">
                            <h5 style="color: #10b981; margin-bottom: 0.5rem;">💚 Threshold (60-80mg)</h5>
                            <p style="font-size: 0.85rem; color: var(--text-secondary); margin: 0;">Minimal effects, slight mood lift, increased sociability</p>
                        </div>
                        <div style="background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(59, 130, 246, 0.3);">
                            <h5 style="color: #3b82f6; margin-bottom: 0.5rem;">💙 Light (80-110mg)</h5>
                            <p style="font-size: 0.85rem; color: var(--text-secondary); margin: 0;">Clear empathogenic effects, enhanced mood, mild euphoria</p>
                        </div>
                        <div style="background: rgba(245, 158, 11, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(245, 158, 11, 0.3);">
                            <h5 style="color: #f59e0b; margin-bottom: 0.5rem;">🧡 Common (110-140mg)</h5>
                            <p style="font-size: 0.85rem; color: var(--text-secondary); margin: 0;">Full MDMA experience, strong empathy, euphoria, energy</p>
                        </div>
                        <div style="background: rgba(239, 68, 68, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(239, 68, 68, 0.3);">
                            <h5 style="color: #ef4444; margin-bottom: 0.5rem;">❤️ Strong (140-180mg)</h5>
                            <p style="font-size: 0.85rem; color: var(--text-secondary); margin: 0;">Intense effects, increased risks, not recommended</p>
                        </div>
                    </div>
                    <div style="margin-top: 1rem; padding: 1rem; background: rgba(239, 68, 68, 0.1); border-radius: var(--radius-md); border: 1px solid rgba(239, 68, 68, 0.3);">
                        <h5 style="color: #ef4444; margin-bottom: 0.5rem;">⚠️ Important Dosage Notes</h5>
                        <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                            <li><strong>Weight-based dosing:</strong> 1.5-2mg/kg for optimal experience</li>
                            <li><strong>Never exceed 200mg:</strong> Higher doses increase toxicity without improving effects</li>
                            <li><strong>Redosing is dangerous:</strong> Can lead to overheating and neurotoxicity</li>
                            <li><strong>Pills vs. crystal:</strong> Pills often contain unknown substances - test first</li>
                        </ul>
                    </div>
                </div>

                <!-- Timeline and Effects -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">⏱️ Timeline and Effects</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">📈 Come-up (30-60 minutes)</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Initial nausea or anxiety</li>
                                <li>Slight jaw clenching</li>
                                <li>Increased heart rate</li>
                                <li>First waves of euphoria</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🌟 Peak (1-3 hours)</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Intense euphoria and empathy</li>
                                <li>Enhanced music appreciation</li>
                                <li>Increased tactile sensations</li>
                                <li>Desire to connect with others</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">📉 Come-down (3-6 hours)</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Gradual decrease in effects</li>
                                <li>Possible mild sadness</li>
                                <li>Fatigue and dehydration</li>
                                <li>Difficulty sleeping</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">😴 After-effects (1-7 days)</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Serotonin depletion ("Suicide Tuesday")</li>
                                <li>Mood fluctuations</li>
                                <li>Increased need for sleep</li>
                                <li>Temporary depression possible</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Safety and Harm Reduction -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--success-color); margin-bottom: 1rem;">🛡️ Safety Guidelines</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">Before Use</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Test your substance with reagents</li>
                                <li>Eat a light meal 2-3 hours prior</li>
                                <li>Get adequate sleep</li>
                                <li>Check medication interactions</li>
                                <li>Plan for 24+ hours of recovery</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">During Use</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Stay hydrated (but don't overdrink)</li>
                                <li>Take breaks in cool areas</li>
                                <li>Have a trusted friend present</li>
                                <li>Monitor body temperature</li>
                                <li>Avoid alcohol and other drugs</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">After Use</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Get plenty of rest</li>
                                <li>Eat nutritious foods</li>
                                <li>Consider 5-HTP supplementation</li>
                                <li>Wait minimum 3 months before next use</li>
                                <li>Practice self-care and integration</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Dangerous Combinations -->
                <div class="warning danger" style="margin: 2rem 0;">
                    <h4>⚠️ DANGEROUS COMBINATIONS - NEVER MIX MDMA WITH:</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-top: 1rem;">
                        <div>
                            <h5 style="color: var(--danger-color); margin-bottom: 0.5rem;">🚫 Antidepressants</h5>
                            <p style="font-size: 0.9rem; margin: 0;">SSRIs, SNRIs, MAOIs can cause serotonin syndrome - potentially fatal</p>
                        </div>
                        <div>
                            <h5 style="color: var(--danger-color); margin-bottom: 0.5rem;">🚫 Tramadol</h5>
                            <p style="font-size: 0.9rem; margin: 0;">High risk of serotonin syndrome and seizures</p>
                        </div>
                        <div>
                            <h5 style="color: var(--danger-color); margin-bottom: 0.5rem;">🚫 DXM</h5>
                            <p style="font-size: 0.9rem; margin: 0;">Increased neurotoxicity and serotonin syndrome risk</p>
                        </div>
                        <div>
                            <h5 style="color: var(--danger-color); margin-bottom: 0.5rem;">🚫 Lithium</h5>
                            <p style="font-size: 0.9rem; margin: 0;">Greatly increased seizure risk</p>
                        </div>
                    </div>
                </div>

                <!-- Testing Information -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--accent-color); margin-bottom: 1rem;">🧪 Testing Your MDMA</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">Reagent Tests</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li><strong>Marquis:</strong> Purple/Black for MDMA</li>
                                <li><strong>Mecke:</strong> Blue/Black confirmation</li>
                                <li><strong>Mandelin:</strong> Blue/Black secondary test</li>
                                <li><strong>Simon's A&B:</strong> Blue for MDMA (not MDA)</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">Common Adulterants</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li><strong>Caffeine:</strong> Stimulant filler</li>
                                <li><strong>MDA:</strong> Similar effects, more visual</li>
                                <li><strong>Methylone:</strong> Shorter duration, less empathy</li>
                                <li><strong>PMMA/PMA:</strong> Dangerous, can be fatal</li>
                            </ul>
                        </div>
                    </div>
                    <div style="margin-top: 1rem; padding: 1rem; background: rgba(59, 130, 246, 0.1); border-radius: var(--radius-md); border: 1px solid rgba(59, 130, 246, 0.3);">
                        <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem;">
                            <strong>💡 Testing Tip:</strong> Always use multiple reagent tests and consider fentanyl test strips. If your substance doesn't react as expected, don't use it.
                        </p>
                    </div>
                </div>

                <!-- Frequency and Tolerance -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--warning-color); margin-bottom: 1rem;">📅 Frequency Guidelines</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div style="background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: var(--radius-md);">
                            <h5 style="color: #10b981; margin-bottom: 0.5rem;">✅ Recommended</h5>
                            <p style="margin: 0; font-size: 0.9rem; color: var(--text-secondary);">
                                <strong>3+ months between uses</strong><br>
                                Allows full serotonin recovery and maintains magical effects
                            </p>
                        </div>
                        <div style="background: rgba(245, 158, 11, 0.1); padding: 1rem; border-radius: var(--radius-md);">
                            <h5 style="color: #f59e0b; margin-bottom: 0.5rem;">⚠️ Risky</h5>
                            <p style="margin: 0; font-size: 0.9rem; color: var(--text-secondary);">
                                <strong>1-3 months between uses</strong><br>
                                Increased neurotoxicity risk, tolerance, and reduced effects
                            </p>
                        </div>
                        <div style="background: rgba(239, 68, 68, 0.1); padding: 1rem; border-radius: var(--radius-md);">
                            <h5 style="color: #ef4444; margin-bottom: 0.5rem;">🚫 Dangerous</h5>
                            <p style="margin: 0; font-size: 0.9rem; color: var(--text-secondary);">
                                <strong>Less than 1 month</strong><br>
                                High neurotoxicity, loss of magic, depression, cognitive damage
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Emergency Information -->
                <div class="emergency-card" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.05) 100%); border: 2px solid rgba(239, 68, 68, 0.3); border-radius: var(--radius-lg); padding: 2rem; margin: 2rem 0;">
                    <h4 style="color: var(--danger-color); margin-bottom: 1rem;">🚨 MDMA Emergency Protocols</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">⚠️ Warning Signs</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Body temperature >39°C (102°F)</li>
                                <li>Rapid or irregular heartbeat</li>
                                <li>Confusion or agitation</li>
                                <li>Seizures or muscle rigidity</li>
                                <li>Nausea and vomiting</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🏥 Immediate Actions</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Call emergency services (112/911)</li>
                                <li>Cool the person down immediately</li>
                                <li>Remove excess clothing</li>
                                <li>Apply cool water to skin</li>
                                <li>Be honest with medical staff</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">❌ DO NOT</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Give ice baths (too cold too fast)</li>
                                <li>Give more stimulants</li>
                                <li>Leave person alone</li>
                                <li>Wait - act immediately</li>
                                <li>Give alcohol or depressants</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- LSD Information Page -->
            <div id="drug-info-lsd-info" class="drug-info-content">
                <h3>🌈 LSD (Lysergic Acid Diethylamide) - Complete Information Guide</h3>
                
                <!-- Overview Section -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">🧬 What is LSD?</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">Chemical Information</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li><strong>Chemical name:</strong> Lysergic Acid Diethylamide</li>
                                <li><strong>Street names:</strong> Acid, Tabs, Trips, L, Lucy</li>
                                <li><strong>Class:</strong> Classical psychedelic</li>
                                <li><strong>Schedule:</strong> Class A/Schedule I (illegal)</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">Mechanism of Action</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>5-HT2A receptor partial agonist</li>
                                <li>Affects glutamate and dopamine systems</li>
                                <li>Disrupts default mode network</li>
                                <li>Creates altered perception and consciousness</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Dosage Information -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">⚖️ Dosage Guidelines (in micrograms)</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div style="background: rgba(34, 197, 94, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(34, 197, 94, 0.3);">
                            <h5 style="color: #22c55e; margin-bottom: 0.5rem;">🌱 Microdose (5-15μg)</h5>
                            <p style="font-size: 0.85rem; color: var(--text-secondary); margin: 0;">Sub-perceptual effects, enhanced creativity and mood</p>
                        </div>
                        <div style="background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(59, 130, 246, 0.3);">
                            <h5 style="color: #3b82f6; margin-bottom: 0.5rem;">🌊 Threshold (15-30μg)</h5>
                            <p style="font-size: 0.85rem; color: var(--text-secondary); margin: 0;">Barely perceptible effects, slight visual changes</p>
                        </div>
                        <div style="background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(16, 185, 129, 0.3);">
                            <h5 style="color: #10b981; margin-bottom: 0.5rem;">✨ Light (30-75μg)</h5>
                            <p style="font-size: 0.85rem; color: var(--text-secondary); margin: 0;">Clear psychedelic effects, mild visuals, enhanced cognition</p>
                        </div>
                        <div style="background: rgba(245, 158, 11, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(245, 158, 11, 0.3);">
                            <h5 style="color: #f59e0b; margin-bottom: 0.5rem;">🌟 Common (75-150μg)</h5>
                            <p style="font-size: 0.85rem; color: var(--text-secondary); margin: 0;">Full psychedelic experience, strong visuals, ego softening</p>
                        </div>
                        <div style="background: rgba(239, 68, 68, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(239, 68, 68, 0.3);">
                            <h5 style="color: #ef4444; margin-bottom: 0.5rem;">🔥 Strong (150-300μg)</h5>
                            <p style="font-size: 0.85rem; color: var(--text-secondary); margin: 0;">Intense experience, ego dissolution, reality distortion</p>
                        </div>
                        <div style="background: rgba(139, 69, 19, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(139, 69, 19, 0.3);">
                            <h5 style="color: #8b4513; margin-bottom: 0.5rem;">⚠️ Heavy (300μg+)</h5>
                            <p style="font-size: 0.85rem; color: var(--text-secondary); margin: 0;">Overwhelming intensity, high risk of difficult experience</p>
                        </div>
                    </div>
                </div>

                <!-- Timeline and Effects -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">⏱️ Timeline and Effects</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">📈 Come-up (30-90 minutes)</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Initial body sensations</li>
                                <li>Slight nausea or anxiety</li>
                                <li>First visual distortions</li>
                                <li>Heightened awareness</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🌟 Peak (2-6 hours)</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Intense visual and auditory effects</li>
                                <li>Altered time perception</li>
                                <li>Deep introspection</li>
                                <li>Possible ego dissolution</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">📉 Come-down (6-10 hours)</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Gradual return to baseline</li>
                                <li>Continued mild visuals</li>
                                <li>Mental clarity returning</li>
                                <li>Possible emotional sensitivity</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🌅 Afterglow (1-3 days)</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Enhanced mood and clarity</li>
                                <li>Increased creativity</li>
                                <li>Better emotional processing</li>
                                <li>Integration of insights</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Set and Setting -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--success-color); margin-bottom: 1rem;">🧠 Set and Setting - Critical for LSD</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🧠 Set (Your Mental State)</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li><strong>Positive mindset:</strong> Optimistic and curious</li>
                                <li><strong>Emotional stability:</strong> Not depressed or anxious</li>
                                <li><strong>Clear intentions:</strong> Know why you're using LSD</li>
                                <li><strong>Physical health:</strong> Well-rested and healthy</li>
                                <li><strong>Mental preparation:</strong> Ready for 8-12 hours</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🏠 Setting (Your Environment)</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li><strong>Safe location:</strong> Private, familiar space</li>
                                <li><strong>Trusted company:</strong> Experienced trip-sitter</li>
                                <li><strong>Comfortable temperature:</strong> Not too hot/cold</li>
                                <li><strong>Minimal distractions:</strong> Phone off, no obligations</li>
                                <li><strong>Nature access:</strong> Outdoor space if possible</li>
                            </ul>
                        </div>
                    </div>
                    <div style="margin-top: 1rem; padding: 1rem; background: rgba(239, 68, 68, 0.1); border-radius: var(--radius-md); border: 1px solid rgba(239, 68, 68, 0.3);">
                        <h5 style="color: #ef4444; margin-bottom: 0.5rem;">🚫 Avoid LSD If:</h5>
                        <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                            <li>Personal/family history of psychosis or schizophrenia</li>
                            <li>Currently taking lithium (seizure risk)</li>
                            <li>Severe depression or suicidal thoughts</li>
                            <li>In an unsafe or unfamiliar environment</li>
                            <li>Under 25 years old (brain development)</li>
                        </ul>
                    </div>
                </div>

                <!-- Testing Information -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--accent-color); margin-bottom: 1rem;">🧪 Testing Your LSD</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">Essential Tests</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li><strong>Ehrlich:</strong> Purple/Pink for LSD</li>
                                <li><strong>Hofmann:</strong> Blue confirms LSD vs analogs</li>
                                <li><strong>UV light:</strong> Real LSD glows under blacklight</li>
                                <li><strong>Taste test:</strong> LSD is tasteless and odorless</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">Dangerous Imposters</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li><strong>25I-NBOMe:</strong> Bitter, metallic taste - can be fatal</li>
                                <li><strong>DOB/DOC:</strong> 12+ hour effects, very intense</li>
                                <li><strong>Bromo-DragonFLY:</strong> Extremely long duration</li>
                                <li><strong>If bitter, it's a spitter!</strong> Real LSD has no taste</li>
                            </ul>
                        </div>
                    </div>
                    <div style="margin-top: 1rem; padding: 1rem; background: rgba(239, 68, 68, 0.1); border-radius: var(--radius-md); border: 1px solid rgba(239, 68, 68, 0.3);">
                        <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem;">
                            <strong>⚠️ CRITICAL:</strong> NBOMe compounds have caused deaths at doses that would be safe for LSD. ALWAYS test your tabs and remember: "If it's bitter, it's a spitter!"
                        </p>
                    </div>
                </div>

                <!-- Tolerance and Frequency -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--warning-color); margin-bottom: 1rem;">📅 Tolerance and Frequency</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">⚡ Rapid Tolerance Development</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Tolerance peaks after 1-3 days</li>
                                <li>Returns to baseline after ~14 days</li>
                                <li>Cross-tolerance with other psychedelics</li>
                                <li>Redosing during trip is ineffective</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">📆 Recommended Spacing</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li><strong>2+ weeks minimum</strong> between trips</li>
                                <li><strong>1+ months optimal</strong> for full reset</li>
                                <li>More spacing = more meaningful experiences</li>
                                <li>Allows time for integration</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Safety Guidelines -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--success-color); margin-bottom: 1rem;">🛡️ Safety Guidelines</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">Preparation</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Clear your entire day (12+ hours)</li>
                                <li>Have experienced trip-sitter present</li>
                                <li>Test your substance thoroughly</li>
                                <li>Prepare calming music playlist</li>
                                <li>Stock water and light snacks</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">During the Trip</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Stay hydrated (normal amounts)</li>
                                <li>Change setting if uncomfortable</li>
                                <li>Remember: "This too shall pass"</li>
                                <li>Avoid driving or dangerous activities</li>
                                <li>Don't make major life decisions</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">Integration</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Journal your experience</li>
                                <li>Discuss insights with trusted friends</li>
                                <li>Take time to process emotions</li>
                                <li>Consider therapy for difficult experiences</li>
                                <li>Wait before next psychedelic use</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Managing Difficult Experiences -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--warning-color); margin-bottom: 1rem;">🌪️ Managing Difficult Experiences</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">✅ What Helps</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Change your environment</li>
                                <li>Listen to calming music</li>
                                <li>Focus on your breathing</li>
                                <li>Remember it's temporary</li>
                                <li>Talk to your trip-sitter</li>
                                <li>Go outside if safe</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">❌ What Doesn't Help</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Fighting the experience</li>
                                <li>Trying to think your way out</li>
                                <li>Using alcohol or other drugs</li>
                                <li>Being around negative people</li>
                                <li>Watching disturbing content</li>
                                <li>Being in crowded places</li>
                            </ul>
                        </div>
                    </div>
                    <div style="margin-top: 1rem; padding: 1rem; background: rgba(59, 130, 246, 0.1); border-radius: var(--radius-md); border: 1px solid rgba(59, 130, 246, 0.3);">
                        <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem;">
                            <strong>💡 Remember:</strong> Difficult experiences often lead to the most growth. Surrender to the experience rather than fighting it, and remind yourself that it will end.
                        </p>
                    </div>
                </div>

                <!-- Emergency Information -->
                <div class="emergency-card" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.05) 100%); border: 2px solid rgba(239, 68, 68, 0.3); border-radius: var(--radius-lg); padding: 2rem; margin: 2rem 0;">
                    <h4 style="color: var(--danger-color); margin-bottom: 1rem;">🚨 LSD Emergency Protocols</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">⚠️ Call 112/911 If:</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Seizures or convulsions</li>
                                <li>Extremely high fever</li>
                                <li>Self-harm or violence</li>
                                <li>Medical emergency symptoms</li>
                                <li>Complete loss of reality contact</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🏥 Medical Treatment</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Be honest about substance use</li>
                                <li>Benzodiazepines may be given</li>
                                <li>Antipsychotics usually avoided</li>
                                <li>Supportive care and monitoring</li>
                                <li>Most resolve without treatment</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🤝 Trip-Sitter Role</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Stay calm and reassuring</li>
                                <li>Remind them it's temporary</li>
                                <li>Keep them safe from harm</li>
                                <li>Change environment if needed</li>
                                <li>Don't leave them alone</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ketamine Information Page -->
            <div id="drug-info-ketamine-info" class="drug-info-content">
                <h3>💎 Ketamine - Complete Information Guide</h3>
                
                <!-- Overview Section -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">🧬 What is Ketamine?</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">Chemical Information</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li><strong>Chemical name:</strong> Ketamine hydrochloride</li>
                                <li><strong>Street names:</strong> Ket, K, Special K, Cat Tranquilizer</li>
                                <li><strong>Class:</strong> Dissociative anesthetic</li>
                                <li><strong>Schedule:</strong> Class B/Schedule III (controlled)</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">Mechanism of Action</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>NMDA receptor antagonist</li>
                                <li>Blocks glutamate transmission</li>
                                <li>Creates dissociative state</li>
                                <li>Anesthetic and analgesic properties</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Dosage Information -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">⚖️ Dosage Guidelines (Nasal/Oral)</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div style="background: rgba(34, 197, 94, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(34, 197, 94, 0.3);">
                            <h5 style="color: #22c55e; margin-bottom: 0.5rem;">🌱 Threshold (5-15mg nasal)</h5>
                            <p style="font-size: 0.85rem; color: var(--text-secondary); margin: 0;">Mild dissociative effects, slight confusion</p>
                        </div>
                        <div style="background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(59, 130, 246, 0.3);">
                            <h5 style="color: #3b82f6; margin-bottom: 0.5rem;">✨ Light (15-30mg nasal)</h5>
                            <p style="font-size: 0.85rem; color: var(--text-secondary); margin: 0;">Clear dissociation, motor impairment, euphoria</p>
                        </div>
                        <div style="background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(16, 185, 129, 0.3);">
                            <h5 style="color: #10b981; margin-bottom: 0.5rem;">🌟 Common (30-75mg nasal)</h5>
                            <p style="font-size: 0.85rem; color: var(--text-secondary); margin: 0;">Strong dissociation, difficulty walking, visual effects</p>
                        </div>
                        <div style="background: rgba(245, 158, 11, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(245, 158, 11, 0.3);">
                            <h5 style="color: #f59e0b; margin-bottom: 0.5rem;">🔥 Strong (75-150mg nasal)</h5>
                            <p style="font-size: 0.85rem; color: var(--text-secondary); margin: 0;">Intense dissociation, near-immobilization, hallucinations</p>
                        </div>
                        <div style="background: rgba(139, 69, 19, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(139, 69, 19, 0.3);">
                            <h5 style="color: #8b4513; margin-bottom: 0.5rem;">⚠️ K-Hole (150mg+ nasal)</h5>
                            <p style="font-size: 0.85rem; color: var(--text-secondary); margin: 0;">Complete dissociation, out-of-body experience, immobilization</p>
                        </div>
                        <div style="background: rgba(239, 68, 68, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(239, 68, 68, 0.3);">
                            <h5 style="color: #ef4444; margin-bottom: 0.5rem;">🚫 Anesthetic (200mg+ nasal)</h5>
                            <p style="font-size: 0.85rem; color: var(--text-secondary); margin: 0;">Dangerous anesthetic doses, respiratory depression risk</p>
                        </div>
                    </div>
                    <div style="margin-top: 1rem; padding: 1rem; background: rgba(59, 130, 246, 0.1); border-radius: var(--radius-md); border: 1px solid rgba(59, 130, 246, 0.3);">
                        <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem;">
                            <strong>📝 Note:</strong> Oral doses are typically 3-4x higher than nasal. IM/IV doses are much lower and extremely dangerous without medical supervision.
                        </p>
                    </div>
                </div>

                <!-- Timeline and Effects -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">⏱️ Timeline and Effects</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">📈 Onset (Nasal: 5-15 min)</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Rapid onset of effects</li>
                                <li>Numbing sensations</li>
                                <li>Initial disorientation</li>
                                <li>Loss of coordination</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🌟 Peak (30-60 minutes)</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Full dissociative effects</li>
                                <li>Visual and auditory distortions</li>
                                <li>Out-of-body sensations</li>
                                <li>Time distortion</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">📉 Come-down (1-2 hours)</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Gradual return of coordination</li>
                                <li>Residual confusion</li>
                                <li>Possible nausea</li>
                                <li>Emotional sensitivity</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🌅 After-effects (2-4 hours)</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Return to baseline</li>
                                <li>Possible mood enhancement</li>
                                <li>Memory gaps from peak</li>
                                <li>Fatigue or stimulation</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Effects Profile -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--success-color); margin-bottom: 1rem;">🌀 Effects Profile</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">✨ Positive Effects</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Euphoria and wellbeing</li>
                                <li>Pain relief (analgesic)</li>
                                <li>Spiritual/mystical experiences</li>
                                <li>Ego dissolution</li>
                                <li>Antidepressant effects</li>
                                <li>Dream-like states</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">⚠️ Neutral/Negative Effects</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Motor impairment and clumsiness</li>
                                <li>Confusion and disorientation</li>
                                <li>Memory suppression</li>
                                <li>Nausea and vomiting</li>
                                <li>Increased heart rate</li>
                                <li>Potential for falls/injury</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Safety and Harm Reduction -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--warning-color); margin-bottom: 1rem;">🛡️ Safety and Harm Reduction</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🏠 Set and Setting</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Safe, familiar environment</li>
                                <li>Sober trip-sitter present</li>
                                <li>Soft surfaces (risk of falling)</li>
                                <li>Remove sharp objects nearby</li>
                                <li>Easy access to bathroom</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">⚖️ Dosage Safety</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Start with small doses</li>
                                <li>Wait 2+ hours before redosing</li>
                                <li>Use precise milligram scale</li>
                                <li>Account for tolerance buildup</li>
                                <li>Never mix with alcohol</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🚫 Avoid Combinations</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li><strong>Alcohol:</strong> Dangerous respiratory depression</li>
                                <li><strong>Opioids:</strong> Increased risk of unconsciousness</li>
                                <li><strong>Benzodiazepines:</strong> Enhanced sedation</li>
                                <li><strong>MAOIs:</strong> Potential dangerous interactions</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Long-term Risks -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--danger-color); margin-bottom: 1rem;">⚠️ Long-term Risks and Addiction</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🧠 Cognitive Effects</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Memory problems with chronic use</li>
                                <li>Attention and concentration issues</li>
                                <li>Potential for psychological dependence</li>
                                <li>Tolerance develops quickly</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🫀 Physical Health</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li><strong>Bladder damage:</strong> K-cramps, frequent urination</li>
                                <li><strong>Kidney problems:</strong> Potential long-term damage</li>
                                <li><strong>Nasal damage:</strong> From insufflation</li>
                                <li><strong>Liver toxicity:</strong> Rare but possible</li>
                            </ul>
                        </div>
                    </div>
                    <div style="margin-top: 1rem; padding: 1rem; background: rgba(239, 68, 68, 0.1); border-radius: var(--radius-md); border: 1px solid rgba(239, 68, 68, 0.3);">
                        <h5 style="color: #ef4444; margin-bottom: 0.5rem;">🚨 K-Cramps Warning</h5>
                        <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem;">
                            Frequent ketamine use can cause severe abdominal pain ("K-cramps") and bladder damage. If you experience persistent stomach pain or urinary problems, seek medical attention immediately.
                        </p>
                    </div>
                </div>

                <!-- Therapeutic Use -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--accent-color); margin-bottom: 1rem;">🏥 Medical and Therapeutic Use</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">Medical Applications</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Anesthesia (especially pediatric)</li>
                                <li>Treatment-resistant depression</li>
                                <li>Chronic pain management</li>
                                <li>PTSD therapy (clinical trials)</li>
                                <li>Emergency sedation</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">Ketamine-Assisted Therapy</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>FDA-approved nasal spray (Spravato)</li>
                                <li>IV ketamine clinics</li>
                                <li>Supervised therapeutic settings</li>
                                <li>Integration with psychotherapy</li>
                                <li>Promising results for depression</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Emergency Information -->
                <div class="emergency-card" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.05) 100%); border: 2px solid rgba(239, 68, 68, 0.3); border-radius: var(--radius-lg); padding: 2rem; margin: 2rem 0;">
                    <h4 style="color: var(--danger-color); margin-bottom: 1rem;">🚨 Ketamine Emergency Protocols</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">⚠️ Call 112/911 If:</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Difficulty breathing or shallow breathing</li>
                                <li>Unconsciousness with slow/no breathing</li>
                                <li>Severe confusion lasting hours</li>
                                <li>Signs of physical injury from falls</li>
                                <li>Persistent vomiting with dehydration</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🏥 Medical Treatment</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Supportive care and monitoring</li>
                                <li>IV fluids for dehydration</li>
                                <li>Airway management if needed</li>
                                <li>Recovery position if unconscious</li>
                                <li>Usually resolves within hours</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🤝 First Aid</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Keep person in recovery position</li>
                                <li>Monitor breathing regularly</li>
                                <li>Protect from injury during confusion</li>
                                <li>Don't leave alone if heavily dissociated</li>
                                <li>Keep calm and provide reassurance</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- GHB/GBL Information Page -->
            <div id="drug-info-ghb-info" class="drug-info-content">
                <h3>🧪 GHB/GBL - Complete Information Guide</h3>
                
                <!-- Overview Section -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">🧬 What are GHB and GBL?</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">GHB (Gamma-Hydroxybutyric Acid)</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li><strong>Street names:</strong> G, Liquid Ecstasy, GBH</li>
                                <li><strong>Class:</strong> CNS depressant</li>
                                <li><strong>Schedule:</strong> Class B/Schedule I</li>
                                <li><strong>Form:</strong> Clear liquid or white powder</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">GBL (Gamma-Butyrolactone)</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li><strong>Street names:</strong> Blue Nitro, GBL</li>
                                <li><strong>Class:</strong> GHB prodrug (converts to GHB)</li>
                                <li><strong>Schedule:</strong> Class B/Controlled</li>
                                <li><strong>Form:</strong> Clear liquid, industrial solvent</li>
                            </ul>
                        </div>
                    </div>
                    <div style="margin-top: 1rem; padding: 1rem; background: rgba(59, 130, 246, 0.1); border-radius: var(--radius-md); border: 1px solid rgba(59, 130, 246, 0.3);">
                        <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem;">
                            <strong>🔄 Important:</strong> GBL is a prodrug that converts to GHB in the body. Effects are nearly identical, but GBL is approximately 1.5-2x more potent than GHB.
                        </p>
                    </div>
                </div>

                <!-- Critical Dosage Warning -->
                <div class="emergency-card" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(239, 68, 68, 0.05) 100%); border: 2px solid rgba(239, 68, 68, 0.4); border-radius: var(--radius-lg); padding: 2rem; margin: 2rem 0;">
                    <h4 style="color: var(--danger-color); margin-bottom: 1rem;">⚠️ CRITICAL DOSAGE WARNING</h4>
                    <p style="color: var(--text-secondary); font-size: 1rem; margin-bottom: 1rem;">
                        <strong>GHB/GBL has an extremely narrow margin between recreational and dangerous doses. The difference between euphoria and overdose can be less than 1ml.</strong>
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🚨 Never:</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Eyeball or guess dosages</li>
                                <li>Redose within 3 hours</li>
                                <li>Mix with alcohol or other depressants</li>
                                <li>Use if you haven't eaten recently</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">✅ Always:</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Use precise measuring tools (1ml syringe)</li>
                                <li>Start with lowest possible dose</li>
                                <li>Have a sober trip-sitter present</li>
                                <li>Keep detailed dose logs</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Dosage Information -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">⚖️ Dosage Guidelines (Oral)</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div style="background: rgba(34, 197, 94, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(34, 197, 94, 0.3);">
                            <h5 style="color: #22c55e; margin-bottom: 0.5rem;">🌱 Threshold</h5>
                            <p style="font-size: 0.85rem; color: var(--text-secondary); margin: 0;"><strong>GHB:</strong> 0.5-1.0g | <strong>GBL:</strong> 0.3-0.7ml</p>
                            <p style="font-size: 0.8rem; color: var(--text-secondary); margin: 0.5rem 0 0 0;">Mild relaxation, slight disinhibition</p>
                        </div>
                        <div style="background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(59, 130, 246, 0.3);">
                            <h5 style="color: #3b82f6; margin-bottom: 0.5rem;">✨ Light</h5>
                            <p style="font-size: 0.85rem; color: var(--text-secondary); margin: 0;"><strong>GHB:</strong> 1.0-1.5g | <strong>GBL:</strong> 0.7-1.0ml</p>
                            <p style="font-size: 0.8rem; color: var(--text-secondary); margin: 0.5rem 0 0 0;">Clear euphoria, sociability, mild sedation</p>
                        </div>
                        <div style="background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(16, 185, 129, 0.3);">
                            <h5 style="color: #10b981; margin-bottom: 0.5rem;">🌟 Common</h5>
                            <p style="font-size: 0.85rem; color: var(--text-secondary); margin: 0;"><strong>GHB:</strong> 1.5-2.5g | <strong>GBL:</strong> 1.0-1.5ml</p>
                            <p style="font-size: 0.8rem; color: var(--text-secondary); margin: 0.5rem 0 0 0;">Strong euphoria, empathy, moderate sedation</p>
                        </div>
                        <div style="background: rgba(245, 158, 11, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(245, 158, 11, 0.3);">
                            <h5 style="color: #f59e0b; margin-bottom: 0.5rem;">⚠️ Strong</h5>
                            <p style="font-size: 0.85rem; color: var(--text-secondary); margin: 0;"><strong>GHB:</strong> 2.5-3.0g | <strong>GBL:</strong> 1.5-2.0ml</p>
                            <p style="font-size: 0.8rem; color: var(--text-secondary); margin: 0.5rem 0 0 0;">Heavy sedation, memory impairment, risk zone</p>
                        </div>
                        <div style="background: rgba(239, 68, 68, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(239, 68, 68, 0.3);">
                            <h5 style="color: #ef4444; margin-bottom: 0.5rem;">🚨 Dangerous</h5>
                            <p style="font-size: 0.85rem; color: var(--text-secondary); margin: 0;"><strong>GHB:</strong> 3.0g+ | <strong>GBL:</strong> 2.0ml+</p>
                            <p style="font-size: 0.8rem; color: var(--text-secondary); margin: 0.5rem 0 0 0;">Unconsciousness, respiratory depression, overdose risk</p>
                        </div>
                    </div>
                    <div style="margin-top: 1rem; padding: 1rem; background: rgba(239, 68, 68, 0.1); border-radius: var(--radius-md); border: 1px solid rgba(239, 68, 68, 0.3);">
                        <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem;">
                            <strong>⚠️ CRITICAL:</strong> These dosages are approximate and vary greatly between individuals. Factors like body weight, tolerance, food intake, and individual sensitivity can dramatically affect response.
                        </p>
                    </div>
                </div>

                <!-- Timeline and Effects -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">⏱️ Timeline and Effects</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">📈 Onset (15-45 minutes)</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Initial relaxation</li>
                                <li>Mild dizziness</li>
                                <li>Increased sociability</li>
                                <li>First signs of disinhibition</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🌟 Peak (1-2 hours)</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Maximum euphoria and empathy</li>
                                <li>Strong sedation</li>
                                <li>Possible memory impairment</li>
                                <li>Risk of unconsciousness</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">📉 Come-down (2-4 hours)</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Gradual return of alertness</li>
                                <li>Possible grogginess</li>
                                <li>Return of normal coordination</li>
                                <li>Mild rebound anxiety possible</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🌅 After-effects (4-8 hours)</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Complete return to baseline</li>
                                <li>Possible refreshed feeling</li>
                                <li>Memory gaps from peak</li>
                                <li>Normal sleep patterns resume</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Effects Profile -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--success-color); margin-bottom: 1rem;">🌀 Effects Profile</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">✨ Positive Effects</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Euphoria and wellbeing</li>
                                <li>Enhanced empathy and sociability</li>
                                <li>Relaxation and stress relief</li>
                                <li>Increased confidence</li>
                                <li>Enhanced sensory perception</li>
                                <li>Mood enhancement</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">⚠️ Negative Effects</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Dizziness and confusion</li>
                                <li>Memory impairment</li>
                                <li>Motor impairment</li>
                                <li>Nausea and vomiting</li>
                                <li>Unconsciousness (at higher doses)</li>
                                <li>Respiratory depression</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Critical Safety Information -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--danger-color); margin-bottom: 1rem;">🚨 Critical Safety Information</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🍷 Alcohol Interaction</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li><strong>NEVER mix with alcohol</strong></li>
                                <li>Both are CNS depressants</li>
                                <li>Dramatically increases overdose risk</li>
                                <li>Can cause fatal respiratory depression</li>
                                <li>Wait 24+ hours after drinking</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">⏰ Redosing Dangers</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Never redose within 3 hours</li>
                                <li>Effects can stack dangerously</li>
                                <li>Easy to accidentally overdose</li>
                                <li>Tolerance builds rapidly</li>
                                <li>"Less is more" philosophy essential</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🎯 Measurement Critical</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Use 1ml oral syringes only</li>
                                <li>Milligram scale for powder</li>
                                <li>Never estimate or eyeball doses</li>
                                <li>Account for concentration differences</li>
                                <li>Keep detailed dose logs</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Addiction and Withdrawal -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--warning-color); margin-bottom: 1rem;">🔄 Addiction and Withdrawal</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">⚡ Addiction Potential</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Moderate to high addiction potential</li>
                                <li>Tolerance develops rapidly</li>
                                <li>Physical dependence possible</li>
                                <li>Compulsive redosing common</li>
                                <li>Around-the-clock use patterns</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🚨 Withdrawal Symptoms</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Severe anxiety and panic attacks</li>
                                <li>Insomnia lasting days/weeks</li>
                                <li>Tremors and sweating</li>
                                <li>Potentially dangerous seizures</li>
                                <li>Requires medical supervision</li>
                            </ul>
                        </div>
                    </div>
                    <div style="margin-top: 1rem; padding: 1rem; background: rgba(239, 68, 68, 0.1); border-radius: var(--radius-md); border: 1px solid rgba(239, 68, 68, 0.3);">
                        <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem;">
                            <strong>⚠️ Medical Note:</strong> GHB withdrawal can be life-threatening and may require hospitalization. Never attempt to detox from chronic GHB use without medical supervision.
                        </p>
                    </div>
                </div>

                <!-- Legal and Social Risks -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--accent-color); margin-bottom: 1rem;">⚖️ Legal and Social Risks</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🚨 Legal Status</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Class B/Schedule I controlled substance</li>
                                <li>Serious penalties for possession</li>
                                <li>Manufacturing/dealing severe charges</li>
                                <li>Associated with "date rape" offenses</li>
                                <li>Zero tolerance in most jurisdictions</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">👥 Social Risks</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Memory blackouts and vulnerability</li>
                                <li>Impaired judgment and consent</li>
                                <li>Risk of sexual assault (victim or accused)</li>
                                <li>Social stigma and reputation damage</li>
                                <li>Relationship and family impacts</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Emergency Information -->
                <div class="emergency-card" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.05) 100%); border: 2px solid rgba(239, 68, 68, 0.3); border-radius: var(--radius-lg); padding: 2rem; margin: 2rem 0;">
                    <h4 style="color: var(--danger-color); margin-bottom: 1rem;">🚨 GHB/GBL Emergency Protocols</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">⚠️ Call 112/911 If:</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Unconsciousness with slow/irregular breathing</li>
                                <li>Blue lips or fingernails (cyanosis)</li>
                                <li>Vomiting while unconscious</li>
                                <li>Cannot be roused by loud noises/pain</li>
                                <li>Seizures or convulsions</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🚑 First Aid</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Place in recovery position</li>
                                <li>Clear airway of vomit</li>
                                <li>Monitor breathing constantly</li>
                                <li>Perform rescue breathing if needed</li>
                                <li>Keep warm but not overheated</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🏥 Medical Information</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Tell medical staff exact substance used</li>
                                <li>Provide dosage and timing if known</li>
                                <li>Mention any alcohol or other drug use</li>
                                <li>Most recover within 2-6 hours</li>
                                <li>Supportive care typically sufficient</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Amphetamines Information Page -->
            <div id="drug-info-amphetamines-info" class="drug-info-content">
                <h3>⚡ Amphetamines - Complete Information Guide</h3>
                
                <!-- Overview Section -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">🧬 What are Amphetamines?</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">Chemical Information</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li><strong>Chemical name:</strong> Amphetamine sulfate</li>
                                <li><strong>Street names:</strong> Speed, Whizz, Billy, Paste</li>
                                <li><strong>Class:</strong> CNS stimulant</li>
                                <li><strong>Schedule:</strong> Class B/Schedule II (controlled)</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">Mechanism of Action</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Dopamine and norepinephrine reuptake inhibitor</li>
                                <li>Increases neurotransmitter release</li>
                                <li>CNS stimulation and alertness</li>
                                <li>Affects reward and motivation pathways</li>
                            </ul>
                        </div>
                    </div>
                    <div style="margin-top: 1rem; padding: 1rem; background: rgba(59, 130, 246, 0.1); border-radius: var(--radius-md); border: 1px solid rgba(59, 130, 246, 0.3);">
                        <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem;">
                            <strong>📝 Note:</strong> This information covers racemic amphetamine. Dextroamphetamine (Adderall) and methamphetamine have different potencies and risk profiles.
                        </p>
                    </div>
                </div>

                <!-- Dosage Information -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">⚖️ Dosage Guidelines (Oral)</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div style="background: rgba(34, 197, 94, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(34, 197, 94, 0.3);">
                            <h5 style="color: #22c55e; margin-bottom: 0.5rem;">🌱 Threshold (2.5-5mg)</h5>
                            <p style="font-size: 0.85rem; color: var(--text-secondary); margin: 0;">Mild alertness, slight focus enhancement</p>
                        </div>
                        <div style="background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(59, 130, 246, 0.3);">
                            <h5 style="color: #3b82f6; margin-bottom: 0.5rem;">✨ Light (5-15mg)</h5>
                            <p style="font-size: 0.85rem; color: var(--text-secondary); margin: 0;">Clear stimulation, enhanced focus and energy</p>
                        </div>
                        <div style="background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(16, 185, 129, 0.3);">
                            <h5 style="color: #10b981; margin-bottom: 0.5rem;">🌟 Common (15-30mg)</h5>
                            <p style="font-size: 0.85rem; color: var(--text-secondary); margin: 0;">Strong stimulation, euphoria, significant effects</p>
                        </div>
                        <div style="background: rgba(245, 158, 11, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(245, 158, 11, 0.3);">
                            <h5 style="color: #f59e0b; margin-bottom: 0.5rem;">🔥 Strong (30-50mg)</h5>
                            <p style="font-size: 0.85rem; color: var(--text-secondary); margin: 0;">Intense stimulation, increased side effects</p>
                        </div>
                        <div style="background: rgba(239, 68, 68, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(239, 68, 68, 0.3);">
                            <h5 style="color: #ef4444; margin-bottom: 0.5rem;">⚠️ Heavy (50mg+)</h5>
                            <p style="font-size: 0.85rem; color: var(--text-secondary); margin: 0;">High risk of adverse effects, cardiovascular stress</p>
                        </div>
                    </div>
                    <div style="margin-top: 1rem; padding: 1rem; background: rgba(245, 158, 11, 0.1); border-radius: var(--radius-md); border: 1px solid rgba(245, 158, 11, 0.3);">
                        <h5 style="color: #f59e0b; margin-bottom: 0.5rem;">📏 Dosage by Route</h5>
                        <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem; margin: 0;">
                            <li><strong>Oral:</strong> Baseline doses (safer, longer duration)</li>
                            <li><strong>Nasal:</strong> ~70% of oral dose (faster onset, shorter duration)</li>
                            <li><strong>IV/IM:</strong> NOT RECOMMENDED (extreme risk, addiction potential)</li>
                        </ul>
                    </div>
                </div>

                <!-- Timeline and Effects -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">⏱️ Timeline and Effects</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">📈 Come-up (Oral: 30-90 min)</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Increased alertness</li>
                                <li>Rising energy levels</li>
                                <li>Enhanced focus</li>
                                <li>Mild euphoria beginning</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🌟 Peak (2-4 hours)</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Maximum stimulation</li>
                                <li>Euphoria and confidence</li>
                                <li>Hyperfocus on tasks</li>
                                <li>Decreased appetite</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">📉 Come-down (4-8 hours)</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Gradual reduction in effects</li>
                                <li>Return of appetite</li>
                                <li>Possible mild depression</li>
                                <li>Fatigue as effects wear off</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">💤 After-effects (8-24 hours)</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Sleep deprivation effects</li>
                                <li>Appetite returning</li>
                                <li>Possible rebound depression</li>
                                <li>Mental fatigue</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Effects Profile -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--success-color); margin-bottom: 1rem;">⚡ Effects Profile</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">✨ Positive Effects</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Enhanced focus and concentration</li>
                                <li>Increased energy and alertness</li>
                                <li>Euphoria and confidence</li>
                                <li>Improved motivation</li>
                                <li>Enhanced cognitive performance</li>
                                <li>Increased sociability</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">⚠️ Negative Effects</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Increased heart rate and blood pressure</li>
                                <li>Insomnia and sleep disruption</li>
                                <li>Appetite suppression</li>
                                <li>Anxiety and restlessness</li>
                                <li>Jaw clenching (bruxism)</li>
                                <li>Potential for hyperfocus on trivial tasks</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Medical Uses -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--accent-color); margin-bottom: 1rem;">🏥 Medical Uses</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">Prescription Uses</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li><strong>ADHD:</strong> Core treatment medication</li>
                                <li><strong>Narcolepsy:</strong> Excessive daytime sleepiness</li>
                                <li><strong>Treatment-resistant depression</strong> (rare)</li>
                                <li><strong>Binge eating disorder</strong> (lisdexamfetamine)</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">Therapeutic Benefits</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Improved attention span</li>
                                <li>Reduced hyperactivity</li>
                                <li>Enhanced executive function</li>
                                <li>Better impulse control</li>
                                <li>Mood stabilization in ADHD</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Safety and Harm Reduction -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--warning-color); margin-bottom: 1rem;">🛡️ Safety and Harm Reduction</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🏃 Physical Health</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Monitor heart rate and blood pressure</li>
                                <li>Stay hydrated (avoid overhydration)</li>
                                <li>Take breaks from activity</li>
                                <li>Maintain electrolyte balance</li>
                                <li>Avoid in hot environments</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🧠 Mental Health</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Avoid if anxiety/panic prone</li>
                                <li>Don't use to manage depression</li>
                                <li>Take tolerance breaks</li>
                                <li>Manage sleep schedule</li>
                                <li>Watch for dependence signs</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">⚖️ Dosage Safety</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Start low, increase gradually</li>
                                <li>Avoid redosing to extend effects</li>
                                <li>Use precise measuring tools</li>
                                <li>Account for tolerance</li>
                                <li>Avoid binge patterns</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Addiction and Tolerance -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--danger-color); margin-bottom: 1rem;">🔄 Addiction and Tolerance</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">⚡ Addiction Risk</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Moderate to high addiction potential</li>
                                <li>Psychological dependence common</li>
                                <li>Compulsive redosing patterns</li>
                                <li>Tolerance develops quickly</li>
                                <li>Withdrawal can be difficult</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">📉 Withdrawal Symptoms</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Severe fatigue and hypersomnia</li>
                                <li>Depression and dysphoria</li>
                                <li>Increased appetite</li>
                                <li>Cognitive impairment</li>
                                <li>Strong cravings</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🔄 Tolerance Management</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Take regular breaks (drug holidays)</li>
                                <li>Avoid daily use</li>
                                <li>Rotate with other stimulants carefully</li>
                                <li>Monitor dose escalation</li>
                                <li>Seek help if losing control</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Dangerous Combinations -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--danger-color); margin-bottom: 1rem;">⚠️ Dangerous Combinations</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🚫 High Risk</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li><strong>MAOIs:</strong> Dangerous blood pressure spikes</li>
                                <li><strong>Other stimulants:</strong> Increased cardiovascular risk</li>
                                <li><strong>Hallucinogens:</strong> Increased anxiety/psychosis risk</li>
                                <li><strong>Tramadol:</strong> Lowered seizure threshold</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">⚠️ Moderate Risk</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li><strong>Alcohol:</strong> Masks intoxication, dehydration</li>
                                <li><strong>Cannabis:</strong> Can increase anxiety</li>
                                <li><strong>Caffeine:</strong> Enhanced jitteriness</li>
                                <li><strong>Nicotine:</strong> Increased cardiovascular stress</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Emergency Information -->
                <div class="emergency-card" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.05) 100%); border: 2px solid rgba(239, 68, 68, 0.3); border-radius: var(--radius-lg); padding: 2rem; margin: 2rem 0;">
                    <h4 style="color: var(--danger-color); margin-bottom: 1rem;">🚨 Amphetamine Emergency Protocols</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">⚠️ Call 112/911 If:</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Chest pain or irregular heartbeat</li>
                                <li>Extremely high blood pressure</li>
                                <li>Hyperthermia (overheating)</li>
                                <li>Seizures or convulsions</li>
                                <li>Psychotic symptoms or paranoia</li>
                                <li>Stroke-like symptoms</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🏥 Medical Treatment</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Benzodiazepines for agitation</li>
                                <li>Cooling measures for hyperthermia</li>
                                <li>IV fluids and electrolyte monitoring</li>
                                <li>Cardiac monitoring</li>
                                <li>Antipsychotics for severe psychosis</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🤝 First Aid</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Move to cool, quiet environment</li>
                                <li>Remove excess clothing</li>
                                <li>Offer small sips of water</li>
                                <li>Calm reassurance for anxiety</li>
                                <li>Monitor vital signs if possible</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cocaine Information Page -->
            <div id="drug-info-cocaine-info" class="drug-info-content">
                <h3>❄️ Cocaine - Complete Information Guide</h3>
                
                <!-- Overview Section -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">🧬 What is Cocaine?</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">Chemical Information</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li><strong>Chemical name:</strong> Cocaine hydrochloride</li>
                                <li><strong>Street names:</strong> Coke, Snow, Blow, Charlie, Powder</li>
                                <li><strong>Class:</strong> CNS stimulant, local anesthetic</li>
                                <li><strong>Schedule:</strong> Class A/Schedule II (high control)</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">Mechanism of Action</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Blocks dopamine reuptake transporter</li>
                                <li>Also affects serotonin and norepinephrine</li>
                                <li>Sodium channel blocker (anesthetic effect)</li>
                                <li>Intense but short-lived effects</li>
                            </ul>
                        </div>
                    </div>
                    <div style="margin-top: 1rem; padding: 1rem; background: rgba(239, 68, 68, 0.1); border-radius: var(--radius-md); border: 1px solid rgba(239, 68, 68, 0.3);">
                        <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem;">
                            <strong>⚠️ Warning:</strong> Cocaine is highly addictive and associated with significant cardiovascular, neurological, and psychological risks. No amount of cocaine use can be considered "safe."
                        </p>
                    </div>
                </div>

                <!-- Forms and Routes -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">📋 Forms and Routes of Administration</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">💨 Insufflation (Snorting)</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li><strong>Onset:</strong> 1-3 minutes</li>
                                <li><strong>Duration:</strong> 15-30 minutes</li>
                                <li><strong>Bioavailability:</strong> ~60%</li>
                                <li><strong>Risks:</strong> Nasal damage, septum perforation</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">💊 Oral</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li><strong>Onset:</strong> 10-30 minutes</li>
                                <li><strong>Duration:</strong> 30-90 minutes</li>
                                <li><strong>Bioavailability:</strong> ~30%</li>
                                <li><strong>Notes:</strong> Longer lasting, less intense</li>
                            </ul>
                        </div>
                        <div style="background: rgba(239, 68, 68, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(239, 68, 68, 0.3);">
                            <h5 style="color: #ef4444; margin-bottom: 0.5rem;">🚫 High-Risk Routes</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li><strong>IV/IM:</strong> Extremely dangerous, high overdose risk</li>
                                <li><strong>Smoking (Crack):</strong> Highly addictive, rapid dependence</li>
                                <li><strong>We strongly advise against these routes</strong></li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Dosage Information -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">⚖️ Dosage Guidelines (Nasal)</h4>
                    <div class="emergency-card" style="background: rgba(239, 68, 68, 0.1); border: 2px solid rgba(239, 68, 68, 0.3); border-radius: var(--radius-md); padding: 1rem; margin-bottom: 1.5rem;">
                        <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem;">
                            <strong>⚠️ CRITICAL:</strong> Street cocaine purity varies dramatically (10-90%). These dosages assume pure cocaine - actual street doses may be much higher due to adulterants and low purity.
                        </p>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div style="background: rgba(34, 197, 94, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(34, 197, 94, 0.3);">
                            <h5 style="color: #22c55e; margin-bottom: 0.5rem;">🌱 Threshold (10-20mg)</h5>
                            <p style="font-size: 0.85rem; color: var(--text-secondary); margin: 0;">Mild stimulation, slight mood elevation</p>
                        </div>
                        <div style="background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(59, 130, 246, 0.3);">
                            <h5 style="color: #3b82f6; margin-bottom: 0.5rem;">✨ Light (20-40mg)</h5>
                            <p style="font-size: 0.85rem; color: var(--text-secondary); margin: 0;">Clear stimulation, confidence, talkativeness</p>
                        </div>
                        <div style="background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(16, 185, 129, 0.3);">
                            <h5 style="color: #10b981; margin-bottom: 0.5rem;">🌟 Common (40-80mg)</h5>
                            <p style="font-size: 0.85rem; color: var(--text-secondary); margin: 0;">Strong euphoria, high energy, possible anxiety</p>
                        </div>
                        <div style="background: rgba(245, 158, 11, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(245, 158, 11, 0.3);">
                            <h5 style="color: #f59e0b; margin-bottom: 0.5rem;">⚠️ Strong (80-120mg)</h5>
                            <p style="font-size: 0.85rem; color: var(--text-secondary); margin: 0;">Intense effects, high risk of adverse reactions</p>
                        </div>
                        <div style="background: rgba(239, 68, 68, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(239, 68, 68, 0.3);">
                            <h5 style="color: #ef4444; margin-bottom: 0.5rem;">🚨 Dangerous (120mg+)</h5>
                            <p style="font-size: 0.85rem; color: var(--text-secondary); margin: 0;">High overdose risk, cardiac complications</p>
                        </div>
                    </div>
                </div>

                <!-- Effects Profile -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--success-color); margin-bottom: 1rem;">⚡ Effects Profile</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">✨ Positive Effects</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Intense euphoria and well-being</li>
                                <li>Increased confidence and self-esteem</li>
                                <li>Enhanced energy and alertness</li>
                                <li>Heightened focus and mental clarity</li>
                                <li>Increased sociability and talkativeness</li>
                                <li>Decreased appetite</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">⚠️ Negative Effects</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Increased heart rate and blood pressure</li>
                                <li>Anxiety, restlessness, paranoia</li>
                                <li>Insomnia and sleep disruption</li>
                                <li>Jaw clenching and teeth grinding</li>
                                <li>Hyperthermia (overheating)</li>
                                <li>Crash and depression after use</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Timeline -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">⏱️ Timeline (Nasal Route)</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">📈 Onset (1-3 minutes)</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Immediate nasal numbing</li>
                                <li>First wave of stimulation</li>
                                <li>Increased alertness</li>
                                <li>Beginning of euphoria</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🌟 Peak (5-10 minutes)</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Maximum euphoria</li>
                                <li>Peak stimulation</li>
                                <li>Heightened confidence</li>
                                <li>Strong urge to redose begins</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">📉 Come-down (15-30 minutes)</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Rapid decline in effects</li>
                                <li>Strong cravings for more</li>
                                <li>Initial crash symptoms</li>
                                <li>Agitation and restlessness</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">💤 After-effects (1-3 hours)</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Depression and dysphoria</li>
                                <li>Mental fatigue</li>
                                <li>Anxiety and irritability</li>
                                <li>Sleep difficulties</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Addiction and Dependence -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--danger-color); margin-bottom: 1rem;">🔄 Addiction and Dependence</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">⚡ High Addiction Potential</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Extremely high psychological dependence risk</li>
                                <li>Rapid development of tolerance</li>
                                <li>Compulsive redosing patterns</li>
                                <li>Strong cravings even after single use</li>
                                <li>Difficult to moderate use</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">📉 Withdrawal Symptoms</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Severe depression and dysphoria</li>
                                <li>Intense cravings</li>
                                <li>Extreme fatigue and hypersomnia</li>
                                <li>Anhedonia (inability to feel pleasure)</li>
                                <li>Cognitive impairment</li>
                                <li>Increased appetite</li>
                            </ul>
                        </div>
                    </div>
                    <div style="margin-top: 1rem; padding: 1rem; background: rgba(239, 68, 68, 0.1); border-radius: var(--radius-md); border: 1px solid rgba(239, 68, 68, 0.3);">
                        <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem;">
                            <strong>🚨 Warning:</strong> Cocaine addiction can develop rapidly, sometimes after just a few uses. The short duration and intense crash create a powerful cycle of compulsive redosing.
                        </p>
                    </div>
                </div>

                <!-- Health Risks -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--danger-color); margin-bottom: 1rem;">⚠️ Health Risks</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">❤️ Cardiovascular</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Heart attack (even with small doses)</li>
                                <li>Irregular heartbeat (arrhythmias)</li>
                                <li>High blood pressure</li>
                                <li>Stroke risk</li>
                                <li>Sudden cardiac death</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🧠 Neurological</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Stroke and brain hemorrhage</li>
                                <li>Seizures</li>
                                <li>Cognitive impairment</li>
                                <li>Memory problems</li>
                                <li>Movement disorders</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">👃 Nasal/Respiratory</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Nasal septum perforation</li>
                                <li>Chronic sinusitis</li>
                                <li>Loss of smell</li>
                                <li>Respiratory problems</li>
                                <li>Lung damage (if smoked)</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🧠 Psychological</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Paranoia and psychosis</li>
                                <li>Anxiety and panic disorders</li>
                                <li>Depression</li>
                                <li>Violent or erratic behavior</li>
                                <li>Suicidal ideation</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Dangerous Combinations -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--danger-color); margin-bottom: 1rem;">⚠️ Extremely Dangerous Combinations</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🍷 Alcohol (Cocaethylene)</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Forms toxic metabolite cocaethylene</li>
                                <li>20x more likely to cause sudden death</li>
                                <li>Increased cardiotoxicity</li>
                                <li>Longer elimination time</li>
                                <li><strong>Never mix these substances</strong></li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🚫 Other High-Risk Combinations</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li><strong>MAOIs:</strong> Dangerous blood pressure spikes</li>
                                <li><strong>Other stimulants:</strong> Increased overdose risk</li>
                                <li><strong>Depressants:</strong> Masked intoxication</li>
                                <li><strong>Any combination increases risks</strong></li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Harm Reduction -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--warning-color); margin-bottom: 1rem;">🛡️ Harm Reduction (If Use Occurs)</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">📏 Dosage and Purity</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Test for adulterants if possible</li>
                                <li>Use precise milligram scales</li>
                                <li>Start with smallest possible amount</li>
                                <li>Avoid redosing within 2+ hours</li>
                                <li>Set strict limits beforehand</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🏥 Safety Measures</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Never use alone</li>
                                <li>Use clean, personal equipment</li>
                                <li>Stay hydrated (small amounts)</li>
                                <li>Monitor heart rate and temperature</li>
                                <li>Take breaks in cool environment</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🧠 Mental Health</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Avoid if prone to paranoia/anxiety</li>
                                <li>Don't use to treat depression</li>
                                <li>Plan for post-use depression</li>
                                <li>Have support system available</li>
                                <li>Consider professional help early</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Emergency Information -->
                <div class="emergency-card" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.05) 100%); border: 2px solid rgba(239, 68, 68, 0.3); border-radius: var(--radius-lg); padding: 2rem; margin: 2rem 0;">
                    <h4 style="color: var(--danger-color); margin-bottom: 1rem;">🚨 Cocaine Emergency Protocols</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">⚠️ Call 112/911 If:</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Chest pain or heart palpitations</li>
                                <li>Difficulty breathing</li>
                                <li>Severe headache or stroke symptoms</li>
                                <li>Seizures or convulsions</li>
                                <li>Hyperthermia (overheating)</li>
                                <li>Psychotic or violent behavior</li>
                                <li>Loss of consciousness</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🏥 Medical Treatment</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Benzodiazepines for agitation/seizures</li>
                                <li>Cooling measures for hyperthermia</li>
                                <li>Cardiac monitoring and treatment</li>
                                <li>Blood pressure management</li>
                                <li>IV fluids and supportive care</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🤝 First Aid</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Keep person calm and cool</li>
                                <li>Remove to quiet environment</li>
                                <li>Monitor breathing and pulse</li>
                                <li>Don't leave alone if agitated</li>
                                <li>Be honest with medical personnel</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 4-MMC Information Page -->
            <div id="drug-info-4mmc-info" class="drug-info-content">
                <h3>💊 4-MMC (Mephedrone) - Complete Information Guide</h3>
                
                <!-- Overview Section -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">🧬 What is 4-MMC?</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">Chemical Information</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li><strong>Chemical name:</strong> 4-Methylmethcathinone</li>
                                <li><strong>Street names:</strong> Mephedrone, M-Cat, Meow Meow, 4-MMC</li>
                                <li><strong>Class:</strong> Synthetic cathinone (bath salt)</li>
                                <li><strong>Schedule:</strong> Class B/Schedule I (illegal)</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">Mechanism of Action</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Triple reuptake inhibitor (dopamine, serotonin, norepinephrine)</li>
                                <li>Also acts as a releasing agent</li>
                                <li>MDMA-like empathogenic effects</li>
                                <li>Stimulant properties similar to amphetamines</li>
                            </ul>
                        </div>
                    </div>
                    <div style="margin-top: 1rem; padding: 1rem; background: rgba(239, 68, 68, 0.1); border-radius: var(--radius-md); border: 1px solid rgba(239, 68, 68, 0.3);">
                        <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem;">
                            <strong>⚠️ Warning:</strong> 4-MMC is a relatively new synthetic drug with limited research on long-term effects. It carries significant risks including cardiovascular complications and high addiction potential.
                        </p>
                    </div>
                </div>

                <!-- Dosage Information -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">⚖️ Dosage Guidelines</h4>
                    <div style="margin-bottom: 1.5rem;">
                        <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">📋 Oral Dosages</h5>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                            <div style="background: rgba(34, 197, 94, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(34, 197, 94, 0.3);">
                                <h6 style="color: #22c55e; margin-bottom: 0.5rem;">🌱 Threshold (15-30mg)</h6>
                                <p style="font-size: 0.8rem; color: var(--text-secondary); margin: 0;">Mild stimulation, slight mood lift</p>
                            </div>
                            <div style="background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(59, 130, 246, 0.3);">
                                <h6 style="color: #3b82f6; margin-bottom: 0.5rem;">✨ Light (30-75mg)</h6>
                                <p style="font-size: 0.8rem; color: var(--text-secondary); margin: 0;">Clear stimulation, enhanced sociability</p>
                            </div>
                            <div style="background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(16, 185, 129, 0.3);">
                                <h6 style="color: #10b981; margin-bottom: 0.5rem;">🌟 Common (75-125mg)</h6>
                                <p style="font-size: 0.8rem; color: var(--text-secondary); margin: 0;">Strong empathy, euphoria</p>
                            </div>
                            <div style="background: rgba(245, 158, 11, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(245, 158, 11, 0.3);">
                                <h6 style="color: #f59e0b; margin-bottom: 0.5rem;">⚠️ Strong (125-175mg)</h6>
                                <p style="font-size: 0.8rem; color: var(--text-secondary); margin: 0;">Intense effects, increased risks</p>
                            </div>
                            <div style="background: rgba(239, 68, 68, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(239, 68, 68, 0.3);">
                                <h6 style="color: #ef4444; margin-bottom: 0.5rem;">🚨 Heavy (175mg+)</h6>
                                <p style="font-size: 0.8rem; color: var(--text-secondary); margin: 0;">High risk, dangerous territory</p>
                            </div>
                        </div>
                    </div>
                    <div style="margin-bottom: 1.5rem;">
                        <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">💨 Nasal Dosages (Not Recommended)</h5>
                        <div style="padding: 1rem; background: rgba(239, 68, 68, 0.1); border-radius: var(--radius-md); border: 1px solid rgba(239, 68, 68, 0.3);">
                            <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem;">
                                <strong>⚠️ Nasal use not recommended:</strong> Extremely caustic to nasal tissues, causes severe damage to nasal cavity and sinuses. If insufflated, doses are typically 25-50% of oral doses, but the damage is severe.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Timeline and Effects -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">⏱️ Timeline and Effects (Oral)</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">📈 Come-up (20-40 minutes)</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Initial alertness and energy</li>
                                <li>Mood elevation beginning</li>
                                <li>Slight increase in heart rate</li>
                                <li>Enhanced sociability emerging</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🌟 Peak (1-3 hours)</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Strong euphoria and empathy</li>
                                <li>Enhanced music appreciation</li>
                                <li>Increased confidence and talkativeness</li>
                                <li>Physical stimulation</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">📉 Come-down (3-6 hours)</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Gradual reduction in euphoria</li>
                                <li>Possible anxiety or restlessness</li>
                                <li>Strong urge to redose</li>
                                <li>Beginning of crash symptoms</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">💤 After-effects (6-24 hours)</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Depression and dysphoria</li>
                                <li>Mental and physical fatigue</li>
                                <li>Sleep difficulties</li>
                                <li>Possible anxiety and paranoia</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Effects Profile -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--success-color); margin-bottom: 1rem;">🌀 Effects Profile</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">✨ Positive Effects</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Intense euphoria and well-being</li>
                                <li>Enhanced empathy and emotional connection</li>
                                <li>Increased energy and alertness</li>
                                <li>Enhanced music and sensory appreciation</li>
                                <li>Increased confidence and sociability</li>
                                <li>Lowered inhibitions</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">⚠️ Negative Effects</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Increased heart rate and blood pressure</li>
                                <li>Hyperthermia (overheating)</li>
                                <li>Jaw clenching and teeth grinding</li>
                                <li>Anxiety and paranoia</li>
                                <li>Insomnia and sleep disruption</li>
                                <li>Compulsive redosing urges</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- High Addiction Risk -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--danger-color); margin-bottom: 1rem;">🔄 Extremely High Addiction Risk</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">⚡ Addiction Characteristics</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Extremely high psychological dependence</li>
                                <li>Rapid tolerance development</li>
                                <li>Compulsive redosing during sessions</li>
                                <li>Strong cravings between uses</li>
                                <li>Difficult to control intake</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">📉 Withdrawal and Crash</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Severe depression lasting days</li>
                                <li>Extreme fatigue and hypersomnia</li>
                                <li>Anhedonia (inability to feel pleasure)</li>
                                <li>Intense cravings</li>
                                <li>Cognitive impairment</li>
                            </ul>
                        </div>
                    </div>
                    <div style="margin-top: 1rem; padding: 1rem; background: rgba(239, 68, 68, 0.1); border-radius: var(--radius-md); border: 1px solid rgba(239, 68, 68, 0.3);">
                        <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem;">
                            <strong>🚨 Critical Warning:</strong> 4-MMC has one of the highest addiction potentials among recreational drugs. Many users report losing control after just a few uses. Binge patterns are extremely common.
                        </p>
                    </div>
                </div>

                <!-- Health Risks -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--danger-color); margin-bottom: 1rem;">⚠️ Health Risks</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">❤️ Cardiovascular</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Rapid heartbeat and palpitations</li>
                                <li>High blood pressure</li>
                                <li>Risk of heart attack</li>
                                <li>Arrhythmias (irregular heartbeat)</li>
                                <li>Cardiovascular collapse</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🌡️ Hyperthermia</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Dangerous overheating</li>
                                <li>Excessive sweating</li>
                                <li>Heat stroke risk</li>
                                <li>Dehydration</li>
                                <li>Multi-organ failure</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🧠 Neurological</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Serotonin syndrome risk</li>
                                <li>Potential neurotoxicity</li>
                                <li>Seizures (especially with high doses)</li>
                                <li>Memory and cognitive problems</li>
                                <li>Mood disorders</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">👃 Physical Damage</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Severe nasal damage (if snorted)</li>
                                <li>Nasal septum perforation</li>
                                <li>Chronic sinusitis</li>
                                <li>Loss of smell and taste</li>
                                <li>Oral health problems</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Dangerous Combinations -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--danger-color); margin-bottom: 1rem;">⚠️ Dangerous Combinations</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🚫 Extremely Dangerous</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li><strong>MAOIs:</strong> Life-threatening serotonin syndrome</li>
                                <li><strong>MDMA/SSRIs:</strong> Serotonin syndrome risk</li>
                                <li><strong>Other cathinones:</strong> Compounded toxicity</li>
                                <li><strong>Stimulants:</strong> Increased cardiovascular risk</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">⚠️ High Risk</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li><strong>Alcohol:</strong> Masks intoxication, dehydration</li>
                                <li><strong>Depressants:</strong> Dangerous with comedown</li>
                                <li><strong>Psychedelics:</strong> Increased anxiety/paranoia</li>
                                <li><strong>Any combination increases risks</strong></li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Harm Reduction -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--warning-color); margin-bottom: 1rem;">🛡️ Critical Harm Reduction</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">⚖️ Dosage Control</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Pre-measure doses before starting</li>
                                <li>Hide or give away extra supply</li>
                                <li>Set strict time limits</li>
                                <li>Never redose within 2+ hours</li>
                                <li>Use precise milligram scales</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🌡️ Temperature Management</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Stay in cool environment</li>
                                <li>Take regular cooling breaks</li>
                                <li>Monitor body temperature</li>
                                <li>Avoid excessive physical activity</li>
                                <li>Remove layers if overheating</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">💧 Hydration and Nutrition</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Sip water regularly (don't overhydrate)</li>
                                <li>Electrolyte replacement important</li>
                                <li>Eat before use (absorption)</li>
                                <li>Have nutritious food for recovery</li>
                                <li>Avoid alcohol completely</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Recovery and Aftercare -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--accent-color); margin-bottom: 1rem;">🌅 Recovery and Aftercare</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">💤 Sleep and Rest</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Plan for 1-3 days of recovery</li>
                                <li>Create sleep-conducive environment</li>
                                <li>Consider natural sleep aids</li>
                                <li>Avoid screens before sleep attempts</li>
                                <li>Don't force sleep immediately</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🧠 Mental Health Support</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Have trusted friends available</li>
                                <li>Plan engaging but low-key activities</li>
                                <li>Practice self-compassion</li>
                                <li>Consider therapy if struggling</li>
                                <li>Join support groups if needed</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🥗 Nutritional Recovery</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Focus on nutrient-dense foods</li>
                                <li>B-vitamins and magnesium supplements</li>
                                <li>Antioxidant-rich fruits and vegetables</li>
                                <li>Stay hydrated throughout recovery</li>
                                <li>Avoid excessive caffeine</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Emergency Information -->
                <div class="emergency-card" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.05) 100%); border: 2px solid rgba(239, 68, 68, 0.3); border-radius: var(--radius-lg); padding: 2rem; margin: 2rem 0;">
                    <h4 style="color: var(--danger-color); margin-bottom: 1rem;">🚨 4-MMC Emergency Protocols</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">⚠️ Call 112/911 If:</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Hyperthermia (very high body temperature)</li>
                                <li>Chest pain or heart problems</li>
                                <li>Seizures or convulsions</li>
                                <li>Loss of consciousness</li>
                                <li>Extreme agitation or psychosis</li>
                                <li>Difficulty breathing</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🏥 Medical Treatment</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Cooling measures for hyperthermia</li>
                                <li>Benzodiazepines for agitation</li>
                                <li>IV fluids and electrolyte monitoring</li>
                                <li>Cardiac monitoring</li>
                                <li>Serotonin syndrome treatment if needed</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🤝 First Aid</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Move to cool, quiet environment</li>
                                <li>Remove excess clothing</li>
                                <li>Cool water on wrists/neck</li>
                                <li>Keep calm and provide reassurance</li>
                                <li>Be completely honest with medical staff</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 2-MMC Information Page -->
            <div id="drug-info-2mmc-info" class="drug-info-content">
                <h3>⚡ 2-MMC (2-Methylmethcathinone) - Complete Information Guide</h3>
                
                <!-- Overview Section -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">🧬 What is 2-MMC?</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">Chemical Information</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li><strong>Chemical name:</strong> 2-Methylmethcathinone</li>
                                <li><strong>Street names:</strong> 2-MMC, Ortomephedrone</li>
                                <li><strong>Class:</strong> Synthetic cathinone (bath salt)</li>
                                <li><strong>Schedule:</strong> Class B/Schedule I (illegal)</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">Mechanism of Action</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Dopamine and norepinephrine reuptake inhibitor</li>
                                <li>Moderate serotonin activity</li>
                                <li>CNS stimulant properties</li>
                                <li>Similar to but distinct from 4-MMC</li>
                            </ul>
                        </div>
                    </div>
                    <div style="margin-top: 1rem; padding: 1rem; background: rgba(239, 68, 68, 0.1); border-radius: var(--radius-md); border: 1px solid rgba(239, 68, 68, 0.3);">
                        <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem;">
                            <strong>⚠️ Warning:</strong> 2-MMC is a relatively new synthetic cathinone with limited research. It carries significant risks including cardiovascular complications, hyperthermia, and extremely high addiction potential.
                        </p>
                    </div>
                </div>

                <!-- Dosage Information -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">⚖️ Dosage Guidelines</h4>
                    <div style="margin-bottom: 1.5rem;">
                        <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">📋 Oral Dosages (Recommended Route)</h5>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                            <div style="background: rgba(34, 197, 94, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(34, 197, 94, 0.3);">
                                <h6 style="color: #22c55e; margin-bottom: 0.5rem;">🌱 Threshold (15-30mg)</h6>
                                <p style="font-size: 0.8rem; color: var(--text-secondary); margin: 0;">Minimal effects, good for sensitivity testing</p>
                            </div>
                            <div style="background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(59, 130, 246, 0.3);">
                                <h6 style="color: #3b82f6; margin-bottom: 0.5rem;">✨ Light (30-60mg)</h6>
                                <p style="font-size: 0.8rem; color: var(--text-secondary); margin: 0;">Clear stimulation, enhanced mood</p>
                            </div>
                            <div style="background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(16, 185, 129, 0.3);">
                                <h6 style="color: #10b981; margin-bottom: 0.5rem;">🌟 Common (60-100mg)</h6>
                                <p style="font-size: 0.8rem; color: var(--text-secondary); margin: 0;">Full effects, recommended maximum</p>
                            </div>
                            <div style="background: rgba(245, 158, 11, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(245, 158, 11, 0.3);">
                                <h6 style="color: #f59e0b; margin-bottom: 0.5rem;">⚠️ Strong (100-150mg)</h6>
                                <p style="font-size: 0.8rem; color: var(--text-secondary); margin: 0;">Intense effects, high risk territory</p>
                            </div>
                            <div style="background: rgba(239, 68, 68, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid rgba(239, 68, 68, 0.3);">
                                <h6 style="color: #ef4444; margin-bottom: 0.5rem;">🚨 Heavy (150mg+)</h6>
                                <p style="font-size: 0.8rem; color: var(--text-secondary); margin: 0;">Dangerous, high overdose risk</p>
                            </div>
                        </div>
                    </div>
                    <div style="margin-bottom: 1.5rem;">
                        <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">💨 Nasal Dosages (Not Recommended)</h5>
                        <div style="padding: 1rem; background: rgba(239, 68, 68, 0.1); border-radius: var(--radius-md); border: 1px solid rgba(239, 68, 68, 0.3);">
                            <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem;">
                                <strong>⚠️ Nasal route strongly discouraged:</strong> 2-MMC is highly caustic and causes severe damage to nasal tissues. If insufflated, doses should be approximately 60-70% of oral doses, but the tissue damage is extensive and potentially permanent.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Timeline and Effects -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">⏱️ Timeline and Effects (Oral)</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">📈 Come-up (20-45 minutes)</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Initial alertness and energy increase</li>
                                <li>Mood elevation beginning</li>
                                <li>Slight increase in heart rate</li>
                                <li>Enhanced focus emerging</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🌟 Peak (1-3 hours)</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Strong stimulation and euphoria</li>
                                <li>Enhanced sociability and confidence</li>
                                <li>Increased music appreciation</li>
                                <li>Physical stimulation and energy</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">📉 Come-down (3-6 hours)</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Gradual reduction in effects</li>
                                <li>Strong urge to redose</li>
                                <li>Possible anxiety or irritability</li>
                                <li>Beginning of crash symptoms</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">💤 After-effects (6-24 hours)</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Depression and dysphoria</li>
                                <li>Mental and physical fatigue</li>
                                <li>Sleep difficulties</li>
                                <li>Possible anxiety and paranoia</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Effects Profile -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--success-color); margin-bottom: 1rem;">🌀 Effects Profile</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">✨ Positive Effects</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Euphoria and well-being</li>
                                <li>Increased energy and alertness</li>
                                <li>Enhanced confidence and sociability</li>
                                <li>Improved focus and motivation</li>
                                <li>Enhanced music and sensory appreciation</li>
                                <li>Mood elevation</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">⚠️ Negative Effects</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Increased heart rate and blood pressure</li>
                                <li>Hyperthermia (overheating)</li>
                                <li>Jaw clenching and teeth grinding</li>
                                <li>Anxiety and restlessness</li>
                                <li>Insomnia and sleep disruption</li>
                                <li>Compulsive redosing urges</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Extreme Addiction Risk -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--danger-color); margin-bottom: 1rem;">🔄 Extreme Addiction Risk</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">⚡ Addiction Characteristics</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Extremely high psychological dependence</li>
                                <li>Rapid tolerance development</li>
                                <li>Compulsive redosing during sessions</li>
                                <li>Strong cravings between uses</li>
                                <li>Difficult to control or moderate use</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">📉 Withdrawal Symptoms</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Severe depression lasting days to weeks</li>
                                <li>Extreme fatigue and hypersomnia</li>
                                <li>Anhedonia (inability to feel pleasure)</li>
                                <li>Intense cravings and obsessive thoughts</li>
                                <li>Cognitive impairment and brain fog</li>
                            </ul>
                        </div>
                    </div>
                    <div style="margin-top: 1rem; padding: 1rem; background: rgba(239, 68, 68, 0.1); border-radius: var(--radius-md); border: 1px solid rgba(239, 68, 68, 0.3);">
                        <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem;">
                            <strong>🚨 Critical Warning:</strong> 2-MMC has one of the highest addiction potentials among recreational drugs. Many users report losing control after just a few uses, with binge patterns developing rapidly. The compulsive redosing is extremely difficult to resist.
                        </p>
                    </div>
                </div>

                <!-- Health Risks -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--danger-color); margin-bottom: 1rem;">⚠️ Health Risks</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">❤️ Cardiovascular</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Rapid heartbeat and palpitations</li>
                                <li>Dangerous blood pressure elevation</li>
                                <li>Risk of heart attack and stroke</li>
                                <li>Arrhythmias (irregular heartbeat)</li>
                                <li>Cardiovascular collapse at high doses</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🌡️ Hyperthermia</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Dangerous body temperature elevation</li>
                                <li>Excessive sweating and dehydration</li>
                                <li>Heat stroke risk in warm environments</li>
                                <li>Multi-organ failure from overheating</li>
                                <li>Death from hyperthermia</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🧠 Neurological</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Potential neurotoxicity (unknown extent)</li>
                                <li>Seizures at high doses</li>
                                <li>Memory and cognitive problems</li>
                                <li>Mood disorders and depression</li>
                                <li>Possible long-term brain changes</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">👃 Physical Damage</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Severe nasal damage if snorted</li>
                                <li>Nasal septum perforation</li>
                                <li>Chronic sinusitis and infections</li>
                                <li>Loss of smell and taste</li>
                                <li>Dental problems from bruxism</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Dangerous Combinations -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--danger-color); margin-bottom: 1rem;">⚠️ Dangerous Combinations</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🚫 Extremely Dangerous</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li><strong>MAOIs:</strong> Risk of hypertensive crisis and death</li>
                                <li><strong>MDMA/SSRIs:</strong> Serotonin syndrome risk</li>
                                <li><strong>Other stimulants:</strong> Compounded cardiovascular risk</li>
                                <li><strong>Tramadol:</strong> Lowered seizure threshold</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">⚠️ High Risk</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li><strong>Alcohol:</strong> Increased dehydration, masked intoxication</li>
                                <li><strong>Depressants:</strong> Dangerous during comedown</li>
                                <li><strong>Psychedelics:</strong> Increased anxiety and paranoia</li>
                                <li><strong>Any combination increases all risks</strong></li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Critical Harm Reduction -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--warning-color); margin-bottom: 1rem;">🛡️ Critical Harm Reduction</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">⚖️ Dosage Control</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Pre-measure single dose before starting</li>
                                <li>Give remaining supply to trusted friend</li>
                                <li>Set strict time and dose limits</li>
                                <li>Never redose within 4+ hours</li>
                                <li>Use precise milligram scales only</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🌡️ Temperature Management</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Stay in cool, well-ventilated areas</li>
                                <li>Take regular cooling breaks</li>
                                <li>Monitor body temperature frequently</li>
                                <li>Avoid physical exertion and dancing</li>
                                <li>Remove layers if feeling warm</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">💧 Hydration and Safety</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Sip water regularly (don't overhydrate)</li>
                                <li>Include electrolyte replacement</li>
                                <li>Eat before use for slower absorption</li>
                                <li>Have sober trip-sitter present</li>
                                <li>Know emergency contacts and procedures</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Research Status -->
                <div class="info-section" style="background: var(--background-secondary); border-radius: var(--radius-lg); padding: 2rem; margin: 1.5rem 0; border: 1px solid var(--border-color);">
                    <h4 style="color: var(--accent-color); margin-bottom: 1rem;">🔬 Research Status and Unknown Risks</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">📊 Limited Research</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Very few human studies available</li>
                                <li>Long-term effects completely unknown</li>
                                <li>Neurotoxicity potential unclear</li>
                                <li>Metabolite toxicity unknown</li>
                                <li>Drug interaction profile incomplete</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">⚠️ Unknown Risks</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Potential for unique toxicities</li>
                                <li>Unknown cancer risk</li>
                                <li>Reproductive health effects unclear</li>
                                <li>Cognitive impairment extent unknown</li>
                                <li>New health risks may be discovered</li>
                            </ul>
                        </div>
                    </div>
                    <div style="margin-top: 1rem; padding: 1rem; background: rgba(245, 158, 11, 0.1); border-radius: var(--radius-md); border: 1px solid rgba(245, 158, 11, 0.3);">
                        <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem;">
                            <strong>🔬 Scientific Note:</strong> 2-MMC is part of the "novel psychoactive substances" (NPS) category. Users are essentially participating in uncontrolled human experiments with unknown long-term consequences.
                        </p>
                    </div>
                </div>

                <!-- Emergency Information -->
                <div class="emergency-card" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.05) 100%); border: 2px solid rgba(239, 68, 68, 0.3); border-radius: var(--radius-lg); padding: 2rem; margin: 2rem 0;">
                    <h4 style="color: var(--danger-color); margin-bottom: 1rem;">🚨 2-MMC Emergency Protocols</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">⚠️ Call 112/911 If:</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Hyperthermia (very high body temperature)</li>
                                <li>Chest pain or heart problems</li>
                                <li>Seizures or convulsions</li>
                                <li>Loss of consciousness</li>
                                <li>Extreme agitation or psychosis</li>
                                <li>Difficulty breathing</li>
                                <li>Stroke-like symptoms</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🏥 Medical Treatment</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Aggressive cooling for hyperthermia</li>
                                <li>Benzodiazepines for agitation/seizures</li>
                                <li>IV fluids and electrolyte monitoring</li>
                                <li>Cardiac monitoring and support</li>
                                <li>Symptom-based supportive care</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: var(--text-primary); margin-bottom: 0.5rem;">🤝 First Aid</h5>
                            <ul style="color: var(--text-secondary); padding-left: 1.5rem; font-size: 0.9rem;">
                                <li>Move to cool, quiet environment</li>
                                <li>Remove excess clothing</li>
                                <li>Apply cool water to wrists/neck</li>
                                <li>Keep calm and provide reassurance</li>
                                <li>Be completely honest with medical staff</li>
                                <li>Monitor breathing and consciousness</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>K3NOX Drug Calculator</h4>
                    <p>Educational harm reduction calculator suite</p>
                </div>
                <div class="footer-section">
                    <h4>Legal</h4>
                    <ul class="footer-links">
                        <li><a href="#" onclick="openModal('tos')">Terms of Service</a></li>
                        <li><a href="#" onclick="openModal('privacy')">Privacy Policy</a></li>
                        <li><a href="#" onclick="openModal('usage')">Usage Agreement</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Information</h4>
                    <ul class="footer-links">
                        <li><a href="#" onclick="showCalculator('liquid')">Liquid Calculator</a></li>
                        <li><a href="#" onclick="showCalculator('tolerance')">Tolerance Calculator</a></li>
                        <li><a href="#" onclick="openDoseMenu()">Dose Calculators</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 K3NOX Drug Calculator. For educational and harm reduction purposes only.</p>
                <p class="footer-disclaimer">This tool is not a substitute for medical advice. Always consult healthcare professionals.</p>
            </div>
        </div>
    </footer>

    <!-- Legal Document Modals -->
    <!-- Terms of Service Modal -->
    <div id="tos-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Terms of Service</h2>
                <span class="close" onclick="closeModal('tos')">&times;</span>
            </div>
            <div class="modal-body">
                <div class="legal-content">
                    <section>
                        <h3>1. Acceptance of Terms</h3>
                        <p>By accessing and using K3NOX Drug Calculator ("the Service"), you accept and agree to be bound by the terms and provision of this agreement. If you do not agree to abide by the above, please do not use this service.</p>
                    </section>
                    
                    <section>
                        <h3>2. Educational Purpose Only</h3>
                        <p>This calculator is designed exclusively for educational and harm reduction purposes. All calculations are theoretical and based on general guidelines found in scientific literature. Individual responses to substances vary significantly due to factors including but not limited to:</p>
                        <ul>
                            <li>Individual metabolism and body chemistry</li>
                            <li>Tolerance levels and previous use history</li>
                            <li>Mental and physical health conditions</li>
                            <li>Concurrent medications or substances</li>
                            <li>Set, setting, and environmental factors</li>
                        </ul>
                    </section>
                    
                    <section>
                        <h3>3. Medical Disclaimer</h3>
                        <p>The information provided by this service is not medical advice and should not be used as a substitute for professional medical consultation, diagnosis, or treatment. Always seek the advice of your physician or other qualified health provider with any questions you may have regarding a medical condition or substance use.</p>
                    </section>
                    
                    <section>
                        <h3>4. Age Restrictions</h3>
                        <p>This service is intended for users who are 18 years of age or older. By using this service, you represent and warrant that you are at least 18 years old. If you are under 18, you must obtain parental or guardian consent before using this service.</p>
                    </section>
                    
                    <section>
                        <h3>5. Prohibited Uses</h3>
                        <p>You agree not to use this service:</p>
                        <ul>
                            <li>For any illegal purpose or to encourage illegal activities</li>
                            <li>To harm, abuse, harass, threaten, or intimidate others</li>
                            <li>To distribute malware or other malicious code</li>
                            <li>To make decisions regarding illegal substance use</li>
                            <li>In violation of any applicable laws or regulations</li>
                        </ul>
                    </section>
                    
                    <section>
                        <h3>6. Limitation of Liability</h3>
                        <p>To the maximum extent permitted by applicable law, K3NOX Drug Calculator and its operators shall not be liable for any indirect, incidental, special, consequential, or punitive damages, or any loss of profits or revenues, whether incurred directly or indirectly, or any loss of data, use, goodwill, or other intangible losses resulting from your use of the service.</p>
                    </section>
                    
                    <section>
                        <h3>7. Accuracy of Information</h3>
                        <p>While we strive to provide accurate information based on current scientific knowledge, we make no representations or warranties of any kind about the completeness, accuracy, reliability, suitability, or availability of the information, products, services, or related graphics contained in this service.</p>
                    </section>
                    
                    <section>
                        <h3>8. Changes to Terms</h3>
                        <p>We reserve the right to modify these terms at any time. Changes will be effective immediately upon posting to the service. Your continued use of the service after any such changes constitutes your acceptance of the new terms.</p>
                    </section>
                    
                    <section>
                        <h3>9. Governing Law</h3>
                        <p>These terms shall be governed by and construed in accordance with applicable international laws regarding educational content and harm reduction resources.</p>
                    </section>
                    
                    <p class="legal-update">Last updated: September 24, 2025</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Privacy Policy Modal -->
    <div id="privacy-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Privacy Policy</h2>
                <span class="close" onclick="closeModal('privacy')">&times;</span>
            </div>
            <div class="modal-body">
                <div class="legal-content">
                    <section>
                        <h3>1. Information We Collect</h3>
                        <p>K3NOX Drug Calculator is designed with privacy in mind. We collect minimal information to provide our service:</p>
                        <ul>
                            <li><strong>No Personal Data:</strong> We do not collect, store, or process any personal information, names, email addresses, or identifying information.</li>
                            <li><strong>No Calculation History:</strong> All calculations are performed locally in your browser and are not stored or transmitted to our servers.</li>
                            <li><strong>Technical Data:</strong> We may collect basic technical information such as browser type, device type, and general geographic region (country level) for service improvement purposes.</li>
                        </ul>
                    </section>
                    
                    <section>
                        <h3>2. How We Use Information</h3>
                        <p>Any technical information collected is used solely for:</p>
                        <ul>
                            <li>Improving service performance and compatibility</li>
                            <li>Understanding general usage patterns to enhance user experience</li>
                            <li>Ensuring service availability and security</li>
                        </ul>
                    </section>
                    
                    <section>
                        <h3>3. Data Storage and Security</h3>
                        <p>Your privacy and security are paramount:</p>
                        <ul>
                            <li>All calculations are performed locally in your browser</li>
                            <li>No calculation data, inputs, or results are transmitted to our servers</li>
                            <li>No user accounts or profiles are created or maintained</li>
                            <li>No cookies are used for tracking or data collection</li>
                        </ul>
                    </section>
                    
                    <section>
                        <h3>4. Third-Party Services</h3>
                        <p>This service operates independently and does not integrate with third-party analytics, advertising, or data collection services. We do not share any information with third parties.</p>
                    </section>
                    
                    <section>
                        <h3>5. Local Storage</h3>
                        <p>Your browser may store temporary data locally for functionality purposes. This data remains on your device and can be cleared by:</p>
                        <ul>
                            <li>Clearing your browser cache and cookies</li>
                            <li>Using private/incognito browsing mode</li>
                            <li>Manually clearing local storage in browser settings</li>
                        </ul>
                    </section>
                    
                    <section>
                        <h3>6. Your Rights</h3>
                        <p>Since we do not collect personal data, traditional data protection rights do not apply. However, you maintain complete control over:</p>
                        <ul>
                            <li>All input data (entered only locally)</li>
                            <li>Calculation results (computed only locally)</li>
                            <li>Browser storage (can be cleared at any time)</li>
                        </ul>
                    </section>
                    
                    <section>
                        <h3>7. Children's Privacy</h3>
                        <p>This service is not intended for children under 18. We do not knowingly collect any information from children. If you believe a child has accessed this service, please contact us immediately.</p>
                    </section>
                    
                    <section>
                        <h3>8. Changes to Privacy Policy</h3>
                        <p>We may update this privacy policy periodically. Any changes will be posted on this page with an updated revision date. Continued use of the service constitutes acceptance of any changes.</p>
                    </section>
                    
                    <section>
                        <h3>9. Contact Information</h3>
                        <p>If you have questions about this privacy policy or our data practices, please review our terms of service or contact us through official channels.</p>
                    </section>
                    
                    <p class="legal-update">Last updated: September 24, 2025</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Usage Agreement Modal -->
    <div id="usage-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Usage Agreement</h2>
                <span class="close" onclick="closeModal('usage')">&times;</span>
            </div>
            <div class="modal-body">
                <div class="legal-content">
                    <section>
                        <h3>1. Harm Reduction Purpose</h3>
                        <p>K3NOX Drug Calculator is a harm reduction educational tool designed to provide theoretical dosage calculations based on scientific literature. This tool is intended to:</p>
                        <ul>
                            <li>Educate users about dosage relationships and tolerance patterns</li>
                            <li>Provide general safety information about various substances</li>
                            <li>Support academic research and educational initiatives</li>
                            <li>Promote understanding of pharmacological principles</li>
                        </ul>
                    </section>
                    
                    <section>
                        <h3>2. Educational Use Only</h3>
                        <p>This calculator is strictly for educational purposes and must not be used to:</p>
                        <ul>
                            <li>Make actual dosing decisions for any controlled or illegal substances</li>
                            <li>Replace professional medical advice or consultation</li>
                            <li>Plan or facilitate illegal drug use</li>
                            <li>Provide medical treatment recommendations</li>
                        </ul>
                    </section>
                    
                    <section>
                        <h3>3. Safety Considerations</h3>
                        <p>Users must understand that:</p>
                        <ul>
                            <li>Individual responses to substances vary dramatically</li>
                            <li>Purity and composition of illegal substances cannot be guaranteed</li>
                            <li>Drug interactions can be dangerous and unpredictable</li>
                            <li>Mental health conditions may affect substance responses</li>
                            <li>No amount of any illegal substance can be considered "safe"</li>
                        </ul>
                    </section>
                    
                    <section>
                        <h3>4. Medical Conditions</h3>
                        <p>This tool does not account for medical conditions that may affect substance metabolism or interactions, including but not limited to:</p>
                        <ul>
                            <li>Cardiovascular conditions</li>
                            <li>Liver or kidney dysfunction</li>
                            <li>Mental health disorders</li>
                            <li>Pregnancy or breastfeeding</li>
                            <li>Concurrent medications</li>
                        </ul>
                    </section>
                    
                    <section>
                        <h3>5. Legal Considerations</h3>
                        <p>Users must be aware that:</p>
                        <ul>
                            <li>Controlled substances are illegal in most jurisdictions</li>
                            <li>Laws vary significantly by location</li>
                            <li>Possession, use, and distribution may carry serious legal penalties</li>
                            <li>This tool does not provide legal advice</li>
                            <li>Users are responsible for understanding and complying with local laws</li>
                        </ul>
                    </section>
                    
                    <section>
                        <h3>6. Emergency Information</h3>
                        <p>In case of medical emergency or adverse reactions:</p>
                        <ul>
                            <li>Call emergency services immediately (911, 112, etc.)</li>
                            <li>Be honest with medical professionals about substance use</li>
                            <li>Do not delay seeking medical attention</li>
                            <li>Consider having naloxone (Narcan) available for opioid emergencies</li>
                        </ul>
                    </section>
                    
                    <section>
                        <h3>7. Accuracy Limitations</h3>
                        <p>This tool's calculations are based on:</p>
                        <ul>
                            <li>General population averages and may not apply to individuals</li>
                            <li>Published research which may have limitations</li>
                            <li>Theoretical models that may not reflect real-world conditions</li>
                            <li>Assumptions about substance purity and consistency</li>
                        </ul>
                    </section>
                    
                    <section>
                        <h3>8. Responsible Use Guidelines</h3>
                        <p>If using this tool for educational purposes, consider:</p>
                        <ul>
                            <li>Researching harm reduction strategies</li>
                            <li>Understanding drug testing and adulterant detection</li>
                            <li>Learning about safer use practices</li>
                            <li>Seeking support for substance use concerns</li>
                            <li>Consulting healthcare providers about substance use</li>
                        </ul>
                    </section>
                    
                    <section>
                        <h3>9. Acknowledgment</h3>
                        <p>By using this service, you acknowledge that you have read, understood, and agree to comply with this usage agreement. You understand the educational nature of this tool and accept full responsibility for any decisions made based on the information provided.</p>
                    </section>
                    
                    <p class="legal-update">Last updated: September 24, 2025</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables for dropdown state
        let isDoseMenuOpen = false;
        
        // Emergency information system
        const emergencyContacts = {
            global: {
                us: "Emergency: 911",
                eu: "Emergency: 112",
                uk: "Emergency: 999",
                au: "Emergency: 000",
                ca: "Emergency: 911"
            },
            poison: {
                us: "Poison Control: 1-800-222-1222",
                uk: "NHS 111 or 999",
                au: "Poisons Information: 13 11 26",
                ca: "Poison Control: 1-844-POISON-X"
            },
            crisis: "Crisis Text Line: Text HOME to 741741",
            danceSafe: "DanceSafe.org for testing info"
        };
        
        // Drug testing information database
        const drugTestingInfo = {
            mdma: {
                reagents: [
                    { name: 'Marquis', expected: 'Purple/Black', adulterants: 'Detects most substitutes' },
                    { name: 'Mecke', expected: 'Blue/Black', adulterants: 'Confirms MDMA presence' },
                    { name: 'Mandelin', expected: 'Blue/Black', adulterants: 'Additional confirmation' }
                ],
                commonAdulterants: ['Caffeine', 'MDA', 'Methylone', 'PMMA', 'PMA'],
                testStrips: 'Fentanyl test strips recommended',
                resources: 'DanceSafe.org, Bunk Police'
            },
            lsd: {
                reagents: [
                    { name: 'Ehrlich', expected: 'Purple/Pink', adulterants: 'Detects indoles' },
                    { name: 'Hofmann', expected: 'Blue', adulterants: 'Confirms LSD vs analogs' }
                ],
                commonAdulterants: ['NBOMe', '25I-NBOMe', 'DOB', 'DOC'],
                testStrips: 'Highly recommended - NBOMe can be fatal',
                resources: 'Test your tabs before use'
            },
            ketamine: {
                reagents: [
                    { name: 'Mandelin', expected: 'Orange', adulterants: 'Primary test' },
                    { name: 'Mecke', expected: 'Light Yellow', adulterants: 'Confirmation' }
                ],
                commonAdulterants: ['Caffeine', 'Lactose', 'MSG', '2F-DCK'],
                testStrips: 'Recommended for purity',
                resources: 'KnowYourStuff NZ, DanceSafe'
            },
            cocaine: {
                reagents: [
                    { name: 'Scott', expected: 'Blue', adulterants: 'Primary cocaine test' },
                    { name: 'Liebermann', expected: 'Orange/Red', adulterants: 'Secondary confirmation' }
                ],
                commonAdulterants: ['Levamisole', 'Lidocaine', 'Caffeine', 'Phenacetin'],
                testStrips: 'Fentanyl strips essential',
                resources: 'High contamination risk - test mandatory'
            }
        };
        
        // Legal status information
        const legalStatus = {
            mdma: { 
                us: 'Schedule I - Illegal', 
                eu: 'Class A/Schedule I - Illegal', 
                uk: 'Class A - Illegal',
                status: 'illegal',
                penalties: 'Severe criminal penalties apply'
            },
            lsd: { 
                us: 'Schedule I - Illegal', 
                eu: 'Class A/Schedule I - Illegal', 
                uk: 'Class A - Illegal',
                status: 'illegal',
                penalties: 'Severe criminal penalties apply'
            },
            ketamine: { 
                us: 'Schedule III - Controlled', 
                eu: 'Prescription only - Controlled', 
                uk: 'Class B - Controlled',
                status: 'controlled',
                penalties: 'Criminal penalties for unauthorized use'
            },
            cocaine: { 
                us: 'Schedule II - Illegal', 
                eu: 'Class A/Schedule I - Illegal', 
                uk: 'Class A - Illegal',
                status: 'illegal',
                penalties: 'Severe criminal penalties apply'
            }
        };
        
        // Enhanced input validation and sanitization
        function validateAndSanitizeInput(value, type, min = 0, max = 1000, fieldName = 'input') {
            if (!value && value !== 0) {
                throw new Error(`${fieldName} is required`);
            }
            
            if (type === 'number') {
                const num = parseFloat(value);
                if (isNaN(num)) {
                    throw new Error(`${fieldName} must be a valid number`);
                }
                if (num < min || num > max) {
                    throw new Error(`${fieldName} must be between ${min} and ${max}`);
                }
                return num;
            }
            
            if (type === 'string') {
                // XSS prevention
                const sanitized = value.toString()
                    .replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '')
                    .replace(/<[^>]*>/g, '')
                    .trim();
                    
                if (sanitized.length < min || sanitized.length > max) {
                    throw new Error(`${fieldName} length must be between ${min} and ${max} characters`);
                }
                return sanitized;
            }
            
            return value;
        }
        
        // Unit conversion system
        const unitConverter = {
            weight: {
                kg: 1,
                lbs: 0.453592,
                stone: 6.35029
            },
            dose: {
                mg: 1,
                μg: 0.001,
                mcg: 0.001,
                g: 1000
            },
            volume: {
                ml: 1,
                l: 1000,
                oz: 29.5735,
                cups: 236.588
            }
        };
        
        function convertUnits(value, fromUnit, toUnit, type) {
            if (!unitConverter[type] || !unitConverter[type][fromUnit] || !unitConverter[type][toUnit]) {
                return value;
            }
            return (value * unitConverter[type][fromUnit]) / unitConverter[type][toUnit];
        }
        
        // User preferences management (privacy-focused)
        function saveUserPreferences() {
            try {
                const preferences = {
                    units: document.getElementById('preferred-units')?.value || 'metric',
                    warnings: document.getElementById('show-warnings')?.checked !== false,
                    language: document.getElementById('preferred-language')?.value || 'en',
                    theme: document.getElementById('preferred-theme')?.value || 'dark',
                    timestamp: Date.now()
                };
                localStorage.setItem('drugCalcPrefs', JSON.stringify(preferences));
            } catch (error) {
                console.warn('Unable to save preferences:', error);
            }
        }
        
        function loadUserPreferences() {
            try {
                const saved = localStorage.getItem('drugCalcPrefs');
                if (saved) {
                    const preferences = JSON.parse(saved);
                    // Apply preferences to UI elements
                    if (document.getElementById('preferred-units')) {
                        document.getElementById('preferred-units').value = preferences.units || 'metric';
                    }
                    return preferences;
                }
            } catch (error) {
                console.warn('Unable to load preferences:', error);
            }
            return null;
        }
        
        // Anonymous usage statistics (no personal data)
        function trackAnonymousUsage(calculatorType) {
            try {
                const stats = JSON.parse(localStorage.getItem('anonStats') || '{}');
                stats.calculationsUsed = (stats.calculationsUsed || 0) + 1;
                stats.lastCalculationType = calculatorType;
                stats.lastUsed = Date.now();
                // Only store aggregate data, never personal information
                localStorage.setItem('anonStats', JSON.stringify(stats));
            } catch (error) {
                console.warn('Unable to track usage:', error);
            }
        }
        
        // Routing system for deep linking
        const RoutingSystem = {
            // Get the base path for GitHub Pages
            getBasePath() {
                return '/drug-rechner';
            },
            
            // Parse the current URL path
            getCurrentPath() {
                const path = window.location.pathname;
                const basePath = this.getBasePath();
                
                // Remove base path if present
                if (path.startsWith(basePath)) {
                    return path.substring(basePath.length);
                }
                return path;
            },
            
            // Update the URL without refreshing the page
            updateUrl(path) {
                const basePath = this.getBasePath();
                const fullPath = basePath + path;
                
                if (window.location.pathname !== fullPath) {
                    window.history.pushState({}, '', fullPath);
                }
            },
            
            // Navigate to a specific calculator
            navigateTo(type, calculator = null) {
                let path = '';
                
                if (type === 'liquid') {
                    path = '/liquid';
                } else if (type === 'tolerance') {
                    path = '/tolerance';
                } else if (type === 'dose' && calculator) {
                    path = `/dose/${calculator}`;
                } else if (calculator) {
                    // Direct calculator access
                    path = `/dose/${type}`;
                }
                
                this.updateUrl(path);
                return path;
            },
            
            // Parse URL path to determine which calculator to show
            parsePathToCalculator(path) {
                // Remove leading/trailing slashes
                path = path.replace(/^\/+|\/+$/g, '');
                
                if (!path || path === '') {
                    return { type: 'liquid', calculator: null };
                }
                
                const segments = path.split('/');
                
                if (segments[0] === 'liquid') {
                    return { type: 'liquid', calculator: null };
                } else if (segments[0] === 'tolerance') {
                    return { type: 'tolerance', calculator: null };
                } else if (segments[0] === 'dose' && segments[1]) {
                    return { type: 'dose', calculator: segments[1] };
                } else if (segments.length === 1) {
                    // Direct calculator access (legacy support)
                    const validCalculators = ['mdma', 'lsd', 'ketamine', 'ghb', 'amphetamines', 'cocaine', '4mmc'];
                    if (validCalculators.includes(segments[0])) {
                        return { type: 'dose', calculator: segments[0] };
                    }
                }
                
                // Default to liquid if path is not recognized
                return { type: 'liquid', calculator: null };
            },
            
            // Initialize routing system
            init() {
                // Check for redirect parameter from 404 page
                const urlParams = new URLSearchParams(window.location.search);
                const redirectPath = urlParams.get('redirect');
                
                if (redirectPath) {
                    // Clean URL and navigate to the correct path
                    const cleanUrl = window.location.origin + this.getBasePath() + redirectPath;
                    window.history.replaceState({}, '', cleanUrl);
                }
                
                // Handle browser back/forward buttons
                window.addEventListener('popstate', () => {
                    this.loadFromCurrentUrl();
                });
                
                // Load the correct calculator on page load
                this.loadFromCurrentUrl();
            },
            
            // Load calculator based on current URL
            loadFromCurrentUrl() {
                const path = this.getCurrentPath();
                const { type, calculator } = this.parsePathToCalculator(path);
                
                if (type === 'dose' && calculator) {
                    showCalculatorInternal(calculator);
                } else {
                    showCalculatorInternal(type);
                }
            }
        };
        
        // Enhanced navigation functionality
        function showCalculator(calculatorId, updateUrl = true) {
            showCalculatorInternal(calculatorId);
            
            // Update URL if requested
            if (updateUrl) {
                if (calculatorId === 'liquid' || calculatorId === 'tolerance') {
                    RoutingSystem.navigateTo(calculatorId);
                } else {
                    RoutingSystem.navigateTo('dose', calculatorId);
                }
            }
        }
        
        // Internal function to show calculator without URL updates
        function showCalculatorInternal(calculatorId) {
            // Hide all calculators
            const sections = document.querySelectorAll('.calculator-section');
            sections.forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all main tabs and update ARIA states
            const tabs = document.querySelectorAll('.tab-btn');
            tabs.forEach(tab => {
                tab.classList.remove('active');
                tab.setAttribute('aria-selected', 'false');
                tab.setAttribute('tabindex', '-1');
            });
            
            // Remove active class from dose toggle
            const doseToggle = document.getElementById('dose-calc-btn');
            doseToggle.classList.remove('active');
            doseToggle.setAttribute('aria-expanded', 'false');
            
            // Remove active class from general info toggle
            const generalInfoToggle = document.getElementById('general-info-btn');
            generalInfoToggle.classList.remove('active');
            
            // Remove active class from drug specific toggle
            const drugSpecificToggle = document.getElementById('drug-specific-btn');
            drugSpecificToggle.classList.remove('active');
            
            // Remove active class from all dose menu items
            const doseMenuItems = document.querySelectorAll('.dose-menu-item');
            doseMenuItems.forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected calculator
            const targetSection = document.getElementById(calculatorId);
            if (targetSection) {
                targetSection.classList.add('active');
                // Announce calculator change to screen readers
                if (typeof announceToScreenReader === 'function') {
                    announceToScreenReader(`Switched to ${calculatorId} calculator`);
                }
            }
            
            // Set active states based on calculator type
            const doseCalculators = ['mdma', 'lsd', 'ketamine', 'ghb', 'amphetamines', 'cocaine', '4mmc', '2mmc'];
            
            if (calculatorId === 'liquid') {
                // Activate liquid dosage tab
                const liquidTab = document.getElementById('liquid-tab');
                if (liquidTab) {
                    liquidTab.classList.add('active');
                    liquidTab.setAttribute('aria-selected', 'true');
                    liquidTab.setAttribute('tabindex', '0');
                }
            } else if (calculatorId === 'tolerance') {
                // Activate general tolerance tab
                const toleranceTab = document.getElementById('tolerance-tab');
                if (toleranceTab) {
                    toleranceTab.classList.add('active');
                    toleranceTab.setAttribute('aria-selected', 'true');
                    toleranceTab.setAttribute('tabindex', '0');
                }
            } else if (doseCalculators.includes(calculatorId)) {
                // Activate dose calculator dropdown button
                doseToggle.classList.add('active');
                // Also activate the specific dropdown item
                const activeMenuItem = document.querySelector(`button[onclick="selectDoseCalculator('${calculatorId}')"]`);
                if (activeMenuItem) {
                    activeMenuItem.classList.add('active');
                }
            } else if (calculatorId === 'drug-info') {
                // Activate both general info and drug specific toggles for drug info section
                generalInfoToggle.classList.add('active');
                drugSpecificToggle.classList.add('active');
            }
            
            // Close all menus if open
            closeDoseMenu();
            closeGeneralInfoMenu();
            closeDrugSpecificMenu();
        }
        
        // Toggle dose calculator menu
        function toggleDoseMenu() {
            const doseMenu = document.getElementById('dose-menu');
            const mobileOverlay = document.getElementById('mobile-overlay');
            const doseCalculators = document.querySelector('.dose-calculators');
            
            if (isDoseMenuOpen) {
                closeDoseMenu();
            } else {
                openDoseMenu();
            }
        }
        
        // Open dose menu
        function openDoseMenu() {
            const doseMenu = document.getElementById('dose-menu');
            const mobileOverlay = document.getElementById('mobile-overlay');
            const doseCalculators = document.querySelector('.dose-calculators');
            const doseToggle = document.getElementById('dose-calc-btn');
            
            doseMenu.classList.add('show');
            doseCalculators.classList.add('open');
            
            // Update ARIA state
            doseToggle.setAttribute('aria-expanded', 'true');
            
            // Show overlay on mobile
            if (window.innerWidth <= 768) {
                mobileOverlay.classList.add('show');
                document.body.style.overflow = 'hidden'; // Prevent background scrolling
            }
            
            isDoseMenuOpen = true;
        }
        
        // Close dose menu
        function closeDoseMenu() {
            const doseMenu = document.getElementById('dose-menu');
            const mobileOverlay = document.getElementById('mobile-overlay');
            const doseCalculators = document.querySelector('.dose-calculators');
            const doseToggle = document.getElementById('dose-calc-btn');
            
            doseMenu.classList.remove('show');
            mobileOverlay.classList.remove('show');
            doseCalculators.classList.remove('open');
            document.body.style.overflow = ''; // Re-enable scrolling
            
            // Update ARIA state
            doseToggle.setAttribute('aria-expanded', 'false');
            
            isDoseMenuOpen = false;
        }
        
        // Select dose calculator from menu
        function selectDoseCalculator(calculatorId) {
            showCalculator(calculatorId);
            closeDoseMenu();
        }
        
        // Variables for new dropdown menus
        let isGeneralInfoMenuOpen = false;
        let isDrugSpecificMenuOpen = false;
        
        // Toggle General Info menu
        function toggleGeneralInfoMenu() {
            const generalInfoMenu = document.getElementById('general-info-menu');
            const mobileOverlay = document.getElementById('mobile-overlay');
            const generalInfoCalculators = document.getElementById('general-info-btn').parentNode;
            
            if (isGeneralInfoMenuOpen) {
                closeGeneralInfoMenu();
            } else {
                // Close other menus first
                closeDoseMenu();
                closeDrugSpecificMenu();
                
                generalInfoMenu.classList.add('show');
                generalInfoCalculators.classList.add('open');
                
                if (window.innerWidth <= 768) {
                    mobileOverlay.classList.add('show');
                    document.body.style.overflow = 'hidden';
                }
                
                isGeneralInfoMenuOpen = true;
            }
        }
        
        // Close General Info menu
        function closeGeneralInfoMenu() {
            const generalInfoMenu = document.getElementById('general-info-menu');
            const mobileOverlay = document.getElementById('mobile-overlay');
            const generalInfoCalculators = document.getElementById('general-info-btn').parentNode;
            
            generalInfoMenu.classList.remove('show');
            generalInfoCalculators.classList.remove('open');
            
            if (!isDoseMenuOpen && !isDrugSpecificMenuOpen) {
                mobileOverlay.classList.remove('show');
                document.body.style.overflow = '';
            }
            
            isGeneralInfoMenuOpen = false;
        }
        
        // Toggle Drug Specific menu
        function toggleDrugSpecificMenu() {
            const drugSpecificMenu = document.getElementById('drug-specific-menu');
            const mobileOverlay = document.getElementById('mobile-overlay');
            const drugSpecificCalculators = document.getElementById('drug-specific-btn').parentNode;
            
            if (isDrugSpecificMenuOpen) {
                closeDrugSpecificMenu();
            } else {
                // Close other menus first
                closeDoseMenu();
                closeGeneralInfoMenu();
                
                drugSpecificMenu.classList.add('show');
                drugSpecificCalculators.classList.add('open');
                
                if (window.innerWidth <= 768) {
                    mobileOverlay.classList.add('show');
                    document.body.style.overflow = 'hidden';
                }
                
                isDrugSpecificMenuOpen = true;
            }
        }
        
        // Close Drug Specific menu
        function closeDrugSpecificMenu() {
            const drugSpecificMenu = document.getElementById('drug-specific-menu');
            const mobileOverlay = document.getElementById('mobile-overlay');
            const drugSpecificCalculators = document.getElementById('drug-specific-btn').parentNode;
            
            drugSpecificMenu.classList.remove('show');
            drugSpecificCalculators.classList.remove('open');
            
            if (!isDoseMenuOpen && !isGeneralInfoMenuOpen) {
                mobileOverlay.classList.remove('show');
                document.body.style.overflow = '';
            }
            
            isDrugSpecificMenuOpen = false;
        }
        
        // Close all menus (for mobile overlay)
        function closeAllMenus() {
            closeDoseMenu();
            closeGeneralInfoMenu();
            closeDrugSpecificMenu();
        }
        
        // Close menu when clicking outside (for desktop)
        document.addEventListener('click', function(event) {
            const doseCalculators = document.querySelector('.dose-calculators');
            const isClickInside = doseCalculators.contains(event.target);
            
            if (!isClickInside && isDoseMenuOpen && window.innerWidth > 768) {
                closeDoseMenu();
            }
            
            // Check for General Info menu
            const generalInfoCalculators = document.getElementById('general-info-btn')?.parentNode;
            const isClickInsideGeneralInfo = generalInfoCalculators?.contains(event.target);
            
            if (!isClickInsideGeneralInfo && isGeneralInfoMenuOpen && window.innerWidth > 768) {
                closeGeneralInfoMenu();
            }
            
            // Check for Drug Specific menu
            const drugSpecificCalculators = document.getElementById('drug-specific-btn')?.parentNode;
            const isClickInsideDrugSpecific = drugSpecificCalculators?.contains(event.target);
            
            if (!isClickInsideDrugSpecific && isDrugSpecificMenuOpen && window.innerWidth > 768) {
                closeDrugSpecificMenu();
            }
        });
        
        // Handle escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                if (isDoseMenuOpen) closeDoseMenu();
                if (isGeneralInfoMenuOpen) closeGeneralInfoMenu();
                if (isDrugSpecificMenuOpen) closeDrugSpecificMenu();
            }
        });
        
        // Handle window resize
        window.addEventListener('resize', function() {
            if (window.innerWidth > 768) {
                // Remove mobile overlay if window becomes larger
                const mobileOverlay = document.getElementById('mobile-overlay');
                if (isDoseMenuOpen || isGeneralInfoMenuOpen || isDrugSpecificMenuOpen) {
                    mobileOverlay.classList.remove('show');
                    document.body.style.overflow = '';
                }
            }
        });

        // Drug Info Section Navigation
        function showDrugInfoSection(sectionId) {
            // First, show the main drug info calculator section
            showCalculatorInternal('drug-info');
            
            // Close any open dropdown menus
            closeGeneralInfoMenu();
            closeDrugSpecificMenu();
            
            // Hide all drug info content sections
            const contentSections = document.querySelectorAll('.drug-info-content');
            contentSections.forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.drug-info-tab');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected section
            const targetSection = document.getElementById('drug-info-' + sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
            }
            
            // Activate selected tab
            const targetTab = document.querySelector(`[data-section="${sectionId}"]`);
            if (targetTab) {
                targetTab.classList.add('active');
            }
        }

        // Modal functionality
        function openModal(modalId) {
            const modal = document.getElementById(modalId + '-modal');
            if (modal) {
                modal.style.display = 'block';
                document.body.style.overflow = 'hidden';
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId + '-modal');
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = '';
            }
        }

        // Close modal when clicking outside of it
        window.addEventListener('click', function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
                document.body.style.overflow = '';
            }
        });

        // Close modal with escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const openModals = document.querySelectorAll('.modal');
                openModals.forEach(modal => {
                    if (modal.style.display === 'block') {
                        modal.style.display = 'none';
                        document.body.style.overflow = '';
                    }
                });
            }
        });

        // Utility functions
        function showWarning(message, type = 'warning') {
            const warningClass = type === 'danger' ? 'warning danger' : 'warning';
            return `<div class="${warningClass}"><h4>${type === 'danger' ? '⚠️ Danger' : '⚠️ Warning'}</h4><p>${message}</p></div>`;
        }

        function validateWeight(weight) {
            return weight >= 40 && weight <= 150;
        }

        function calculateBMI(weight, height) {
            if (!height || height <= 0) return null;
            return weight / ((height / 100) * (height / 100));
        }

        function getBMIMultiplier(bmi) {
            if (!bmi) return 1.0;
            
            if (bmi < 16) {
                return 0.7; // Severely underweight - reduce dose significantly
            } else if (bmi < 18.5) {
                return 0.85; // Underweight - reduce dose moderately
            } else if (bmi >= 35) {
                return 1.15; // Severely obese - may need slightly higher dose
            } else if (bmi >= 30) {
                return 1.05; // Obese - may need slightly higher dose
            }
            return 1.0; // Normal BMI range
        }

        function getBMIWarning(bmi) {
            if (!bmi) return '';
            
            if (bmi < 16) {
                return showWarning('Severely underweight BMI detected - doses reduced significantly. Consider medical consultation.', 'danger');
            } else if (bmi < 18.5) {
                return showWarning('Underweight BMI detected - doses reduced for safety.');
            } else if (bmi >= 35) {
                return showWarning('High BMI detected - metabolism may differ. Monitor effects carefully.');
            } else if (bmi >= 30) {
                return showWarning('Elevated BMI detected - body composition affects drug distribution.');
            }
            return '';
        }

        function checkMedicationInteractions(substance, medications) {
            if (!medications || medications === 'none') return { blocked: false, warning: '' };
            
            const dangerousInteractions = {
                'mdma': ['ssri', 'snri', 'maoi', 'tricyclic', 'lithium', 'tramadol', 'dxm', 'other_serotonin'],
                '4mmc': ['ssri', 'snri', 'maoi', 'tricyclic', 'lithium', 'tramadol', 'dxm', 'other_serotonin'],
                'amphetamines': ['maoi', 'tricyclic'],
                'cocaine': ['maoi']
            };
            
            const interactionMessages = {
                'ssri': 'SSRI antidepressants block MDMA effects and increase serotonin syndrome risk',
                'snri': 'SNRI antidepressants block MDMA effects and increase serotonin syndrome risk', 
                'maoi': 'MAOI antidepressants cause LIFE-THREATENING interactions with most psychoactive substances',
                'tricyclic': 'Tricyclic antidepressants can cause dangerous cardiovascular interactions',
                'lithium': 'Lithium significantly increases seizure risk with serotonergic substances',
                'tramadol': 'Tramadol combined with serotonergic substances causes severe serotonin syndrome',
                'dxm': 'DXM has dangerous interactions with serotonergic substances',
                'other_serotonin': 'Other serotonergic medications increase risk of serotonin syndrome'
            };
            
            if (dangerousInteractions[substance] && dangerousInteractions[substance].includes(medications)) {
                return {
                    blocked: true,
                    warning: interactionMessages[medications] || 'Dangerous medication interaction detected'
                };
            }
            
            return { blocked: false, warning: '' };
        }

        function getAgeMultiplier(age) {
            if (!age || age < 18) return 1.0;
            
            if (age < 21) {
                return 0.8; // Young adults - more conservative dosing
            } else if (age >= 65) {
                return 0.7; // Elderly - significantly reduced metabolism
            } else if (age >= 50) {
                return 0.85; // Middle-aged - somewhat reduced metabolism
            }
            return 1.0; // Normal adult range (21-49)
        }

        function getAgeWarning(age) {
            if (!age || age < 18) return '';
            
            if (age < 21) {
                return showWarning('Young adult (under 21) - brain still developing. Doses reduced for safety and reduced neurotoxicity risk.');
            } else if (age >= 65) {
                return showWarning('Elderly (65+) - significantly reduced metabolism and increased cardiovascular risk. Doses reduced substantially.', 'danger');
            } else if (age >= 50) {
                return showWarning('Middle-aged (50+) - metabolism slowing and increased health risks. Monitor carefully.');
            }
            return '';
        }

        function getCrossToleranceWarning(substance, lastUseDays) {
            const crossToleranceGroups = {
                'psychedelics': {
                    substances: ['lsd', 'psilocybin', '2cb', 'mescaline'],
                    warningDays: 14,
                    message: 'Psychedelics have strong cross-tolerance. Recent use of other psychedelics may significantly reduce effects.'
                },
                'entactogens': {
                    substances: ['mdma', 'mda', '4mmc', '6apb'],
                    warningDays: 30,
                    message: 'Entactogens deplete serotonin and have cross-tolerance. Recent use of MDMA/similar substances increases neurotoxicity risk.'
                },
                'stimulants': {
                    substances: ['amphetamine', 'dextroamphetamine', 'methamphetamine', 'cocaine'],
                    warningDays: 7,
                    message: 'Stimulants have partial cross-tolerance and cumulative cardiovascular risks.'
                },
                'dissociatives': {
                    substances: ['ketamine', 'dxm', 'pcp', '3meopcp'],
                    warningDays: 10,
                    message: 'Dissociatives have cross-tolerance and cumulative effects on bladder/urinary system.'
                },
                'depressants': {
                    substances: ['ghb', 'gbl', 'phenibut', 'alcohol'],
                    warningDays: 3,
                    message: 'Depressants have dangerous cross-tolerance and respiratory depression risks.'
                },
                'opioids': {
                    substances: ['morphine', 'oxycodone', 'tramadol', 'kratom'],
                    warningDays: 7,
                    message: 'Opioids have strong cross-tolerance and cumulative dependence risks.'
                }
            };

            // Check if the substance belongs to any cross-tolerance group
            for (const [groupName, group] of Object.entries(crossToleranceGroups)) {
                if (group.substances.includes(substance) && lastUseDays < group.warningDays) {
                    return showWarning(`Cross-tolerance warning: ${group.message}`, 'danger');
                }
            }

            return '';
        }

        function getEmergencyProtocols(substance) {
            const protocols = {
                'mdma': {
                    symptoms: 'Hyperthermia, rapid heartbeat, confusion, seizures, muscle rigidity',
                    immediate: 'Cool the person down, remove excess clothing, apply cool water to skin',
                    antidotes: 'No specific antidote - supportive care only',
                    avoid: 'Do not give ice baths (too cold too fast), avoid more stimulants',
                    call911: 'Temperature >103°F (39.4°C), seizures, unconsciousness, irregular heartbeat'
                },
                'lsd': {
                    symptoms: 'Panic, anxiety, dangerous behavior, hyperthermia, seizures (rare)',
                    immediate: 'Calm environment, reassurance, stay with person, prevent self-harm',
                    antidotes: 'Benzodiazepines for severe anxiety/panic',
                    avoid: 'Do not restrain unless absolutely necessary, avoid loud noises/bright lights',
                    call911: 'Seizures, hyperthermia, violence toward self/others, medical complications'
                },
                'ketamine': {
                    symptoms: 'Respiratory depression, loss of consciousness, vomiting, hypothermia',
                    immediate: 'Recovery position if unconscious, ensure airway clear, monitor breathing',
                    antidotes: 'No specific antidote - supportive care and oxygen',
                    avoid: 'Do not leave person alone if unconscious, avoid stimulants',
                    call911: 'Stopped/slow breathing, blue lips/fingernails, unresponsive, persistent vomiting'
                },
                'cocaine': {
                    symptoms: 'Chest pain, irregular heartbeat, seizures, hyperthermia, stroke',
                    immediate: 'Cool down, give aspirin if conscious and no bleeding, monitor vitals',
                    antidotes: 'Benzodiazepines for agitation/seizures, aspirin for heart attack',
                    avoid: 'Do not give beta-blockers, avoid ice baths',
                    call911: 'Chest pain, difficulty breathing, seizures, stroke symptoms, unconsciousness'
                },
                'ghb': {
                    symptoms: 'Respiratory depression, unconsciousness, vomiting, bradycardia',
                    immediate: 'Recovery position, ensure airway clear, DO NOT induce vomiting',
                    antidotes: 'No specific antidote - supportive care only',
                    avoid: 'Do not give stimulants, do not leave alone if unconscious',
                    call911: 'Unconsciousness, slow/stopped breathing, blue color, unresponsive'
                }
            };

            return protocols[substance] || null;
        }

        function getGenderMultiplier(gender, substance) {
            const multipliers = {
                'mdma': { male: 1.0, female: 0.85 },
                'lsd': { male: 1.0, female: 0.9 },
                'ghb': { male: 1.0, female: 0.8 },
                'amphetamines': { male: 1.0, female: 0.85 },
                'cocaine': { male: 1.0, female: 0.85 }
            };
            return multipliers[substance] ? multipliers[substance][gender] || 1.0 : 1.0;
        }

        // Enhanced emergency and safety information functions
        function displayEmergencyInfo(substance) {
            return `
                <div class="emergency-info" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.05) 100%); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: var(--radius-lg); padding: 1.5rem; margin: 1rem 0;">
                    <h4 style="color: var(--danger-color); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        🚨 Emergency Information
                    </h4>
                    <div style="margin-bottom: 1rem;">
                        <strong>Emergency Contacts:</strong><br>
                        ${emergencyContacts.global.us} | ${emergencyContacts.global.eu} | ${emergencyContacts.global.uk}<br>
                        ${emergencyContacts.poison.us}<br>
                        ${emergencyContacts.crisis}
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <strong>Crisis Resources:</strong><br>
                        • ${emergencyContacts.danceSafe}<br>
                        • PsychonautWiki for substance information<br>
                        • Erowid.org for experience reports and safety data
                    </div>
                    <div>
                        <strong>Signs requiring immediate medical attention:</strong><br>
                        • Difficulty breathing or stopped breathing<br>
                        • Unconsciousness or unresponsiveness<br>
                        • Seizures or convulsions<br>
                        • Chest pain or irregular heartbeat<br>
                        • Extreme hyperthermia (overheating)<br>
                        • Severe panic or dangerous behavior
                    </div>
                </div>
            `;
        }
        
        function getTestingInfo(substance) {
            const info = drugTestingInfo[substance];
            if (!info) return '';
            
            return `
                <div class="testing-info" style="background: linear-gradient(135deg, rgba(6, 182, 212, 0.1) 0%, rgba(6, 182, 212, 0.05) 100%); border: 1px solid rgba(6, 182, 212, 0.3); border-radius: var(--radius-lg); padding: 1.5rem; margin: 1rem 0;">
                    <h4 style="color: var(--accent-color); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        🧪 Drug Testing Information
                    </h4>
                    <div style="margin-bottom: 1rem;">
                        <strong>Recommended Reagent Tests:</strong><br>
                        ${info.reagents.map(reagent => `• <strong>${reagent.name}</strong>: Expected ${reagent.expected} (${reagent.adulterants})`).join('<br>')}
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <strong>Common Adulterants to Watch For:</strong><br>
                        ${info.commonAdulterants.join(', ')}
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <strong>Test Strips:</strong> ${info.testStrips}
                    </div>
                    <div>
                        <strong>Testing Resources:</strong> ${info.resources}
                    </div>
                </div>
            `;
        }
        
        function getLegalWarning(substance) {
            const legal = legalStatus[substance];
            if (!legal) return '';
            
            return `
                <div class="legal-warning" style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(245, 158, 11, 0.05) 100%); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: var(--radius-lg); padding: 1.5rem; margin: 1rem 0;">
                    <h4 style="color: var(--warning-color); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        ⚖️ Legal Status Warning
                    </h4>
                    <div style="margin-bottom: 0.5rem;">
                        <strong>Legal Status by Jurisdiction:</strong><br>
                        <strong>United States:</strong> ${legal.us}<br>
                        <strong>European Union:</strong> ${legal.eu}<br>
                        <strong>United Kingdom:</strong> ${legal.uk}
                    </div>
                    <div style="color: var(--warning-color); font-weight: 500;">
                        ⚠️ ${legal.penalties}
                    </div>
                    <div style="margin-top: 0.5rem; font-size: 0.875rem; color: var(--text-muted);">
                        This information is for educational purposes only. Laws vary by jurisdiction and change frequently. Consult local legal resources for current information.
                    </div>
                </div>
            `;
        }

        function getPharmacologyInfo(substance) {
            const pharmData = {
                mdma: {
                    mechanism: 'Serotonin, dopamine, and norepinephrine reuptake inhibition + release',
                    metabolism: 'Hepatic via CYP2D6, CYP3A4, CYP1A2',
                    halfLife: '6-10 hours',
                    peakPlasma: '2-4 hours',
                    excretion: 'Renal (65% unchanged)',
                    bioavailability: '50-90% oral'
                },
                lsd: {
                    mechanism: '5-HT2A receptor partial agonist',
                    metabolism: 'Hepatic via CYP2D6, rapid first-pass',
                    halfLife: '3-5 hours (effects last 8-12 hours)',
                    peakPlasma: '1-3 hours',
                    excretion: 'Renal (8% unchanged)',
                    bioavailability: '71% oral'
                },
                ketamine: {
                    mechanism: 'NMDA receptor antagonist',
                    metabolism: 'Hepatic via CYP2B6, CYP3A4 to norketamine',
                    halfLife: '2-4 hours',
                    peakPlasma: '1-2 hours oral, 5-30 min IV',
                    excretion: 'Renal (91% as metabolites)',
                    bioavailability: '17% oral, 45% intranasal'
                },
                cocaine: {
                    mechanism: 'Dopamine, serotonin, norepinephrine reuptake inhibition',
                    metabolism: 'Hepatic via plasma cholinesterases',
                    halfLife: '0.5-1.5 hours',
                    peakPlasma: '30-60 minutes',
                    excretion: 'Renal (1-9% unchanged)',
                    bioavailability: '33% oral, 60-90% intranasal'
                }
            };

            const info = pharmData[substance];
            if (!info) return '';

            return `
                <div class="pharmacology-info" style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(139, 92, 246, 0.05) 100%); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: var(--radius-lg); padding: 1.5rem; margin: 1rem 0;">
                    <h4 style="color: #8b5cf6; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        🧬 Pharmacology Information
                    </h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; font-size: 0.875rem;">
                        <div><strong>Mechanism:</strong><br>${info.mechanism}</div>
                        <div><strong>Metabolism:</strong><br>${info.metabolism}</div>
                        <div><strong>Half-life:</strong><br>${info.halfLife}</div>
                        <div><strong>Peak Plasma:</strong><br>${info.peakPlasma}</div>
                        <div><strong>Excretion:</strong><br>${info.excretion}</div>
                        <div><strong>Bioavailability:</strong><br>${info.bioavailability}</div>
                    </div>
                </div>
            `;
        }

        // Enhanced drug interaction checking system
        function checkMedicationInteractions(substance, medications = []) {
            const interactions = {
                dangerous: [],
                caution: [],
                contraindicated: []
            };
            
            // Enhanced interaction matrix
            const interactionMatrix = {
                mdma: {
                    'ssri': { level: 'dangerous', info: 'Risk of serotonin syndrome - potentially fatal. Seek medical advice before use.' },
                    'snri': { level: 'dangerous', info: 'Risk of serotonin syndrome - potentially fatal. Seek medical advice before use.' },
                    'maoi': { level: 'contraindicated', info: 'Extreme risk of serotonin syndrome - DO NOT COMBINE under any circumstances.' },
                    'tramadol': { level: 'contraindicated', info: 'High risk of serotonin syndrome and seizures.' },
                    'dxm': { level: 'dangerous', info: 'Risk of serotonin syndrome and increased neurotoxicity.' },
                    'lithium': { level: 'dangerous', info: 'Increased risk of seizures and cardiac complications.' },
                    'alcohol': { level: 'dangerous', info: 'Increased dehydration, neurotoxicity, and impaired temperature regulation.' }
                },
                lsd: {
                    'ssri': { level: 'caution', info: 'May significantly reduce or block psychedelic effects.' },
                    'snri': { level: 'caution', info: 'May significantly reduce or block psychedelic effects.' },
                    'antipsychotics': { level: 'contraindicated', info: 'Will completely block psychedelic effects and may cause complications.' },
                    'lithium': { level: 'dangerous', info: 'Increased risk of seizures - avoid combination.' },
                    'tramadol': { level: 'caution', info: 'Potential serotonin interaction - use with extreme caution.' }
                },
                ketamine: {
                    'alcohol': { level: 'dangerous', info: 'Severe respiratory depression risk - potentially fatal combination.' },
                    'benzodiazepines': { level: 'dangerous', info: 'Respiratory depression risk - monitor breathing carefully.' },
                    'opioids': { level: 'contraindicated', info: 'Severe respiratory depression risk - DO NOT COMBINE.' },
                    'stimulants': { level: 'dangerous', info: 'Cardiovascular stress and unpredictable effects.' },
                    'depressants': { level: 'dangerous', info: 'Compounded sedation and respiratory depression.' }
                },
                cocaine: {
                    'alcohol': { level: 'contraindicated', info: 'Creates toxic cocaethylene metabolite - significantly increased toxicity and cardiac risk.' },
                    'maoi': { level: 'dangerous', info: 'Risk of hypertensive crisis and cardiac complications.' },
                    'stimulants': { level: 'dangerous', info: 'Cardiovascular overload - increased risk of heart attack and stroke.' },
                    'beta_blockers': { level: 'dangerous', info: 'Paradoxical hypertension and increased cardiac stress.' },
                    'depressants': { level: 'caution', info: 'Masks warning signs of overdose from either substance.' }
                }
            };
            
            if (medications && medications.length > 0) {
                medications.forEach(medication => {
                    const med = medication.toLowerCase().trim();
                    const substanceInteractions = interactionMatrix[substance] || {};
                    
                    Object.keys(substanceInteractions).forEach(interactionKey => {
                        if (med.includes(interactionKey) || checkMedicationClass(med, interactionKey)) {
                            const interaction = substanceInteractions[interactionKey];
                            interactions[interaction.level].push({
                                medication: medication,
                                info: interaction.info,
                                type: interactionKey
                            });
                        }
                    });
                });
            }
            
            return interactions;
        }
        
        function checkMedicationClass(medication, drugClass) {
            const medicationClasses = {
                'ssri': ['fluoxetine', 'sertraline', 'paroxetine', 'citalopram', 'escitalopram', 'prozac', 'zoloft', 'paxil', 'celexa', 'lexapro', 'fluvoxamine'],
                'snri': ['venlafaxine', 'duloxetine', 'desvenlafaxine', 'effexor', 'cymbalta', 'pristiq'],
                'maoi': ['phenelzine', 'tranylcypromine', 'isocarboxazid', 'selegiline', 'nardil', 'parnate', 'marplan', 'emsam'],
                'benzodiazepines': ['alprazolam', 'lorazepam', 'clonazepam', 'diazepam', 'temazepam', 'xanax', 'ativan', 'klonopin', 'valium', 'restoril'],
                'opioids': ['morphine', 'oxycodone', 'hydrocodone', 'fentanyl', 'codeine', 'oxycontin', 'vicodin', 'percocet', 'tramadol'],
                'stimulants': ['amphetamine', 'methylphenidate', 'dextroamphetamine', 'adderall', 'ritalin', 'concerta', 'vyvanse'],
                'antipsychotics': ['haloperidol', 'risperidone', 'quetiapine', 'olanzapine', 'aripiprazole', 'haldol', 'risperdal', 'seroquel', 'zyprexa', 'abilify'],
                'beta_blockers': ['propranolol', 'metoprolol', 'atenolol', 'carvedilol', 'inderal', 'lopressor', 'tenormin'],
                'depressants': ['alcohol', 'barbiturate', 'benzodiazepine', 'ghb', 'phenibut']
            };
            
            return medicationClasses[drugClass] && medicationClasses[drugClass].some(med => 
                medication.toLowerCase().includes(med.toLowerCase())
            );
        }

        function displayInteractionWarnings(interactions) {
            if (!interactions || (interactions.contraindicated.length === 0 && interactions.dangerous.length === 0 && interactions.caution.length === 0)) {
                return '';
            }

            let html = `<div class="interaction-warnings" style="margin: 1rem 0;">`;

            if (interactions.contraindicated.length > 0) {
                html += `
                    <div style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(239, 68, 68, 0.1) 100%); border: 2px solid var(--danger-color); border-radius: var(--radius-lg); padding: 1rem; margin-bottom: 1rem;">
                        <h4 style="color: var(--danger-color); margin-bottom: 0.5rem;">⛔ CONTRAINDICATED COMBINATIONS</h4>
                        ${interactions.contraindicated.map(interaction => `<p style="margin: 0.25rem 0;"><strong>${interaction.medication}:</strong> ${interaction.info}</p>`).join('')}
                    </div>
                `;
            }

            if (interactions.dangerous.length > 0) {
                html += `
                    <div style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.15) 0%, rgba(245, 158, 11, 0.1) 100%); border: 2px solid var(--warning-color); border-radius: var(--radius-lg); padding: 1rem; margin-bottom: 1rem;">
                        <h4 style="color: var(--warning-color); margin-bottom: 0.5rem;">⚠️ DANGEROUS COMBINATIONS</h4>
                        ${interactions.dangerous.map(interaction => `<p style="margin: 0.25rem 0;"><strong>${interaction.medication}:</strong> ${interaction.info}</p>`).join('')}
                    </div>
                `;
            }

            if (interactions.caution.length > 0) {
                html += `
                    <div style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(59, 130, 246, 0.05) 100%); border: 1px solid var(--primary-color); border-radius: var(--radius-lg); padding: 1rem;">
                        <h4 style="color: var(--primary-color); margin-bottom: 0.5rem;">💡 CAUTION ADVISED</h4>
                        ${interactions.caution.map(interaction => `<p style="margin: 0.25rem 0;"><strong>${interaction.medication}:</strong> ${interaction.info}</p>`).join('')}
                    </div>
                `;
            }

            html += `</div>`;
            return html;
        }

        // Enhanced liquid dosage calculator
        function calculateLiquidDose() {
            const totalVolume = parseFloat(document.getElementById('total-volume').value);
            const totalMedication = parseFloat(document.getElementById('total-medication').value);
            const drugPurity = parseFloat(document.getElementById('drug-purity').value);
            const targetVolume = parseFloat(document.getElementById('target-volume').value);
            const resultValue = document.getElementById('liquid-result-value');
            const resultDiv = document.getElementById('liquid-result');

            if (isNaN(totalVolume) || isNaN(totalMedication) || isNaN(targetVolume) || isNaN(drugPurity) || 
                totalVolume <= 0 || drugPurity < 0 || drugPurity > 100) {
                resultValue.innerHTML = 'Please enter valid numbers. Total volume must be > 0. Purity must be between 0 and 100.';
                resultDiv.style.display = 'block';
                return;
            }

            const result = (totalMedication * 1000) / totalVolume * targetVolume * (drugPurity / 100);
            resultValue.innerHTML = `${result.toFixed(2)} mg`;
            resultDiv.style.display = 'block';
        }

        // Enhanced MDMA calculator
        function calculateMDMA() {
            const weight = parseFloat(document.getElementById('mdma-weight').value);
            const age = parseFloat(document.getElementById('mdma-age').value) || null;
            const gender = document.getElementById('mdma-gender').value;
            const experience = document.getElementById('mdma-experience').value;
            const intensity = document.getElementById('mdma-intensity').value;
            const lastUse = parseFloat(document.getElementById('mdma-last-use').value) || 90;
            const setting = document.getElementById('mdma-setting').value;
            const medications = document.getElementById('mdma-medications').value;
            const duration = document.getElementById('mdma-duration').value;
            const resultValue = document.getElementById('mdma-result-value');
            const resultDetails = document.getElementById('mdma-details');
            const resultDiv = document.getElementById('mdma-result');

            if (!validateWeight(weight) || !gender || !experience || !intensity || !setting || !duration) {
                resultValue.innerHTML = 'Please fill in all fields with valid values.';
                resultDetails.innerHTML = '';
                resultDiv.style.display = 'block';
                return;
            }

            // Check for dangerous medication interactions
            const medicationCheck = checkMedicationInteractions('mdma', medications);
            if (medicationCheck.blocked) {
                resultValue.innerHTML = 'CONTRAINDICATED';
                resultDetails.innerHTML = `
                    <div style="background: linear-gradient(135deg, rgba(139, 69, 19, 0.2) 0%, rgba(139, 69, 19, 0.1) 100%); border: 2px solid #8B4513; border-radius: var(--radius-lg); padding: 2rem; margin: 1rem 0; text-align: center;">
                        <h3 style="color: #8B4513; margin-bottom: 1rem; font-size: 1.5rem;">⚠️ DANGEROUS MEDICATION INTERACTION ⚠️</h3>
                        <p style="color: var(--text-primary); font-size: 1.1rem; font-weight: bold; margin-bottom: 1rem;">
                            MDMA + Current Medication = HIGH RISK
                        </p>
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                            ${medicationCheck.warning}
                        </p>
                        <p style="color: #8B4513; font-weight: bold;">
                            Consult with medical professional about drug interactions
                        </p>
                    </div>
                `;
                resultDiv.style.display = 'block';
                return;
            }

            // Calculate age factors if provided
            const ageMultiplier = getAgeMultiplier(age);
            const ageWarning = getAgeWarning(age);

            // Duration-based adjustments for better experience
            const durationMultiplier = {
                'short': 1.0,   // Standard dose for shorter experience
                'medium': 1.1,  // Slightly higher for full experience
                'long': 1.2     // Higher dose for extended experience
            };

            // Enhanced dosage calculation based on research
            const intensityDoses = {
                'threshold': { base: 0.8, max: 1.0 },  // 56-70mg for 70kg
                'light': { base: 1.0, max: 1.3 },      // 70-91mg for 70kg
                'common': { base: 1.3, max: 1.7 },     // 91-119mg for 70kg
                'strong': { base: 1.7, max: 2.2 }      // 119-154mg for 70kg
            };

            const experienceMultiplier = {
                'beginner': 0.75,     // Lower dose for safety
                'experienced': 1.0,   // Standard dose
                'expert': 1.1         // Slightly higher due to tolerance
            };

            // Gender-based metabolism differences
            const genderMultiplier = {
                'male': 1.0,
                'female': 0.83,       // Lower dose due to typically lower body water content
                'other': 0.9          // Conservative approach
            };

            // Setting-based adjustments for safety
            const settingMultiplier = {
                'home': 1.0,          // Safest environment
                'therapy': 0.9,       // Therapeutic doses are typically lower
                'club': 0.85,         // High-energy environment, risk of overheating
                'festival': 0.8       // Outdoor, physical activity, dehydration risk
            };

            // Calculate base dose
            let baseDose = weight * intensityDoses[intensity].base;
            let maxDose = weight * intensityDoses[intensity].max;

            // Apply multipliers
            baseDose *= experienceMultiplier[experience] * genderMultiplier[gender] * settingMultiplier[setting] * ageMultiplier * durationMultiplier[duration];
            maxDose *= experienceMultiplier[experience] * genderMultiplier[gender] * settingMultiplier[setting] * ageMultiplier * durationMultiplier[duration];

            // Tolerance factor based on time since last use
            let toleranceFactor = 1.0;
            if (lastUse < 30) {
                toleranceFactor = 1.4; // Significant tolerance
            } else if (lastUse < 60) {
                toleranceFactor = 1.2; // Moderate tolerance
            } else if (lastUse < 90) {
                toleranceFactor = 1.1; // Mild tolerance
            }

            baseDose *= toleranceFactor;
            maxDose *= toleranceFactor;

            // Safety caps (absolute maximum limits)
            const absoluteMaxByWeight = Math.min(200, weight * 2.5);
            const safeDose = Math.min(baseDose, absoluteMaxByWeight);
            const safeMaxDose = Math.min(maxDose, absoluteMaxByWeight);

            // Generate warnings based on multiple factors
            let warnings = '';
            let riskLevel = 'low';

            // Dose-based warnings
            if (safeDose > 180) {
                warnings += showWarning('EXTREMELY HIGH DOSE - Serious risk of hyperthermia, serotonin syndrome, and cardiovascular issues!', 'danger');
                riskLevel = 'extreme';
            } else if (safeDose > 150) {
                warnings += showWarning('Very high dose - Exercise extreme caution! Have medical support available.', 'danger');
                riskLevel = 'high';
            } else if (safeDose > 120) {
                warnings += showWarning('Moderate-high dose - Stay hydrated, monitor body temperature, have a sober friend present.');
                riskLevel = 'moderate';
            }

            // Experience-based warnings
            if (experience === 'beginner' && intensity === 'strong') {
                warnings += showWarning('Strong doses not recommended for beginners. Consider starting with light or common intensity.');
            }

            // Frequency-based warnings
            if (lastUse < 30) {
                warnings += showWarning('VERY RECENT USE - High risk of neurotoxicity and reduced effects. Wait at least 3 months between uses!', 'danger');
            } else if (lastUse < 90) {
                warnings += showWarning('Recent use detected - Consider waiting longer for full serotonin recovery (3+ months recommended).');
            }

            // Cross-tolerance warning for entactogens
            const crossToleranceWarning = getCrossToleranceWarning('mdma', lastUse);
            if (crossToleranceWarning) {
                warnings += crossToleranceWarning;
            }

            // Setting-based warnings
            if (setting === 'club' || setting === 'festival') {
                warnings += showWarning('High-energy environment - Extra attention to hydration, cooling, and electrolyte balance required.');
            }

            // Calculate redose recommendation
            const redose = Math.round(safeDose * 0.4); // 40% of initial dose
            const totalSessionDose = safeDose + redose;

            // Duration and timeline information based on selection
            const durationTimelines = {
                'short': {
                    onset: '30-60 minutes',
                    peak: '1.5-2.5 hours after onset',
                    duration: '3-4 hours total',
                    redoseWindow: '1.5-2 hours after initial dose'
                },
                'medium': {
                    onset: '30-60 minutes',
                    peak: '1.5-2.5 hours after onset',
                    duration: '4-6 hours total',
                    redoseWindow: '1.5-2 hours after initial dose'
                },
                'long': {
                    onset: '30-60 minutes',
                    peak: '2-3 hours after onset',
                    duration: '6-8 hours total',
                    redoseWindow: '2-2.5 hours after initial dose'
                }
            };
            const timeline = durationTimelines[duration];

            // Get emergency protocols
            const emergencyInfo = getEmergencyProtocols('mdma');

            // Risk color coding
            const riskColors = {
                'low': '#10b981',      // Green
                'moderate': '#f59e0b', // Orange
                'high': '#ef4444',     // Red
                'extreme': '#7c2d12'   // Dark red
            };

            resultValue.innerHTML = `<span style="color: ${riskColors[riskLevel]}">${Math.round(safeDose)}mg</span>`;
            
            resultDetails.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem;">
                    <div>
                        <h4 style="color: var(--text-primary); margin-bottom: 0.75rem;">💊 Dosage Information</h4>
                        <p><strong>Initial dose:</strong> ${Math.round(safeDose)}mg</p>
                        <p><strong>Optional redose:</strong> ${redose}mg (if needed)</p>
                        <p><strong>Max session total:</strong> ${Math.round(totalSessionDose)}mg</p>
                        <p><strong>Dose per kg:</strong> ${(safeDose/weight).toFixed(1)}mg/kg</p>
                    </div>
                    <div>
                        <h4 style="color: var(--text-primary); margin-bottom: 0.75rem;">⏱️ Timeline</h4>
                        <p><strong>Onset:</strong> ${timeline.onset}</p>
                        <p><strong>Peak effects:</strong> ${timeline.peak}</p>
                        <p><strong>Total duration:</strong> ${timeline.duration}</p>
                        <p><strong>Redose window:</strong> ${timeline.redoseWindow}</p>
                    </div>
                </div>
                
                <div style="background: var(--background-secondary); padding: 1.25rem; border-radius: var(--radius-md); margin: 1.5rem 0;">
                    <h4 style="color: var(--success-color); margin-bottom: 1rem;">🛡️ Safety Guidelines for ${setting.charAt(0).toUpperCase() + setting.slice(1)} Setting</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <div>
                            <strong>Before:</strong><br>
                            • Test your substance with reagents<br>
                            • Eat a light meal 2-3 hours prior<br>
                            • Get adequate sleep the night before<br>
                            • Avoid alcohol and other drugs
                        </div>
                        <div>
                            <strong>During:</strong><br>
                            • Stay hydrated (but don't overdrink)<br>
                            • Take breaks in cool areas<br>
                            • Have a trusted sober friend present<br>
                            • Monitor body temperature
                        </div>
                        <div>
                            <strong>After:</strong><br>
                            • Get plenty of rest<br>
                            • Eat nutritious foods<br>
                            • Consider 5-HTP supplementation<br>
                            • Wait at least 3 months before next use
                        </div>
                    </div>
                </div>
                
                ${emergencyInfo ? `
                <div style="background: var(--background-secondary); padding: 1.25rem; border-radius: var(--radius-md); margin: 1.5rem 0; border-left: 4px solid #ef4444;">
                    <h4 style="color: #ef4444; margin-bottom: 1rem;">🚨 Emergency Protocols for MDMA</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <div>
                            <strong>Warning Signs:</strong><br>
                            ${emergencyInfo.symptoms}
                        </div>
                        <div>
                            <strong>Immediate Action:</strong><br>
                            ${emergencyInfo.immediate}
                        </div>
                        <div>
                            <strong>Medical Treatment:</strong><br>
                            ${emergencyInfo.antidotes}
                        </div>
                        <div>
                            <strong>NEVER Do:</strong><br>
                            ${emergencyInfo.avoid}
                        </div>
                    </div>
                    <div style="margin-top: 1rem; padding: 1rem; background: rgba(239, 68, 68, 0.1); border-radius: var(--radius-sm);">
                        <strong style="color: #ef4444;">🚨 Call 911 immediately if:</strong><br>
                        ${emergencyInfo.call911}
                    </div>
                </div>
                ` : ''}
                
                <div class="scientific-note">
                    <strong>Enhanced Calculation Factors:</strong><br>
                    • Weight-based dosing: ${(intensityDoses[intensity].base).toFixed(1)}-${(intensityDoses[intensity].max).toFixed(1)}mg/kg base range<br>
                    • Experience adjustment: ${(experienceMultiplier[experience] * 100).toFixed(0)}% of standard dose<br>
                    • Gender metabolic factor: ${(genderMultiplier[gender] * 100).toFixed(0)}% adjustment<br>
                    • Setting safety factor: ${(settingMultiplier[setting] * 100).toFixed(0)}% adjustment<br>
                    • Duration preference: ${(durationMultiplier[duration] * 100).toFixed(0)}% adjustment (${duration} experience)<br>
                    ${age ? `• Age safety factor: ${(ageMultiplier * 100).toFixed(0)}% adjustment (Age: ${age})<br>` : ''}
                    • Tolerance consideration: ${(toleranceFactor * 100).toFixed(0)}% increase (${lastUse} days since last use)<br>
                    • Risk level: <strong style="color: ${riskColors[riskLevel]}">${riskLevel.toUpperCase()}</strong>
                </div>
                
                <div style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(59, 130, 246, 0.05) 100%); border: 1px solid var(--primary-color); border-radius: var(--radius-lg); padding: 1.5rem; margin: 1rem 0;">
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">⏱️ Expected Duration: ${timeline.duration}</h4>
                    <p style="color: var(--text-secondary); margin: 0;">This duration is based on your selected preference and typical MDMA pharmacokinetics. Individual experiences may vary based on metabolism, tolerance, and environmental factors.</p>
                </div>
                
                ${warnings}
                ${ageWarning}
            `;
            resultDiv.style.display = 'block';
        }

        // Enhanced LSD calculator
        function calculateLSD() {
            try {
                const weight = parseFloat(document.getElementById('lsd-weight').value);
                const gender = document.getElementById('lsd-gender').value;
                const experience = document.getElementById('lsd-experience').value;
                const intensity = document.getElementById('lsd-intensity').value;
                const lastPsychedelic = parseFloat(document.getElementById('lsd-last-psychedelic').value) || 14;
                const setting = document.getElementById('lsd-setting').value;
                const duration = document.getElementById('lsd-duration').value;
                
                const resultValue = document.getElementById('lsd-result-value');
                const resultDetails = document.getElementById('lsd-details');
                const resultDiv = document.getElementById('lsd-result');

                if (!validateWeight(weight) || !gender || !experience || !intensity || !setting || !duration) {
                    resultValue.innerHTML = 'Please fill in all fields with valid values.';
                    resultDetails.innerHTML = '';
                    resultDiv.style.display = 'block';
                    return;
                }

                // Enhanced dosage calculation with more precise ranges
                const intensityDoses = {
                    'microdose': { dose: 8, range: '5-12' },      // Sub-perceptual
                    'threshold': { dose: 20, range: '15-30' },    // Barely perceptual
                    'light': { dose: 50, range: '30-75' },        // Clear effects
                    'common': { dose: 100, range: '75-150' },     // Standard trip
                    'strong': { dose: 200, range: '150-300' },    // Intense experience
                    'heavy': { dose: 350, range: '300-500' }      // Very intense (not recommended)
                };

                // Calculate base dose
                let calculatedDose = intensityDoses[intensity].dose;

                // Apply experience multiplier
                const experienceMultiplier = {
                    'first-time': 0.7,
                    'novice': 0.8,
                    'experienced': 1.0,
                    'expert': 1.1
                };
                calculatedDose *= experienceMultiplier[experience];

                // Apply gender multiplier (women generally more sensitive)
                const genderMultiplier = {
                    'male': 1.0,
                    'female': 0.9,
                    'other': 0.95
                };
                calculatedDose *= genderMultiplier[gender] || 1.0;

                // Apply setting safety multiplier
                const settingMultiplier = {
                    'home': 1.0,
                    'nature': 1.0,
                    'controlled': 1.0,
                    'festival': 0.85
                };
                calculatedDose *= settingMultiplier[setting] || 1.0;

                // Duration-based adjustments for better experience
                const durationMultiplier = {
                    'short': 0.9,   // Lower dose for shorter experience
                    'medium': 1.0,  // Standard dose
                    'long': 1.1     // Slightly higher for extended experience
                };
                calculatedDose *= durationMultiplier[duration];

                // Calculate age multiplier (simplified)
                let ageMultiplier = 1.0;
                // This would be implemented if age input was available
                if (false) { // Disabled for now as age input doesn't exist in this form
                    calculatedDose *= ageMultiplier;
                }

                // Apply tolerance from last psychedelic use
                let toleranceFactor = 1.0;
                if (lastPsychedelic < 14) {
                    // Strong cross-tolerance with other psychedelics
                    toleranceFactor = 1.0 + (14 - lastPsychedelic) * 0.15; // Up to +150% for daily use
                }
                calculatedDose *= toleranceFactor;

                // Check for dangerous drug interactions (simplified for now)
                const interactions = { contraindicated: [], dangerous: [], caution: [] };

                // Apply safety caps
                const maxSafeDose = {
                    'first-time': 75,
                    'novice': 100,
                    'experienced': 200,
                    'expert': 300
                };
                calculatedDose = Math.min(calculatedDose, maxSafeDose[experience]);

                // Determine risk level
                let riskLevel = 'low';
                if (calculatedDose > 150) riskLevel = 'moderate';
                if (calculatedDose > 250) riskLevel = 'high';
                if (interactions.contraindicated.length > 0 || interactions.dangerous.length > 0) riskLevel = 'high';

                const riskColors = {
                    'low': '#10b981',
                    'moderate': '#f59e0b', 
                    'high': '#ef4444'
                };

                // Generate warnings
                let warnings = '';
                if (calculatedDose > 200) {
                    warnings += showWarning('High dose - increased risk of challenging experience, anxiety, and HPPD. Consider reducing dose.', 'danger');
                }
                if (lastPsychedelic < 7) {
                    warnings += showWarning('Short time since last psychedelic use - significant cross-tolerance may be present.');
                }

                const ageWarning = '';
                const legalWarning = '';
                const testingInfo = '';
                const pharmacologyInfo = '';
                const emergencyInfo = '';
                const interactionWarnings = '';

                // Track usage (anonymous) - simplified for now
                // trackAnonymousUsage('lsd'); // Disabled for now

                resultValue.innerHTML = `
                    <div style="font-size: 2rem; font-weight: bold; color: ${riskColors[riskLevel]};">
                        ${Math.round(calculatedDose)}μg
                    </div>
                    <div style="font-size: 1rem; color: var(--text-secondary); margin-top: 0.5rem;">
                        Range: ${intensityDoses[intensity].range}μg (${intensity})
                    </div>
                `;

                resultDetails.innerHTML = `
                    ${legalWarning}
                    ${testingInfo}
                    ${interactionWarnings}
                    ${emergencyInfo}
                    ${pharmacologyInfo}
                    
                    <div class="scientific-note">
                        <strong>Enhanced Calculation Factors:</strong><br>
                        • Base dose for ${intensity}: ${intensityDoses[intensity].dose}μg<br>
                        • Experience adjustment: ${(experienceMultiplier[experience] * 100).toFixed(0)}% of standard dose<br>
                        • Gender metabolic factor: ${(genderMultiplier[gender] * 100).toFixed(0)}% adjustment<br>
                        • Setting safety factor: ${(settingMultiplier[setting] * 100).toFixed(0)}% adjustment<br>
                        • Duration preference: ${(durationMultiplier[duration] * 100).toFixed(0)}% adjustment (${duration} experience)<br>
                        • Tolerance consideration: ${(toleranceFactor * 100).toFixed(0)}% increase (${lastPsychedelic} days since last psychedelic)<br>
                        • Risk level: <strong style="color: ${riskColors[riskLevel]}">${riskLevel.toUpperCase()}</strong>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(139, 92, 246, 0.05) 100%); border: 1px solid #8b5cf6; border-radius: var(--radius-lg); padding: 1.5rem; margin: 1rem 0;">
                        <h4 style="color: #8b5cf6; margin-bottom: 1rem;">⏱️ Expected Duration</h4>
                        <p style="color: var(--text-secondary); margin: 0;">
                            ${duration === 'short' ? 'Short experience (6-8 hours): Faster onset, more manageable duration for beginners' : 
                              duration === 'medium' ? 'Medium experience (8-12 hours): Standard full LSD experience' : 
                              'Long experience (12-16 hours): Extended journey, ensure adequate time and preparation'}
                        </p>
                    </div>
                    
                    ${warnings}
                    ${ageWarning}
                    
                    <div style="margin-top: 1rem; padding: 1rem; background: rgba(59, 130, 246, 0.1); border-radius: var(--radius-md); border: 1px solid rgba(59, 130, 246, 0.3);">
                        <h4 style="color: var(--primary-color); margin-bottom: 0.5rem;">🔬 Important LSD Safety Notes:</h4>
                        <ul style="margin: 0; padding-left: 1.5rem; color: var(--text-secondary);">
                            <li>LSD effects last 8-12 hours - ensure safe environment for entire duration</li>
                            <li>Strong psychological effects - have a trusted sober trip sitter present</li>
                            <li>Cross-tolerance with other psychedelics (psilocybin, mescaline, etc.) lasts ~14 days</li>
                            <li>Start low, especially if inexperienced - you can't "un-take" a dose</li>
                            <li>Avoid NBOMe and other dangerous LSD analogs - always test your substance</li>
                            <li>Set and setting are crucial - comfortable environment and positive mindset</li>
                        </ul>
                    </div>
                `;
                resultDiv.style.display = 'block';
                
                // Announce result to screen readers
                try {
                    announceToScreenReader(`LSD dosage calculated: ${Math.round(calculatedDose)} micrograms`);
                } catch (e) {
                    // Function not available, skip announcement
                }

            } catch (error) {
                const resultValue = document.getElementById('lsd-result-value');
                const resultDetails = document.getElementById('lsd-details');
                const resultDiv = document.getElementById('lsd-result');
                
                resultValue.innerHTML = `<span style="color: var(--danger-color);">Error: ${error.message}</span>`;
                resultDetails.innerHTML = '';
                resultDiv.style.display = 'block';
                
                console.error('LSD Calculator Error:', error);
            }
        }

        // Helper function for expected effects
        function getExpectedEffects(intensity) {

            // Minimal weight adjustment for LSD (weak correlation)
            const weightFactor = Math.pow(weight / 70, 0.25); // Very weak weight dependence
            dose *= weightFactor;

            // Tolerance factor based on time since last psychedelic use
            let toleranceFactor = 1.0;
            if (lastPsychedelic < 3) {
                toleranceFactor = 2.5;  // Very high tolerance
            } else if (lastPsychedelic < 7) {
                toleranceFactor = 1.8;  // High tolerance
            } else if (lastPsychedelic < 14) {
                toleranceFactor = 1.3;  // Moderate tolerance
            }

            dose *= toleranceFactor;

            // Safety caps
            const maxSafeDose = intensity === 'microdose' ? 15 : 
                               intensity === 'threshold' ? 40 :
                               intensity === 'light' ? 100 :
                               intensity === 'common' ? 200 :
                               intensity === 'strong' ? 350 : 500;

            dose = Math.min(dose, maxSafeDose);

            // Generate warnings and risk assessment
            let warnings = '';
            let riskLevel = 'low';

            // Dose-based warnings
            if (dose > 300) {
                warnings += showWarning('VERY HIGH DOSE - Risk of overwhelming experience, panic, and dangerous behavior!', 'danger');
                riskLevel = 'extreme';
            } else if (dose > 200) {
                warnings += showWarning('High dose - Intense experience likely. Ensure experienced sitter present.', 'danger');
                riskLevel = 'high';
            } else if (dose > 150) {
                warnings += showWarning('Strong dose - Significant psychedelic effects. Safe environment essential.');
                riskLevel = 'moderate';
            }

            // Experience-based warnings
            if (experience === 'beginner' && ['strong', 'heavy'].includes(intensity)) {
                warnings += showWarning('High doses not recommended for beginners. Start with threshold or light doses.');
            }

            // Tolerance-based warnings
            if (lastPsychedelic < 7) {
                warnings += showWarning('VERY RECENT PSYCHEDELIC USE - Tolerance is likely very high. Effects may be minimal despite high dose!', 'danger');
            } else if (lastPsychedelic < 14) {
                warnings += showWarning('Recent psychedelic use - Tolerance may reduce effects. Consider waiting longer.');
            }

            // Setting-based warnings
            if (setting === 'festival' && ['common', 'strong', 'heavy'].includes(intensity)) {
                warnings += showWarning('High doses in festival settings can be overwhelming. Consider lower dose or safer setting.');
            }

            // Experience timeline based on dose
            const timeline = {
                microdose: {
                    onset: '60-90 minutes',
                    peak: '3-5 hours',
                    duration: '6-8 hours',
                    afterglow: '1-2 days'
                },
                threshold: {
                    onset: '45-75 minutes',
                    peak: '2-4 hours',
                    duration: '8-10 hours',
                    afterglow: '1-2 days'
                },
                light: {
                    onset: '30-60 minutes',
                    peak: '2-4 hours',
                    duration: '8-12 hours',
                    afterglow: '1-3 days'
                },
                common: {
                    onset: '30-60 minutes',
                    peak: '3-5 hours',
                    duration: '10-12 hours',
                    afterglow: '2-4 days'
                },
                strong: {
                    onset: '20-45 minutes',
                    peak: '4-6 hours',
                    duration: '12-16 hours',
                    afterglow: '3-7 days'
                },
                heavy: {
                    onset: '15-30 minutes',
                    peak: '5-8 hours',
                    duration: '14-18 hours',
                    afterglow: '5-10 days'
                }
            };

            const currentTimeline = timeline[intensity];

            // Risk color coding
            const riskColors = {
                'low': '#10b981',
                'moderate': '#f59e0b',
                'high': '#ef4444',
                'extreme': '#7c2d12'
            };

            resultValue.innerHTML = `<span style="color: ${riskColors[riskLevel]}">${Math.round(dose)} µg</span>`;

            resultDetails.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem;">
                    <div>
                        <h4 style="color: var(--text-primary); margin-bottom: 0.75rem;">💊 Dosage Information</h4>
                        <p><strong>Recommended dose:</strong> ${Math.round(dose)} µg</p>
                        <p><strong>Typical range:</strong> ${intensityDoses[intensity].range} µg</p>
                        <p><strong>Intensity level:</strong> ${intensity.charAt(0).toUpperCase() + intensity.slice(1)}</p>
                        <p><strong>Risk level:</strong> <span style="color: ${riskColors[riskLevel]}">${riskLevel.toUpperCase()}</span></p>
                    </div>
                    <div>
                        <h4 style="color: var(--text-primary); margin-bottom: 0.75rem;">⏱️ Timeline</h4>
                        <p><strong>Onset:</strong> ${currentTimeline.onset}</p>
                        <p><strong>Peak effects:</strong> ${currentTimeline.peak}</p>
                        <p><strong>Total duration:</strong> ${currentTimeline.duration}</p>
                        <p><strong>Afterglow:</strong> ${currentTimeline.afterglow}</p>
                    </div>
                </div>

                <div style="background: var(--background-secondary); padding: 1.25rem; border-radius: var(--radius-md); margin: 1.5rem 0;">
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">🧠 Expected Effects for ${intensity.charAt(0).toUpperCase() + intensity.slice(1)} Dose</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        ${getExpectedEffects(intensity)}
                    </div>
                </div>
                
                <div style="background: var(--background-secondary); padding: 1.25rem; border-radius: var(--radius-md); margin: 1.5rem 0;">
                    <h4 style="color: var(--success-color); margin-bottom: 1rem;">🛡️ Safety Guidelines for ${setting.charAt(0).toUpperCase() + setting.slice(1)} Setting</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <div>
                            <strong>Preparation:</strong><br>
                            • Clear schedule for next 24 hours<br>
                            • Comfortable, safe environment<br>
                            • Trusted, experienced trip sitter<br>
                            • Emergency contacts ready
                        </div>
                        <div>
                            <strong>During:</strong><br>
                            • Stay hydrated with water<br>
                            • Have light snacks available<br>
                            • Avoid driving or dangerous activities<br>
                            • Change setting if uncomfortable
                        </div>
                        <div>
                            <strong>Integration:</strong><br>
                            • Journal your experience<br>
                            • Discuss insights with trusted friends<br>
                            • Wait 2+ weeks before next psychedelic<br>
                            • Consider therapy if processing is needed
                        </div>
                    </div>
                </div>
                
                <div class="scientific-note">
                    <strong>Enhanced Calculation Factors:</strong><br>
                    • Base dose for ${intensity}: ${intensityDoses[intensity].dose} µg<br>
                    • Experience adjustment: ${(experienceMultiplier[experience] * 100).toFixed(0)}% of standard dose<br>
                    • Gender sensitivity factor: ${(genderMultiplier[gender] * 100).toFixed(0)}% adjustment<br>
                    • Setting safety factor: ${(settingMultiplier[setting] * 100).toFixed(0)}% adjustment<br>
                    • Weight correlation: ${(weightFactor * 100).toFixed(0)}% (minimal effect)<br>
                    • Tolerance factor: ${(toleranceFactor * 100).toFixed(0)}% (${lastPsychedelic} days since last psychedelic)
                </div>
                
                ${warnings}
            `;
            resultDiv.style.display = 'block';
        }

        // Helper function for expected effects
        function getExpectedEffects(intensity) {
            const effects = {
                'microdose': `
                    <div><strong>Physical:</strong><br>Slight energy increase, enhanced colors</div>
                    <div><strong>Mental:</strong><br>Improved focus, slight mood lift</div>
                    <div><strong>Visual:</strong><br>Subtle color enhancement</div>
                `,
                'threshold': `
                    <div><strong>Physical:</strong><br>Light body sensations, mild euphoria</div>
                    <div><strong>Mental:</strong><br>Slight thought changes, enhanced creativity</div>
                    <div><strong>Visual:</strong><br>Mild breathing walls, color shifts</div>
                `,
                'light': `
                    <div><strong>Physical:</strong><br>Clear body high, energy fluctuations</div>
                    <div><strong>Mental:</strong><br>Noticeable thought patterns, mild confusion</div>
                    <div><strong>Visual:</strong><br>Clear visual distortions, pattern recognition</div>
                `,
                'common': `
                    <div><strong>Physical:</strong><br>Strong body sensations, possible nausea</div>
                    <div><strong>Mental:</strong><br>Altered thinking, emotional intensity</div>
                    <div><strong>Visual:</strong><br>Strong visuals, geometric patterns</div>
                `,
                'strong': `
                    <div><strong>Physical:</strong><br>Intense body load, temperature changes</div>
                    <div><strong>Mental:</strong><br>Deep introspection, ego dissolution</div>
                    <div><strong>Visual:</strong><br>Complex visuals, reality distortion</div>
                `,
                'heavy': `
                    <div><strong>Physical:</strong><br>Overwhelming sensations, motor impairment</div>
                    <div><strong>Mental:</strong><br>Complete ego loss, mystical experiences</div>
                    <div><strong>Visual:</strong><br>Total visual replacement, entity contact</div>
                `
            };
            return effects[intensity] || '';
        }

        // Enhanced ketamine calculator with comprehensive factors
        function calculateKetamine() {
            const weight = parseFloat(document.getElementById('ket-weight').value);
            const gender = document.getElementById('ket-gender').value;
            const experience = document.getElementById('ket-experience').value;
            const route = document.getElementById('ket-route').value;
            const intensity = document.getElementById('ket-intensity').value;
            const lastUse = parseFloat(document.getElementById('ket-last-use').value) || 7;
            const setting = document.getElementById('ket-setting').value;
            const toleranceHistory = document.getElementById('ket-tolerance-history').value;
            const duration = document.getElementById('ket-duration').value;
            const resultValue = document.getElementById('ket-result-value');
            const resultDetails = document.getElementById('ket-details');
            const resultDiv = document.getElementById('ketamine-result');

            if (!validateWeight(weight) || !gender || !experience || !route || !intensity || !setting || !toleranceHistory || !duration) {
                resultValue.innerHTML = 'Please fill in all fields with valid values.';
                resultDetails.innerHTML = '';
                resultDiv.style.display = 'block';
                return;
            }

            // CORRECTED dosage calculation based on route and intensity - FIXED DANGEROUS OVER-DOSING
            const intensityDoses = {
                'threshold': { oral: 0.4, nasal: 0.25, sublingual: 0.3, intramuscular: 0.2, intravenous: 0.15 },
                'light': { oral: 0.8, nasal: 0.5, sublingual: 0.6, intramuscular: 0.4, intravenous: 0.25 },
                'common': { oral: 1.2, nasal: 0.8, sublingual: 1.0, intramuscular: 0.6, intravenous: 0.4 },
                'strong': { oral: 1.8, nasal: 1.2, sublingual: 1.5, intramuscular: 0.9, intravenous: 0.6 },
                'k-hole': { oral: 2.5, nasal: 1.8, sublingual: 2.2, intramuscular: 1.3, intravenous: 0.9 }
            };

            const experienceMultiplier = {
                'beginner': 0.7,      // Conservative dosing for safety
                'experienced': 1.0,   // Standard dosing
                'expert': 1.2         // Can handle higher doses
            };

            // Gender-based metabolism differences (smaller than other substances)
            const genderMultiplier = {
                'male': 1.0,
                'female': 0.85,       // Generally lower dose needed
                'other': 0.9          // Conservative approach
            };

            // Setting-based safety adjustments
            const settingMultiplier = {
                'home': 1.0,          // Safest environment
                'therapeutic': 0.8,   // Medical setting, lower recreational doses
                'party': 0.7,         // Social setting, need to stay functional
                'club': 0.6           // High-stimulation environment, safety priority
            };

            // Tolerance history adjustments - REDUCED to prevent dangerous stacking
            const toleranceMultiplier = {
                'none': 1.0,          // No tolerance
                'occasional': 1.1,    // Slight tolerance - REDUCED from 1.15
                'regular': 1.2,       // Moderate tolerance - REDUCED from 1.4
                'frequent': 1.3       // High tolerance - REDUCED from 1.8
            };

            // Calculate base dose (mg/kg for route)
            let baseDose = weight * intensityDoses[intensity][route];

            // Apply all multipliers
            baseDose *= experienceMultiplier[experience] * genderMultiplier[gender] * settingMultiplier[setting];

            // Recent use tolerance factor - REDUCED to prevent dangerous escalation
            let recentToleranceFactor = 1.0;
            if (lastUse < 2) {
                recentToleranceFactor = 1.3; // High tolerance - REDUCED from 1.6
            } else if (lastUse < 5) {
                recentToleranceFactor = 1.15; // Moderate tolerance - REDUCED from 1.3
            } else if (lastUse < 10) {
                recentToleranceFactor = 1.05; // Mild tolerance - REDUCED from 1.1
            }

            // Apply tolerance factors with safety cap to prevent dangerous escalation
            baseDose *= toleranceMultiplier[toleranceHistory] * recentToleranceFactor;
            
            // SAFETY CAP: Never recommend more than 2.5x base dose regardless of tolerance
            const originalBaseDose = weight * intensityDoses[intensity][route];
            const maxToleranceDose = originalBaseDose * 2.5;
            if (baseDose > maxToleranceDose) {
                baseDose = maxToleranceDose;
                warnings += showWarning('Dose capped at 2.5x base due to safety concerns. Consider taking a longer break to reset tolerance.', 'danger');
            }

            // Safety caps by route - REDUCED to safer levels
            const maxSafeDose = {
                'oral': weight * 3,     // REDUCED from weight * 8
                'nasal': weight * 2,    // REDUCED from weight * 5  
                'sublingual': weight * 2.5, // REDUCED from weight * 6
                'intramuscular': weight * 1.5, // REDUCED from weight * 3
                'intravenous': weight * 1   // REDUCED from weight * 2
            };

            const safeDose = Math.min(baseDose, maxSafeDose[route]);

            // Generate warnings based on multiple factors
            let warnings = '';
            let riskLevel = 'low';

            // Route-specific warnings
            if (route === 'intravenous') {
                warnings += showWarning('IV administration carries extreme risks! Medical supervision required. Risk of infection, overdose, and vascular damage.', 'danger');
                riskLevel = 'extreme';
            } else if (route === 'intramuscular') {
                warnings += showWarning('IM injection requires sterile technique and medical knowledge. High risk if done improperly.', 'danger');
                riskLevel = 'high';
            }

            // Dose-based warnings
            if (safeDose > weight * 3 && !['intravenous', 'intramuscular'].includes(route)) {
                warnings += showWarning('Very high dose - risk of prolonged dissociation and respiratory depression!', 'danger');
                riskLevel = 'high';
            } else if (safeDose > weight * 2 && !['intravenous', 'intramuscular'].includes(route)) {
                warnings += showWarning('High dose - ensure experienced sitter present and safe environment.');
                riskLevel = 'moderate';
            }

            // Experience vs intensity warnings
            if (experience === 'beginner' && ['strong', 'k-hole'].includes(intensity)) {
                warnings += showWarning('High-intensity experiences not recommended for beginners. Start with light or common doses.');
            }

            // Frequency warnings
            if (toleranceHistory === 'frequent') {
                warnings += showWarning('Frequent ketamine use can cause serious bladder damage and psychological dependence. Consider harm reduction resources.', 'danger');
            } else if (toleranceHistory === 'regular') {
                warnings += showWarning('Regular ketamine use increases risk of tolerance and urinary tract damage. Monitor usage frequency.');
            }

            // Recent use warnings
            if (lastUse < 3) {
                warnings += showWarning('Very recent use - high tolerance likely. Effects may be diminished despite increased dose.');
            }

            // K-hole specific warnings
            if (intensity === 'k-hole') {
                warnings += showWarning('K-hole doses cause complete dissociation. Experienced sitter essential. Risk of injury from inability to move.', 'danger');
            }

            // Timeline and duration info
            const routeInfo = {
                'oral': { onset: '45-90 minutes', peak: '1.5-3 hours', duration: '4-6 hours', bioavailability: '20-25%' },
                'nasal': { onset: '10-20 minutes', peak: '30-60 minutes', duration: '2-3 hours', bioavailability: '45-50%' },
                'sublingual': { onset: '15-30 minutes', peak: '45-90 minutes', duration: '2.5-4 hours', bioavailability: '30-35%' },
                'intramuscular': { onset: '5-15 minutes', peak: '20-40 minutes', duration: '1.5-3 hours', bioavailability: '85-95%' },
                'intravenous': { onset: '1-3 minutes', peak: '5-15 minutes', duration: '1-2 hours', bioavailability: '100%' }
            };

            const currentRoute = routeInfo[route];

            // Risk color coding
            const riskColors = {
                'low': '#10b981',
                'moderate': '#f59e0b',
                'high': '#ef4444',
                'extreme': '#7c2d12'
            };

            resultValue.innerHTML = `<span style="color: ${riskColors[riskLevel]}">${Math.round(safeDose)}mg</span>`;
            
            resultDetails.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem;">
                    <div>
                        <h4 style="color: var(--text-primary); margin-bottom: 0.75rem;">💊 Dosage Information</h4>
                        <p><strong>Recommended dose:</strong> ${Math.round(safeDose)}mg</p>
                        <p><strong>Route:</strong> ${route.charAt(0).toUpperCase() + route.slice(1)}</p>
                        <p><strong>Dose per kg:</strong> ${(safeDose/weight).toFixed(1)}mg/kg</p>
                        <p><strong>Bioavailability:</strong> ${currentRoute.bioavailability}</p>
                        <p><strong>Risk level:</strong> <span style="color: ${riskColors[riskLevel]}">${riskLevel.toUpperCase()}</span></p>
                    </div>
                    <div>
                        <h4 style="color: var(--text-primary); margin-bottom: 0.75rem;">⏱️ ${route.charAt(0).toUpperCase() + route.slice(1)} Timeline</h4>
                        <p><strong>Onset:</strong> ${currentRoute.onset}</p>
                        <p><strong>Peak effects:</strong> ${currentRoute.peak}</p>
                        <p><strong>Total duration:</strong> ${currentRoute.duration}</p>
                        <p><strong>Intensity:</strong> ${intensity.charAt(0).toUpperCase() + intensity.slice(1)}</p>
                    </div>
                </div>
                
                <div style="background: var(--background-secondary); padding: 1.25rem; border-radius: var(--radius-md); margin: 1.5rem 0;">
                    <h4 style="color: var(--success-color); margin-bottom: 1rem;">🛡️ Safety Guidelines for ${setting.charAt(0).toUpperCase() + setting.slice(1)} Setting</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <div>
                            <strong>Before:</strong><br>
                            • Test substance with reagents<br>
                            • Ensure experienced sitter present<br>
                            • Remove potential hazards from area<br>
                            • Have emergency contacts ready
                        </div>
                        <div>
                            <strong>During:</strong><br>
                            • Stay in safe, comfortable position<br>
                            • Avoid driving or dangerous activities<br>
                            • Monitor breathing and consciousness<br>
                            • Keep environment calm and safe
                        </div>
                        <div>
                            <strong>After:</strong><br>
                            • Allow full recovery before activity<br>
                            • Hydrate and rest adequately<br>
                            • Reflect on experience safely<br>
                            • Wait appropriate time before next use
                        </div>
                    </div>
                </div>
                
                <div class="scientific-note">
                    <strong>Enhanced Calculation Factors:</strong><br>
                    • Base dose (${route}): ${intensityDoses[intensity][route]}mg/kg for ${intensity} intensity<br>
                    • Experience adjustment: ${(experienceMultiplier[experience] * 100).toFixed(0)}% of standard dose<br>
                    • Gender factor: ${(genderMultiplier[gender] * 100).toFixed(0)}% adjustment<br>
                    • Setting safety factor: ${(settingMultiplier[setting] * 100).toFixed(0)}% adjustment<br>
                    • Tolerance history: ${(toleranceMultiplier[toleranceHistory] * 100).toFixed(0)}% increase<br>
                    • Recent use factor: ${(recentToleranceFactor * 100).toFixed(0)}% (${lastUse} days ago)<br>
                    Based on NMDA receptor tolerance patterns and route-specific pharmacokinetics.
                </div>
                
                ${warnings}
            `;
            resultDiv.style.display = 'block';
        }

        // Enhanced GHB/GBL calculator with comprehensive safety factors
        function calculateGHB() {
            const weight = parseFloat(document.getElementById('ghb-weight').value);
            const gender = document.getElementById('ghb-gender').value;
            const substance = document.getElementById('ghb-substance').value;
            const experience = document.getElementById('ghb-experience').value;
            const intensity = document.getElementById('ghb-intensity').value;
            const lastUse = parseFloat(document.getElementById('ghb-last-use').value) || 3;
            const stomach = document.getElementById('ghb-stomach').value;
            const setting = document.getElementById('ghb-setting').value;
            const alcohol = document.getElementById('ghb-alcohol').value;
            const resultValue = document.getElementById('ghb-result-value');
            const resultDetails = document.getElementById('ghb-details');
            const resultDiv = document.getElementById('ghb-result');

            if (!validateWeight(weight) || !gender || !substance || !experience || !intensity || !stomach || !setting || !alcohol) {
                resultValue.innerHTML = 'Please fill in all fields with valid values.';
                resultDetails.innerHTML = '';
                resultDiv.style.display = 'block';
                return;
            }

            // CRITICAL: Check for alcohol consumption first
            if (alcohol !== 'none') {
                resultValue.innerHTML = 'CONTRAINDICATED';
                resultDetails.innerHTML = `
                    <div style="background: linear-gradient(135deg, rgba(139, 69, 19, 0.2) 0%, rgba(139, 69, 19, 0.1) 100%); border: 2px solid #8B4513; border-radius: var(--radius-lg); padding: 2rem; margin: 1rem 0; text-align: center;">
                        <h3 style="color: #8B4513; margin-bottom: 1rem; font-size: 1.5rem;">⚠️ EXTREMELY DANGEROUS COMBINATION ⚠️</h3>
                        <p style="color: var(--text-primary); font-size: 1.1rem; font-weight: bold; margin-bottom: 1rem;">
                            GHB/GBL + Alcohol = POTENTIALLY FATAL
                        </p>
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                            This combination causes severe respiratory depression, coma, and death. Wait at least 12-24 hours after any alcohol consumption before considering GHB/GBL use.
                        </p>
                        <p style="color: #8B4513; font-weight: bold;">
                            NO SAFE DOSE EXISTS WITH ALCOHOL IN YOUR SYSTEM
                        </p>
                    </div>
                `;
                resultDiv.style.display = 'block';
                return;
            }

            // Enhanced dosage calculation with safety factors
            const intensityDoses = {
                'threshold': { ghb: 0.5, gbl: 0.35, bdo: 0.6 },    // g/70kg
                'light': { ghb: 1.0, gbl: 0.7, bdo: 1.2 },         // g/70kg
                'common': { ghb: 1.75, gbl: 1.2, bdo: 2.1 },       // g/70kg
                'strong': { ghb: 2.5, gbl: 1.75, bdo: 3.0 }        // g/70kg - DANGEROUS
            };

            const experienceMultiplier = {
                'beginner': 0.6,      // Much more conservative for safety
                'experienced': 0.8,   // Still conservative
                'expert': 1.0         // Standard dosing only for very experienced users
            };

            // Gender-based metabolism differences (significant for GHB)
            const genderMultiplier = {
                'male': 1.0,
                'female': 0.75,       // Significantly lower due to metabolism differences
                'other': 0.8          // Conservative approach
            };

            // Stomach status has major impact on absorption
            const stomachMultiplier = {
                'empty': 1.0,         // Fastest, most dangerous absorption
                'light': 0.7,         // Slower absorption, safer
                'full': 0.5           // Much slower absorption, much safer
            };

            // Setting-based safety adjustments
            const settingMultiplier = {
                'home': 1.0,          // Safest environment
                'therapeutic': 0.6,   // Medical setting, very conservative
                'party': 0.7,         // Need to stay functional and safe
                'club': 0.6           // High-risk environment, very conservative
            };

            // Calculate base dose in grams
            let baseDose = (weight / 70) * intensityDoses[intensity][substance];

            // Apply all safety multipliers
            baseDose *= experienceMultiplier[experience] * genderMultiplier[gender] * stomachMultiplier[stomach] * settingMultiplier[setting];

            // Tolerance factor (GHB tolerance develops rapidly)
            let toleranceFactor = 1.0;
            if (lastUse < 1) {
                toleranceFactor = 1.5; // Significant tolerance
            } else if (lastUse < 3) {
                toleranceFactor = 1.2; // Moderate tolerance
            } else if (lastUse < 7) {
                toleranceFactor = 1.1; // Mild tolerance
            }

            baseDose *= toleranceFactor;

            // STRICT safety caps - GHB has very narrow therapeutic window
            const absoluteMaxDose = {
                'ghb': 3.5,      // Absolute maximum in grams
                'gbl': 2.5,      // More potent
                'bdo': 4.0       // Less potent but still dangerous
            };

            const safeDose = Math.min(baseDose, absoluteMaxDose[substance]);

            // Convert to appropriate units and calculate volume for liquids
            let displayValue, unit;
            if (substance === 'ghb') {
                displayValue = (safeDose * 1000).toFixed(0); // Convert to mg
                unit = 'mg';
            } else {
                // For GBL/BDO, calculate volume (typical concentration ~1g/ml)
                const volumeMl = safeDose; // Approximate 1:1 ratio for pure substances
                displayValue = volumeMl.toFixed(2);
                unit = 'ml';
            }

            // Generate comprehensive warnings
            let warnings = '';
            let riskLevel = 'extreme'; // GHB is always high risk

            // Dose-based warnings
            if (safeDose > absoluteMaxDose[substance] * 0.8) {
                warnings += showWarning('EXTREMELY HIGH DOSE - Life-threatening risk of coma and respiratory failure!', 'danger');
            } else if (safeDose > absoluteMaxDose[substance] * 0.6) {
                warnings += showWarning('Very high dose - Serious risk of unconsciousness and breathing problems!', 'danger');
            } else if (safeDose > absoluteMaxDose[substance] * 0.4) {
                warnings += showWarning('High dose - Significant risk of loss of consciousness!', 'danger');
            }

            // Experience-based warnings
            if (experience === 'beginner') {
                warnings += showWarning('First time users should start with threshold doses and have experienced supervision.', 'danger');
            }

            // Frequency-based warnings
            if (lastUse < 3) {
                warnings += showWarning('Recent use detected - GHB tolerance develops rapidly and increases overdose risk!', 'danger');
            }

            // Stomach warnings
            if (stomach === 'empty') {
                warnings += showWarning('Empty stomach increases absorption speed and overdose risk. Consider eating something light first.');
            }

            // Setting warnings
            if (['party', 'club'].includes(setting)) {
                warnings += showWarning('Social settings increase risks due to distractions and peer pressure. Stay with trusted friends.');
            }

            // Universal GHB warnings
            warnings += showWarning('GHB has an extremely narrow margin between active and dangerous doses. Start low and wait fully before any redose!', 'danger');
            warnings += showWarning('Never combine with alcohol, benzodiazepines, opioids, or any other depressants - potentially fatal!', 'danger');

            // Timeline and safety info
            const substanceInfo = {
                'ghb': {
                    onset: stomach === 'empty' ? '15-30 minutes' : '30-60 minutes',
                    peak: '45-90 minutes',
                    duration: '2-4 hours',
                    redoseWait: '3+ hours',
                    name: 'GHB'
                },
                'gbl': {
                    onset: stomach === 'empty' ? '10-20 minutes' : '20-45 minutes',
                    peak: '30-75 minutes',
                    duration: '2-3.5 hours',
                    redoseWait: '3+ hours',
                    name: 'GBL'
                },
                'bdo': {
                    onset: stomach === 'empty' ? '30-60 minutes' : '60-120 minutes',
                    peak: '1-2 hours',
                    duration: '3-6 hours',
                    redoseWait: '4+ hours',
                    name: '1,4-BDO'
                }
            };

            const currentSubstance = substanceInfo[substance];

            resultValue.innerHTML = `<span style="color: #ef4444">${displayValue} ${unit}</span>`;
            
            resultDetails.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem;">
                    <div>
                        <h4 style="color: var(--text-primary); margin-bottom: 0.75rem;">💊 Dosage Information</h4>
                        <p><strong>Substance:</strong> ${currentSubstance.name}</p>
                        <p><strong>Dose:</strong> ${displayValue} ${unit}</p>
                        <p><strong>Dose (grams):</strong> ${safeDose.toFixed(2)}g</p>
                        <p><strong>Intensity:</strong> ${intensity.charAt(0).toUpperCase() + intensity.slice(1)}</p>
                        <p><strong>Risk level:</strong> <span style="color: #ef4444">EXTREME</span></p>
                    </div>
                    <div>
                        <h4 style="color: var(--text-primary); margin-bottom: 0.75rem;">⏱️ Timeline (${stomach} stomach)</h4>
                        <p><strong>Onset:</strong> ${currentSubstance.onset}</p>
                        <p><strong>Peak effects:</strong> ${currentSubstance.peak}</p>
                        <p><strong>Duration:</strong> ${currentSubstance.duration}</p>
                        <p><strong>Minimum redose wait:</strong> ${currentSubstance.redoseWait}</p>
                    </div>
                </div>
                
                <div style="background: var(--background-secondary); padding: 1.25rem; border-radius: var(--radius-md); margin: 1.5rem 0;">
                    <h4 style="color: #ef4444; margin-bottom: 1rem;">🚨 CRITICAL Safety Guidelines</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <div>
                            <strong>Before:</strong><br>
                            • ZERO alcohol for 12+ hours<br>
                            • Have experienced sitter present<br>
                            • Emergency contacts ready<br>
                            • Remove all dangerous objects
                        </div>
                        <div>
                            <strong>During:</strong><br>
                            • Take dose ALL AT ONCE<br>
                            • Set timer for redose safety<br>
                            • Stay in safe position<br>
                            • Monitor consciousness/breathing
                        </div>
                        <div>
                            <strong>Emergency:</strong><br>
                            • Call emergency services if unconscious<br>
                            • Recovery position if vomiting<br>
                            • Never leave person alone<br>
                            • Be honest with medical staff
                        </div>
                    </div>
                </div>
                
                <div class="scientific-note">
                    <strong>Enhanced Calculation Factors:</strong><br>
                    • Base dose: ${intensityDoses[intensity][substance]}g/70kg for ${intensity} intensity<br>
                    • Experience safety factor: ${(experienceMultiplier[experience] * 100).toFixed(0)}% of standard dose<br>
                    • Gender metabolic factor: ${(genderMultiplier[gender] * 100).toFixed(0)}% adjustment<br>
                    • Stomach absorption factor: ${(stomachMultiplier[stomach] * 100).toFixed(0)}% (${stomach} stomach)<br>
                    • Setting safety factor: ${(settingMultiplier[setting] * 100).toFixed(0)}% adjustment<br>
                    • Tolerance factor: ${(toleranceFactor * 100).toFixed(0)}% (${lastUse} days since last use)<br>
                    GHB acts on GABA-B receptors with extremely narrow therapeutic window.
                </div>
                
                ${warnings}
            `;
            resultDiv.style.display = 'block';
        }

        // Enhanced amphetamines calculator with comprehensive factors
        function calculateAmphetamines() {
            const weight = parseFloat(document.getElementById('amp-weight').value);
            const gender = document.getElementById('amp-gender').value;
            const substance = document.getElementById('amp-substance').value;
            const experience = document.getElementById('amp-experience').value;
            const route = document.getElementById('amp-route').value;
            const intensity = document.getElementById('amp-intensity').value;
            const lastUse = parseFloat(document.getElementById('amp-last-use').value) || 7;
            const setting = document.getElementById('amp-setting').value;
            const health = document.getElementById('amp-health').value;
            const resultValue = document.getElementById('amp-result-value');
            const resultDetails = document.getElementById('amp-details');
            const resultDiv = document.getElementById('amp-result');

            if (!validateWeight(weight) || !gender || !substance || !experience || !route || !intensity || !setting || !health) {
                resultValue.innerHTML = 'Please fill in all fields with valid values.';
                resultDetails.innerHTML = '';
                resultDiv.style.display = 'block';
                return;
            }

            // CRITICAL: Check cardiovascular health first
            if (health === 'serious') {
                resultValue.innerHTML = 'CONTRAINDICATED';
                resultDetails.innerHTML = `
                    <div style="background: linear-gradient(135deg, rgba(139, 69, 19, 0.2) 0%, rgba(139, 69, 19, 0.1) 100%); border: 2px solid #8B4513; border-radius: var(--radius-lg); padding: 2rem; margin: 1rem 0; text-align: center;">
                        <h3 style="color: #8B4513; margin-bottom: 1rem; font-size: 1.5rem;">⚠️ SERIOUS HEALTH RISK ⚠️</h3>
                        <p style="color: var(--text-primary); font-size: 1.1rem; font-weight: bold; margin-bottom: 1rem;">
                            Stimulants + Cardiovascular Issues = DANGEROUS
                        </p>
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                            Amphetamines can cause heart attacks, strokes, and arrhythmias in people with cardiovascular conditions. Please consult a medical professional.
                        </p>
                        <p style="color: #8B4513; font-weight: bold;">
                            NO SAFE DOSE FOR SERIOUS HEART CONDITIONS
                        </p>
                    </div>
                `;
                resultDiv.style.display = 'block';
                return;
            }

            // CORRECTED dosage calculation - FIXED DANGEROUS OVER-DOSING
            const intensityDoses = {
                'threshold': { 
                    'amphetamine': { oral: 0.04, nasal: 0.03, sublingual: 0.035, rectal: 0.035, intravenous: 0.02, smoked: 0.02 },
                    'dextroamphetamine': { oral: 0.03, nasal: 0.02, sublingual: 0.025, rectal: 0.025, intravenous: 0.015, smoked: 0.015 },
                    'methamphetamine': { oral: 0.02, nasal: 0.01, sublingual: 0.015, rectal: 0.015, intravenous: 0.008, smoked: 0.008 },
                    'adderall': { oral: 0.035, nasal: 0.025, sublingual: 0.03, rectal: 0.03, intravenous: 0.018, smoked: 0.018 }
                },
                'light': {
                    'amphetamine': { oral: 0.08, nasal: 0.06, sublingual: 0.07, rectal: 0.07, intravenous: 0.04, smoked: 0.04 },
                    'dextroamphetamine': { oral: 0.06, nasal: 0.045, sublingual: 0.055, rectal: 0.055, intravenous: 0.03, smoked: 0.03 },
                    'methamphetamine': { oral: 0.04, nasal: 0.03, sublingual: 0.035, rectal: 0.035, intravenous: 0.02, smoked: 0.02 },
                    'adderall': { oral: 0.07, nasal: 0.05, sublingual: 0.06, rectal: 0.06, intravenous: 0.035, smoked: 0.035 }
                },
                'common': {
                    'amphetamine': { oral: 0.15, nasal: 0.11, sublingual: 0.13, rectal: 0.13, intravenous: 0.08, smoked: 0.08 },
                    'dextroamphetamine': { oral: 0.11, nasal: 0.08, sublingual: 0.095, rectal: 0.095, intravenous: 0.06, smoked: 0.06 },
                    'methamphetamine': { oral: 0.08, nasal: 0.06, sublingual: 0.07, rectal: 0.07, intravenous: 0.04, smoked: 0.04 },
                    'adderall': { oral: 0.13, nasal: 0.095, sublingual: 0.11, rectal: 0.11, intravenous: 0.07, smoked: 0.07 }
                },
                'strong': {
                    'amphetamine': { oral: 0.25, nasal: 0.18, sublingual: 0.21, rectal: 0.21, intravenous: 0.13, smoked: 0.13 },
                    'dextroamphetamine': { oral: 0.18, nasal: 0.13, sublingual: 0.15, rectal: 0.15, intravenous: 0.09, smoked: 0.09 },
                    'methamphetamine': { oral: 0.13, nasal: 0.09, sublingual: 0.11, rectal: 0.11, intravenous: 0.07, smoked: 0.07 },
                    'adderall': { oral: 0.21, nasal: 0.15, sublingual: 0.18, rectal: 0.18, intravenous: 0.11, smoked: 0.11 }
                }
            };

            const experienceMultiplier = {
                'beginner': 0.6,      // Much more conservative for safety
                'experienced': 0.8,   // Moderately conservative
                'expert': 1.0         // Standard dosing
            };

            // Gender-based metabolism differences
            const genderMultiplier = {
                'male': 1.0,
                'female': 0.8,        // Generally lower dose needed
                'other': 0.85         // Conservative approach
            };

            // Setting-based safety adjustments
            const settingMultiplier = {
                'home': 1.0,          // Safe environment
                'work': 0.7,          // Need to stay functional
                'therapeutic': 0.6,   // Medical setting, conservative
                'party': 0.8,         // Social setting, moderate reduction
                'club': 0.7           // High-stimulation environment
            };

            // Health-based safety reductions
            const healthMultiplier = {
                'healthy': 1.0,       // No adjustment
                'minor': 0.7,         // Significant reduction
                'moderate': 0.4,      // Major reduction
                'serious': 0.0        // Already handled above
            };

            // Calculate base dose (mg/kg for route and substance)
            let baseDose = weight * intensityDoses[intensity][substance][route];

            // Apply all multipliers
            baseDose *= experienceMultiplier[experience] * genderMultiplier[gender] * settingMultiplier[setting] * healthMultiplier[health];

            // Tolerance factor based on recent use - REDUCED to prevent dangerous escalation
            let toleranceFactor = 1.0;
            if (lastUse < 1) {
                toleranceFactor = 1.2; // High tolerance - REDUCED from 1.4
            } else if (lastUse < 3) {
                toleranceFactor = 1.1; // Moderate tolerance - REDUCED from 1.2
            } else if (lastUse < 7) {
                toleranceFactor = 1.05; // Mild tolerance - REDUCED from 1.1
            }

            baseDose *= toleranceFactor;

            // SAFETY CAP: Never recommend more than 2x base dose regardless of tolerance
            const originalBaseDose = weight * intensityDoses[intensity][substance][route];
            const maxToleranceDose = originalBaseDose * 2.0;
            if (baseDose > maxToleranceDose) {
                baseDose = maxToleranceDose;
                warnings += showWarning('Dose capped at 2x base due to safety concerns. Consider taking a longer break to reset tolerance.', 'danger');
            }

            // Safety caps by substance and route - REDUCED to safer levels
            const maxSafeDose = {
                'amphetamine': { oral: 35, nasal: 20, sublingual: 25, rectal: 25, intravenous: 12, smoked: 12 },
                'dextroamphetamine': { oral: 25, nasal: 15, sublingual: 20, rectal: 20, intravenous: 10, smoked: 10 },
                'methamphetamine': { oral: 18, nasal: 10, sublingual: 12, rectal: 12, intravenous: 6, smoked: 6 },
                'adderall': { oral: 30, nasal: 18, sublingual: 22, rectal: 22, intravenous: 10, smoked: 10 }
            };

            const safeDose = Math.min(baseDose, maxSafeDose[substance][route]);

            // Generate warnings based on multiple factors
            let warnings = '';
            let riskLevel = 'low';

            // Route-specific warnings
            if (['intravenous', 'smoked'].includes(route)) {
                warnings += showWarning('IV/Smoking routes carry extreme addiction risk and dangerous cardiovascular effects!', 'danger');
                riskLevel = 'extreme';
            } else if (route === 'nasal') {
                warnings += showWarning('Nasal use can damage nasal passages and increases addiction potential.');
                riskLevel = 'moderate';
            }

            // Substance-specific warnings
            if (substance === 'methamphetamine') {
                warnings += showWarning('Methamphetamine has very high neurotoxicity and addiction potential. Consider safer alternatives.', 'danger');
                riskLevel = 'high';
            }

            // Health-based warnings
            if (health === 'moderate') {
                warnings += showWarning('Cardiovascular issues present - monitor heart rate, blood pressure, and have medical support available.', 'danger');
                riskLevel = 'high';
            } else if (health === 'minor') {
                warnings += showWarning('Monitor cardiovascular signs closely. Stop immediately if chest pain, irregular heartbeat, or breathing difficulties occur.');
            }

            // Dose-based warnings
            if (safeDose > maxSafeDose[substance][route] * 0.8) {
                warnings += showWarning('High dose - serious cardiovascular risks! Monitor vital signs.', 'danger');
                riskLevel = 'high';
            } else if (safeDose > maxSafeDose[substance][route] * 0.6) {
                warnings += showWarning('Moderate-high dose - monitor heart rate and blood pressure.');
                riskLevel = 'moderate';
            }

            // Experience vs intensity warnings
            if (experience === 'beginner' && intensity === 'strong') {
                warnings += showWarning('Strong doses not recommended for beginners. High risk of panic, overstimulation, and cardiovascular issues.');
            }

            // Frequency warnings
            if (lastUse < 3) {
                warnings += showWarning('Recent use detected - tolerance develops quickly with stimulants. Risk of dependence and cardiovascular strain.');
            }

            // Timeline and duration info by route
            const routeInfo = {
                'oral': { onset: '30-60 minutes', peak: '2-4 hours', duration: getDuration(substance, 'oral'), bioavailability: '70-80%' },
                'nasal': { onset: '5-15 minutes', peak: '30-90 minutes', duration: getDuration(substance, 'nasal'), bioavailability: '60-70%' },
                'sublingual': { onset: '15-30 minutes', peak: '1-2 hours', duration: getDuration(substance, 'sublingual'), bioavailability: '50-60%' },
                'rectal': { onset: '10-30 minutes', peak: '1-3 hours', duration: getDuration(substance, 'rectal'), bioavailability: '80-90%' },
                'intravenous': { onset: 'Immediate', peak: '5-15 minutes', duration: getDuration(substance, 'iv'), bioavailability: '100%' },
                'smoked': { onset: 'Immediate', peak: '2-10 minutes', duration: getDuration(substance, 'smoked'), bioavailability: '70-90%' }
            };

            function getDuration(sub, rt) {
                const durations = {
                    'amphetamine': { oral: '4-6 hours', nasal: '2-4 hours', sublingual: '3-5 hours', rectal: '4-6 hours', iv: '1-3 hours', smoked: '1-3 hours' },
                    'dextroamphetamine': { oral: '4-6 hours', nasal: '2-4 hours', sublingual: '3-5 hours', rectal: '4-6 hours', iv: '1-3 hours', smoked: '1-3 hours' },
                    'methamphetamine': { oral: '8-12 hours', nasal: '4-8 hours', sublingual: '6-10 hours', rectal: '8-12 hours', iv: '4-8 hours', smoked: '4-8 hours' },
                    'adderall': { oral: '4-6 hours', nasal: '2-4 hours', sublingual: '3-5 hours', rectal: '4-6 hours', iv: '1-3 hours', smoked: '1-3 hours' }
                };
                return durations[sub][rt];
            }

            const currentRoute = routeInfo[route];

            // Risk color coding
            const riskColors = {
                'low': '#10b981',
                'moderate': '#f59e0b',
                'high': '#ef4444',
                'extreme': '#7c2d12'
            };

            resultValue.innerHTML = `<span style="color: ${riskColors[riskLevel]}">${Math.round(safeDose)}mg</span>`;
            
            resultDetails.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem;">
                    <div>
                        <h4 style="color: var(--text-primary); margin-bottom: 0.75rem;">💊 Dosage Information</h4>
                        <p><strong>Substance:</strong> ${substance.charAt(0).toUpperCase() + substance.slice(1)}</p>
                        <p><strong>Dose:</strong> ${Math.round(safeDose)}mg</p>
                        <p><strong>Route:</strong> ${route.charAt(0).toUpperCase() + route.slice(1)}</p>
                        <p><strong>Bioavailability:</strong> ${currentRoute.bioavailability}</p>
                        <p><strong>Risk level:</strong> <span style="color: ${riskColors[riskLevel]}">${riskLevel.toUpperCase()}</span></p>
                    </div>
                    <div>
                        <h4 style="color: var(--text-primary); margin-bottom: 0.75rem;">⏱️ ${route.charAt(0).toUpperCase() + route.slice(1)} Timeline</h4>
                        <p><strong>Onset:</strong> ${currentRoute.onset}</p>
                        <p><strong>Peak effects:</strong> ${currentRoute.peak}</p>
                        <p><strong>Duration:</strong> ${currentRoute.duration}</p>
                        <p><strong>Intensity:</strong> ${intensity.charAt(0).toUpperCase() + intensity.slice(1)}</p>
                    </div>
                </div>
                
                <div style="background: var(--background-secondary); padding: 1.25rem; border-radius: var(--radius-md); margin: 1.5rem 0;">
                    <h4 style="color: var(--success-color); margin-bottom: 1rem;">🛡️ Safety Guidelines for ${setting.charAt(0).toUpperCase() + setting.slice(1)} Setting</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <div>
                            <strong>Before:</strong><br>
                            • Check blood pressure/heart rate<br>
                            • Eat a proper meal<br>
                            • Get adequate sleep<br>
                            • Have emergency contacts ready
                        </div>
                        <div>
                            <strong>During:</strong><br>
                            • Monitor cardiovascular signs<br>
                            • Stay hydrated (not excessive)<br>
                            • Take breaks if overheating<br>
                            • Avoid combining with other drugs
                        </div>
                        <div>
                            <strong>After:</strong><br>
                            • Eat nutritious food<br>
                            • Get sleep when effects wear off<br>
                            • Monitor mood for several days<br>
                            • Wait appropriate time before next use
                        </div>
                    </div>
                </div>
                
                <div class="scientific-note">
                    <strong>Enhanced Calculation Factors:</strong><br>
                    • Base dose (${route}): ${intensityDoses[intensity][substance][route]}mg/kg for ${intensity} intensity<br>
                    • Experience adjustment: ${(experienceMultiplier[experience] * 100).toFixed(0)}% of standard dose<br>
                    • Gender factor: ${(genderMultiplier[gender] * 100).toFixed(0)}% adjustment<br>
                    • Setting safety factor: ${(settingMultiplier[setting] * 100).toFixed(0)}% adjustment<br>
                    • Health safety factor: ${(healthMultiplier[health] * 100).toFixed(0)}% adjustment<br>
                    • Tolerance factor: ${(toleranceFactor * 100).toFixed(0)}% (${lastUse} days since last use)<br>
                    Based on dopamine/norepinephrine reuptake inhibition and cardiovascular effects.
                </div>
                
                ${warnings}
            `;
            resultDiv.style.display = 'block';
        }

        // Enhanced cocaine calculator with comprehensive safety factors
        function calculateCocaine() {
            const weight = parseFloat(document.getElementById('coc-weight').value);
            const gender = document.getElementById('coc-gender').value;
            const experience = document.getElementById('coc-experience').value;
            const route = document.getElementById('coc-route').value;
            const intensity = document.getElementById('coc-intensity').value;
            const lastUse = parseFloat(document.getElementById('coc-last-use').value) || 14;
            const setting = document.getElementById('coc-setting').value;
            const health = document.getElementById('coc-health').value;
            const alcohol = document.getElementById('coc-alcohol').value;
            const resultValue = document.getElementById('coc-result-value');
            const resultDetails = document.getElementById('coc-details');
            const resultDiv = document.getElementById('coc-result');

            if (!validateWeight(weight) || !gender || !experience || !route || !intensity || !setting || !health || !alcohol) {
                resultValue.innerHTML = 'Please fill in all fields with valid values.';
                resultDetails.innerHTML = '';
                resultDiv.style.display = 'block';
                return;
            }

            // CRITICAL: Check for serious cardiovascular issues
            if (health === 'serious') {
                resultValue.innerHTML = 'CONTRAINDICATED';
                resultDetails.innerHTML = `
                    <div style="background: linear-gradient(135deg, rgba(139, 69, 19, 0.2) 0%, rgba(139, 69, 19, 0.1) 100%); border: 2px solid #8B4513; border-radius: var(--radius-lg); padding: 2rem; margin: 1rem 0; text-align: center;">
                        <h3 style="color: #8B4513; margin-bottom: 1rem; font-size: 1.5rem;">⚠️ EXTREME CARDIOVASCULAR RISK ⚠️</h3>
                        <p style="color: var(--text-primary); font-size: 1.1rem; font-weight: bold; margin-bottom: 1rem;">
                            Cocaine + Heart Conditions = POTENTIALLY FATAL
                        </p>
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                            Cocaine causes severe cardiovascular effects including heart attacks, strokes, and arrhythmias. With existing heart conditions, this is extremely dangerous.
                        </p>
                        <p style="color: #8B4513; font-weight: bold;">
                            NO SAFE DOSE FOR SERIOUS CARDIOVASCULAR CONDITIONS
                        </p>
                    </div>
                `;
                resultDiv.style.display = 'block';
                return;
            }

            // CRITICAL: Check for alcohol consumption (creates cocaethylene)
            if (alcohol !== 'none') {
                resultValue.innerHTML = 'HIGHLY DANGEROUS';
                resultDetails.innerHTML = `
                    <div style="background: linear-gradient(135deg, rgba(139, 69, 19, 0.2) 0%, rgba(139, 69, 19, 0.1) 100%); border: 2px solid #8B4513; border-radius: var(--radius-lg); padding: 2rem; margin: 1rem 0; text-align: center;">
                        <h3 style="color: #8B4513; margin-bottom: 1rem; font-size: 1.5rem;">⚠️ TOXIC COMBINATION ⚠️</h3>
                        <p style="color: var(--text-primary); font-size: 1.1rem; font-weight: bold; margin-bottom: 1rem;">
                            Cocaine + Alcohol = Cocaethylene (Cardiotoxic)
                        </p>
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                            This combination creates cocaethylene, which is more toxic than either substance alone and significantly increases risk of sudden cardiac death.
                        </p>
                        <p style="color: #8B4513; font-weight: bold;">
                            Wait at least 12+ hours after alcohol before considering cocaine use
                        </p>
                    </div>
                `;
                resultDiv.style.display = 'block';
                return;
            }

            // CORRECTED dosage calculation - FIXED DANGEROUS OVER-DOSING
            const intensityDoses = {
                'threshold': { nasal: 0.12, oral: 0.2, gums: 0.1, smoked: 0.06, intravenous: 0.04 },
                'light': { nasal: 0.25, oral: 0.4, gums: 0.2, smoked: 0.12, intravenous: 0.08 },
                'common': { nasal: 0.5, oral: 0.8, gums: 0.4, smoked: 0.25, intravenous: 0.15 },
                'strong': { nasal: 0.8, oral: 1.3, gums: 0.65, smoked: 0.4, intravenous: 0.25 }
            };

            const experienceMultiplier = {
                'beginner': 0.5,      // Very conservative for safety
                'experienced': 0.7,   // Still conservative
                'expert': 0.85        // Slightly less conservative
            };

            // Gender-based metabolism differences
            const genderMultiplier = {
                'male': 1.0,
                'female': 0.8,        // Generally lower dose needed
                'other': 0.85         // Conservative approach
            };

            // Setting-based safety adjustments
            const settingMultiplier = {
                'home': 1.0,          // Safest environment
                'party': 0.8,         // Social setting, moderate reduction
                'club': 0.7,          // High-stimulation environment
                'public': 0.6         // Highest risk environment
            };

            // Health-based safety reductions
            const healthMultiplier = {
                'healthy': 1.0,       // No adjustment
                'minor': 0.6,         // Significant reduction
                'moderate': 0.3,      // Major reduction
                'serious': 0.0        // Already handled above
            };

            // Calculate base dose (mg/kg for route)
            let baseDose = weight * intensityDoses[intensity][route];

            // Apply all safety multipliers
            baseDose *= experienceMultiplier[experience] * genderMultiplier[gender] * settingMultiplier[setting] * healthMultiplier[health];

            // Tolerance factor (cocaine tolerance is rapid but short-lived) - REDUCED for safety
            let toleranceFactor = 1.0;
            if (lastUse < 1) {
                toleranceFactor = 1.15; // Moderate tolerance - REDUCED from 1.3
            } else if (lastUse < 3) {
                toleranceFactor = 1.08; // Mild tolerance - REDUCED from 1.15
            } else if (lastUse < 7) {
                toleranceFactor = 1.03; // Very mild tolerance - REDUCED from 1.05
            }

            baseDose *= toleranceFactor;

            // SAFETY CAP: Never recommend more than 2x base dose regardless of tolerance
            const originalBaseDose = weight * intensityDoses[intensity][route];
            const maxToleranceDose = originalBaseDose * 2.0;
            if (baseDose > maxToleranceDose) {
                baseDose = maxToleranceDose;
                warnings += showWarning('Dose capped at 2x base due to safety concerns. Cocaine has severe cardiovascular risks.', 'danger');
            }

            // STRICT safety caps by route - REDUCED to safer levels
            const maxSafeDose = {
                'nasal': 50,         // Nasal maximum - REDUCED from 120
                'oral': 80,          // Oral maximum - REDUCED from 200
                'gums': 40,          // Gums maximum - REDUCED from 100
                'smoked': 25,        // Smoking maximum - REDUCED from 60
                'intravenous': 15    // IV maximum - REDUCED from 40
            };

            const safeDose = Math.min(baseDose, maxSafeDose[route]);

            // Generate comprehensive warnings
            let warnings = '';
            let riskLevel = 'high'; // Cocaine is always high risk

            // Route-specific warnings
            if (route === 'intravenous') {
                warnings += showWarning('IV cocaine use carries EXTREME risks: overdose, heart attack, stroke, infection, collapsed veins, and addiction!', 'danger');
                riskLevel = 'extreme';
            } else if (route === 'smoked') {
                warnings += showWarning('Smoking cocaine (crack) has very high addiction potential and severe lung/cardiovascular risks!', 'danger');
                riskLevel = 'extreme';
            } else if (route === 'nasal') {
                warnings += showWarning('Nasal use can cause severe nasal damage, deviated septum, and loss of smell. High addiction risk.');
            }

            // Dose-based warnings
            if (safeDose > maxSafeDose[route] * 0.8) {
                warnings += showWarning('VERY HIGH DOSE - Serious risk of heart attack, stroke, and seizures!', 'danger');
            } else if (safeDose > maxSafeDose[route] * 0.6) {
                warnings += showWarning('High dose - Significant cardiovascular and neurological risks!', 'danger');
            }

            // Experience-based warnings
            if (experience === 'beginner') {
                warnings += showWarning('First-time users are at highest risk for adverse reactions. Have medical support available.');
            }

            // Health-based warnings
            if (health === 'moderate') {
                warnings += showWarning('Cardiovascular concerns present - extremely high risk of complications. Consider avoiding use entirely.', 'danger');
            } else if (health === 'minor') {
                warnings += showWarning('Monitor cardiovascular signs extremely closely. Seek immediate medical help for chest pain or breathing issues.', 'danger');
            }

            // Frequency warnings
            if (lastUse < 7) {
                warnings += showWarning('Recent use detected - cocaine has high addiction potential and cardiovascular cumulative effects.');
            }

            // Universal cocaine warnings
            warnings += showWarning('Cocaine carries severe risks: heart attack, stroke, seizures, hyperthermia, and addiction. Consider harm reduction alternatives.', 'danger');
            warnings += showWarning('Never mix with alcohol, depressants, or other stimulants. Have emergency contacts ready.', 'danger');

            // Timeline and duration info by route
            const routeInfo = {
                'nasal': { onset: '1-5 minutes', peak: '15-30 minutes', duration: '20-60 minutes', bioavailability: '60-80%' },
                'oral': { onset: '30-60 minutes', peak: '60-90 minutes', duration: '60-120 minutes', bioavailability: '30-40%' },
                'gums': { onset: '5-15 minutes', peak: '15-45 minutes', duration: '30-90 minutes', bioavailability: '40-60%' },
                'smoked': { onset: 'Immediate', peak: '2-5 minutes', duration: '5-15 minutes', bioavailability: '70-90%' },
                'intravenous': { onset: 'Immediate', peak: '1-3 minutes', duration: '5-20 minutes', bioavailability: '100%' }
            };

            const currentRoute = routeInfo[route];

            // Risk color coding
            const riskColors = {
                'high': '#ef4444',
                'extreme': '#7c2d12'
            };

            resultValue.innerHTML = `<span style="color: ${riskColors[riskLevel]}">${Math.round(safeDose)}mg</span>`;
            
            resultDetails.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem;">
                    <div>
                        <h4 style="color: var(--text-primary); margin-bottom: 0.75rem;">💊 Dosage Information</h4>
                        <p><strong>Dose:</strong> ${Math.round(safeDose)}mg</p>
                        <p><strong>Route:</strong> ${route.charAt(0).toUpperCase() + route.slice(1)}</p>
                        <p><strong>Bioavailability:</strong> ${currentRoute.bioavailability}</p>
                        <p><strong>Purity assumption:</strong> 70% (street cocaine)</p>
                        <p><strong>Risk level:</strong> <span style="color: ${riskColors[riskLevel]}">${riskLevel.toUpperCase()}</span></p>
                    </div>
                    <div>
                        <h4 style="color: var(--text-primary); margin-bottom: 0.75rem;">⏱️ ${route.charAt(0).toUpperCase() + route.slice(1)} Timeline</h4>
                        <p><strong>Onset:</strong> ${currentRoute.onset}</p>
                        <p><strong>Peak effects:</strong> ${currentRoute.peak}</p>
                        <p><strong>Duration:</strong> ${currentRoute.duration}</p>
                        <p><strong>Compulsive redosing:</strong> Very high risk</p>
                    </div>
                </div>
                
                <div style="background: var(--background-secondary); padding: 1.25rem; border-radius: var(--radius-md); margin: 1.5rem 0;">
                    <h4 style="color: #ef4444; margin-bottom: 1rem;">🚨 CRITICAL Safety Guidelines</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <div>
                            <strong>Before:</strong><br>
                            • Check blood pressure/heart rate<br>
                            • ZERO alcohol for 24+ hours<br>
                            • Have naloxone and emergency contacts<br>
                            • Remove dangerous objects
                        </div>
                        <div>
                            <strong>During:</strong><br>
                            • Monitor heart rate constantly<br>
                            • Stay cool and hydrated<br>
                            • Avoid combining with any other drugs<br>
                            • Set limits beforehand
                        </div>
                        <div>
                            <strong>Emergency:</strong><br>
                            • Call emergency services for chest pain<br>
                            • Be honest with medical staff<br>
                            • Watch for hyperthermia signs<br>
                            • Aspirin for heart attack symptoms
                        </div>
                    </div>
                </div>
                
                <div class="scientific-note">
                    <strong>Enhanced Calculation Factors:</strong><br>
                    • Base dose (${route}): ${intensityDoses[intensity][route]}mg/kg for ${intensity} intensity<br>
                    • Experience safety factor: ${(experienceMultiplier[experience] * 100).toFixed(0)}% of standard dose<br>
                    • Gender factor: ${(genderMultiplier[gender] * 100).toFixed(0)}% adjustment<br>
                    • Setting safety factor: ${(settingMultiplier[setting] * 100).toFixed(0)}% adjustment<br>
                    • Health safety factor: ${(healthMultiplier[health] * 100).toFixed(0)}% adjustment<br>
                    • Tolerance factor: ${(toleranceFactor * 100).toFixed(0)}% (${lastUse} days since last use)<br>
                    Cocaine blocks dopamine, norepinephrine, and sodium channels with severe cardiovascular effects.
                </div>
                
                ${warnings}
            `;
            resultDiv.style.display = 'block';
        }

        // Enhanced 4-MMC calculator with comprehensive safety factors
        function calculate4MMC() {
            const weight = parseFloat(document.getElementById('mmc-weight').value);
            const gender = document.getElementById('mmc-gender').value;
            const experience = document.getElementById('mmc-experience').value;
            const route = document.getElementById('mmc-route').value;
            const intensity = document.getElementById('mmc-intensity').value;
            const lastUse = parseFloat(document.getElementById('mmc-last-use').value) || 14;
            const setting = document.getElementById('mmc-setting').value;
            const cardiovascular = document.getElementById('mmc-cardiovascular').value;
            const temperature = document.getElementById('mmc-temperature').value;
            const serotonin = document.getElementById('mmc-serotonin').value;
            const resultValue = document.getElementById('mmc-result-value');
            const resultDetails = document.getElementById('mmc-details');
            const resultDiv = document.getElementById('mmc-result');

            if (!validateWeight(weight) || !gender || !experience || !route || !intensity || !setting || 
                !cardiovascular || !temperature || !serotonin) {
                resultValue.innerHTML = 'Please fill in all fields with valid values.';
                resultDetails.innerHTML = '';
                resultDiv.style.display = 'block';
                return;
            }

            // CRITICAL: Check for serious contraindications
            if (cardiovascular === 'serious') {
                resultValue.innerHTML = 'CONTRAINDICATED';
                resultDetails.innerHTML = `
                    <div style="background: linear-gradient(135deg, rgba(139, 69, 19, 0.2) 0%, rgba(139, 69, 19, 0.1) 100%); border: 2px solid #8B4513; border-radius: var(--radius-lg); padding: 2rem; margin: 1rem 0; text-align: center;">
                        <h3 style="color: #8B4513; margin-bottom: 1rem; font-size: 1.5rem;">⚠️ EXTREME CARDIOVASCULAR RISK ⚠️</h3>
                        <p style="color: var(--text-primary); font-size: 1.1rem; font-weight: bold; margin-bottom: 1rem;">
                            4-MMC + Heart Conditions = POTENTIALLY FATAL
                        </p>
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                            4-MMC causes severe cardiovascular strain, hyperthermia, and arrhythmias. With existing heart conditions, this is extremely dangerous.
                        </p>
                        <p style="color: #8B4513; font-weight: bold;">
                            NO SAFE DOSE FOR SERIOUS CARDIOVASCULAR CONDITIONS
                        </p>
                    </div>
                `;
                resultDiv.style.display = 'block';
                return;
            }

            // CRITICAL: Check for dangerous serotonin interactions
            if (serotonin === 'antidepressants') {
                resultValue.innerHTML = 'CONTRAINDICATED';
                resultDetails.innerHTML = `
                    <div style="background: linear-gradient(135deg, rgba(139, 69, 19, 0.2) 0%, rgba(139, 69, 19, 0.1) 100%); border: 2px solid #8B4513; border-radius: var(--radius-lg); padding: 2rem; margin: 1rem 0; text-align: center;">
                        <h3 style="color: #8B4513; margin-bottom: 1rem; font-size: 1.5rem;">⚠️ SEROTONIN SYNDROME RISK ⚠️</h3>
                        <p style="color: var(--text-primary); font-size: 1.1rem; font-weight: bold; margin-bottom: 1rem;">
                            4-MMC + Antidepressants = SEROTONIN SYNDROME
                        </p>
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                            This combination can cause life-threatening serotonin syndrome with hyperthermia, seizures, and cardiovascular collapse.
                        </p>
                        <p style="color: #8B4513; font-weight: bold;">
                            NEVER COMBINE WITH SSRIs, SNRIs, OR MAOIs
                        </p>
                    </div>
                `;
                resultDiv.style.display = 'block';
                return;
            }

            // CORRECTED dosage calculation - FIXED DANGEROUS OVER-DOSING
            const intensityDoses = {
                'threshold': { oral: 0.5, nasal: 0.35, rectal: 0.4, intravenous: 0.2 },
                'light': { oral: 1.0, nasal: 0.7, rectal: 0.8, intravenous: 0.4 },
                'common': { oral: 1.6, nasal: 1.1, rectal: 1.3, intravenous: 0.7 },
                'strong': { oral: 2.4, nasal: 1.7, rectal: 2.0, intravenous: 1.0 }
            };

            const experienceMultiplier = {
                'beginner': 0.6,      // Very conservative for 4-MMC
                'experienced': 0.8,   // Still conservative due to neurotoxicity
                'expert': 0.9         // Slightly less conservative
            };

            // Gender-based metabolism differences
            const genderMultiplier = {
                'male': 1.0,
                'female': 0.85,       // Generally more sensitive
                'other': 0.9          // Conservative approach
            };

            // Setting-based safety adjustments (important for temperature regulation)
            const settingMultiplier = {
                'home': 1.0,          // Safest environment
                'party': 0.85,        // Social setting, some reduction
                'club': 0.7,          // High-stimulation, crowd heat
                'public': 0.6         // Highest risk environment
            };

            // Health-based safety reductions
            const healthMultiplier = {
                'healthy': 1.0,       // No adjustment
                'minor': 0.7,         // Significant reduction
                'moderate': 0.4,      // Major reduction
                'serious': 0.0        // Already handled above
            };

            // Temperature safety factor (crucial for 4-MMC)
            const temperatureMultiplier = {
                'cool': 1.0,          // Ideal conditions
                'warm': 0.8,          // Some risk reduction
                'hot': 0.6            // High hyperthermia risk
            };

            // Serotonin safety factor
            const serotoninMultiplier = {
                'none': 1.0,          // No recent use
                'mdma': 0.5,          // Significant serotonin depletion
                'recent': 0.6,        // Other recent serotonergic use
                'antidepressants': 0.0 // Already handled above
            };

            // Calculate base dose (mg/kg for route)
            let baseDose = weight * intensityDoses[intensity][route];

            // Apply all safety multipliers
            baseDose *= experienceMultiplier[experience] * genderMultiplier[gender] * 
                       settingMultiplier[setting] * healthMultiplier[cardiovascular] * 
                       temperatureMultiplier[temperature] * serotoninMultiplier[serotonin];

            // Tolerance factor (4-MMC has rapid tolerance development) - REDUCED for safety
            let toleranceFactor = 1.0;
            if (lastUse < 3) {
                toleranceFactor = 1.25; // Significant tolerance - REDUCED from 1.5
            } else if (lastUse < 7) {
                toleranceFactor = 1.15; // Moderate tolerance - REDUCED from 1.25
            } else if (lastUse < 14) {
                toleranceFactor = 1.05; // Mild tolerance - REDUCED from 1.1
            }

            baseDose *= toleranceFactor;

            // SAFETY CAP: Never recommend more than 2x base dose regardless of tolerance
            const originalBaseDose = weight * intensityDoses[intensity][route];
            const maxToleranceDose = originalBaseDose * 2.0;
            if (baseDose > maxToleranceDose) {
                baseDose = maxToleranceDose;
                warnings += showWarning('Dose capped at 2x base due to neurotoxicity concerns. 4-MMC is extremely dangerous with frequent use.', 'danger');
            }

            // STRICT safety caps by route - REDUCED to safer levels
            const maxSafeDose = {
                'oral': 100,          // Oral maximum - REDUCED from 200
                'nasal': 75,          // Nasal maximum - REDUCED from 150
                'rectal': 90,         // Rectal maximum - REDUCED from 180
                'intravenous': 40     // IV maximum - REDUCED from 80
            };

            const safeDose = Math.min(baseDose, maxSafeDose[route]);

            // Generate comprehensive warnings
            let warnings = '';
            let riskLevel = 'extreme'; // 4-MMC is always extremely high risk

            // Route-specific warnings
            if (route === 'intravenous') {
                warnings += showWarning('IV 4-MMC carries EXTREME risks: instant overdose, severe addiction, collapsed veins, and cardiac arrest!', 'danger');
            } else if (route === 'nasal') {
                warnings += showWarning('Nasal 4-MMC causes severe nasal damage and has high redose compulsion. Extreme addiction risk!', 'danger');
            }

            // Dose-based warnings
            if (safeDose > maxSafeDose[route] * 0.8) {
                warnings += showWarning('VERY HIGH DOSE - Severe hyperthermia, cardiovascular collapse, and neurotoxicity risk!', 'danger');
            } else if (safeDose > maxSafeDose[route] * 0.6) {
                warnings += showWarning('High dose - Significant hyperthermia and cardiovascular risks!', 'danger');
            }

            // Experience-based warnings
            if (experience === 'beginner') {
                warnings += showWarning('4-MMC is NOT suitable for beginners. Extremely high addiction and neurotoxicity risks.', 'danger');
            }

            // Health-based warnings
            if (cardiovascular === 'moderate') {
                warnings += showWarning('Cardiovascular concerns + 4-MMC = extremely high risk of heart attack or stroke!', 'danger');
            } else if (cardiovascular === 'minor') {
                warnings += showWarning('Monitor cardiovascular signs extremely closely. 4-MMC causes severe cardiac strain.', 'danger');
            }

            // Temperature warnings
            if (temperature === 'hot') {
                warnings += showWarning('HOT environment + 4-MMC = extreme hyperthermia risk. Consider avoiding use entirely.', 'danger');
            } else if (temperature === 'warm') {
                warnings += showWarning('Monitor body temperature constantly. 4-MMC causes dangerous hyperthermia.', 'danger');
            }

            // Serotonin warnings
            if (serotonin === 'mdma') {
                warnings += showWarning('Recent MDMA use detected - serotonin depletion increases neurotoxicity risk significantly!', 'danger');
            } else if (serotonin === 'recent') {
                warnings += showWarning('Recent serotonergic drug use increases risk of adverse reactions and neurotoxicity.', 'danger');
            }

            // Frequency warnings
            if (lastUse < 14) {
                warnings += showWarning('Frequent 4-MMC use causes severe neurotoxicity and rapid addiction development!', 'danger');
            }

            // Universal 4-MMC warnings
            warnings += showWarning('4-MMC is extremely neurotoxic and highly addictive. Maximum 2-3 uses per year recommended.', 'danger');
            warnings += showWarning('Compulsive redosing is common - remove access to additional material beforehand.', 'danger');
            warnings += showWarning('Monitor temperature constantly - hyperthermia can be fatal. Stay cool and hydrated.', 'danger');

            // Timeline and duration info by route
            const routeInfo = {
                'oral': { onset: '30-60 minutes', peak: '1-2 hours', duration: '4-6 hours', bioavailability: '70-90%' },
                'nasal': { onset: '5-15 minutes', peak: '30-60 minutes', duration: '2-4 hours', bioavailability: '80-95%' },
                'rectal': { onset: '15-30 minutes', peak: '45-90 minutes', duration: '3-5 hours', bioavailability: '85-95%' },
                'intravenous': { onset: 'Immediate', peak: '5-15 minutes', duration: '1-3 hours', bioavailability: '100%' }
            };

            const currentRoute = routeInfo[route];

            resultValue.innerHTML = `<span style="color: #7c2d12">${Math.round(safeDose)}mg</span>`;
            
            resultDetails.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem;">
                    <div>
                        <h4 style="color: var(--text-primary); margin-bottom: 0.75rem;">💊 Dosage Information</h4>
                        <p><strong>Dose:</strong> ${Math.round(safeDose)}mg</p>
                        <p><strong>Route:</strong> ${route.charAt(0).toUpperCase() + route.slice(1)}</p>
                        <p><strong>Bioavailability:</strong> ${currentRoute.bioavailability}</p>
                        <p><strong>Purity assumption:</strong> 80% (laboratory grade)</p>
                        <p><strong>Risk level:</strong> <span style="color: #7c2d12">EXTREME</span></p>
                    </div>
                    <div>
                        <h4 style="color: var(--text-primary); margin-bottom: 0.75rem;">⏱️ ${route.charAt(0).toUpperCase() + route.slice(1)} Timeline</h4>
                        <p><strong>Onset:</strong> ${currentRoute.onset}</p>
                        <p><strong>Peak effects:</strong> ${currentRoute.peak}</p>
                        <p><strong>Duration:</strong> ${currentRoute.duration}</p>
                        <p><strong>Compulsive redosing:</strong> Very high risk</p>
                    </div>
                </div>
                
                <div style="background: var(--background-secondary); padding: 1.25rem; border-radius: var(--radius-md); margin: 1.5rem 0;">
                    <h4 style="color: #ef4444; margin-bottom: 1rem;">🚨 CRITICAL Safety Guidelines</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <div>
                            <strong>Before:</strong><br>
                            • Test for purity/adulterants<br>
                            • Remove all additional material<br>
                            • Ensure cool environment<br>
                            • Have emergency contacts ready
                        </div>
                        <div>
                            <strong>During:</strong><br>
                            • Monitor temperature constantly<br>
                            • Stay cool and hydrated<br>
                            • Avoid alcohol and stimulants<br>
                            • Resist redosing urges
                        </div>
                        <div>
                            <strong>After:</strong><br>
                            • 5-HTP supplementation (24h+ later)<br>
                            • Antioxidants (Vitamin C, E)<br>
                            • Wait minimum 3+ months<br>
                            • Monitor mental health
                        </div>
                    </div>
                </div>
                
                <div class="scientific-note">
                    <strong>Enhanced Calculation Factors:</strong><br>
                    • Base dose (${route}): ${intensityDoses[intensity][route]}mg/kg for ${intensity} intensity<br>
                    • Experience safety factor: ${(experienceMultiplier[experience] * 100).toFixed(0)}% of standard dose<br>
                    • Gender factor: ${(genderMultiplier[gender] * 100).toFixed(0)}% adjustment<br>
                    • Setting safety factor: ${(settingMultiplier[setting] * 100).toFixed(0)}% adjustment<br>
                    • Health safety factor: ${(healthMultiplier[cardiovascular] * 100).toFixed(0)}% adjustment<br>
                    • Temperature safety factor: ${(temperatureMultiplier[temperature] * 100).toFixed(0)}% adjustment<br>
                    • Serotonin safety factor: ${(serotoninMultiplier[serotonin] * 100).toFixed(0)}% adjustment<br>
                    • Tolerance factor: ${(toleranceFactor * 100).toFixed(0)}% (${lastUse} days since last use)<br>
                    4-MMC is a potent serotonin-norepinephrine-dopamine reuptake inhibitor with severe neurotoxic potential.
                </div>
                
                ${warnings}
            `;
            resultDiv.style.display = 'block';
        }

        // Enhanced 2-MMC calculator with comprehensive safety factors
        function calculate2MMC() {
            const weight = parseFloat(document.getElementById('2mmc-weight').value);
            const experience = document.getElementById('2mmc-experience').value;
            const route = document.getElementById('2mmc-route').value;
            const lastUse = document.getElementById('2mmc-last-use').value;
            const setting = document.getElementById('2mmc-setting').value;
            const temperature = document.getElementById('2mmc-temperature').value;
            const serotonin = document.getElementById('2mmc-serotonin').value;
            const medical = document.getElementById('2mmc-medical').value;

            // Validation
            if (!weight || weight < 30 || weight > 200) {
                alert('Please enter a valid weight between 30-200 kg');
                return;
            }

            if (!experience || !route || !lastUse || !setting || !temperature || !serotonin || !medical) {
                alert('Please fill in all fields');
                return;
            }

            // Safety checks - absolute contraindications
            if (medical === 'cardiac' || medical === 'hypertension') {
                document.getElementById('2mmc-results').innerHTML = `
                    <div class="safety-warning" style="background: #fef2f2; border: 2px solid #ef4444; padding: 20px; border-radius: 12px;">
                        <h3 style="color: #ef4444;">🚨 ABSOLUTE CONTRAINDICATION</h3>
                        <p><strong>2-MMC is extremely dangerous with your medical condition.</strong></p>
                        <p>Cardiac conditions and hypertension are absolute contraindications for stimulant use. 2-MMC can cause:</p>
                        <ul>
                            <li>Heart attack or cardiac arrest</li>
                            <li>Dangerous blood pressure spikes</li>
                            <li>Stroke</li>
                            <li>Fatal arrhythmias</li>
                        </ul>
                        <p><strong>Please do not use 2-MMC. Consider speaking with a healthcare provider about harm reduction.</strong></p>
                    </div>
                `;
                document.getElementById('2mmc-results').style.display = 'block';
                return;
            }

            if (serotonin === 'mdma' || serotonin === 'ssri') {
                document.getElementById('2mmc-results').innerHTML = `
                    <div class="safety-warning" style="background: #fef2f2; border: 2px solid #ef4444; padding: 20px; border-radius: 12px;">
                        <h3 style="color: #ef4444;">🚨 DANGEROUS DRUG INTERACTION</h3>
                        <p><strong>Combining 2-MMC with recent MDMA use or SSRI medication is extremely dangerous.</strong></p>
                        <p>This combination can cause life-threatening serotonin syndrome with symptoms including:</p>
                        <ul>
                            <li>Hyperthermia (dangerous overheating)</li>
                            <li>Seizures</li>
                            <li>Coma</li>
                            <li>Death</li>
                        </ul>
                        <p><strong>Wait at least 2 weeks after MDMA or consult your doctor about SSRI interactions.</strong></p>
                    </div>
                `;
                document.getElementById('2mmc-results').style.display = 'block';
                return;
            }

            if (lastUse === 'same-day') {
                document.getElementById('2mmc-results').innerHTML = `
                    <div class="safety-warning" style="background: #fef2f2; border: 2px solid #ef4444; padding: 20px; border-radius: 12px;">
                        <h3 style="color: #ef4444;">🚨 DANGEROUS TOLERANCE SITUATION</h3>
                        <p><strong>Using 2-MMC multiple times in one day is extremely dangerous.</strong></p>
                        <p>Same-day redosing leads to:</p>
                        <ul>
                            <li>Exponentially increased overdose risk</li>
                            <li>Severe cardiovascular stress</li>
                            <li>Hyperthermia and dehydration</li>
                            <li>Rapid addiction development</li>
                        </ul>
                        <p><strong>Please wait at least 3-7 days between uses. Consider seeking help if you're struggling with compulsive use.</strong></p>
                    </div>
                `;
                document.getElementById('2mmc-results').style.display = 'block';
                return;
            }

            // Base dosages (mg/kg) - 2-MMC is similar potency to 4-MMC
            const baseDosages = {
                'oral': {
                    'threshold': 0.5,
                    'light': 0.8,
                    'common': 1.2,
                    'danger': 2.0
                },
                'nasal': {
                    'threshold': 0.3,
                    'light': 0.6,
                    'common': 0.9,
                    'danger': 1.4
                }
            };

            // Safety multipliers
            const experienceMultipliers = {
                'first-time': 0.5,
                'inexperienced': 0.7,
                'experienced': 0.9,
                'very-experienced': 1.0
            };

            const settingMultipliers = {
                'home': 1.0,
                'private': 0.9,
                'public': 0.7,
                'outdoor': 0.8
            };

            const temperatureMultipliers = {
                'cool': 1.0,
                'warm': 0.8,
                'hot': 0.6
            };

            const toleranceMultipliers = {
                'never': 1.0,
                '1-week': 1.0,
                '3-days': 0.7,
                '1-day': 0.5
            };

            // Calculate doses
            const baseRoute = baseDosages[route];
            const expMult = experienceMultipliers[experience];
            const setMult = settingMultipliers[setting];
            const tempMult = temperatureMultipliers[temperature];
            const tolMult = toleranceMultipliers[lastUse];

            const safetyFactor = expMult * setMult * tempMult * tolMult;

            const thresholdDose = Math.round(baseRoute.threshold * weight * safetyFactor);
            const lightDose = Math.round(baseRoute.light * weight * safetyFactor);
            const commonDose = Math.round(baseRoute.common * weight * safetyFactor);
            const dangerDose = Math.round(baseRoute.danger * weight * safetyFactor);

            // Update results
            document.getElementById('2mmc-threshold-dose').textContent = `${thresholdDose}mg`;
            document.getElementById('2mmc-light-dose').textContent = `${lightDose}mg`;
            document.getElementById('2mmc-common-dose').textContent = `${commonDose}mg`;
            document.getElementById('2mmc-danger-dose').textContent = `${dangerDose}mg+`;

            // Safety recommendations
            let safetyContent = '<ul>';
            
            if (experience === 'first-time') {
                safetyContent += '<li><strong>First-time use:</strong> Start with threshold dose only. Wait full duration before considering more.</li>';
            }
            
            if (route === 'nasal') {
                safetyContent += '<li><strong>Nasal route:</strong> Extremely caustic - expect severe nasal damage. Consider switching to oral.</li>';
            }
            
            if (temperature === 'hot') {
                safetyContent += '<li><strong>Hot environment:</strong> High hyperthermia risk. Take frequent cooling breaks, stay hydrated.</li>';
            }
            
            if (setting === 'public') {
                safetyContent += '<li><strong>Public setting:</strong> Increased risks due to crowds, heat, and potential for dangerous situations.</li>';
            }

            safetyContent += '<li><strong>Never redose:</strong> 2-MMC has extreme compulsive redosing potential. Pre-measure dose and hide the rest.</li>';
            safetyContent += '<li><strong>Temperature monitoring:</strong> Check body temperature regularly. Seek cooling if overheating.</li>';
            safetyContent += '<li><strong>Hydration:</strong> Sip water regularly but don\'t overhydrate. Electrolytes important.</li>';
            safetyContent += '<li><strong>Have a sitter:</strong> Someone sober should monitor your condition throughout.</li>';
            safetyContent += '<li><strong>Emergency plan:</strong> Know the signs of overdose and have emergency contacts ready.</li>';
            safetyContent += '</ul>';

            document.getElementById('2mmc-safety-content').innerHTML = safetyContent;

            // Show results
            document.getElementById('2mmc-results').style.display = 'block';
        }

        // General tolerance calculator
        function calculateGeneralTolerance() {
            const substance = document.getElementById('tol-substance').value;
            const customHalflife = parseFloat(document.getElementById('tol-custom-halflife').value);
            const previousDose = parseFloat(document.getElementById('tol-previous-dose').value);
            const doseUnit = document.getElementById('tol-dose-unit').value;
            const daysAgo = parseFloat(document.getElementById('tol-days-ago').value);
            const targetEffect = document.getElementById('tol-target-effect').value;
            const effectMultiplier = parseFloat(document.getElementById('tol-effect-multiplier').value) || 1;
            const resultValue = document.getElementById('tolerance-result-value');
            const resultDetails = document.getElementById('tolerance-details');
            const resultDiv = document.getElementById('tolerance-result');

            // Validation
            if (!substance || isNaN(previousDose) || isNaN(daysAgo) || previousDose <= 0 || daysAgo < 0) {
                resultValue.innerHTML = 'Please fill in all required fields with valid values.';
                resultDetails.innerHTML = '';
                resultDiv.style.display = 'block';
                return;
            }

            if (substance === 'custom' && (isNaN(customHalflife) || customHalflife <= 0)) {
                resultValue.innerHTML = 'Please enter a valid custom tolerance half-life.';
                resultDetails.innerHTML = '';
                resultDiv.style.display = 'block';
                return;
            }

            // Tolerance half-lives in days (approximate values based on research)
            const toleranceHalfLives = {
                // Psychedelics - very fast tolerance, cross-tolerance between them
                'lsd': 2.5,               // LSD - classic psychedelic tolerance
                'psilocybin': 3,          // Psilocybin - slightly longer than LSD
                'dmt': 0.5,               // DMT - minimal tolerance buildup
                '2cb': 4,                 // 2C-B - phenethylamine tolerance
                'mescaline': 5,           // Mescaline - longer lasting tolerance
                
                // Entactogens - serotonin-heavy, longer recovery needed
                'mdma': 14,               // MDMA - long recovery due to serotonin depletion
                'mda': 12,                // MDA - similar to MDMA but slightly faster
                '4mmc': 10,               // 4-MMC - cathinone tolerance pattern
                '6apb': 16,               // 6-APB - longer acting, longer tolerance
                
                // Stimulants - dopamine/norepinephrine, moderate tolerance
                'amphetamine': 7,         // Amphetamine - moderate stimulant tolerance
                'dextroamphetamine': 6,   // Dextroamphetamine - slightly faster recovery
                'methamphetamine': 10,    // Methamphetamine - longer tolerance due to neurotoxicity
                'cocaine': 2,             // Cocaine - fast tolerance but quick recovery
                'caffeine': 1,            // Caffeine - daily tolerance cycle
                'modafinil': 3,           // Modafinil - unique mechanism, moderate tolerance
                
                // Dissociatives - NMDA antagonism, variable tolerance
                'ketamine': 4,            // Ketamine - moderate NMDA tolerance
                'dxm': 7,                 // DXM - longer tolerance due to multiple mechanisms
                'pcp': 14,                // PCP - long-lasting tolerance
                '3meopcp': 10,            // 3-MeO-PCP - research chemical, estimated
                
                // Depressants - GABA system, fast tolerance development
                'ghb': 3,                 // GHB - fast tolerance, dangerous escalation
                'gbl': 3,                 // GBL - similar to GHB
                'phenibut': 3,            // Phenibut - rapid tolerance development
                'alcohol': 1,             // Alcohol - daily tolerance cycle
                'xanax': 7,               // Alprazolam - benzodiazepine tolerance
                'valium': 14,             // Diazepam - longer half-life, longer tolerance
                
                // Opioids - significant tolerance and dependence issues
                'morphine': 5,            // Morphine - classic opioid tolerance
                'oxycodone': 4,           // Oxycodone - faster tolerance development
                'tramadol': 6,            // Tramadol - unique mechanism, moderate tolerance
                'kratom': 3,              // Kratom - faster tolerance than traditional opioids
                
                // Cannabis - cannabinoid system
                'thc': 3,                 // THC - fast tolerance development
                'cbd': 0.5,               // CBD - minimal tolerance
                
                // Other
                'nitrous': 0.1,           // N2O - virtually no tolerance
                'custom': customHalflife  // User-defined
            };

            const toleranceHalfLife = toleranceHalfLives[substance];

            // Calculate remaining tolerance (exponential decay)
            const toleranceDecay = Math.pow(0.5, daysAgo / toleranceHalfLife);
            const remainingTolerance = toleranceDecay;

            // Generate tolerance recovery graph
            generateToleranceGraph(toleranceHalfLife, daysAgo, substance);

            // Calculate required dose multiplier based on target effect
            let targetMultiplier = 1;
            switch (targetEffect) {
                case 'same':
                    targetMultiplier = 1;
                    break;
                case 'stronger':
                    targetMultiplier = effectMultiplier;
                    break;
                case 'weaker':
                    targetMultiplier = effectMultiplier;
                    break;
                case 'baseline':
                    targetMultiplier = 1;
                    // For baseline, we calculate what the original dose would be without any tolerance
                    const baselineDose = previousDose / (1 + remainingTolerance);
                    resultValue.innerHTML = `${baselineDose.toFixed(2)} ${doseUnit}`;
                    resultDetails.innerHTML = `
                        <p><strong>Baseline dose (no tolerance):</strong> ${baselineDose.toFixed(2)} ${doseUnit}</p>
                        <p><strong>Your previous dose had tolerance:</strong> ${(remainingTolerance * 100).toFixed(1)}% tolerance present</p>
                        <p><strong>Current tolerance remaining:</strong> ${(toleranceDecay * 100).toFixed(1)}%</p>
                        <div class="scientific-note">
                            <strong>Substance:</strong> ${substance.charAt(0).toUpperCase() + substance.slice(1)}<br>
                            <strong>Tolerance half-life:</strong> ${toleranceHalfLife} days<br>
                            <strong>Recovery rate:</strong> ${((1 - toleranceDecay) * 100).toFixed(1)}% recovered
                        </div>
                    `;
                    resultDiv.style.display = 'block';
                    return;
            }

            // Calculate required dose for target effect
            // If we want the same effect as before, we need to account for current tolerance
            let requiredDose = previousDose * targetMultiplier;

            // Adjust for current tolerance level
            if (remainingTolerance > 0) {
                requiredDose = requiredDose * (1 + remainingTolerance);
            }

            // Safety warnings
            let warnings = '';
            const doseIncrease = requiredDose / previousDose;
            
            if (doseIncrease > 2.0) {
                warnings += showWarning('Very high dose increase required - consider waiting longer for tolerance to decrease!', 'danger');
            } else if (doseIncrease > 1.5) {
                warnings += showWarning('Significant dose increase required - exercise caution and consider harm reduction strategies.');
            }

            if (daysAgo < toleranceHalfLife) {
                warnings += showWarning(`Short time since last dose. Consider waiting longer for better tolerance recovery (half-life: ${toleranceHalfLife} days).`);
            }

            // Substance-specific warnings
            // Psychedelics
            if (['lsd', 'psilocybin', '2cb', 'mescaline'].includes(substance) && daysAgo < 7) {
                warnings += showWarning('Psychedelics: Consider waiting at least 1-2 weeks between uses for full tolerance reset and meaningful experiences.');
            } else if (substance === 'dmt' && daysAgo < 1) {
                warnings += showWarning('DMT: While tolerance is minimal, consider spacing sessions for integration time.');
            
            // Entactogens - Serotonin heavy substances
            } else if (substance === 'mdma' && daysAgo < 30) {
                warnings += showWarning('MDMA: Recommended to wait at least 1-3 months between uses for serotonin recovery and safety.', 'danger');
            } else if (substance === 'mda' && daysAgo < 30) {
                warnings += showWarning('MDA: Similar to MDMA - wait at least 1-3 months between uses for neurotransmitter recovery.', 'danger');
            } else if (substance === '4mmc' && daysAgo < 14) {
                warnings += showWarning('4-MMC: Recommended to wait at least 2 weeks between uses due to neurotoxicity concerns.', 'danger');
            } else if (substance === '6apb' && daysAgo < 45) {
                warnings += showWarning('6-APB: Very long-acting - wait at least 6-8 weeks between uses for safety.', 'danger');
            
            // Stimulants
            } else if (substance === 'methamphetamine') {
                warnings += showWarning('Methamphetamine: High neurotoxicity and addiction potential. Consider harm reduction resources.', 'danger');
            } else if (substance === 'cocaine' && daysAgo < 3) {
                warnings += showWarning('Cocaine: High cardiovascular risks and addiction potential. Frequent use is dangerous.');
            } else if (substance === 'caffeine' && daysAgo < 2) {
                warnings += showWarning('Caffeine: Daily tolerance develops quickly. Consider cycling to maintain effectiveness.');
            
            // Dissociatives
            } else if (substance === 'ketamine' && daysAgo < 7) {
                warnings += showWarning('Ketamine: Frequent use can lead to bladder damage and psychological dependence.');
            } else if (substance === 'pcp') {
                warnings += showWarning('PCP: Extremely unpredictable and dangerous substance. High risk of injury and legal issues.', 'danger');
            
            // Depressants
            } else if (['ghb', 'gbl'].includes(substance)) {
                warnings += showWarning('GHB/GBL: Extremely dangerous - narrow margin between active and lethal dose. Never mix with alcohol!', 'danger');
            } else if (substance === 'alcohol' && daysAgo < 1) {
                warnings += showWarning('Alcohol: Daily use leads to rapid tolerance and health issues. Consider moderation.');
            } else if (['xanax', 'valium'].includes(substance)) {
                warnings += showWarning('Benzodiazepines: High dependence potential and dangerous withdrawals. Medical supervision recommended.', 'danger');
            } else if (substance === 'phenibut' && daysAgo < 3) {
                warnings += showWarning('Phenibut: Rapid tolerance and severe withdrawal syndrome. Maximum 2-3 times per week.', 'danger');
            
            // Opioids
            } else if (['morphine', 'oxycodone', 'tramadol', 'kratom'].includes(substance)) {
                warnings += showWarning('Opioids: Extremely high addiction potential and serious tolerance issues. Consider harm reduction resources.', 'danger');
            
            // Cannabis
            } else if (substance === 'thc' && daysAgo < 2) {
                warnings += showWarning('THC: Rapid tolerance development with daily use. Consider tolerance breaks for effectiveness.');
            
            // Special cases
            } else if (substance === 'nitrous' && daysAgo < 0.1) {
                warnings += showWarning('Nitrous Oxide: Risk of B12 depletion with frequent use. Ensure adequate spacing and B12 supplementation.');
            }

            resultValue.innerHTML = `${requiredDose.toFixed(2)} ${doseUnit}`;
            resultDetails.innerHTML = `
                <p><strong>Previous dose:</strong> ${previousDose} ${doseUnit}</p>
                <p><strong>Required dose:</strong> ${requiredDose.toFixed(2)} ${doseUnit}</p>
                <p><strong>Dose multiplier:</strong> ${doseIncrease.toFixed(2)}x</p>
                <p><strong>Current tolerance:</strong> ${(toleranceDecay * 100).toFixed(1)}% remaining</p>
                <p><strong>Recovery:</strong> ${((1 - toleranceDecay) * 100).toFixed(1)}% recovered</p>
                <div class="scientific-note">
                    <strong>Substance category:</strong> ${substance.charAt(0).toUpperCase() + substance.slice(1)}<br>
                    <strong>Tolerance half-life:</strong> ${toleranceHalfLife} days<br>
                    <strong>Days since last use:</strong> ${daysAgo} days<br>
                    <strong>Target effect:</strong> ${targetEffect === 'same' ? 'Same as previous' : targetEffect}
                    ${targetEffect !== 'same' ? `<br><strong>Effect multiplier:</strong> ${effectMultiplier}x` : ''}
                </div>
                ${warnings}
            `;
            resultDiv.style.display = 'block';
        }

        // Generate tolerance recovery graph
        function generateToleranceGraph(halfLife, currentDay, substance) {
            const canvas = document.getElementById('tolerance-graph');
            const ctx = canvas.getContext('2d');
            
            // Set canvas size
            canvas.width = 600;
            canvas.height = 300;
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Graph dimensions
            const padding = 50;
            const graphWidth = canvas.width - 2 * padding;
            const graphHeight = canvas.height - 2 * padding;
            
            // Time range (show up to 4 half-lives for good visualization)
            const maxDays = Math.max(halfLife * 4, currentDay + halfLife);
            const timeStep = maxDays / 100; // 100 points for smooth curve
            
            // Set up drawing context
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            
            // Draw axes
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            // Y-axis
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, canvas.height - padding);
            // X-axis
            ctx.moveTo(padding, canvas.height - padding);
            ctx.lineTo(canvas.width - padding, canvas.height - padding);
            ctx.stroke();
            
            // Draw tolerance curve
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            let firstPoint = true;
            for (let day = 0; day <= maxDays; day += timeStep) {
                const tolerance = Math.pow(0.5, day / halfLife) * 100; // Convert to percentage
                const x = padding + (day / maxDays) * graphWidth;
                const y = canvas.height - padding - (tolerance / 100) * graphHeight;
                
                if (firstPoint) {
                    ctx.moveTo(x, y);
                    firstPoint = false;
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.stroke();
            
            // Mark current day
            if (currentDay <= maxDays) {
                const currentTolerance = Math.pow(0.5, currentDay / halfLife) * 100;
                const currentX = padding + (currentDay / maxDays) * graphWidth;
                const currentY = canvas.height - padding - (currentTolerance / 100) * graphHeight;
                
                // Draw current day marker
                ctx.fillStyle = '#ff6b6b';
                ctx.beginPath();
                ctx.arc(currentX, currentY, 6, 0, 2 * Math.PI);
                ctx.fill();
                
                // Draw vertical line to current day
                ctx.strokeStyle = '#ff6b6b';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(currentX, currentY);
                ctx.lineTo(currentX, canvas.height - padding);
                ctx.stroke();
                ctx.setLineDash([]);
            }
            
            // Add labels
            ctx.fillStyle = '#333';
            ctx.font = 'bold 14px Segoe UI';
            ctx.textAlign = 'center';
            
            // Y-axis labels (tolerance percentage)
            ctx.textAlign = 'right';
            ctx.textBaseline = 'middle';
            for (let i = 0; i <= 100; i += 25) {
                const y = canvas.height - padding - (i / 100) * graphHeight;
                ctx.fillText(i + '%', padding - 10, y);
                
                // Draw grid lines
                if (i > 0) {
                    ctx.strokeStyle = '#e0e0e0';
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.moveTo(padding, y);
                    ctx.lineTo(canvas.width - padding, y);
                    ctx.stroke();
                }
            }
            
            // X-axis labels (days)
            ctx.textAlign = 'center';
            ctx.textBaseline = 'top';
            const dayStep = Math.ceil(maxDays / 8); // Show about 8 labels
            for (let day = 0; day <= maxDays; day += dayStep) {
                const x = padding + (day / maxDays) * graphWidth;
                ctx.fillStyle = '#333';
                ctx.fillText(Math.round(day) + 'd', x, canvas.height - padding + 5);
                
                // Draw grid lines
                if (day > 0) {
                    ctx.strokeStyle = '#e0e0e0';
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.moveTo(x, padding);
                    ctx.lineTo(x, canvas.height - padding);
                    ctx.stroke();
                }
            }
            
            // Add axis titles
            ctx.fillStyle = '#333';
            ctx.font = 'bold 16px Segoe UI';
            
            // Y-axis title
            ctx.save();
            ctx.translate(20, canvas.height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.textAlign = 'center';
            ctx.fillText('Tolerance Level (%)', 0, 0);
            ctx.restore();
            
            // X-axis title
            ctx.textAlign = 'center';
            ctx.fillText('Days Since Last Use', canvas.width / 2, canvas.height - 10);
            
            // Add half-life marker
            if (halfLife <= maxDays) {
                const halfLifeX = padding + (halfLife / maxDays) * graphWidth;
                ctx.strokeStyle = '#ffa500';
                ctx.lineWidth = 2;
                ctx.setLineDash([10, 5]);
                ctx.beginPath();
                ctx.moveTo(halfLifeX, padding);
                ctx.lineTo(halfLifeX, canvas.height - padding);
                ctx.stroke();
                ctx.setLineDash([]);
                
                // Half-life label
                ctx.fillStyle = '#ffa500';
                ctx.font = 'bold 12px Segoe UI';
                ctx.textAlign = 'center';
                ctx.fillText('Half-life', halfLifeX, padding - 10);
            }
            
            // Add substance name and half-life info
            ctx.fillStyle = '#333';
            ctx.font = 'bold 14px Segoe UI';
            ctx.textAlign = 'left';
            const substanceName = substance.charAt(0).toUpperCase() + substance.slice(1);
            ctx.fillText(`${substanceName} (t½ = ${halfLife}d)`, padding + 10, padding + 20);
        }

        // Show/hide custom half-life input based on substance selection
        function handleSubstanceChange() {
            const substance = document.getElementById('tol-substance').value;
            const customGroup = document.getElementById('custom-halflife-group');
            
            if (substance === 'custom') {
                customGroup.style.display = 'block';
            } else {
                customGroup.style.display = 'none';
            }
        }

        // Show/hide effect multiplier based on target effect
        function handleTargetEffectChange() {
            const targetEffect = document.getElementById('tol-target-effect').value;
            const multiplierGroup = document.getElementById('effect-multiplier-group');
            
            if (targetEffect === 'stronger' || targetEffect === 'weaker') {
                multiplierGroup.style.display = 'block';
            } else {
                multiplierGroup.style.display = 'none';
            }
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize routing system
            RoutingSystem.init();
            
            // Add event listeners for dynamic form behavior
            const substanceSelect = document.getElementById('tol-substance');
            const targetEffectSelect = document.getElementById('tol-target-effect');
            
            if (substanceSelect) {
                substanceSelect.addEventListener('change', handleSubstanceChange);
            }
            
            if (targetEffectSelect) {
                targetEffectSelect.addEventListener('change', handleTargetEffectChange);
            }
            
            // PWA Service Worker Registration
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', function() {
                    navigator.serviceWorker.register('./sw.js')
                        .then(function(registration) {
                            console.log('ServiceWorker registration successful with scope: ', registration.scope);
                        })
                        .catch(function(error) {
                            console.log('ServiceWorker registration failed: ', error);
                        });
                });
            }
            
            // Load user preferences on page load
            loadUserPreferences();
            
            // Add keyboard navigation support
            document.addEventListener('keydown', function(event) {
                // Handle escape key for modals and dropdowns
                if (event.key === 'Escape') {
                    // Close any open modals
                    const modals = document.querySelectorAll('.modal');
                    modals.forEach(modal => {
                        if (modal.style.display === 'block') {
                            modal.style.display = 'none';
                        }
                    });
                    
                    // Close dose menu
                    closeDoseMenu();
                }
                
                // Handle tab navigation
                if (event.key === 'Tab') {
                    // Let browser handle default tab behavior
                    // Add visual focus indicators via CSS
                }
            });
            
            // Add accessibility announcements
            function announceToScreenReader(message) {
                const announcement = document.createElement('div');
                announcement.setAttribute('aria-live', 'polite');
                announcement.setAttribute('aria-atomic', 'true');
                announcement.className = 'sr-only';
                announcement.style.position = 'absolute';
                announcement.style.left = '-10000px';
                announcement.style.width = '1px';
                announcement.style.height = '1px';
                announcement.style.overflow = 'hidden';
                announcement.textContent = message;
                document.body.appendChild(announcement);
                
                setTimeout(() => {
                    document.body.removeChild(announcement);
                }, 1000);
            }
        });

        // Drug Information Navigation
        function showDrugInfo(sectionId) {
            // Hide all drug info content sections
            document.querySelectorAll('.drug-info-content').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show selected section
            const selectedSection = document.getElementById(sectionId);
            if (selectedSection) {
                selectedSection.classList.add('active');
            }
            
            // Update active state on navigation items
            document.querySelectorAll('.drug-info-nav li').forEach(item => {
                item.classList.remove('active');
            });
            
            // Add active class to clicked item if event exists
            if (typeof event !== 'undefined' && event.target) {
                const listItem = event.target.closest('li');
                if (listItem) {
                    listItem.classList.add('active');
                }
            }
        }

        // Initialize drug info when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Set up drug info tab initialization
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                        const drugInfoSection = document.getElementById('drug-info');
                        if (drugInfoSection && drugInfoSection.classList.contains('tabcontent') && drugInfoSection.style.display === 'block') {
                            // Show overview by default when drug info tab is opened
                            setTimeout(() => {
                                showDrugInfo('drug-info-overview');
                                // Set first nav item as active
                                const firstNavItem = document.querySelector('.drug-info-nav li:first-child');
                                if (firstNavItem) {
                                    firstNavItem.classList.add('active');
                                }
                            }, 100);
                        }
                    }
                });
            });

            const drugInfoSection = document.getElementById('drug-info');
            if (drugInfoSection) {
                observer.observe(drugInfoSection, { attributes: true });
            }
        });
    </script>
</body>
</html>
