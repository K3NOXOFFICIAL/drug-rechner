<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K3NOX Drug Calc - Drug Calculator Suite</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Comprehensive drug calculator suite for harm reduction education and scientific research. Calculate dosages for MDMA, LSD, Ketamine, GHB, and more with advanced tolerance modeling and safety features.">
    <meta name="keywords" content="drug calculator, harm reduction, dosage calculator, tolerance calculator, MDMA calculator, LSD calculator, ketamine calculator, substance safety, pharmacology">
    <meta name="author" content="K3NOX Drug Calc">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://k3noxofficial.github.io/drug-rechner/">
    <meta property="og:title" content="K3NOX Drug Calc - Drug Calculator Suite">
    <meta property="og:description" content="🧮 Comprehensive drug calculator suite for harm reduction education and scientific research. Features advanced tolerance modeling, safety warnings, and interactive graphs for 8+ substances.">
    <meta property="og:image" content="https://k3noxofficial.github.io/drug-rechner/preview-image.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="K3NOX Drug Calc">
    <meta property="og:locale" content="en_US">
    
    <!-- Twitter Card -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://k3noxofficial.github.io/drug-rechner/">
    <meta property="twitter:title" content="K3NOX Drug Calc - Drug Calculator Suite">
    <meta property="twitter:description" content="🧮 Comprehensive drug calculator suite for harm reduction education and scientific research. Features advanced tolerance modeling, safety warnings, and interactive graphs for 8+ substances.">
    <meta property="twitter:image" content="https://k3noxofficial.github.io/drug-rechner/preview-image.png">
    <meta property="twitter:image:alt" content="K3NOX Drug Calc - Drug Calculator Suite Interface">
    
    <!-- WhatsApp / Telegram specific -->
    <meta name="telegram:channel" content="@k3noxofficial">
    
    <!-- Additional Meta Tags -->
    <meta name="theme-color" content="#667eea">
    <meta name="msapplication-TileColor" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="K3NOX Drug Calc">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🧮</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🧮</text></svg>">
    
    <!-- Schema.org markup for better SEO -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "K3NOX Drug Calc - Drug Calculator Suite",
        "description": "Comprehensive drug calculator suite for harm reduction education and scientific research with advanced tolerance modeling and safety features.",
        "url": "https://k3noxofficial.github.io/drug-rechner/",
        "applicationCategory": "HealthApplication",
        "operatingSystem": "Any",
        "permissions": "none",
        "isAccessibleForFree": true,
        "creator": {
            "@type": "Organization",
            "name": "K3NOX Drug Calc"
        },
        "audience": {
            "@type": "Audience",
            "audienceType": "Researchers, Harm Reduction Educators"
        },
        "mainEntity": {
            "@type": "Thing",
            "name": "Drug Dosage Calculator",
            "description": "Educational calculator for substance dosage and tolerance modeling"
        }
    }
    </script>
    <style>
        :root {
            --primary-color: #3b82f6;
            --primary-hover: #2563eb;
            --secondary-color: #6b7280;
            --accent-color: #06b6d4;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --background-primary: #000000;
            --background-secondary: #111111;
            --background-card: #1a1a1a;
            --background-elevated: #222222;
            --text-primary: #ffffff;
            --text-secondary: #d1d5db;
            --text-muted: #9ca3af;
            --border-color: #333333;
            --border-light: #2a2a2a;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.3);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.4), 0 2px 4px -2px rgb(0 0 0 / 0.3);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.5), 0 4px 6px -4px rgb(0 0 0 / 0.4);
            --radius-sm: 0.5rem;
            --radius-md: 0.75rem;
            --radius-lg: 1rem;
            --radius-xl: 1.5rem;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background: var(--background-primary);
            min-height: 100vh;
            font-size: 16px;
        }
        
        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        
        /* Header Styling */
        .header {
            padding: 4rem 0 3rem;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
        }
        
        .header-content {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .brand {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .brand-icon {
            font-size: 3.5rem;
            opacity: 0.9;
        }
        
        .brand-text h1 {
            font-size: 3rem;
            font-weight: 600;
            margin: 0;
            color: var(--text-primary);
            letter-spacing: -0.02em;
        }
        
        .brand-tagline {
            font-size: 0.875rem;
            font-weight: 400;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.15em;
            margin-top: 0.5rem;
            display: block;
        }
        
        .header-description {
            font-size: 1rem;
            color: var(--text-secondary);
            font-weight: 400;
            max-width: 500px;
            margin: 0 auto;
        }
        
        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 3rem 0;
            padding: 0;
        }
        
        .tab-btn {
            background: var(--background-secondary);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 1rem 1.5rem;
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            white-space: nowrap;
        }
        
        .tab-btn:hover {
            background: var(--background-elevated);
            color: var(--text-primary);
            border-color: var(--primary-color);
        }
        
        .tab-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        /* Dropdown Styling */
        .dose-calculators {
            position: relative;
            display: inline-block;
        }
        
        .dose-toggle {
            background: var(--background-secondary);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 1rem 1.5rem;
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .dose-toggle:hover {
            background: var(--background-elevated);
            color: var(--text-primary);
            border-color: var(--primary-color);
        }
        
        .dose-toggle.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .dose-menu {
            display: none;
            position: absolute;
            top: calc(100% + 0.5rem);
            left: 50%;
            transform: translateX(-50%);
            background: var(--background-card);
            min-width: 280px;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
            padding: 0.5rem;
            z-index: 1000;
            animation: slideDown 0.2s ease;
        }
        
        .dose-menu.show {
            display: block;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-8px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }
        
        .dose-menu-item {
            display: block;
            width: 100%;
            padding: 0.75rem 1rem;
            border: none;
            background: none;
            text-align: left;
            color: var(--text-secondary);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .dose-menu-item:hover {
            background: var(--background-elevated);
            color: var(--text-primary);
        }
        
        .dose-menu-item.active {
            background: var(--primary-color);
            color: white;
        }
        
        .dropdown-arrow {
            transition: transform 0.2s ease;
            font-size: 0.75rem;
        }
        
        .dose-calculators.open .dropdown-arrow {
            transform: rotate(180deg);
        }
        
        .mobile-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }
        
        .mobile-overlay.show {
            display: block;
        }
        
        /* Calculator Sections */
        .calculator-section {
            display: none;
            background: var(--background-card);
            border-radius: var(--radius-xl);
            padding: 3rem;
            margin-bottom: 3rem;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
            animation: fadeIn 0.3s ease;
        }
        
        .calculator-section.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(20px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }
        
        .calculator-section h2 {
            color: var(--text-primary);
            margin-bottom: 1rem;
            font-size: 2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 1rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 1rem;
        }
        
        .calculator-section p {
            color: var(--text-secondary);
            margin-bottom: 2.5rem;
            font-size: 1rem;
        }
        
        /* Form Styling */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 2.5rem;
        }
        
        .input-group {
            background: var(--background-secondary);
            padding: 1.5rem;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            transition: all 0.2s ease;
        }
        
        .input-group:hover {
            border-color: var(--primary-color);
        }
        
        .input-group:focus-within {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .input-group label {
            display: block;
            margin-bottom: 0.75rem;
            font-weight: 500;
            color: var(--text-primary);
            font-size: 0.875rem;
        }
        
        .input-group input,
        .input-group select {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: 1rem;
            background: var(--background-primary);
            color: var(--text-primary);
            transition: all 0.2s ease;
        }
        
        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .input-group input::placeholder {
            color: var(--text-muted);
        }
        
        /* Button Styling */
        .btn {
            background: var(--primary-color);
            color: white;
            padding: 1.25rem 2.5rem;
            border: none;
            border-radius: var(--radius-lg);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.2s ease;
            display: block;
            margin: 2rem auto;
            min-width: 220px;
            box-shadow: var(--shadow-sm);
        }
        
        .btn:hover {
            background: var(--primary-hover);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        /* Result Styling */
        .result {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: var(--radius-lg);
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: var(--shadow-sm);
        }
        
        .result h3 {
            color: var(--success-color);
            margin-bottom: 1.5rem;
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        .result-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--success-color);
            text-align: center;
            margin: 1.5rem 0;
        }
        
        /* Warning Styling */
        .warning {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(245, 158, 11, 0.05) 100%);
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: var(--radius-lg);
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: var(--shadow-sm);
        }
        
        .warning.danger {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.05) 100%);
            border-color: rgba(239, 68, 68, 0.3);
        }
        
        .warning h4 {
            color: var(--warning-color);
            margin-bottom: 1rem;
            font-size: 1.125rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .warning.danger h4 {
            color: var(--danger-color);
        }
        
        /* Disclaimer */
        .disclaimer {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.05) 100%);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: var(--radius-xl);
            padding: 2.5rem;
            margin-bottom: 3rem;
            color: var(--text-primary);
            box-shadow: var(--shadow-sm);
        }
        
        .disclaimer h4 {
            color: var(--danger-color);
            margin-bottom: 1.5rem;
            font-size: 1.25rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .disclaimer h4::before {
            content: "⚠️";
            font-size: 1.5rem;
        }
        
        /* Scientific Note */
        .scientific-note {
            background: var(--background-secondary);
            border-radius: var(--radius-md);
            padding: 1.25rem;
            margin-top: 1.5rem;
            font-style: italic;
            color: var(--text-secondary);
            border-left: 4px solid var(--secondary-color);
            font-size: 0.875rem;
        }
        
        /* Tooltip */
        .tooltip {
            position: relative;
            cursor: help;
            border-bottom: 1px dotted var(--text-muted);
        }
        
        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--background-elevated);
            color: var(--text-primary);
            padding: 0.75rem 1rem;
            border-radius: var(--radius-md);
            font-size: 0.75rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            z-index: 1000;
            pointer-events: none;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
        }
        
        .tooltip:hover::after {
            opacity: 1;
            visibility: visible;
        }
        
        /* Graph Container */
        .graph-container {
            background: var(--background-secondary);
            border-radius: var(--radius-lg);
            padding: 2rem;
            margin: 2rem 0;
            border: 1px solid var(--border-color);
        }
        
        .graph-wrapper {
            display: flex;
            justify-content: center;
            background: var(--background-card);
            border-radius: var(--radius-md);
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
        }
        
        #tolerance-graph {
            max-width: 100%;
            height: auto;
            border-radius: var(--radius-sm);
        }
        
        .graph-legend {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.875rem;
            color: var(--text-primary);
        }
        
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: var(--radius-sm);
            display: inline-block;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 0 0.75rem;
            }
            
            .header {
                padding: 2rem 0 1.5rem;
            }
            
            .brand {
                flex-direction: column;
                gap: 0.75rem;
            }
            
            .brand-text h1 {
                font-size: 2rem;
            }
            
            .nav-tabs {
                flex-direction: column;
                gap: 0.75rem;
                padding: 1.5rem;
            }
            
            .tab-btn,
            .dose-toggle {
                width: 100%;
                justify-content: center;
            }
            
            .dose-calculators {
                width: 100%;
            }
            
            .dose-menu {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 90%;
                max-width: 320px;
                max-height: 60vh;
                overflow-y: auto;
                border-radius: var(--radius-xl);
                padding: 1rem;
            }
            
            .calculator-section {
                padding: 1.5rem;
                margin-bottom: 1.5rem;
            }
            
            .calculator-section h2 {
                font-size: 1.5rem;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .input-group {
                padding: 1rem;
            }
            
            .result-value {
                font-size: 1.5rem;
            }
            
            .footer-content {
                grid-template-columns: 1fr;
                gap: 2rem;
                text-align: center;
            }
            
            .modal-content {
                width: 95%;
                margin: 1rem auto;
                max-height: 90vh;
            }
        }
        
        @media (max-width: 480px) {
            .brand-icon {
                font-size: 2.5rem;
            }
            
            .brand-text h1 {
                font-size: 1.75rem;
            }
            
            .header-description {
                font-size: 1rem;
            }
            
            .calculator-section {
                padding: 1rem;
            }
            
            .disclaimer {
                padding: 1.5rem;
            }
        }
        
        /* Footer Styling */
        .footer {
            background: var(--background-secondary);
            border-top: 1px solid var(--border-color);
            padding: 3rem 0 2rem;
            margin-top: 4rem;
        }
        
        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 3rem;
            margin-bottom: 2rem;
        }
        
        .footer-section h4 {
            color: var(--text-primary);
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        .footer-section p {
            color: var(--text-secondary);
            font-size: 0.875rem;
            line-height: 1.5;
        }
        
        .footer-links {
            list-style: none;
            padding: 0;
        }
        
        .footer-links li {
            margin-bottom: 0.5rem;
        }
        
        .footer-links a {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.875rem;
            transition: color 0.2s ease;
        }
        
        .footer-links a:hover {
            color: var(--primary-color);
        }
        
        .footer-bottom {
            border-top: 1px solid var(--border-color);
            padding-top: 2rem;
            text-align: center;
        }
        
        .footer-bottom p {
            color: var(--text-muted);
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }
        
        .footer-disclaimer {
            font-size: 0.75rem !important;
            font-style: italic;
        }
        
        /* Modal Styling */
        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
        }
        
        .modal-content {
            background-color: var(--background-card);
            margin: 2rem auto;
            border-radius: var(--radius-xl);
            width: 90%;
            max-width: 800px;
            max-height: 85vh;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-lg);
            animation: modalSlideIn 0.3s ease;
            overflow: hidden;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--border-color);
            background: var(--background-secondary);
        }
        
        .modal-header h2 {
            color: var(--text-primary);
            font-size: 1.5rem;
            font-weight: 600;
            margin: 0;
        }
        
        .close {
            color: var(--text-muted);
            font-size: 2rem;
            font-weight: 300;
            cursor: pointer;
            transition: color 0.2s ease;
            line-height: 1;
        }
        
        .close:hover {
            color: var(--text-primary);
        }
        
        .modal-body {
            padding: 2rem;
            overflow-y: auto;
            max-height: 70vh;
        }
        
        .legal-content {
            color: var(--text-secondary);
            line-height: 1.6;
        }
        
        .legal-content section {
            margin-bottom: 2rem;
        }
        
        .legal-content h3 {
            color: var(--text-primary);
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 0.5rem;
        }
        
        .legal-content p {
            margin-bottom: 1rem;
        }
        
        .legal-content ul {
            margin: 1rem 0;
            padding-left: 1.5rem;
        }
        
        .legal-content li {
            margin-bottom: 0.5rem;
        }
        
        .legal-content strong {
            color: var(--text-primary);
            font-weight: 600;
        }
        
        .legal-update {
            font-style: italic;
            color: var(--text-muted);
            font-size: 0.875rem;
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <div class="brand">
                    <div class="brand-icon">🧮</div>
                    <div class="brand-text">
                        <h1>K3NOX Drug Calc</h1>
                        <span class="brand-tagline">Harm Reduction Calculator Suite</span>
                    </div>
                </div>
                <p class="header-description">Evidence-based dosage calculations for educational and research purposes</p>
            </div>
        </div>

        <div class="disclaimer">
            <h4>For Scientific/Educational Purposes Only</h4>
            <p>This calculator is designed for harm reduction education and scientific research purposes. Always consult medical professionals and follow local laws. Individual responses vary significantly, and these calculations are theoretical models based on general guidelines.</p>
        </div>

        <div class="nav-tabs">
            <button class="tab-btn active" onclick="showCalculator('liquid')">💧 Liquid Dosage</button>
            
            <div class="dose-calculators">
                <button class="dose-toggle" id="dose-calc-btn" onclick="toggleDoseMenu()">
                    💊 Dose Calculator 
                    <span class="dropdown-arrow">▼</span>
                </button>
                <div class="dose-menu" id="dose-menu">
                    <button class="dose-menu-item" onclick="selectDoseCalculator('mdma')">💊 MDMA</button>
                    <button class="dose-menu-item" onclick="selectDoseCalculator('lsd')">🌈 LSD</button>
                    <button class="dose-menu-item" onclick="selectDoseCalculator('ketamine')">🧠 Ketamine</button>
                    <button class="dose-menu-item" onclick="selectDoseCalculator('ghb')">🥤 GHB/GBL</button>
                    <button class="dose-menu-item" onclick="selectDoseCalculator('amphetamines')">⚡ Amphetamines</button>
                    <button class="dose-menu-item" onclick="selectDoseCalculator('cocaine')">❄️ Cocaine</button>
                    <button class="dose-menu-item" onclick="selectDoseCalculator('4mmc')">🔥 4-MMC</button>
                </div>
            </div>
            
            <button class="tab-btn" onclick="showCalculator('tolerance')">⚖️ General Tolerance</button>
        </div>

        <!-- Mobile overlay -->
        <div class="mobile-overlay" id="mobile-overlay" onclick="closeDoseMenu()"></div>

        <!-- Liquid Dosage Calculator -->
        <div id="liquid" class="calculator-section active">
            <h2>� Liquid Dosage Calculator</h2>
            <p>Calculate the amount of medication in a specific volume of liquid</p>

            <div class="form-grid">
                <div class="input-group">
                    <label for="total-volume">Total liquid volume (ml):</label>
                    <input type="number" id="total-volume" placeholder="e.g., 28" step="0.1">
                </div>

                <div class="input-group">
                    <label for="total-medication">Total medication (g):</label>
                    <input type="number" id="total-medication" placeholder="e.g., 4" step="0.01">
                </div>

                <div class="input-group">
                    <label for="drug-purity" class="tooltip" data-tooltip="Purity percentage of the substance">Drug Purity (%):</label>
                    <input type="number" id="drug-purity" value="100" placeholder="e.g., 97" min="0" max="100">
                </div>

                <div class="input-group">
                    <label for="target-volume">Target volume (ml):</label>
                    <input type="number" id="target-volume" value="0.1" placeholder="e.g., 0.1" step="0.01">
                </div>
            </div>

            <button class="btn" onclick="calculateLiquidDose()">Calculate Liquid Dose</button>

            <div id="liquid-result" class="result" style="display: none;">
                <h3>Result:</h3>
                <div class="result-value" id="liquid-result-value"></div>
            </div>
        </div>

        <!-- MDMA Calculator -->
        <div id="mdma" class="calculator-section">
            <h2>💊 MDMA Dose Calculator</h2>
            <p>Calculate MDMA dosage based on body weight and desired intensity</p>

            <div class="form-grid">
                <div class="input-group">
                    <label for="mdma-weight">Body Weight (kg):</label>
                    <input type="number" id="mdma-weight" placeholder="e.g., 70" min="40" max="150">
                </div>

                <div class="input-group">
                    <label for="mdma-gender">Gender:</label>
                    <select id="mdma-gender">
                        <option value="">Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="mdma-experience" class="tooltip" data-tooltip="Your experience level with MDMA">Experience Level:</label>
                    <select id="mdma-experience">
                        <option value="">Select Experience</option>
                        <option value="beginner">Beginner</option>
                        <option value="experienced">Experienced</option>
                        <option value="expert">Expert</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="mdma-intensity">Desired Intensity:</label>
                    <select id="mdma-intensity">
                        <option value="">Select Intensity</option>
                        <option value="threshold">Threshold (mild)</option>
                        <option value="light">Light</option>
                        <option value="common">Common</option>
                        <option value="strong">Strong</option>
                    </select>
                </div>
            </div>

            <button class="btn" onclick="calculateMDMA()">Calculate MDMA Dose</button>

            <div id="mdma-result" class="result" style="display: none;">
                <h3>Recommended MDMA Dose:</h3>
                <div class="result-value" id="mdma-result-value"></div>
                <div id="mdma-details"></div>
            </div>
        </div>

        <!-- LSD Calculator -->
        <div id="lsd" class="calculator-section">
            <h2>🌈 LSD Dose Calculator</h2>
            <p>Calculate LSD dosage based on body weight, gender, and desired intensity</p>

            <div class="form-grid">
                <div class="input-group">
                    <label for="lsd-weight">Body Weight (kg):</label>
                    <input type="number" id="lsd-weight" placeholder="e.g., 70" min="40" max="150">
                </div>

                <div class="input-group">
                    <label for="lsd-gender">Gender:</label>
                    <select id="lsd-gender">
                        <option value="">Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="lsd-experience">Experience Level:</label>
                    <select id="lsd-experience">
                        <option value="">Select Experience</option>
                        <option value="beginner">Beginner</option>
                        <option value="experienced">Experienced</option>
                        <option value="expert">Expert</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="lsd-intensity">Desired Intensity:</label>
                    <select id="lsd-intensity">
                        <option value="">Select Intensity</option>
                        <option value="microdose">Microdose</option>
                        <option value="threshold">Threshold</option>
                        <option value="light">Light</option>
                        <option value="common">Common</option>
                        <option value="strong">Strong</option>
                        <option value="heavy">Heavy</option>
                    </select>
                </div>
            </div>

            <button class="btn" onclick="calculateLSD()">Calculate LSD Dose</button>

            <div id="lsd-result" class="result" style="display: none;">
                <h3>Recommended LSD Dose:</h3>
                <div class="result-value" id="lsd-result-value"></div>
                <div id="lsd-details"></div>
            </div>
        </div>

        <!-- Ketamine Calculator (Enhanced) -->
        <div id="ketamine" class="calculator-section">
            <h2>🧠 Ketamine Tolerance Calculator</h2>
            <p>Calculate adjusted dosage based on previous ketamine use and tolerance buildup</p>

            <div class="form-grid">
                <div class="input-group">
                    <label for="ket-weight">Body Weight (kg):</label>
                    <input type="number" id="ket-weight" placeholder="e.g., 70" min="40" max="150">
                </div>

                <div class="input-group">
                    <label for="ket-previous-dose">Previous dose (mg):</label>
                    <input type="number" id="ket-previous-dose" placeholder="e.g., 100">
                </div>

                <div class="input-group">
                    <label for="ket-days-ago">Days since last dose:</label>
                    <input type="number" id="ket-days-ago" placeholder="e.g., 4" min="0">
                </div>

                <div class="input-group">
                    <label for="ket-desired-effect" class="tooltip" data-tooltip="1=threshold, 10=maximum safe intensity">Desired effect intensity (1-10):</label>
                    <input type="number" id="ket-desired-effect" min="1" max="10" value="7" placeholder="7">
                </div>
            </div>

            <button class="btn" onclick="calculateKetamineTolerance()">Calculate Ketamine Dose</button>

            <div id="ketamine-result" class="result" style="display: none;">
                <h3>Recommended Ketamine Dose:</h3>
                <div class="result-value" id="ket-result-value"></div>
                <div id="ket-details"></div>
                <div class="scientific-note">
                    Based on ketamine's tolerance half-life of approximately 3-5 days and NMDA receptor downregulation patterns.
                </div>
            </div>
        </div>

        <!-- GHB/GBL Calculator -->
        <div id="ghb" class="calculator-section">
            <h2>🥤 GHB/GBL Dose Calculator</h2>
            <p>Calculate GHB or GBL dosage based on body weight and substance type</p>

            <div class="form-grid">
                <div class="input-group">
                    <label for="ghb-weight">Body Weight (kg):</label>
                    <input type="number" id="ghb-weight" placeholder="e.g., 70" min="40" max="150">
                </div>

                <div class="input-group">
                    <label for="ghb-gender">Gender:</label>
                    <select id="ghb-gender">
                        <option value="">Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="ghb-substance">Substance:</label>
                    <select id="ghb-substance">
                        <option value="">Select Substance</option>
                        <option value="ghb">GHB (Sodium γ-hydroxybutyrate)</option>
                        <option value="gbl">GBL (γ-butyrolactone)</option>
                        <option value="bdo">1,4-BDO (1,4-butanediol)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="ghb-intensity">Desired Intensity:</label>
                    <select id="ghb-intensity">
                        <option value="">Select Intensity</option>
                        <option value="threshold">Threshold</option>
                        <option value="light">Light</option>
                        <option value="common">Common</option>
                        <option value="strong">Strong</option>
                    </select>
                </div>
            </div>

            <button class="btn" onclick="calculateGHB()">Calculate GHB/GBL Dose</button>

            <div id="ghb-result" class="result" style="display: none;">
                <h3>Recommended Dose:</h3>
                <div class="result-value" id="ghb-result-value"></div>
                <div id="ghb-details"></div>
            </div>
        </div>

        <!-- Amphetamines Calculator -->
        <div id="amphetamines" class="calculator-section">
            <h2>⚡ Amphetamines Dose Calculator</h2>
            <p>Calculate amphetamine dosage based on body weight and substance type</p>

            <div class="form-grid">
                <div class="input-group">
                    <label for="amp-weight">Body Weight (kg):</label>
                    <input type="number" id="amp-weight" placeholder="e.g., 70" min="40" max="150">
                </div>

                <div class="input-group">
                    <label for="amp-gender">Gender:</label>
                    <select id="amp-gender">
                        <option value="">Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="amp-substance">Substance Type:</label>
                    <select id="amp-substance">
                        <option value="">Select Substance</option>
                        <option value="amphetamine">Amphetamine (racemic)</option>
                        <option value="dextroamphetamine">Dextroamphetamine</option>
                        <option value="methamphetamine">Methamphetamine</option>
                        <option value="adderall">Adderall (mixed salts)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="amp-intensity">Desired Intensity:</label>
                    <select id="amp-intensity">
                        <option value="">Select Intensity</option>
                        <option value="threshold">Threshold</option>
                        <option value="light">Light</option>
                        <option value="common">Common</option>
                        <option value="strong">Strong</option>
                    </select>
                </div>
            </div>

            <button class="btn" onclick="calculateAmphetamines()">Calculate Amphetamine Dose</button>

            <div id="amp-result" class="result" style="display: none;">
                <h3>Recommended Dose:</h3>
                <div class="result-value" id="amp-result-value"></div>
                <div id="amp-details"></div>
            </div>
        </div>

        <!-- Cocaine Calculator -->
        <div id="cocaine" class="calculator-section">
            <h2>❄️ Cocaine Dose Calculator</h2>
            <p>Calculate cocaine dosage based on body weight and route of administration</p>

            <div class="form-grid">
                <div class="input-group">
                    <label for="coc-weight">Body Weight (kg):</label>
                    <input type="number" id="coc-weight" placeholder="e.g., 70" min="40" max="150">
                </div>

                <div class="input-group">
                    <label for="coc-gender">Gender:</label>
                    <select id="coc-gender">
                        <option value="">Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="coc-route">Route of Administration:</label>
                    <select id="coc-route">
                        <option value="">Select Route</option>
                        <option value="nasal">Nasal (snorted)</option>
                        <option value="oral">Oral</option>
                        <option value="iv">Intravenous (IV)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="coc-intensity">Desired Intensity:</label>
                    <select id="coc-intensity">
                        <option value="">Select Intensity</option>
                        <option value="threshold">Threshold</option>
                        <option value="light">Light</option>
                        <option value="common">Common</option>
                        <option value="strong">Strong</option>
                    </select>
                </div>
            </div>

            <button class="btn" onclick="calculateCocaine()">Calculate Cocaine Dose</button>

            <div id="coc-result" class="result" style="display: none;">
                <h3>Recommended Dose:</h3>
                <div class="result-value" id="coc-result-value"></div>
                <div id="coc-details"></div>
            </div>
        </div>

        <!-- 4-MMC Calculator (Enhanced) -->
        <div id="4mmc" class="calculator-section">
            <h2>🔥 4-MMC Tolerance Calculator</h2>
            <p>Calculate adjusted 4-MMC dosage based on previous use and tolerance buildup</p>

            <div class="form-grid">
                <div class="input-group">
                    <label for="mmc-weight">Body Weight (kg):</label>
                    <input type="number" id="mmc-weight" placeholder="e.g., 70" min="40" max="150">
                </div>

                <div class="input-group">
                    <label for="mmc-previous-dose">Previous dose (mg):</label>
                    <input type="number" id="mmc-previous-dose" placeholder="e.g., 150">
                </div>

                <div class="input-group">
                    <label for="mmc-days-ago">Days since last dose:</label>
                    <input type="number" id="mmc-days-ago" placeholder="e.g., 4" min="0">
                </div>

                <div class="input-group">
                    <label for="mmc-desired-effect" class="tooltip" data-tooltip="1=threshold, 10=maximum safe intensity">Desired effect intensity (1-10):</label>
                    <input type="number" id="mmc-desired-effect" min="1" max="10" value="7" placeholder="7">
                </div>
            </div>

            <button class="btn" onclick="calculate4MMCTolerance()">Calculate 4-MMC Dose</button>

            <div id="mmc-result" class="result" style="display: none;">
                <h3>Recommended 4-MMC Dose:</h3>
                <div class="result-value" id="mmc-result-value"></div>
                <div id="mmc-details"></div>
                <div class="scientific-note">
                    Based on 4-MMC's tolerance half-life of approximately 7-14 days and serotonin/dopamine receptor recovery patterns.
                </div>
            </div>
        </div>

        <!-- General Tolerance Calculator -->
        <div id="tolerance" class="calculator-section">
            <h2>⚖️ General Tolerance Calculator</h2>
            <p>Calculate how much you need to take for the same effect based on previous dose and time elapsed</p>

            <div class="form-grid">
                <div class="input-group">
                    <label for="tol-substance" class="tooltip" data-tooltip="Different substances have different tolerance patterns">Substance Type:</label>
                    <select id="tol-substance">
                        <option value="">Select Substance</option>
                        
                        <!-- Psychedelics -->
                        <option value="lsd">LSD (Lysergic Acid Diethylamide)</option>
                        <option value="psilocybin">Psilocybin (Magic Mushrooms)</option>
                        <option value="dmt">DMT (N,N-Dimethyltryptamine)</option>
                        <option value="2cb">2C-B</option>
                        <option value="mescaline">Mescaline</option>
                        
                        <!-- Entactogens -->
                        <option value="mdma">MDMA (Ecstasy/Molly)</option>
                        <option value="mda">MDA (Methylenedioxyamphetamine)</option>
                        <option value="4mmc">4-MMC (Mephedrone)</option>
                        <option value="6apb">6-APB</option>
                        
                        <!-- Stimulants -->
                        <option value="amphetamine">Amphetamine (Speed)</option>
                        <option value="dextroamphetamine">Dextroamphetamine (Dexedrine)</option>
                        <option value="methamphetamine">Methamphetamine (Crystal)</option>
                        <option value="cocaine">Cocaine</option>
                        <option value="caffeine">Caffeine</option>
                        <option value="modafinil">Modafinil</option>
                        
                        <!-- Dissociatives -->
                        <option value="ketamine">Ketamine</option>
                        <option value="dxm">DXM (Dextromethorphan)</option>
                        <option value="pcp">PCP</option>
                        <option value="3meopcp">3-MeO-PCP</option>
                        
                        <!-- Depressants -->
                        <option value="ghb">GHB (γ-Hydroxybutyric acid)</option>
                        <option value="gbl">GBL (γ-Butyrolactone)</option>
                        <option value="phenibut">Phenibut</option>
                        <option value="alcohol">Alcohol (Ethanol)</option>
                        <option value="xanax">Xanax (Alprazolam)</option>
                        <option value="valium">Valium (Diazepam)</option>
                        
                        <!-- Opioids -->
                        <option value="morphine">Morphine</option>
                        <option value="oxycodone">Oxycodone</option>
                        <option value="tramadol">Tramadol</option>
                        <option value="kratom">Kratom</option>
                        
                        <!-- Cannabis -->
                        <option value="thc">THC (Cannabis)</option>
                        <option value="cbd">CBD</option>
                        
                        <!-- Other -->
                        <option value="nitrous">Nitrous Oxide (N2O)</option>
                        <option value="custom">Custom (specify half-life)</option>
                    </select>
                </div>

                <div class="input-group" id="custom-halflife-group" style="display: none;">
                    <label for="tol-custom-halflife" class="tooltip" data-tooltip="Tolerance half-life in days - how long it takes for tolerance to reduce by 50%">Custom Tolerance Half-life (days):</label>
                    <input type="number" id="tol-custom-halflife" placeholder="e.g., 3" min="0.1" step="0.1">
                </div>

                <div class="input-group">
                    <label for="tol-previous-dose">Previous Dose:</label>
                    <input type="number" id="tol-previous-dose" placeholder="e.g., 100" step="0.1">
                </div>

                <div class="input-group">
                    <label for="tol-dose-unit">Dose Unit:</label>
                    <select id="tol-dose-unit">
                        <option value="mg">mg (milligrams)</option>
                        <option value="μg">μg (micrograms)</option>
                        <option value="g">g (grams)</option>
                        <option value="ml">ml (milliliters)</option>
                        <option value="tabs">tabs/hits</option>
                        <option value="custom">custom unit</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="tol-days-ago">Days Since Last Dose:</label>
                    <input type="number" id="tol-days-ago" placeholder="e.g., 4" min="0" step="0.1">
                </div>

                <div class="input-group">
                    <label for="tol-target-effect" class="tooltip" data-tooltip="What effect level are you aiming for?">Target Effect Level:</label>
                    <select id="tol-target-effect">
                        <option value="same">Same as previous dose</option>
                        <option value="stronger">Stronger than previous</option>
                        <option value="weaker">Weaker than previous</option>
                        <option value="baseline">Baseline (no tolerance)</option>
                    </select>
                </div>

                <div class="input-group" id="effect-multiplier-group" style="display: none;">
                    <label for="tol-effect-multiplier" class="tooltip" data-tooltip="How much stronger/weaker? 1.5 = 50% stronger, 0.7 = 30% weaker">Effect Multiplier:</label>
                    <input type="number" id="tol-effect-multiplier" placeholder="e.g., 1.5" min="0.1" max="3" step="0.1" value="1">
                </div>
            </div>

            <button class="btn" onclick="calculateGeneralTolerance()">Calculate Required Dose</button>

            <div id="tolerance-result" class="result" style="display: none;">
                <h3>Recommended Dose for Same Effect:</h3>
                <div class="result-value" id="tolerance-result-value"></div>
                <div id="tolerance-details"></div>
                
                <!-- Tolerance Recovery Graph -->
                <div class="graph-container" id="tolerance-graph-container" style="margin-top: 25px;">
                    <h4 style="text-align: center; color: #155724; margin-bottom: 15px;">📊 Tolerance Recovery Over Time</h4>
                    <div class="graph-wrapper">
                        <canvas id="tolerance-graph" width="600" height="300"></canvas>
                    </div>
                    <div class="graph-legend">
                        <div class="legend-item">
                            <span class="legend-color" style="background: #667eea;"></span>
                            <span>Tolerance Level (%)</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color" style="background: #ff6b6b;"></span>
                            <span>Current Day</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>K3NOX Drug Calc</h4>
                    <p>Educational harm reduction calculator suite</p>
                </div>
                <div class="footer-section">
                    <h4>Legal</h4>
                    <ul class="footer-links">
                        <li><a href="#" onclick="openModal('tos')">Terms of Service</a></li>
                        <li><a href="#" onclick="openModal('privacy')">Privacy Policy</a></li>
                        <li><a href="#" onclick="openModal('usage')">Usage Agreement</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Information</h4>
                    <ul class="footer-links">
                        <li><a href="#" onclick="showCalculator('liquid')">Liquid Calculator</a></li>
                        <li><a href="#" onclick="showCalculator('tolerance')">Tolerance Calculator</a></li>
                        <li><a href="#" onclick="openDoseMenu()">Dose Calculators</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 K3NOX Drug Calc. For educational and harm reduction purposes only.</p>
                <p class="footer-disclaimer">This tool is not a substitute for medical advice. Always consult healthcare professionals.</p>
            </div>
        </div>
    </footer>

    <!-- Legal Document Modals -->
    <!-- Terms of Service Modal -->
    <div id="tos-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Terms of Service</h2>
                <span class="close" onclick="closeModal('tos')">&times;</span>
            </div>
            <div class="modal-body">
                <div class="legal-content">
                    <section>
                        <h3>1. Acceptance of Terms</h3>
                        <p>By accessing and using K3NOX Drug Calc ("the Service"), you accept and agree to be bound by the terms and provision of this agreement. If you do not agree to abide by the above, please do not use this service.</p>
                    </section>
                    
                    <section>
                        <h3>2. Educational Purpose Only</h3>
                        <p>This calculator is designed exclusively for educational and harm reduction purposes. All calculations are theoretical and based on general guidelines found in scientific literature. Individual responses to substances vary significantly due to factors including but not limited to:</p>
                        <ul>
                            <li>Individual metabolism and body chemistry</li>
                            <li>Tolerance levels and previous use history</li>
                            <li>Mental and physical health conditions</li>
                            <li>Concurrent medications or substances</li>
                            <li>Set, setting, and environmental factors</li>
                        </ul>
                    </section>
                    
                    <section>
                        <h3>3. Medical Disclaimer</h3>
                        <p>The information provided by this service is not medical advice and should not be used as a substitute for professional medical consultation, diagnosis, or treatment. Always seek the advice of your physician or other qualified health provider with any questions you may have regarding a medical condition or substance use.</p>
                    </section>
                    
                    <section>
                        <h3>4. Age Restrictions</h3>
                        <p>This service is intended for users who are 18 years of age or older. By using this service, you represent and warrant that you are at least 18 years old. If you are under 18, you must obtain parental or guardian consent before using this service.</p>
                    </section>
                    
                    <section>
                        <h3>5. Prohibited Uses</h3>
                        <p>You agree not to use this service:</p>
                        <ul>
                            <li>For any illegal purpose or to encourage illegal activities</li>
                            <li>To harm, abuse, harass, threaten, or intimidate others</li>
                            <li>To distribute malware or other malicious code</li>
                            <li>To make decisions regarding illegal substance use</li>
                            <li>In violation of any applicable laws or regulations</li>
                        </ul>
                    </section>
                    
                    <section>
                        <h3>6. Limitation of Liability</h3>
                        <p>To the maximum extent permitted by applicable law, K3NOX Drug Calc and its operators shall not be liable for any indirect, incidental, special, consequential, or punitive damages, or any loss of profits or revenues, whether incurred directly or indirectly, or any loss of data, use, goodwill, or other intangible losses resulting from your use of the service.</p>
                    </section>
                    
                    <section>
                        <h3>7. Accuracy of Information</h3>
                        <p>While we strive to provide accurate information based on current scientific knowledge, we make no representations or warranties of any kind about the completeness, accuracy, reliability, suitability, or availability of the information, products, services, or related graphics contained in this service.</p>
                    </section>
                    
                    <section>
                        <h3>8. Changes to Terms</h3>
                        <p>We reserve the right to modify these terms at any time. Changes will be effective immediately upon posting to the service. Your continued use of the service after any such changes constitutes your acceptance of the new terms.</p>
                    </section>
                    
                    <section>
                        <h3>9. Governing Law</h3>
                        <p>These terms shall be governed by and construed in accordance with applicable international laws regarding educational content and harm reduction resources.</p>
                    </section>
                    
                    <p class="legal-update">Last updated: September 22, 2025</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Privacy Policy Modal -->
    <div id="privacy-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Privacy Policy</h2>
                <span class="close" onclick="closeModal('privacy')">&times;</span>
            </div>
            <div class="modal-body">
                <div class="legal-content">
                    <section>
                        <h3>1. Information We Collect</h3>
                        <p>K3NOX Drug Calc is designed with privacy in mind. We collect minimal information to provide our service:</p>
                        <ul>
                            <li><strong>No Personal Data:</strong> We do not collect, store, or process any personal information, names, email addresses, or identifying information.</li>
                            <li><strong>No Calculation History:</strong> All calculations are performed locally in your browser and are not stored or transmitted to our servers.</li>
                            <li><strong>Technical Data:</strong> We may collect basic technical information such as browser type, device type, and general geographic region (country level) for service improvement purposes.</li>
                        </ul>
                    </section>
                    
                    <section>
                        <h3>2. How We Use Information</h3>
                        <p>Any technical information collected is used solely for:</p>
                        <ul>
                            <li>Improving service performance and compatibility</li>
                            <li>Understanding general usage patterns to enhance user experience</li>
                            <li>Ensuring service availability and security</li>
                        </ul>
                    </section>
                    
                    <section>
                        <h3>3. Data Storage and Security</h3>
                        <p>Your privacy and security are paramount:</p>
                        <ul>
                            <li>All calculations are performed locally in your browser</li>
                            <li>No calculation data, inputs, or results are transmitted to our servers</li>
                            <li>No user accounts or profiles are created or maintained</li>
                            <li>No cookies are used for tracking or data collection</li>
                        </ul>
                    </section>
                    
                    <section>
                        <h3>4. Third-Party Services</h3>
                        <p>This service operates independently and does not integrate with third-party analytics, advertising, or data collection services. We do not share any information with third parties.</p>
                    </section>
                    
                    <section>
                        <h3>5. Local Storage</h3>
                        <p>Your browser may store temporary data locally for functionality purposes. This data remains on your device and can be cleared by:</p>
                        <ul>
                            <li>Clearing your browser cache and cookies</li>
                            <li>Using private/incognito browsing mode</li>
                            <li>Manually clearing local storage in browser settings</li>
                        </ul>
                    </section>
                    
                    <section>
                        <h3>6. Your Rights</h3>
                        <p>Since we do not collect personal data, traditional data protection rights do not apply. However, you maintain complete control over:</p>
                        <ul>
                            <li>All input data (entered only locally)</li>
                            <li>Calculation results (computed only locally)</li>
                            <li>Browser storage (can be cleared at any time)</li>
                        </ul>
                    </section>
                    
                    <section>
                        <h3>7. Children's Privacy</h3>
                        <p>This service is not intended for children under 18. We do not knowingly collect any information from children. If you believe a child has accessed this service, please contact us immediately.</p>
                    </section>
                    
                    <section>
                        <h3>8. Changes to Privacy Policy</h3>
                        <p>We may update this privacy policy periodically. Any changes will be posted on this page with an updated revision date. Continued use of the service constitutes acceptance of any changes.</p>
                    </section>
                    
                    <section>
                        <h3>9. Contact Information</h3>
                        <p>If you have questions about this privacy policy or our data practices, please review our terms of service or contact us through official channels.</p>
                    </section>
                    
                    <p class="legal-update">Last updated: September 22, 2025</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Usage Agreement Modal -->
    <div id="usage-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Usage Agreement</h2>
                <span class="close" onclick="closeModal('usage')">&times;</span>
            </div>
            <div class="modal-body">
                <div class="legal-content">
                    <section>
                        <h3>1. Harm Reduction Purpose</h3>
                        <p>K3NOX Drug Calc is a harm reduction educational tool designed to provide theoretical dosage calculations based on scientific literature. This tool is intended to:</p>
                        <ul>
                            <li>Educate users about dosage relationships and tolerance patterns</li>
                            <li>Provide general safety information about various substances</li>
                            <li>Support academic research and educational initiatives</li>
                            <li>Promote understanding of pharmacological principles</li>
                        </ul>
                    </section>
                    
                    <section>
                        <h3>2. Educational Use Only</h3>
                        <p>This calculator is strictly for educational purposes and must not be used to:</p>
                        <ul>
                            <li>Make actual dosing decisions for any controlled or illegal substances</li>
                            <li>Replace professional medical advice or consultation</li>
                            <li>Plan or facilitate illegal drug use</li>
                            <li>Provide medical treatment recommendations</li>
                        </ul>
                    </section>
                    
                    <section>
                        <h3>3. Safety Considerations</h3>
                        <p>Users must understand that:</p>
                        <ul>
                            <li>Individual responses to substances vary dramatically</li>
                            <li>Purity and composition of illegal substances cannot be guaranteed</li>
                            <li>Drug interactions can be dangerous and unpredictable</li>
                            <li>Mental health conditions may affect substance responses</li>
                            <li>No amount of any illegal substance can be considered "safe"</li>
                        </ul>
                    </section>
                    
                    <section>
                        <h3>4. Medical Conditions</h3>
                        <p>This tool does not account for medical conditions that may affect substance metabolism or interactions, including but not limited to:</p>
                        <ul>
                            <li>Cardiovascular conditions</li>
                            <li>Liver or kidney dysfunction</li>
                            <li>Mental health disorders</li>
                            <li>Pregnancy or breastfeeding</li>
                            <li>Concurrent medications</li>
                        </ul>
                    </section>
                    
                    <section>
                        <h3>5. Legal Considerations</h3>
                        <p>Users must be aware that:</p>
                        <ul>
                            <li>Controlled substances are illegal in most jurisdictions</li>
                            <li>Laws vary significantly by location</li>
                            <li>Possession, use, and distribution may carry serious legal penalties</li>
                            <li>This tool does not provide legal advice</li>
                            <li>Users are responsible for understanding and complying with local laws</li>
                        </ul>
                    </section>
                    
                    <section>
                        <h3>6. Emergency Information</h3>
                        <p>In case of medical emergency or adverse reactions:</p>
                        <ul>
                            <li>Call emergency services immediately (911, 112, etc.)</li>
                            <li>Be honest with medical professionals about substance use</li>
                            <li>Do not delay seeking medical attention</li>
                            <li>Consider having naloxone (Narcan) available for opioid emergencies</li>
                        </ul>
                    </section>
                    
                    <section>
                        <h3>7. Accuracy Limitations</h3>
                        <p>This tool's calculations are based on:</p>
                        <ul>
                            <li>General population averages and may not apply to individuals</li>
                            <li>Published research which may have limitations</li>
                            <li>Theoretical models that may not reflect real-world conditions</li>
                            <li>Assumptions about substance purity and consistency</li>
                        </ul>
                    </section>
                    
                    <section>
                        <h3>8. Responsible Use Guidelines</h3>
                        <p>If using this tool for educational purposes, consider:</p>
                        <ul>
                            <li>Researching harm reduction strategies</li>
                            <li>Understanding drug testing and adulterant detection</li>
                            <li>Learning about safer use practices</li>
                            <li>Seeking support for substance use concerns</li>
                            <li>Consulting healthcare providers about substance use</li>
                        </ul>
                    </section>
                    
                    <section>
                        <h3>9. Acknowledgment</h3>
                        <p>By using this service, you acknowledge that you have read, understood, and agree to comply with this usage agreement. You understand the educational nature of this tool and accept full responsibility for any decisions made based on the information provided.</p>
                    </section>
                    
                    <p class="legal-update">Last updated: September 22, 2025</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables for dropdown state
        let isDoseMenuOpen = false;
        
        // Enhanced navigation functionality
        function showCalculator(calculatorId) {
            // Hide all calculators
            const sections = document.querySelectorAll('.calculator-section');
            sections.forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all main tabs
            const tabs = document.querySelectorAll('.tab-btn');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from dose toggle
            const doseToggle = document.getElementById('dose-calc-btn');
            doseToggle.classList.remove('active');
            
            // Remove active class from all dose menu items
            const doseMenuItems = document.querySelectorAll('.dose-menu-item');
            doseMenuItems.forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected calculator
            document.getElementById(calculatorId).classList.add('active');
            
            // Set active states based on calculator type
            const doseCalculators = ['mdma', 'lsd', 'ketamine', 'ghb', 'amphetamines', 'cocaine', '4mmc'];
            
            if (calculatorId === 'liquid') {
                // Activate liquid dosage tab
                document.querySelector('button[onclick="showCalculator(\'liquid\')"]').classList.add('active');
            } else if (calculatorId === 'tolerance') {
                // Activate general tolerance tab
                document.querySelector('button[onclick="showCalculator(\'tolerance\')"]').classList.add('active');
            } else if (doseCalculators.includes(calculatorId)) {
                // Activate dose calculator dropdown button
                doseToggle.classList.add('active');
                // Also activate the specific dropdown item
                const activeMenuItem = document.querySelector(`button[onclick="selectDoseCalculator('${calculatorId}')"]`);
                if (activeMenuItem) {
                    activeMenuItem.classList.add('active');
                }
            }
            
            // Close dose menu if open
            closeDoseMenu();
        }
        
        // Toggle dose calculator menu
        function toggleDoseMenu() {
            const doseMenu = document.getElementById('dose-menu');
            const mobileOverlay = document.getElementById('mobile-overlay');
            const doseCalculators = document.querySelector('.dose-calculators');
            
            if (isDoseMenuOpen) {
                closeDoseMenu();
            } else {
                openDoseMenu();
            }
        }
        
        // Open dose menu
        function openDoseMenu() {
            const doseMenu = document.getElementById('dose-menu');
            const mobileOverlay = document.getElementById('mobile-overlay');
            const doseCalculators = document.querySelector('.dose-calculators');
            
            doseMenu.classList.add('show');
            doseCalculators.classList.add('open');
            
            // Show overlay on mobile
            if (window.innerWidth <= 768) {
                mobileOverlay.classList.add('show');
                document.body.style.overflow = 'hidden'; // Prevent background scrolling
            }
            
            isDoseMenuOpen = true;
        }
        
        // Close dose menu
        function closeDoseMenu() {
            const doseMenu = document.getElementById('dose-menu');
            const mobileOverlay = document.getElementById('mobile-overlay');
            const doseCalculators = document.querySelector('.dose-calculators');
            
            doseMenu.classList.remove('show');
            mobileOverlay.classList.remove('show');
            doseCalculators.classList.remove('open');
            document.body.style.overflow = ''; // Re-enable scrolling
            
            isDoseMenuOpen = false;
        }
        
        // Select dose calculator from menu
        function selectDoseCalculator(calculatorId) {
            showCalculator(calculatorId);
            closeDoseMenu();
        }
        
        // Close menu when clicking outside (for desktop)
        document.addEventListener('click', function(event) {
            const doseCalculators = document.querySelector('.dose-calculators');
            const isClickInside = doseCalculators.contains(event.target);
            
            if (!isClickInside && isDoseMenuOpen && window.innerWidth > 768) {
                closeDoseMenu();
            }
        });
        
        // Handle escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape' && isDoseMenuOpen) {
                closeDoseMenu();
            }
        });
        
        // Handle window resize
        window.addEventListener('resize', function() {
            if (window.innerWidth > 768 && isDoseMenuOpen) {
                // Remove mobile overlay if window becomes larger
                const mobileOverlay = document.getElementById('mobile-overlay');
                mobileOverlay.classList.remove('show');
                document.body.style.overflow = '';
            }
        });

        // Modal functionality
        function openModal(modalId) {
            const modal = document.getElementById(modalId + '-modal');
            if (modal) {
                modal.style.display = 'block';
                document.body.style.overflow = 'hidden';
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId + '-modal');
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = '';
            }
        }

        // Close modal when clicking outside of it
        window.addEventListener('click', function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
                document.body.style.overflow = '';
            }
        });

        // Close modal with escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const openModals = document.querySelectorAll('.modal');
                openModals.forEach(modal => {
                    if (modal.style.display === 'block') {
                        modal.style.display = 'none';
                        document.body.style.overflow = '';
                    }
                });
            }
        });

        // Utility functions
        function showWarning(message, type = 'warning') {
            const warningClass = type === 'danger' ? 'warning danger' : 'warning';
            return `<div class="${warningClass}"><h4>${type === 'danger' ? '⚠️ Danger' : '⚠️ Warning'}</h4><p>${message}</p></div>`;
        }

        function validateWeight(weight) {
            return weight >= 40 && weight <= 150;
        }

        function getGenderMultiplier(gender, substance) {
            const multipliers = {
                'mdma': { male: 1.0, female: 0.85 },
                'lsd': { male: 1.0, female: 0.9 },
                'ghb': { male: 1.0, female: 0.8 },
                'amphetamines': { male: 1.0, female: 0.85 },
                'cocaine': { male: 1.0, female: 0.85 }
            };
            return multipliers[substance] ? multipliers[substance][gender] || 1.0 : 1.0;
        }

        // Enhanced liquid dosage calculator
        function calculateLiquidDose() {
            const totalVolume = parseFloat(document.getElementById('total-volume').value);
            const totalMedication = parseFloat(document.getElementById('total-medication').value);
            const drugPurity = parseFloat(document.getElementById('drug-purity').value);
            const targetVolume = parseFloat(document.getElementById('target-volume').value);
            const resultValue = document.getElementById('liquid-result-value');
            const resultDiv = document.getElementById('liquid-result');

            if (isNaN(totalVolume) || isNaN(totalMedication) || isNaN(targetVolume) || isNaN(drugPurity) || 
                totalVolume <= 0 || drugPurity < 0 || drugPurity > 100) {
                resultValue.innerHTML = 'Please enter valid numbers. Total volume must be > 0. Purity must be between 0 and 100.';
                resultDiv.style.display = 'block';
                return;
            }

            const result = (totalMedication * 1000) / totalVolume * targetVolume * (drugPurity / 100);
            resultValue.innerHTML = `${result.toFixed(2)} mg`;
            resultDiv.style.display = 'block';
        }

        // MDMA calculator
        function calculateMDMA() {
            const weight = parseFloat(document.getElementById('mdma-weight').value);
            const gender = document.getElementById('mdma-gender').value;
            const experience = document.getElementById('mdma-experience').value;
            const intensity = document.getElementById('mdma-intensity').value;
            const resultValue = document.getElementById('mdma-result-value');
            const resultDetails = document.getElementById('mdma-details');
            const resultDiv = document.getElementById('mdma-result');

            if (!validateWeight(weight) || !gender || !experience || !intensity) {
                resultValue.innerHTML = 'Please fill in all fields with valid values.';
                resultDetails.innerHTML = '';
                resultDiv.style.display = 'block';
                return;
            }

            const intensityDoses = {
                'threshold': { base: 0.8, max: 1.0 },
                'light': { base: 1.0, max: 1.3 },
                'common': { base: 1.3, max: 1.7 },
                'strong': { base: 1.7, max: 2.5 }
            };

            const experienceMultiplier = {
                'beginner': 0.8,
                'experienced': 1.0,
                'expert': 1.1
            };

            const genderMultiplier = getGenderMultiplier(gender, 'mdma');
            const baseDose = weight * intensityDoses[intensity].base * genderMultiplier * experienceMultiplier[experience];
            const maxDose = weight * intensityDoses[intensity].max * genderMultiplier * experienceMultiplier[experience];

            // Safety caps
            const absoluteMax = Math.min(200, weight * 2.5);
            const safeDose = Math.min(baseDose, absoluteMax);
            const safeMaxDose = Math.min(maxDose, absoluteMax);

            let warnings = '';
            if (safeDose > 150) {
                warnings += showWarning('High dose - exercise extreme caution! Consider reducing dose.', 'danger');
            } else if (safeDose > 120) {
                warnings += showWarning('Moderate-high dose - be careful and stay hydrated.');
            }

            if (experience === 'beginner' && intensity === 'strong') {
                warnings += showWarning('Strong doses not recommended for beginners. Consider starting with a lower intensity.');
            }

            resultValue.innerHTML = `${Math.round(safeDose)} - ${Math.round(safeMaxDose)} mg`;
            resultDetails.innerHTML = `
                <p><strong>Initial dose:</strong> ${Math.round(safeDose)} mg</p>
                <p><strong>Optional redose:</strong> ${Math.round(safeDose * 0.5)} mg (after 1.5-2 hours)</p>
                <p><strong>Total session:</strong> ≤ ${Math.round(safeMaxDose)} mg</p>
                <div class="scientific-note">
                    <strong>Safety Guidelines:</strong><br>
                    • Wait at least 3 months between uses<br>
                    • Stay hydrated but don't overdrink<br>
                    • Test your substance with reagents<br>
                    • Have a trusted sober friend present
                </div>
                ${warnings}
            `;
            resultDiv.style.display = 'block';
        }

        // LSD calculator
        function calculateLSD() {
            const weight = parseFloat(document.getElementById('lsd-weight').value);
            const gender = document.getElementById('lsd-gender').value;
            const experience = document.getElementById('lsd-experience').value;
            const intensity = document.getElementById('lsd-intensity').value;
            const resultValue = document.getElementById('lsd-result-value');
            const resultDetails = document.getElementById('lsd-details');
            const resultDiv = document.getElementById('lsd-result');

            if (!validateWeight(weight) || !gender || !experience || !intensity) {
                resultValue.innerHTML = 'Please fill in all fields with valid values.';
                resultDetails.innerHTML = '';
                resultDiv.style.display = 'block';
                return;
            }

            const intensityDoses = {
                'microdose': { dose: 10 },
                'threshold': { dose: 25 },
                'light': { dose: 50 },
                'common': { dose: 100 },
                'strong': { dose: 200 },
                'heavy': { dose: 300 }
            };

            const experienceMultiplier = {
                'beginner': 0.7,
                'experienced': 1.0,
                'expert': 1.2
            };

            const genderMultiplier = getGenderMultiplier(gender, 'lsd');
            let dose = intensityDoses[intensity].dose * genderMultiplier * experienceMultiplier[experience];

            // Weight adjustment for LSD (minimal effect)
            const weightFactor = weight / 70; // 70kg reference
            dose *= Math.pow(weightFactor, 0.3); // Weak weight dependence

            let warnings = '';
            if (dose > 250) {
                warnings += showWarning('Very high dose - serious psychological risks!', 'danger');
            } else if (dose > 150) {
                warnings += showWarning('High dose - ensure safe environment and experienced trip sitter.');
            }

            if (experience === 'beginner' && ['strong', 'heavy'].includes(intensity)) {
                warnings += showWarning('High doses not recommended for beginners. Start with threshold or light doses.');
            }

            const duration = intensity === 'microdose' ? '4-6 hours' : 
                           ['threshold', 'light'].includes(intensity) ? '8-10 hours' : '10-12 hours';

            resultValue.innerHTML = `${Math.round(dose)} µg`;
            resultDetails.innerHTML = `
                <p><strong>Expected duration:</strong> ${duration}</p>
                <p><strong>Onset:</strong> 30-90 minutes</p>
                <p><strong>Peak:</strong> 2-4 hours after onset</p>
                <div class="scientific-note">
                    <strong>Safety Guidelines:</strong><br>
                    • Use only in a safe, comfortable environment<br>
                    • Have a trusted, sober trip sitter present<br>
                    • Avoid mixing with other substances<br>
                    • Wait at least 2 weeks between uses for tolerance reset
                </div>
                ${warnings}
            `;
            resultDiv.style.display = 'block';
        }

        // Enhanced ketamine tolerance calculator
        function calculateKetamineTolerance() {
            const weight = parseFloat(document.getElementById('ket-weight').value);
            const previousDose = parseFloat(document.getElementById('ket-previous-dose').value);
            const daysAgo = parseFloat(document.getElementById('ket-days-ago').value);
            const desiredEffect = parseFloat(document.getElementById('ket-desired-effect').value);
            const resultValue = document.getElementById('ket-result-value');
            const resultDetails = document.getElementById('ket-details');
            const resultDiv = document.getElementById('ketamine-result');

            if (!validateWeight(weight) || isNaN(previousDose) || isNaN(daysAgo) || isNaN(desiredEffect) || 
                previousDose <= 0 || daysAgo < 0 || desiredEffect < 1 || desiredEffect > 10) {
                resultValue.innerHTML = 'Please enter valid numbers. Previous dose > 0, days ≥ 0, effect intensity 1-10.';
                resultDetails.innerHTML = '';
                resultDiv.style.display = 'block';
                return;
            }

            const toleranceHalfLife = 4; // days
            const baselineDose = weight * 1.0; // 1mg/kg baseline
            
            // Calculate remaining tolerance
            const toleranceDecay = Math.pow(0.5, daysAgo / toleranceHalfLife);
            const remainingTolerance = toleranceDecay;
            
            // Cross-tolerance factor
            const crossToleranceFactor = Math.log(previousDose / baselineDose + 1) * 0.3;
            const totalTolerance = remainingTolerance * (1 + crossToleranceFactor);
            
            // Effect scaling
            const effectMultiplier = Math.pow(desiredEffect / 7, 1.5);
            
            // Calculate dose
            let recommendedDose = baselineDose * effectMultiplier * (1 + totalTolerance);
            
            // Safety caps
            const maxRecommendedDose = Math.min(previousDose * 2.5, weight * 4);
            if (recommendedDose > maxRecommendedDose) {
                recommendedDose = maxRecommendedDose;
            }

            let warnings = '';
            if (recommendedDose > weight * 3) {
                warnings += showWarning('Very high dose relative to body weight!', 'danger');
            } else if (recommendedDose > weight * 2.5) {
                warnings += showWarning('High dose - exercise extreme caution!');
            }

            resultValue.innerHTML = `${Math.round(recommendedDose)} mg`;
            resultDetails.innerHTML = `
                <p><strong>Tolerance factor:</strong> ${(totalTolerance * 100).toFixed(1)}% remaining</p>
                <p><strong>Recovery rate:</strong> ${((1 - remainingTolerance) * 100).toFixed(1)}% recovered</p>
                <p><strong>Dose per kg:</strong> ${(recommendedDose / weight).toFixed(1)} mg/kg</p>
                <div class="scientific-note">
                    <strong>Route Guidelines:</strong><br>
                    • Oral: Full dose, 45-90 min onset<br>
                    • Nasal: 70% of dose, 10-20 min onset<br>
                    • IM: 60% of dose, 5-15 min onset
                </div>
                ${warnings}
            `;
            resultDiv.style.display = 'block';
        }

        // GHB/GBL calculator
        function calculateGHB() {
            const weight = parseFloat(document.getElementById('ghb-weight').value);
            const gender = document.getElementById('ghb-gender').value;
            const substance = document.getElementById('ghb-substance').value;
            const intensity = document.getElementById('ghb-intensity').value;
            const resultValue = document.getElementById('ghb-result-value');
            const resultDetails = document.getElementById('ghb-details');
            const resultDiv = document.getElementById('ghb-result');

            if (!validateWeight(weight) || !gender || !substance || !intensity) {
                resultValue.innerHTML = 'Please fill in all fields with valid values.';
                resultDetails.innerHTML = '';
                resultDiv.style.display = 'block';
                return;
            }

            const intensityMultipliers = {
                'threshold': 15,
                'light': 25,
                'common': 35,
                'strong': 50
            };

            const substanceMultipliers = {
                'ghb': 1.0,
                'gbl': 0.7,  // GBL is more potent
                'bdo': 1.2   // BDO is less potent
            };

            const genderMultiplier = getGenderMultiplier(gender, 'ghb');
            let dose = (weight / 70) * intensityMultipliers[intensity] * genderMultiplier * substanceMultipliers[substance];

            // Convert to ml for liquid substances
            const density = substance === 'ghb' ? 1.0 : 1.1; // Approximate densities
            const volumeMl = dose / density / 1000; // Convert mg to ml

            let warnings = '';
            if (dose > 60) {
                warnings += showWarning('Very high dose - serious risk of unconsciousness and respiratory depression!', 'danger');
            } else if (dose > 45) {
                warnings += showWarning('High dose - significant risk of loss of consciousness!', 'danger');
            }

            warnings += showWarning('Never mix with alcohol or other depressants - potentially fatal combination!', 'danger');

            const unit = substance === 'ghb' ? 'mg' : 'ml';
            const displayValue = substance === 'ghb' ? Math.round(dose) : volumeMl.toFixed(2);

            resultValue.innerHTML = `${displayValue} ${unit}`;
            resultDetails.innerHTML = `
                <p><strong>Onset:</strong> 15-45 minutes</p>
                <p><strong>Duration:</strong> 2-4 hours</p>
                <p><strong>Peak:</strong> 1-2 hours</p>
                <div class="scientific-note">
                    <strong>Critical Safety Information:</strong><br>
                    • NEVER mix with alcohol or other depressants<br>
                    • Wait at least 2-3 hours between doses<br>
                    • Have a sober person monitor you<br>
                    • Keep emergency contacts ready<br>
                    • The margin between active and dangerous dose is very small
                </div>
                ${warnings}
            `;
            resultDiv.style.display = 'block';
        }

        // Amphetamines calculator
        function calculateAmphetamines() {
            const weight = parseFloat(document.getElementById('amp-weight').value);
            const gender = document.getElementById('amp-gender').value;
            const substance = document.getElementById('amp-substance').value;
            const intensity = document.getElementById('amp-intensity').value;
            const resultValue = document.getElementById('amp-result-value');
            const resultDetails = document.getElementById('amp-details');
            const resultDiv = document.getElementById('amp-result');

            if (!validateWeight(weight) || !gender || !substance || !intensity) {
                resultValue.innerHTML = 'Please fill in all fields with valid values.';
                resultDetails.innerHTML = '';
                resultDiv.style.display = 'block';
                return;
            }

            const intensityMultipliers = {
                'threshold': 0.15,
                'light': 0.3,
                'common': 0.5,
                'strong': 0.8
            };

            const substanceMultipliers = {
                'amphetamine': 1.0,
                'dextroamphetamine': 0.7,
                'methamphetamine': 0.4,
                'adderall': 0.8
            };

            const genderMultiplier = getGenderMultiplier(gender, 'amphetamines');
            let dose = weight * intensityMultipliers[intensity] * genderMultiplier * substanceMultipliers[substance];

            // Safety caps
            const maxDoses = {
                'amphetamine': 60,
                'dextroamphetamine': 40,
                'methamphetamine': 25,
                'adderall': 50
            };

            dose = Math.min(dose, maxDoses[substance]);

            let warnings = '';
            if (dose > maxDoses[substance] * 0.8) {
                warnings += showWarning('High dose - monitor heart rate and blood pressure!');
            }

            if (substance === 'methamphetamine') {
                warnings += showWarning('Methamphetamine has high addiction potential and neurotoxicity risk.', 'danger');
            }

            const duration = {
                'amphetamine': '4-6 hours',
                'dextroamphetamine': '4-6 hours',
                'methamphetamine': '8-12 hours',
                'adderall': '4-6 hours'
            };

            resultValue.innerHTML = `${Math.round(dose)} mg`;
            resultDetails.innerHTML = `
                <p><strong>Duration:</strong> ${duration[substance]}</p>
                <p><strong>Onset:</strong> 30-60 minutes (oral)</p>
                <p><strong>Peak:</strong> 1-3 hours</p>
                <div class="scientific-note">
                    <strong>Safety Guidelines:</strong><br>
                    • Monitor cardiovascular signs<br>
                    • Stay hydrated and eat regularly<br>
                    • Avoid frequent use (tolerance and dependence)<br>
                    • Get adequate sleep between uses
                </div>
                ${warnings}
            `;
            resultDiv.style.display = 'block';
        }

        // Cocaine calculator
        function calculateCocaine() {
            const weight = parseFloat(document.getElementById('coc-weight').value);
            const gender = document.getElementById('coc-gender').value;
            const route = document.getElementById('coc-route').value;
            const intensity = document.getElementById('coc-intensity').value;
            const resultValue = document.getElementById('coc-result-value');
            const resultDetails = document.getElementById('coc-details');
            const resultDiv = document.getElementById('coc-result');

            if (!validateWeight(weight) || !gender || !route || !intensity) {
                resultValue.innerHTML = 'Please fill in all fields with valid values.';
                resultDetails.innerHTML = '';
                resultDiv.style.display = 'block';
                return;
            }

            const routeMultipliers = {
                'oral': 1.0,
                'nasal': 0.7,
                'iv': 0.3
            };

            const intensityMultipliers = {
                'threshold': 0.3,
                'light': 0.6,
                'common': 1.0,
                'strong': 1.5
            };

            const genderMultiplier = getGenderMultiplier(gender, 'cocaine');
            let dose = weight * intensityMultipliers[intensity] * genderMultiplier * routeMultipliers[route];

            // Safety caps by route
            const maxDoses = {
                'oral': 200,
                'nasal': 100,
                'iv': 50
            };

            dose = Math.min(dose, maxDoses[route]);

            let warnings = '';
            if (route === 'iv') {
                warnings += showWarning('Intravenous use carries extreme risks including overdose, infection, and addiction!', 'danger');
            }
            if (dose > maxDoses[route] * 0.7) {
                warnings += showWarning('High dose - serious cardiovascular risks!', 'danger');
            }

            warnings += showWarning('Cocaine has high addiction potential and serious cardiovascular risks.', 'danger');

            const duration = {
                'oral': '30-90 minutes',
                'nasal': '15-30 minutes',
                'iv': '5-15 minutes'
            };

            const onset = {
                'oral': '30-60 minutes',
                'nasal': '1-5 minutes',
                'iv': 'Immediate'
            };

            resultValue.innerHTML = `${Math.round(dose)} mg`;
            resultDetails.innerHTML = `
                <p><strong>Duration:</strong> ${duration[route]}</p>
                <p><strong>Onset:</strong> ${onset[route]}</p>
                <p><strong>Route:</strong> ${route.charAt(0).toUpperCase() + route.slice(1)}</p>
                <div class="scientific-note">
                    <strong>Critical Safety Information:</strong><br>
                    • Never mix with alcohol (creates cocaethylene)<br>
                    • Monitor heart rate and blood pressure<br>
                    • Have emergency contacts ready<br>
                    • High risk of addiction and cardiovascular events<br>
                    • Consider harm reduction alternatives
                </div>
                ${warnings}
            `;
            resultDiv.style.display = 'block';
        }

        // Enhanced 4-MMC tolerance calculator
        function calculate4MMCTolerance() {
            const weight = parseFloat(document.getElementById('mmc-weight').value);
            const previousDose = parseFloat(document.getElementById('mmc-previous-dose').value);
            const daysAgo = parseFloat(document.getElementById('mmc-days-ago').value);
            const desiredEffect = parseFloat(document.getElementById('mmc-desired-effect').value);
            const resultValue = document.getElementById('mmc-result-value');
            const resultDetails = document.getElementById('mmc-details');
            const resultDiv = document.getElementById('mmc-result');

            if (!validateWeight(weight) || isNaN(previousDose) || isNaN(daysAgo) || isNaN(desiredEffect) || 
                previousDose <= 0 || daysAgo < 0 || desiredEffect < 1 || desiredEffect > 10) {
                resultValue.innerHTML = 'Please enter valid numbers. Previous dose > 0, days ≥ 0, effect intensity 1-10.';
                resultDetails.innerHTML = '';
                resultDiv.style.display = 'block';
                return;
            }

            const toleranceHalfLife = 10; // days
            const baselineDose = weight * 1.7; // 1.7mg/kg baseline
            
            // Calculate remaining tolerance
            const toleranceDecay = Math.pow(0.5, daysAgo / toleranceHalfLife);
            const remainingTolerance = toleranceDecay;
            
            // Cross-tolerance factor
            const crossToleranceFactor = Math.log(previousDose / baselineDose + 1) * 0.4;
            const totalTolerance = remainingTolerance * (1 + crossToleranceFactor);
            
            // Effect scaling
            const effectMultiplier = Math.pow(desiredEffect / 7, 1.3);
            
            // Calculate dose
            let recommendedDose = baselineDose * effectMultiplier * (1 + totalTolerance);
            
            // Safety caps
            const maxRecommendedDose = Math.min(previousDose * 2, 300, weight * 4);
            if (recommendedDose > maxRecommendedDose) {
                recommendedDose = maxRecommendedDose;
            }

            let warnings = '';
            if (recommendedDose > 250) {
                warnings += showWarning('Very high dose - serious health risks including hyperthermia and cardiovascular stress!', 'danger');
            } else if (recommendedDose > 200) {
                warnings += showWarning('High dose - significant risks!', 'danger');
            }
            
            if (daysAgo < 7) {
                warnings += showWarning('Consider waiting longer for better serotonin recovery (recommended: 1-2 weeks minimum).');
            }

            warnings += showWarning('4-MMC has neurotoxic potential - limit frequency of use and consider safer alternatives.');

            resultValue.innerHTML = `${Math.round(recommendedDose)} mg`;
            resultDetails.innerHTML = `
                <p><strong>Tolerance factor:</strong> ${(totalTolerance * 100).toFixed(1)}% remaining</p>
                <p><strong>Recovery rate:</strong> ${((1 - remainingTolerance) * 100).toFixed(1)}% recovered</p>
                <p><strong>Dose per kg:</strong> ${(recommendedDose / weight).toFixed(1)} mg/kg</p>
                <div class="scientific-note">
                    <strong>Safety Guidelines:</strong><br>
                    • Wait at least 1-2 weeks between uses<br>
                    • Monitor body temperature and hydration<br>
                    • Use in cool environment with good ventilation<br>
                    • Consider pre/post-loading with supplements (5-HTP, antioxidants)<br>
                    • Maximum 3-4 uses per year recommended
                </div>
                ${warnings}
            `;
            resultDiv.style.display = 'block';
        }

        // General tolerance calculator
        function calculateGeneralTolerance() {
            const substance = document.getElementById('tol-substance').value;
            const customHalflife = parseFloat(document.getElementById('tol-custom-halflife').value);
            const previousDose = parseFloat(document.getElementById('tol-previous-dose').value);
            const doseUnit = document.getElementById('tol-dose-unit').value;
            const daysAgo = parseFloat(document.getElementById('tol-days-ago').value);
            const targetEffect = document.getElementById('tol-target-effect').value;
            const effectMultiplier = parseFloat(document.getElementById('tol-effect-multiplier').value) || 1;
            const resultValue = document.getElementById('tolerance-result-value');
            const resultDetails = document.getElementById('tolerance-details');
            const resultDiv = document.getElementById('tolerance-result');

            // Validation
            if (!substance || isNaN(previousDose) || isNaN(daysAgo) || previousDose <= 0 || daysAgo < 0) {
                resultValue.innerHTML = 'Please fill in all required fields with valid values.';
                resultDetails.innerHTML = '';
                resultDiv.style.display = 'block';
                return;
            }

            if (substance === 'custom' && (isNaN(customHalflife) || customHalflife <= 0)) {
                resultValue.innerHTML = 'Please enter a valid custom tolerance half-life.';
                resultDetails.innerHTML = '';
                resultDiv.style.display = 'block';
                return;
            }

            // Tolerance half-lives in days (approximate values based on research)
            const toleranceHalfLives = {
                // Psychedelics - very fast tolerance, cross-tolerance between them
                'lsd': 2.5,               // LSD - classic psychedelic tolerance
                'psilocybin': 3,          // Psilocybin - slightly longer than LSD
                'dmt': 0.5,               // DMT - minimal tolerance buildup
                '2cb': 4,                 // 2C-B - phenethylamine tolerance
                'mescaline': 5,           // Mescaline - longer lasting tolerance
                
                // Entactogens - serotonin-heavy, longer recovery needed
                'mdma': 14,               // MDMA - long recovery due to serotonin depletion
                'mda': 12,                // MDA - similar to MDMA but slightly faster
                '4mmc': 10,               // 4-MMC - cathinone tolerance pattern
                '6apb': 16,               // 6-APB - longer acting, longer tolerance
                
                // Stimulants - dopamine/norepinephrine, moderate tolerance
                'amphetamine': 7,         // Amphetamine - moderate stimulant tolerance
                'dextroamphetamine': 6,   // Dextroamphetamine - slightly faster recovery
                'methamphetamine': 10,    // Methamphetamine - longer tolerance due to neurotoxicity
                'cocaine': 2,             // Cocaine - fast tolerance but quick recovery
                'caffeine': 1,            // Caffeine - daily tolerance cycle
                'modafinil': 3,           // Modafinil - unique mechanism, moderate tolerance
                
                // Dissociatives - NMDA antagonism, variable tolerance
                'ketamine': 4,            // Ketamine - moderate NMDA tolerance
                'dxm': 7,                 // DXM - longer tolerance due to multiple mechanisms
                'pcp': 14,                // PCP - long-lasting tolerance
                '3meopcp': 10,            // 3-MeO-PCP - research chemical, estimated
                
                // Depressants - GABA system, fast tolerance development
                'ghb': 3,                 // GHB - fast tolerance, dangerous escalation
                'gbl': 3,                 // GBL - similar to GHB
                'phenibut': 3,            // Phenibut - rapid tolerance development
                'alcohol': 1,             // Alcohol - daily tolerance cycle
                'xanax': 7,               // Alprazolam - benzodiazepine tolerance
                'valium': 14,             // Diazepam - longer half-life, longer tolerance
                
                // Opioids - significant tolerance and dependence issues
                'morphine': 5,            // Morphine - classic opioid tolerance
                'oxycodone': 4,           // Oxycodone - faster tolerance development
                'tramadol': 6,            // Tramadol - unique mechanism, moderate tolerance
                'kratom': 3,              // Kratom - faster tolerance than traditional opioids
                
                // Cannabis - cannabinoid system
                'thc': 3,                 // THC - fast tolerance development
                'cbd': 0.5,               // CBD - minimal tolerance
                
                // Other
                'nitrous': 0.1,           // N2O - virtually no tolerance
                'custom': customHalflife  // User-defined
            };

            const toleranceHalfLife = toleranceHalfLives[substance];

            // Calculate remaining tolerance (exponential decay)
            const toleranceDecay = Math.pow(0.5, daysAgo / toleranceHalfLife);
            const remainingTolerance = toleranceDecay;

            // Generate tolerance recovery graph
            generateToleranceGraph(toleranceHalfLife, daysAgo, substance);

            // Calculate required dose multiplier based on target effect
            let targetMultiplier = 1;
            switch (targetEffect) {
                case 'same':
                    targetMultiplier = 1;
                    break;
                case 'stronger':
                    targetMultiplier = effectMultiplier;
                    break;
                case 'weaker':
                    targetMultiplier = effectMultiplier;
                    break;
                case 'baseline':
                    targetMultiplier = 1;
                    // For baseline, we calculate what the original dose would be without any tolerance
                    const baselineDose = previousDose / (1 + remainingTolerance);
                    resultValue.innerHTML = `${baselineDose.toFixed(2)} ${doseUnit}`;
                    resultDetails.innerHTML = `
                        <p><strong>Baseline dose (no tolerance):</strong> ${baselineDose.toFixed(2)} ${doseUnit}</p>
                        <p><strong>Your previous dose had tolerance:</strong> ${(remainingTolerance * 100).toFixed(1)}% tolerance present</p>
                        <p><strong>Current tolerance remaining:</strong> ${(toleranceDecay * 100).toFixed(1)}%</p>
                        <div class="scientific-note">
                            <strong>Substance:</strong> ${substance.charAt(0).toUpperCase() + substance.slice(1)}<br>
                            <strong>Tolerance half-life:</strong> ${toleranceHalfLife} days<br>
                            <strong>Recovery rate:</strong> ${((1 - toleranceDecay) * 100).toFixed(1)}% recovered
                        </div>
                    `;
                    resultDiv.style.display = 'block';
                    return;
            }

            // Calculate required dose for target effect
            // If we want the same effect as before, we need to account for current tolerance
            let requiredDose = previousDose * targetMultiplier;

            // Adjust for current tolerance level
            if (remainingTolerance > 0) {
                requiredDose = requiredDose * (1 + remainingTolerance);
            }

            // Safety warnings
            let warnings = '';
            const doseIncrease = requiredDose / previousDose;
            
            if (doseIncrease > 2.0) {
                warnings += showWarning('Very high dose increase required - consider waiting longer for tolerance to decrease!', 'danger');
            } else if (doseIncrease > 1.5) {
                warnings += showWarning('Significant dose increase required - exercise caution and consider harm reduction strategies.');
            }

            if (daysAgo < toleranceHalfLife) {
                warnings += showWarning(`Short time since last dose. Consider waiting longer for better tolerance recovery (half-life: ${toleranceHalfLife} days).`);
            }

            // Substance-specific warnings
            // Psychedelics
            if (['lsd', 'psilocybin', '2cb', 'mescaline'].includes(substance) && daysAgo < 7) {
                warnings += showWarning('Psychedelics: Consider waiting at least 1-2 weeks between uses for full tolerance reset and meaningful experiences.');
            } else if (substance === 'dmt' && daysAgo < 1) {
                warnings += showWarning('DMT: While tolerance is minimal, consider spacing sessions for integration time.');
            
            // Entactogens - Serotonin heavy substances
            } else if (substance === 'mdma' && daysAgo < 30) {
                warnings += showWarning('MDMA: Recommended to wait at least 1-3 months between uses for serotonin recovery and safety.', 'danger');
            } else if (substance === 'mda' && daysAgo < 30) {
                warnings += showWarning('MDA: Similar to MDMA - wait at least 1-3 months between uses for neurotransmitter recovery.', 'danger');
            } else if (substance === '4mmc' && daysAgo < 14) {
                warnings += showWarning('4-MMC: Recommended to wait at least 2 weeks between uses due to neurotoxicity concerns.', 'danger');
            } else if (substance === '6apb' && daysAgo < 45) {
                warnings += showWarning('6-APB: Very long-acting - wait at least 6-8 weeks between uses for safety.', 'danger');
            
            // Stimulants
            } else if (substance === 'methamphetamine') {
                warnings += showWarning('Methamphetamine: High neurotoxicity and addiction potential. Consider harm reduction resources.', 'danger');
            } else if (substance === 'cocaine' && daysAgo < 3) {
                warnings += showWarning('Cocaine: High cardiovascular risks and addiction potential. Frequent use is dangerous.');
            } else if (substance === 'caffeine' && daysAgo < 2) {
                warnings += showWarning('Caffeine: Daily tolerance develops quickly. Consider cycling to maintain effectiveness.');
            
            // Dissociatives
            } else if (substance === 'ketamine' && daysAgo < 7) {
                warnings += showWarning('Ketamine: Frequent use can lead to bladder damage and psychological dependence.');
            } else if (substance === 'pcp') {
                warnings += showWarning('PCP: Extremely unpredictable and dangerous substance. High risk of injury and legal issues.', 'danger');
            
            // Depressants
            } else if (['ghb', 'gbl'].includes(substance)) {
                warnings += showWarning('GHB/GBL: Extremely dangerous - narrow margin between active and lethal dose. Never mix with alcohol!', 'danger');
            } else if (substance === 'alcohol' && daysAgo < 1) {
                warnings += showWarning('Alcohol: Daily use leads to rapid tolerance and health issues. Consider moderation.');
            } else if (['xanax', 'valium'].includes(substance)) {
                warnings += showWarning('Benzodiazepines: High dependence potential and dangerous withdrawals. Medical supervision recommended.', 'danger');
            } else if (substance === 'phenibut' && daysAgo < 3) {
                warnings += showWarning('Phenibut: Rapid tolerance and severe withdrawal syndrome. Maximum 2-3 times per week.', 'danger');
            
            // Opioids
            } else if (['morphine', 'oxycodone', 'tramadol', 'kratom'].includes(substance)) {
                warnings += showWarning('Opioids: Extremely high addiction potential and serious tolerance issues. Consider harm reduction resources.', 'danger');
            
            // Cannabis
            } else if (substance === 'thc' && daysAgo < 2) {
                warnings += showWarning('THC: Rapid tolerance development with daily use. Consider tolerance breaks for effectiveness.');
            
            // Special cases
            } else if (substance === 'nitrous' && daysAgo < 0.1) {
                warnings += showWarning('Nitrous Oxide: Risk of B12 depletion with frequent use. Ensure adequate spacing and B12 supplementation.');
            }

            resultValue.innerHTML = `${requiredDose.toFixed(2)} ${doseUnit}`;
            resultDetails.innerHTML = `
                <p><strong>Previous dose:</strong> ${previousDose} ${doseUnit}</p>
                <p><strong>Required dose:</strong> ${requiredDose.toFixed(2)} ${doseUnit}</p>
                <p><strong>Dose multiplier:</strong> ${doseIncrease.toFixed(2)}x</p>
                <p><strong>Current tolerance:</strong> ${(toleranceDecay * 100).toFixed(1)}% remaining</p>
                <p><strong>Recovery:</strong> ${((1 - toleranceDecay) * 100).toFixed(1)}% recovered</p>
                <div class="scientific-note">
                    <strong>Substance category:</strong> ${substance.charAt(0).toUpperCase() + substance.slice(1)}<br>
                    <strong>Tolerance half-life:</strong> ${toleranceHalfLife} days<br>
                    <strong>Days since last use:</strong> ${daysAgo} days<br>
                    <strong>Target effect:</strong> ${targetEffect === 'same' ? 'Same as previous' : targetEffect}
                    ${targetEffect !== 'same' ? `<br><strong>Effect multiplier:</strong> ${effectMultiplier}x` : ''}
                </div>
                ${warnings}
            `;
            resultDiv.style.display = 'block';
        }

        // Generate tolerance recovery graph
        function generateToleranceGraph(halfLife, currentDay, substance) {
            const canvas = document.getElementById('tolerance-graph');
            const ctx = canvas.getContext('2d');
            
            // Set canvas size
            canvas.width = 600;
            canvas.height = 300;
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Graph dimensions
            const padding = 50;
            const graphWidth = canvas.width - 2 * padding;
            const graphHeight = canvas.height - 2 * padding;
            
            // Time range (show up to 4 half-lives for good visualization)
            const maxDays = Math.max(halfLife * 4, currentDay + halfLife);
            const timeStep = maxDays / 100; // 100 points for smooth curve
            
            // Set up drawing context
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            
            // Draw axes
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            // Y-axis
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, canvas.height - padding);
            // X-axis
            ctx.moveTo(padding, canvas.height - padding);
            ctx.lineTo(canvas.width - padding, canvas.height - padding);
            ctx.stroke();
            
            // Draw tolerance curve
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            let firstPoint = true;
            for (let day = 0; day <= maxDays; day += timeStep) {
                const tolerance = Math.pow(0.5, day / halfLife) * 100; // Convert to percentage
                const x = padding + (day / maxDays) * graphWidth;
                const y = canvas.height - padding - (tolerance / 100) * graphHeight;
                
                if (firstPoint) {
                    ctx.moveTo(x, y);
                    firstPoint = false;
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.stroke();
            
            // Mark current day
            if (currentDay <= maxDays) {
                const currentTolerance = Math.pow(0.5, currentDay / halfLife) * 100;
                const currentX = padding + (currentDay / maxDays) * graphWidth;
                const currentY = canvas.height - padding - (currentTolerance / 100) * graphHeight;
                
                // Draw current day marker
                ctx.fillStyle = '#ff6b6b';
                ctx.beginPath();
                ctx.arc(currentX, currentY, 6, 0, 2 * Math.PI);
                ctx.fill();
                
                // Draw vertical line to current day
                ctx.strokeStyle = '#ff6b6b';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(currentX, currentY);
                ctx.lineTo(currentX, canvas.height - padding);
                ctx.stroke();
                ctx.setLineDash([]);
            }
            
            // Add labels
            ctx.fillStyle = '#333';
            ctx.font = 'bold 14px Segoe UI';
            ctx.textAlign = 'center';
            
            // Y-axis labels (tolerance percentage)
            ctx.textAlign = 'right';
            ctx.textBaseline = 'middle';
            for (let i = 0; i <= 100; i += 25) {
                const y = canvas.height - padding - (i / 100) * graphHeight;
                ctx.fillText(i + '%', padding - 10, y);
                
                // Draw grid lines
                if (i > 0) {
                    ctx.strokeStyle = '#e0e0e0';
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.moveTo(padding, y);
                    ctx.lineTo(canvas.width - padding, y);
                    ctx.stroke();
                }
            }
            
            // X-axis labels (days)
            ctx.textAlign = 'center';
            ctx.textBaseline = 'top';
            const dayStep = Math.ceil(maxDays / 8); // Show about 8 labels
            for (let day = 0; day <= maxDays; day += dayStep) {
                const x = padding + (day / maxDays) * graphWidth;
                ctx.fillStyle = '#333';
                ctx.fillText(Math.round(day) + 'd', x, canvas.height - padding + 5);
                
                // Draw grid lines
                if (day > 0) {
                    ctx.strokeStyle = '#e0e0e0';
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.moveTo(x, padding);
                    ctx.lineTo(x, canvas.height - padding);
                    ctx.stroke();
                }
            }
            
            // Add axis titles
            ctx.fillStyle = '#333';
            ctx.font = 'bold 16px Segoe UI';
            
            // Y-axis title
            ctx.save();
            ctx.translate(20, canvas.height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.textAlign = 'center';
            ctx.fillText('Tolerance Level (%)', 0, 0);
            ctx.restore();
            
            // X-axis title
            ctx.textAlign = 'center';
            ctx.fillText('Days Since Last Use', canvas.width / 2, canvas.height - 10);
            
            // Add half-life marker
            if (halfLife <= maxDays) {
                const halfLifeX = padding + (halfLife / maxDays) * graphWidth;
                ctx.strokeStyle = '#ffa500';
                ctx.lineWidth = 2;
                ctx.setLineDash([10, 5]);
                ctx.beginPath();
                ctx.moveTo(halfLifeX, padding);
                ctx.lineTo(halfLifeX, canvas.height - padding);
                ctx.stroke();
                ctx.setLineDash([]);
                
                // Half-life label
                ctx.fillStyle = '#ffa500';
                ctx.font = 'bold 12px Segoe UI';
                ctx.textAlign = 'center';
                ctx.fillText('Half-life', halfLifeX, padding - 10);
            }
            
            // Add substance name and half-life info
            ctx.fillStyle = '#333';
            ctx.font = 'bold 14px Segoe UI';
            ctx.textAlign = 'left';
            const substanceName = substance.charAt(0).toUpperCase() + substance.slice(1);
            ctx.fillText(`${substanceName} (t½ = ${halfLife}d)`, padding + 10, padding + 20);
        }

        // Show/hide custom half-life input based on substance selection
        function handleSubstanceChange() {
            const substance = document.getElementById('tol-substance').value;
            const customGroup = document.getElementById('custom-halflife-group');
            
            if (substance === 'custom') {
                customGroup.style.display = 'block';
            } else {
                customGroup.style.display = 'none';
            }
        }

        // Show/hide effect multiplier based on target effect
        function handleTargetEffectChange() {
            const targetEffect = document.getElementById('tol-target-effect').value;
            const multiplierGroup = document.getElementById('effect-multiplier-group');
            
            if (targetEffect === 'stronger' || targetEffect === 'weaker') {
                multiplierGroup.style.display = 'block';
            } else {
                multiplierGroup.style.display = 'none';
            }
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            // Show liquid calculator by default
            showCalculator('liquid');
            
            // Add event listeners for dynamic form behavior
            const substanceSelect = document.getElementById('tol-substance');
            const targetEffectSelect = document.getElementById('tol-target-effect');
            
            if (substanceSelect) {
                substanceSelect.addEventListener('change', handleSubstanceChange);
            }
            
            if (targetEffectSelect) {
                targetEffectSelect.addEventListener('change', handleTargetEffectChange);
            }
        });
    </script>
</body>
</html>
